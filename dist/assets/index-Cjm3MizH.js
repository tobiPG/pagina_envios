(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function _E(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ny={exports:{}},Ed={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0;function nN(){if(N0)return Ed;N0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,l,u){var f=null;if(u!==void 0&&(f=""+u),l.key!==void 0&&(f=""+l.key),"key"in l){u={};for(var y in l)y!=="key"&&(u[y]=l[y])}else u=l;return l=u.ref,{$$typeof:n,type:r,key:f,ref:l!==void 0?l:null,props:u}}return Ed.Fragment=e,Ed.jsx=t,Ed.jsxs=t,Ed}var C0;function iN(){return C0||(C0=1,ny.exports=nN()),ny.exports}var a=iN(),iy={exports:{}},Vt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R0;function rN(){if(R0)return Vt;R0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),R=Symbol.iterator;function I(A){return A===null||typeof A!="object"?null:(A=R&&A[R]||A["@@iterator"],typeof A=="function"?A:null)}var G={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,Z={};function F(A,W,$){this.props=A,this.context=W,this.refs=Z,this.updater=$||G}F.prototype.isReactComponent={},F.prototype.setState=function(A,W){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,W,"setState")},F.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function Q(){}Q.prototype=F.prototype;function se(A,W,$){this.props=A,this.context=W,this.refs=Z,this.updater=$||G}var ue=se.prototype=new Q;ue.constructor=se,H(ue,F.prototype),ue.isPureReactComponent=!0;var we=Array.isArray,Ce={H:null,A:null,T:null,S:null,V:null},Ue=Object.prototype.hasOwnProperty;function P(A,W,$,te,me,J){return $=J.ref,{$$typeof:n,type:A,key:W,ref:$!==void 0?$:null,props:J}}function M(A,W){return P(A.type,W,void 0,void 0,void 0,A.props)}function D(A){return typeof A=="object"&&A!==null&&A.$$typeof===n}function U(A){var W={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function($){return W[$]})}var k=/\/+/g;function q(A,W){return typeof A=="object"&&A!==null&&A.key!=null?U(""+A.key):W.toString(36)}function j(){}function de(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(j,j):(A.status="pending",A.then(function(W){A.status==="pending"&&(A.status="fulfilled",A.value=W)},function(W){A.status==="pending"&&(A.status="rejected",A.reason=W)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function ae(A,W,$,te,me){var J=typeof A;(J==="undefined"||J==="boolean")&&(A=null);var oe=!1;if(A===null)oe=!0;else switch(J){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(A.$$typeof){case n:case e:oe=!0;break;case w:return oe=A._init,ae(oe(A._payload),W,$,te,me)}}if(oe)return me=me(A),oe=te===""?"."+q(A,0):te,we(me)?($="",oe!=null&&($=oe.replace(k,"$&/")+"/"),ae(me,W,$,"",function(Ae){return Ae})):me!=null&&(D(me)&&(me=M(me,$+(me.key==null||A&&A.key===me.key?"":(""+me.key).replace(k,"$&/")+"/")+oe)),W.push(me)),1;oe=0;var re=te===""?".":te+":";if(we(A))for(var he=0;he<A.length;he++)te=A[he],J=re+q(te,he),oe+=ae(te,W,$,J,me);else if(he=I(A),typeof he=="function")for(A=he.call(A),he=0;!(te=A.next()).done;)te=te.value,J=re+q(te,he++),oe+=ae(te,W,$,J,me);else if(J==="object"){if(typeof A.then=="function")return ae(de(A),W,$,te,me);throw W=String(A),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return oe}function Y(A,W,$){if(A==null)return A;var te=[],me=0;return ae(A,te,"","",function(J){return W.call($,J,me++)}),te}function ye(A){if(A._status===-1){var W=A._result;W=W(),W.then(function($){(A._status===0||A._status===-1)&&(A._status=1,A._result=$)},function($){(A._status===0||A._status===-1)&&(A._status=2,A._result=$)}),A._status===-1&&(A._status=0,A._result=W)}if(A._status===1)return A._result.default;throw A._result}var ie=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function be(){}return Vt.Children={map:Y,forEach:function(A,W,$){Y(A,function(){W.apply(this,arguments)},$)},count:function(A){var W=0;return Y(A,function(){W++}),W},toArray:function(A){return Y(A,function(W){return W})||[]},only:function(A){if(!D(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},Vt.Component=F,Vt.Fragment=t,Vt.Profiler=l,Vt.PureComponent=se,Vt.StrictMode=r,Vt.Suspense=_,Vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ce,Vt.__COMPILER_RUNTIME={__proto__:null,c:function(A){return Ce.H.useMemoCache(A)}},Vt.cache=function(A){return function(){return A.apply(null,arguments)}},Vt.cloneElement=function(A,W,$){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var te=H({},A.props),me=A.key,J=void 0;if(W!=null)for(oe in W.ref!==void 0&&(J=void 0),W.key!==void 0&&(me=""+W.key),W)!Ue.call(W,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&W.ref===void 0||(te[oe]=W[oe]);var oe=arguments.length-2;if(oe===1)te.children=$;else if(1<oe){for(var re=Array(oe),he=0;he<oe;he++)re[he]=arguments[he+2];te.children=re}return P(A.type,me,void 0,void 0,J,te)},Vt.createContext=function(A){return A={$$typeof:f,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:u,_context:A},A},Vt.createElement=function(A,W,$){var te,me={},J=null;if(W!=null)for(te in W.key!==void 0&&(J=""+W.key),W)Ue.call(W,te)&&te!=="key"&&te!=="__self"&&te!=="__source"&&(me[te]=W[te]);var oe=arguments.length-2;if(oe===1)me.children=$;else if(1<oe){for(var re=Array(oe),he=0;he<oe;he++)re[he]=arguments[he+2];me.children=re}if(A&&A.defaultProps)for(te in oe=A.defaultProps,oe)me[te]===void 0&&(me[te]=oe[te]);return P(A,J,void 0,void 0,null,me)},Vt.createRef=function(){return{current:null}},Vt.forwardRef=function(A){return{$$typeof:y,render:A}},Vt.isValidElement=D,Vt.lazy=function(A){return{$$typeof:w,_payload:{_status:-1,_result:A},_init:ye}},Vt.memo=function(A,W){return{$$typeof:v,type:A,compare:W===void 0?null:W}},Vt.startTransition=function(A){var W=Ce.T,$={};Ce.T=$;try{var te=A(),me=Ce.S;me!==null&&me($,te),typeof te=="object"&&te!==null&&typeof te.then=="function"&&te.then(be,ie)}catch(J){ie(J)}finally{Ce.T=W}},Vt.unstable_useCacheRefresh=function(){return Ce.H.useCacheRefresh()},Vt.use=function(A){return Ce.H.use(A)},Vt.useActionState=function(A,W,$){return Ce.H.useActionState(A,W,$)},Vt.useCallback=function(A,W){return Ce.H.useCallback(A,W)},Vt.useContext=function(A){return Ce.H.useContext(A)},Vt.useDebugValue=function(){},Vt.useDeferredValue=function(A,W){return Ce.H.useDeferredValue(A,W)},Vt.useEffect=function(A,W,$){var te=Ce.H;if(typeof $=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return te.useEffect(A,W)},Vt.useId=function(){return Ce.H.useId()},Vt.useImperativeHandle=function(A,W,$){return Ce.H.useImperativeHandle(A,W,$)},Vt.useInsertionEffect=function(A,W){return Ce.H.useInsertionEffect(A,W)},Vt.useLayoutEffect=function(A,W){return Ce.H.useLayoutEffect(A,W)},Vt.useMemo=function(A,W){return Ce.H.useMemo(A,W)},Vt.useOptimistic=function(A,W){return Ce.H.useOptimistic(A,W)},Vt.useReducer=function(A,W,$){return Ce.H.useReducer(A,W,$)},Vt.useRef=function(A){return Ce.H.useRef(A)},Vt.useState=function(A){return Ce.H.useState(A)},Vt.useSyncExternalStore=function(A,W,$){return Ce.H.useSyncExternalStore(A,W,$)},Vt.useTransition=function(){return Ce.H.useTransition()},Vt.version="19.1.0",Vt}var I0;function b_(){return I0||(I0=1,iy.exports=rN()),iy.exports}var E=b_();const wm=_E(E);var ry={exports:{}},Sd={},sy={exports:{}},ay={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P0;function sN(){return P0||(P0=1,function(n){function e(Y,ye){var ie=Y.length;Y.push(ye);e:for(;0<ie;){var be=ie-1>>>1,A=Y[be];if(0<l(A,ye))Y[be]=ye,Y[ie]=A,ie=be;else break e}}function t(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var ye=Y[0],ie=Y.pop();if(ie!==ye){Y[0]=ie;e:for(var be=0,A=Y.length,W=A>>>1;be<W;){var $=2*(be+1)-1,te=Y[$],me=$+1,J=Y[me];if(0>l(te,ie))me<A&&0>l(J,te)?(Y[be]=J,Y[me]=ie,be=me):(Y[be]=te,Y[$]=ie,be=$);else if(me<A&&0>l(J,ie))Y[be]=J,Y[me]=ie,be=me;else break e}}return ye}function l(Y,ye){var ie=Y.sortIndex-ye.sortIndex;return ie!==0?ie:Y.id-ye.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,y=f.now();n.unstable_now=function(){return f.now()-y}}var _=[],v=[],w=1,R=null,I=3,G=!1,H=!1,Z=!1,F=!1,Q=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;function we(Y){for(var ye=t(v);ye!==null;){if(ye.callback===null)r(v);else if(ye.startTime<=Y)r(v),ye.sortIndex=ye.expirationTime,e(_,ye);else break;ye=t(v)}}function Ce(Y){if(Z=!1,we(Y),!H)if(t(_)!==null)H=!0,Ue||(Ue=!0,q());else{var ye=t(v);ye!==null&&ae(Ce,ye.startTime-Y)}}var Ue=!1,P=-1,M=5,D=-1;function U(){return F?!0:!(n.unstable_now()-D<M)}function k(){if(F=!1,Ue){var Y=n.unstable_now();D=Y;var ye=!0;try{e:{H=!1,Z&&(Z=!1,se(P),P=-1),G=!0;var ie=I;try{t:{for(we(Y),R=t(_);R!==null&&!(R.expirationTime>Y&&U());){var be=R.callback;if(typeof be=="function"){R.callback=null,I=R.priorityLevel;var A=be(R.expirationTime<=Y);if(Y=n.unstable_now(),typeof A=="function"){R.callback=A,we(Y),ye=!0;break t}R===t(_)&&r(_),we(Y)}else r(_);R=t(_)}if(R!==null)ye=!0;else{var W=t(v);W!==null&&ae(Ce,W.startTime-Y),ye=!1}}break e}finally{R=null,I=ie,G=!1}ye=void 0}}finally{ye?q():Ue=!1}}}var q;if(typeof ue=="function")q=function(){ue(k)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,de=j.port2;j.port1.onmessage=k,q=function(){de.postMessage(null)}}else q=function(){Q(k,0)};function ae(Y,ye){P=Q(function(){Y(n.unstable_now())},ye)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Y){Y.callback=null},n.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<Y?Math.floor(1e3/Y):5},n.unstable_getCurrentPriorityLevel=function(){return I},n.unstable_next=function(Y){switch(I){case 1:case 2:case 3:var ye=3;break;default:ye=I}var ie=I;I=ye;try{return Y()}finally{I=ie}},n.unstable_requestPaint=function(){F=!0},n.unstable_runWithPriority=function(Y,ye){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var ie=I;I=Y;try{return ye()}finally{I=ie}},n.unstable_scheduleCallback=function(Y,ye,ie){var be=n.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?be+ie:be):ie=be,Y){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=ie+A,Y={id:w++,callback:ye,priorityLevel:Y,startTime:ie,expirationTime:A,sortIndex:-1},ie>be?(Y.sortIndex=ie,e(v,Y),t(_)===null&&Y===t(v)&&(Z?(se(P),P=-1):Z=!0,ae(Ce,ie-be))):(Y.sortIndex=A,e(_,Y),H||G||(H=!0,Ue||(Ue=!0,q()))),Y},n.unstable_shouldYield=U,n.unstable_wrapCallback=function(Y){var ye=I;return function(){var ie=I;I=ye;try{return Y.apply(this,arguments)}finally{I=ie}}}}(ay)),ay}var M0;function aN(){return M0||(M0=1,sy.exports=sN()),sy.exports}var oy={exports:{}},wr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k0;function oN(){if(k0)return wr;k0=1;var n=b_();function e(_){var v="https://react.dev/errors/"+_;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)v+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+_+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},l=Symbol.for("react.portal");function u(_,v,w){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:R==null?null:""+R,children:_,containerInfo:v,implementation:w}}var f=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function y(_,v){if(_==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return wr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,wr.createPortal=function(_,v){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(e(299));return u(_,v,null,w)},wr.flushSync=function(_){var v=f.T,w=r.p;try{if(f.T=null,r.p=2,_)return _()}finally{f.T=v,r.p=w,r.d.f()}},wr.preconnect=function(_,v){typeof _=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,r.d.C(_,v))},wr.prefetchDNS=function(_){typeof _=="string"&&r.d.D(_)},wr.preinit=function(_,v){if(typeof _=="string"&&v&&typeof v.as=="string"){var w=v.as,R=y(w,v.crossOrigin),I=typeof v.integrity=="string"?v.integrity:void 0,G=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;w==="style"?r.d.S(_,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:R,integrity:I,fetchPriority:G}):w==="script"&&r.d.X(_,{crossOrigin:R,integrity:I,fetchPriority:G,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},wr.preinitModule=function(_,v){if(typeof _=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var w=y(v.as,v.crossOrigin);r.d.M(_,{crossOrigin:w,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&r.d.M(_)},wr.preload=function(_,v){if(typeof _=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var w=v.as,R=y(w,v.crossOrigin);r.d.L(_,w,{crossOrigin:R,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},wr.preloadModule=function(_,v){if(typeof _=="string")if(v){var w=y(v.as,v.crossOrigin);r.d.m(_,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:w,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else r.d.m(_)},wr.requestFormReset=function(_){r.d.r(_)},wr.unstable_batchedUpdates=function(_,v){return _(v)},wr.useFormState=function(_,v,w){return f.H.useFormState(_,v,w)},wr.useFormStatus=function(){return f.H.useHostTransitionStatus()},wr.version="19.1.0",wr}var O0;function vE(){if(O0)return oy.exports;O0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),oy.exports=oN(),oy.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0;function lN(){if(D0)return Sd;D0=1;var n=aN(),e=b_(),t=vE();function r(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function u(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function f(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function y(i){if(u(i)!==i)throw Error(r(188))}function _(i){var s=i.alternate;if(!s){if(s=u(i),s===null)throw Error(r(188));return s!==i?null:i}for(var c=i,h=s;;){var g=c.return;if(g===null)break;var b=g.alternate;if(b===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===b.child){for(b=g.child;b;){if(b===c)return y(g),i;if(b===h)return y(g),s;b=b.sibling}throw Error(r(188))}if(c.return!==h.return)c=g,h=b;else{for(var C=!1,V=g.child;V;){if(V===c){C=!0,c=g,h=b;break}if(V===h){C=!0,h=g,c=b;break}V=V.sibling}if(!C){for(V=b.child;V;){if(V===c){C=!0,c=b,h=g;break}if(V===h){C=!0,h=b,c=g;break}V=V.sibling}if(!C)throw Error(r(189))}}if(c.alternate!==h)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?i:s}function v(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=v(i),s!==null)return s;i=i.sibling}return null}var w=Object.assign,R=Symbol.for("react.element"),I=Symbol.for("react.transitional.element"),G=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),se=Symbol.for("react.consumer"),ue=Symbol.for("react.context"),we=Symbol.for("react.forward_ref"),Ce=Symbol.for("react.suspense"),Ue=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),k=Symbol.iterator;function q(i){return i===null||typeof i!="object"?null:(i=k&&i[k]||i["@@iterator"],typeof i=="function"?i:null)}var j=Symbol.for("react.client.reference");function de(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===j?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case H:return"Fragment";case F:return"Profiler";case Z:return"StrictMode";case Ce:return"Suspense";case Ue:return"SuspenseList";case D:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case G:return"Portal";case ue:return(i.displayName||"Context")+".Provider";case se:return(i._context.displayName||"Context")+".Consumer";case we:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case P:return s=i.displayName||null,s!==null?s:de(i.type)||"Memo";case M:s=i._payload,i=i._init;try{return de(i(s))}catch{}}return null}var ae=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie={pending:!1,data:null,method:null,action:null},be=[],A=-1;function W(i){return{current:i}}function $(i){0>A||(i.current=be[A],be[A]=null,A--)}function te(i,s){A++,be[A]=i.current,i.current=s}var me=W(null),J=W(null),oe=W(null),re=W(null);function he(i,s){switch(te(oe,s),te(J,i),te(me,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?n0(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=n0(s),i=i0(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}$(me),te(me,i)}function Ae(){$(me),$(J),$(oe)}function K(i){i.memoizedState!==null&&te(re,i);var s=me.current,c=i0(s,i.type);s!==c&&(te(J,i),te(me,c))}function le(i){J.current===i&&($(me),$(J)),re.current===i&&($(re),vd._currentValue=ie)}var Re=Object.prototype.hasOwnProperty,Ge=n.unstable_scheduleCallback,Je=n.unstable_cancelCallback,Ze=n.unstable_shouldYield,Ct=n.unstable_requestPaint,Ot=n.unstable_now,Ke=n.unstable_getCurrentPriorityLevel,ft=n.unstable_ImmediatePriority,Wt=n.unstable_UserBlockingPriority,Hn=n.unstable_NormalPriority,pn=n.unstable_LowPriority,qn=n.unstable_IdlePriority,gr=n.log,kt=n.unstable_setDisableYieldValue,yt=null,ct=null;function $t(i){if(typeof gr=="function"&&kt(i),ct&&typeof ct.setStrictMode=="function")try{ct.setStrictMode(yt,i)}catch{}}var Ln=Math.clz32?Math.clz32:Rr,ts=Math.log,ia=Math.LN2;function Rr(i){return i>>>=0,i===0?32:31-(ts(i)/ia|0)|0}var zr=256,Ki=4194304;function X(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Fe(i,s,c){var h=i.pendingLanes;if(h===0)return 0;var g=0,b=i.suspendedLanes,C=i.pingedLanes;i=i.warmLanes;var V=h&134217727;return V!==0?(h=V&~b,h!==0?g=X(h):(C&=V,C!==0?g=X(C):c||(c=V&~i,c!==0&&(g=X(c))))):(V=h&~b,V!==0?g=X(V):C!==0?g=X(C):c||(c=h&~i,c!==0&&(g=X(c)))),g===0?0:s!==0&&s!==g&&(s&b)===0&&(b=g&-g,c=s&-s,b>=c||b===32&&(c&4194048)!==0)?s:g}function st(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function zt(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $n(){var i=zr;return zr<<=1,(zr&4194048)===0&&(zr=256),i}function Xn(){var i=Ki;return Ki<<=1,(Ki&62914560)===0&&(Ki=4194304),i}function Nn(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function Yt(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function En(i,s,c,h,g,b){var C=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var V=i.entanglements,ne=i.expirationTimes,ve=i.hiddenUpdates;for(c=C&~c;0<c;){var Ie=31-Ln(c),De=1<<Ie;V[Ie]=0,ne[Ie]=-1;var Te=ve[Ie];if(Te!==null)for(ve[Ie]=null,Ie=0;Ie<Te.length;Ie++){var Ee=Te[Ie];Ee!==null&&(Ee.lane&=-536870913)}c&=~De}h!==0&&dn(i,h,0),b!==0&&g===0&&i.tag!==0&&(i.suspendedLanes|=b&~(C&~s))}function dn(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var h=31-Ln(s);i.entangledLanes|=s,i.entanglements[h]=i.entanglements[h]|1073741824|c&4194090}function bn(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var h=31-Ln(c),g=1<<h;g&s|i[h]&s&&(i[h]|=s),c&=~g}}function St(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function hn(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function gn(){var i=ye.p;return i!==0?i:(i=window.event,i===void 0?32:T0(i.type))}function Pi(i,s){var c=ye.p;try{return ye.p=i,s()}finally{ye.p=c}}var Ht=Math.random().toString(36).slice(2),Mt="__reactFiber$"+Ht,ke="__reactProps$"+Ht,at="__reactContainer$"+Ht,Gn="__reactEvents$"+Ht,nt="__reactListeners$"+Ht,ni="__reactHandles$"+Ht,Ir="__reactResources$"+Ht,Ti="__reactMarker$"+Ht;function sr(i){delete i[Mt],delete i[ke],delete i[Gn],delete i[nt],delete i[ni]}function wi(i){var s=i[Mt];if(s)return s;for(var c=i.parentNode;c;){if(s=c[at]||c[Mt]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=o0(i);i!==null;){if(c=i[Mt])return c;i=o0(i)}return s}i=c,c=i.parentNode}return null}function Cn(i){if(i=i[Mt]||i[at]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function _t(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(r(33))}function Rn(i){var s=i[Ir];return s||(s=i[Ir]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function fn(i){i[Ti]=!0}var Ls=new Set,yr={};function Vn(i,s){Bi(i,s),Bi(i+"Capture",s)}function Bi(i,s){for(yr[i]=s,i=0;i<s.length;i++)Ls.add(s[i])}var bs=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Jn={},Un={};function ii(i){return Re.call(Un,i)?!0:Re.call(Jn,i)?!1:bs.test(i)?Un[i]=!0:(Jn[i]=!0,!1)}function li(i,s,c){if(ii(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var h=s.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function ei(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function xn(i,s,c,h){if(h===null)i.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+h)}}var gi,ns;function Br(i){if(gi===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);gi=s&&s[1]||"",ns=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gi+i+ns}var Vs=!1;function Hr(i,s){if(!i||Vs)return"";Vs=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(s){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(Ee){var Te=Ee}Reflect.construct(i,[],De)}else{try{De.call()}catch(Ee){Te=Ee}i.call(De.prototype)}}else{try{throw Error()}catch(Ee){Te=Ee}(De=i())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(Ee){if(Ee&&Te&&typeof Ee.stack=="string")return[Ee.stack,Te.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=h.DetermineComponentFrameRoot(),C=b[0],V=b[1];if(C&&V){var ne=C.split(`
`),ve=V.split(`
`);for(g=h=0;h<ne.length&&!ne[h].includes("DetermineComponentFrameRoot");)h++;for(;g<ve.length&&!ve[g].includes("DetermineComponentFrameRoot");)g++;if(h===ne.length||g===ve.length)for(h=ne.length-1,g=ve.length-1;1<=h&&0<=g&&ne[h]!==ve[g];)g--;for(;1<=h&&0<=g;h--,g--)if(ne[h]!==ve[g]){if(h!==1||g!==1)do if(h--,g--,0>g||ne[h]!==ve[g]){var Ie=`
`+ne[h].replace(" at new "," at ");return i.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",i.displayName)),Ie}while(1<=h&&0<=g);break}}}finally{Vs=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?Br(c):""}function Dt(i){switch(i.tag){case 26:case 27:case 5:return Br(i.type);case 16:return Br("Lazy");case 13:return Br("Suspense");case 19:return Br("SuspenseList");case 0:case 15:return Hr(i.type,!1);case 11:return Hr(i.type.render,!1);case 1:return Hr(i.type,!0);case 31:return Br("Activity");default:return""}}function bt(i){try{var s="";do s+=Dt(i),i=i.return;while(i);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function yi(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Pt(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function xs(i){var s=Pt(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),h=""+i[s];if(!i.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,b=c.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return g.call(this)},set:function(C){h=""+C,b.call(this,C)}}),Object.defineProperty(i,s,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(C){h=""+C},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function is(i){i._valueTracker||(i._valueTracker=xs(i))}function jt(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),h="";return i&&(h=Pt(i)?i.checked?"true":"false":i.value),i=h,i!==c?(s.setValue(i),!0):!1}function Tn(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Aa=/[\n"\\]/g;function Fn(i){return i.replace(Aa,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function mn(i,s,c,h,g,b,C,V){i.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?i.type=C:i.removeAttribute("type"),s!=null?C==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+yi(s)):i.value!==""+yi(s)&&(i.value=""+yi(s)):C!=="submit"&&C!=="reset"||i.removeAttribute("value"),s!=null?xe(i,C,yi(s)):c!=null?xe(i,C,yi(c)):h!=null&&i.removeAttribute("value"),g==null&&b!=null&&(i.defaultChecked=!!b),g!=null&&(i.checked=g&&typeof g!="function"&&typeof g!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?i.name=""+yi(V):i.removeAttribute("name")}function z(i,s,c,h,g,b,C,V){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(i.type=b),s!=null||c!=null){if(!(b!=="submit"&&b!=="reset"||s!=null))return;c=c!=null?""+yi(c):"",s=s!=null?""+yi(s):c,V||s===i.value||(i.value=s),i.defaultValue=s}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,i.checked=V?i.checked:!!h,i.defaultChecked=!!h,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(i.name=C)}function xe(i,s,c){s==="number"&&Tn(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function He(i,s,c,h){if(i=i.options,s){s={};for(var g=0;g<c.length;g++)s["$"+c[g]]=!0;for(c=0;c<i.length;c++)g=s.hasOwnProperty("$"+i[c].value),i[c].selected!==g&&(i[c].selected=g),g&&h&&(i[c].defaultSelected=!0)}else{for(c=""+yi(c),s=null,g=0;g<i.length;g++){if(i[g].value===c){i[g].selected=!0,h&&(i[g].defaultSelected=!0);return}s!==null||i[g].disabled||(s=i[g])}s!==null&&(s.selected=!0)}}function Ne(i,s,c){if(s!=null&&(s=""+yi(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+yi(c):""}function ot(i,s,c,h){if(s==null){if(h!=null){if(c!=null)throw Error(r(92));if(ae(h)){if(1<h.length)throw Error(r(93));h=h[0]}c=h}c==null&&(c=""),s=c}c=yi(s),i.defaultValue=c,h=i.textContent,h===c&&h!==""&&h!==null&&(i.value=h)}function et(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var Be=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ye(i,s,c){var h=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?h?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":h?i.setProperty(s,c):typeof c!="number"||c===0||Be.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function We(i,s,c){if(s!=null&&typeof s!="object")throw Error(r(62));if(i=i.style,c!=null){for(var h in c)!c.hasOwnProperty(h)||s!=null&&s.hasOwnProperty(h)||(h.indexOf("--")===0?i.setProperty(h,""):h==="float"?i.cssFloat="":i[h]="");for(var g in s)h=s[g],s.hasOwnProperty(g)&&c[g]!==h&&Ye(i,g,h)}else for(var b in s)s.hasOwnProperty(b)&&Ye(i,b,s[b])}function mt(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Zn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ci(i){return Zn.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Mi=null;function Ei(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var _r=null,ar=null;function ra(i){var s=Cn(i);if(s&&(i=s.stateNode)){var c=i[ke]||null;e:switch(i=s.stateNode,s.type){case"input":if(mn(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Fn(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var h=c[s];if(h!==i&&h.form===i.form){var g=h[ke]||null;if(!g)throw Error(r(90));mn(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(s=0;s<c.length;s++)h=c[s],h.form===i.form&&jt(h)}break e;case"textarea":Ne(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&He(i,!!c.multiple,s,!1)}}}var dt=!1;function or(i,s,c){if(dt)return i(s,c);dt=!0;try{var h=i(s);return h}finally{if(dt=!1,(_r!==null||ar!==null)&&(gf(),_r&&(s=_r,i=ar,ar=_r=null,ra(s),i)))for(s=0;s<i.length;s++)ra(i[s])}}function tn(i,s){var c=i.stateNode;if(c===null)return null;var h=c[ke]||null;if(h===null)return null;c=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(r(231,s,typeof c));return c}var vr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wi=!1;if(vr)try{var Si={};Object.defineProperty(Si,"passive",{get:function(){Wi=!0}}),window.addEventListener("test",Si,Si),window.removeEventListener("test",Si,Si)}catch{Wi=!1}var yn=null,ri=null,Yi=null;function Pr(){if(Yi)return Yi;var i,s=ri,c=s.length,h,g="value"in yn?yn.value:yn.textContent,b=g.length;for(i=0;i<c&&s[i]===g[i];i++);var C=c-i;for(h=1;h<=C&&s[c-h]===g[b-h];h++);return Yi=g.slice(i,1<h?1-h:void 0)}function wn(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function ji(){return!0}function co(){return!1}function Ai(i){function s(c,h,g,b,C){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var V in i)i.hasOwnProperty(V)&&(c=i[V],this[V]=c?c(b):b[V]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?ji:co,this.isPropagationStopped=co,this}return w(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=ji)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=ji)},persist:function(){},isPersistent:ji}),s}var _n={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Na=Ai(_n),Us=w({},_n,{view:0,detail:0}),mc=Ai(Us),Ca,Lt,Ts,Hi=w({},Us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:aa,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ts&&(Ts&&i.type==="mousemove"?(Ca=i.screenX-Ts.screenX,Lt=i.screenY-Ts.screenY):Lt=Ca=0,Ts=i),Ca)},movementY:function(i){return"movementY"in i?i.movementY:Lt}}),Qi=Ai(Hi),Tl=w({},Hi,{dataTransfer:0}),Du=Ai(Tl),Fs=w({},Us,{relatedTarget:0}),uo=Ai(Fs),ho=w({},_n,{animationName:0,elapsedTime:0,pseudoElement:0}),fo=Ai(ho),pc=w({},_n,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),sa=Ai(pc),Lu=w({},_n,{data:0}),br=Ai(Lu),Ra={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mo(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=rs[i])?!!s[i]:!1}function aa(){return mo}var po=w({},Us,{key:function(i){if(i.key){var s=Ra[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=wn(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?wl[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:aa,charCode:function(i){return i.type==="keypress"?wn(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?wn(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),go=Ai(po),El=w({},Hi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yo=Ai(El),zs=w({},Us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:aa}),gc=Ai(zs),_o=w({},_n,{propertyName:0,elapsedTime:0,pseudoElement:0}),yc=Ai(_o),Sl=w({},Hi,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Ia=Ai(Sl),ki=w({},_n,{newState:0,oldState:0}),ws=Ai(ki),_c=[9,13,27,32],xr=vr&&"CompositionEvent"in window,m=null;vr&&"documentMode"in document&&(m=document.documentMode);var T=vr&&"TextEvent"in window&&!m,N=vr&&(!xr||m&&8<m&&11>=m),B=" ",pe=!1;function je(i,s){switch(i){case"keyup":return _c.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qe(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var nn=!1;function _i(i,s){switch(i){case"compositionend":return qe(s);case"keypress":return s.which!==32?null:(pe=!0,B);case"textInput":return i=s.data,i===B&&pe?null:i;default:return null}}function rn(i,s){if(nn)return i==="compositionend"||!xr&&je(i,s)?(i=Pr(),Yi=ri=yn=null,nn=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return N&&s.locale!=="ko"?null:s.data;default:return null}}var Sn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kn(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Sn[i.type]:s==="textarea"}function Bs(i,s,c,h){_r?ar?ar.push(h):ar=[h]:_r=h,s=Tf(s,"onChange"),0<s.length&&(c=new Na("onChange","change",null,c,h),i.push({event:c,listeners:s}))}var zn=null,Es=null;function Ss(i){Qx(i,0)}function vc(i){var s=_t(i);if(jt(s))return i}function vo(i,s){if(i==="change")return s}var Vu=!1;if(vr){var bo;if(vr){var Uu="oninput"in document;if(!Uu){var Hs=document.createElement("div");Hs.setAttribute("oninput","return;"),Uu=typeof Hs.oninput=="function"}bo=Uu}else bo=!1;Vu=bo&&(!document.documentMode||9<document.documentMode)}function jl(){zn&&(zn.detachEvent("onpropertychange",kh),Es=zn=null)}function kh(i){if(i.propertyName==="value"&&vc(Es)){var s=[];Bs(s,Es,i,Ei(i)),or(Ss,s)}}function Fu(i,s,c){i==="focusin"?(jl(),zn=s,Es=c,zn.attachEvent("onpropertychange",kh)):i==="focusout"&&jl()}function jp(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return vc(Es)}function qs(i,s){if(i==="click")return vc(s)}function Ap(i,s){if(i==="input"||i==="change")return vc(s)}function xo(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Mr=typeof Object.is=="function"?Object.is:xo;function kr(i,s){if(Mr(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),h=Object.keys(s);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!Re.call(s,g)||!Mr(i[g],s[g]))return!1}return!0}function Al(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function zu(i,s){var c=Al(i);i=0;for(var h;c;){if(c.nodeType===3){if(h=i+c.textContent.length,i<=s&&h>=s)return{node:c,offset:s-i};i=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Al(c)}}function bc(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?bc(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Nl(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Tn(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=Tn(i.document)}return s}function Cl(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var xc=vr&&"documentMode"in document&&11>=document.documentMode,ss=null,To=null,Pa=null,Tc=!1;function Oh(i,s,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Tc||ss==null||ss!==Tn(h)||(h=ss,"selectionStart"in h&&Cl(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Pa&&kr(Pa,h)||(Pa=h,h=Tf(To,"onSelect"),0<h.length&&(s=new Na("onSelect","select",null,s,c),i.push({event:s,listeners:h}),s.target=ss)))}function js(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var wo={animationend:js("Animation","AnimationEnd"),animationiteration:js("Animation","AnimationIteration"),animationstart:js("Animation","AnimationStart"),transitionrun:js("Transition","TransitionRun"),transitionstart:js("Transition","TransitionStart"),transitioncancel:js("Transition","TransitionCancel"),transitionend:js("Transition","TransitionEnd")},wc={},Dh={};vr&&(Dh=document.createElement("div").style,"AnimationEvent"in window||(delete wo.animationend.animation,delete wo.animationiteration.animation,delete wo.animationstart.animation),"TransitionEvent"in window||delete wo.transitionend.transition);function oa(i){if(wc[i])return wc[i];if(!wo[i])return i;var s=wo[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Dh)return wc[i]=s[c];return i}var Lh=oa("animationend"),as=oa("animationiteration"),Rl=oa("animationstart"),Np=oa("transitionrun"),Ec=oa("transitionstart"),Cp=oa("transitioncancel"),Bu=oa("transitionend"),Vh=new Map,Ma="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ma.push("scrollEnd");function os(i,s){Vh.set(i,s),Vn(s,[i])}var ka=new WeakMap;function Or(i,s){if(typeof i=="object"&&i!==null){var c=ka.get(i);return c!==void 0?c:(s={value:i,source:s,stack:bt(s)},ka.set(i,s),s)}return{value:i,source:s,stack:bt(s)}}var Dr=[],Eo=0,ls=0;function Il(){for(var i=Eo,s=ls=Eo=0;s<i;){var c=Dr[s];Dr[s++]=null;var h=Dr[s];Dr[s++]=null;var g=Dr[s];Dr[s++]=null;var b=Dr[s];if(Dr[s++]=null,h!==null&&g!==null){var C=h.pending;C===null?g.next=g:(g.next=C.next,C.next=g),h.pending=g}b!==0&&Ml(c,g,b)}}function Pl(i,s,c,h){Dr[Eo++]=i,Dr[Eo++]=s,Dr[Eo++]=c,Dr[Eo++]=h,ls|=h,i.lanes|=h,i=i.alternate,i!==null&&(i.lanes|=h)}function Oa(i,s,c,h){return Pl(i,s,c,h),la(i)}function So(i,s){return Pl(i,null,null,s),la(i)}function Ml(i,s,c){i.lanes|=c;var h=i.alternate;h!==null&&(h.lanes|=c);for(var g=!1,b=i.return;b!==null;)b.childLanes|=c,h=b.alternate,h!==null&&(h.childLanes|=c),b.tag===22&&(i=b.stateNode,i===null||i._visibility&1||(g=!0)),i=b,b=b.return;return i.tag===3?(b=i.stateNode,g&&s!==null&&(g=31-Ln(c),i=b.hiddenUpdates,h=i[g],h===null?i[g]=[s]:h.push(s),s.lane=c|536870912),b):null}function la(i){if(50<dd)throw dd=0,jg=null,Error(r(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Da={};function Uh(i,s,c,h){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lr(i,s,c,h){return new Uh(i,s,c,h)}function Sc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function As(i,s){var c=i.alternate;return c===null?(c=Lr(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Hu(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function kl(i,s,c,h,g,b){var C=0;if(h=i,typeof i=="function")Sc(i)&&(C=1);else if(typeof i=="string")C=HA(i,c,me.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case D:return i=Lr(31,c,s,g),i.elementType=D,i.lanes=b,i;case H:return ca(c.children,g,b,s);case Z:C=8,g|=24;break;case F:return i=Lr(12,c,s,g|2),i.elementType=F,i.lanes=b,i;case Ce:return i=Lr(13,c,s,g),i.elementType=Ce,i.lanes=b,i;case Ue:return i=Lr(19,c,s,g),i.elementType=Ue,i.lanes=b,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Q:case ue:C=10;break e;case se:C=9;break e;case we:C=11;break e;case P:C=14;break e;case M:C=16,h=null;break e}C=29,c=Error(r(130,i===null?"null":typeof i,"")),h=null}return s=Lr(C,c,s,g),s.elementType=i,s.type=h,s.lanes=b,s}function ca(i,s,c,h){return i=Lr(7,i,h,s),i.lanes=c,i}function qu(i,s,c){return i=Lr(6,i,null,s),i.lanes=c,i}function jc(i,s,c){return s=Lr(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var La=[],jo=0,o=null,d=0,p=[],x=0,S=null,O=1,ee="";function ge(i,s){La[jo++]=d,La[jo++]=o,o=i,d=s}function Se(i,s,c){p[x++]=O,p[x++]=ee,p[x++]=S,S=i;var h=O;i=ee;var g=32-Ln(h)-1;h&=~(1<<g),c+=1;var b=32-Ln(s)+g;if(30<b){var C=g-g%5;b=(h&(1<<C)-1).toString(32),h>>=C,g-=C,O=1<<32-Ln(s)+g|c<<g|h,ee=b+i}else O=1<<b|c<<g|h,ee=i}function Ve(i){i.return!==null&&(ge(i,1),Se(i,1,0))}function Qe(i){for(;i===o;)o=La[--jo],La[jo]=null,d=La[--jo],La[jo]=null;for(;i===S;)S=p[--x],p[x]=null,ee=p[--x],p[x]=null,O=p[--x],p[x]=null}var it=null,lt=null,Rt=!1,Wn=null,ui=!1,Xi=Error(r(519));function qr(i){var s=Error(r(418,""));throw No(Or(s,i)),Xi}function Fh(i){var s=i.stateNode,c=i.type,h=i.memoizedProps;switch(s[Mt]=i,s[ke]=h,c){case"dialog":Jt("cancel",s),Jt("close",s);break;case"iframe":case"object":case"embed":Jt("load",s);break;case"video":case"audio":for(c=0;c<fd.length;c++)Jt(fd[c],s);break;case"source":Jt("error",s);break;case"img":case"image":case"link":Jt("error",s),Jt("load",s);break;case"details":Jt("toggle",s);break;case"input":Jt("invalid",s),z(s,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),is(s);break;case"select":Jt("invalid",s);break;case"textarea":Jt("invalid",s),ot(s,h.value,h.defaultValue,h.children),is(s)}c=h.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||h.suppressHydrationWarning===!0||t0(s.textContent,c)?(h.popover!=null&&(Jt("beforetoggle",s),Jt("toggle",s)),h.onScroll!=null&&Jt("scroll",s),h.onScrollEnd!=null&&Jt("scrollend",s),h.onClick!=null&&(s.onclick=wf),s=!0):s=!1,s||qr(i)}function zh(i){for(it=i.return;it;)switch(it.tag){case 5:case 13:ui=!1;return;case 27:case 3:ui=!0;return;default:it=it.return}}function Ol(i){if(i!==it)return!1;if(!Rt)return zh(i),Rt=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||Bg(i.type,i.memoizedProps)),c=!c),c&&lt&&qr(i),zh(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(c=i.data,c==="/$"){if(s===0){lt=Ks(i.nextSibling);break e}s--}else c!=="$"&&c!=="$!"&&c!=="$?"||s++;i=i.nextSibling}lt=null}}else s===27?(s=lt,Ho(i.type)?(i=Gg,Gg=null,lt=i):lt=s):lt=it?Ks(i.stateNode.nextSibling):null;return!0}function Ao(){lt=it=null,Rt=!1}function Bh(){var i=Wn;return i!==null&&(Zr===null?Zr=i:Zr.push.apply(Zr,i),Wn=null),i}function No(i){Wn===null?Wn=[i]:Wn.push(i)}var si=W(null),Ns=null,$s=null;function ua(i,s,c){te(si,s._currentValue),s._currentValue=c}function Gs(i){i._currentValue=si.current,$(si)}function Dl(i,s,c){for(;i!==null;){var h=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),i===c)break;i=i.return}}function Ac(i,s,c,h){var g=i.child;for(g!==null&&(g.return=i);g!==null;){var b=g.dependencies;if(b!==null){var C=g.child;b=b.firstContext;e:for(;b!==null;){var V=b;b=g;for(var ne=0;ne<s.length;ne++)if(V.context===s[ne]){b.lanes|=c,V=b.alternate,V!==null&&(V.lanes|=c),Dl(b.return,c,i),h||(C=null);break e}b=V.next}}else if(g.tag===18){if(C=g.return,C===null)throw Error(r(341));C.lanes|=c,b=C.alternate,b!==null&&(b.lanes|=c),Dl(C,c,i),C=null}else C=g.child;if(C!==null)C.return=g;else for(C=g;C!==null;){if(C===i){C=null;break}if(g=C.sibling,g!==null){g.return=C.return,C=g;break}C=C.return}g=C}}function Ll(i,s,c,h){i=null;for(var g=s,b=!1;g!==null;){if(!b){if((g.flags&524288)!==0)b=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var C=g.alternate;if(C===null)throw Error(r(387));if(C=C.memoizedProps,C!==null){var V=g.type;Mr(g.pendingProps.value,C.value)||(i!==null?i.push(V):i=[V])}}else if(g===re.current){if(C=g.alternate,C===null)throw Error(r(387));C.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(i!==null?i.push(vd):i=[vd])}g=g.return}i!==null&&Ac(s,i,c,h),s.flags|=262144}function Hh(i){for(i=i.firstContext;i!==null;){if(!Mr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Vl(i){Ns=i,$s=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Tr(i){return zv(Ns,i)}function qh(i,s){return Ns===null&&Vl(i),zv(i,s)}function zv(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},$s===null){if(i===null)throw Error(r(308));$s=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else $s=$s.next=s;return c}var Bj=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,h){i.push(h)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},Hj=n.unstable_scheduleCallback,qj=n.unstable_NormalPriority,qi={$$typeof:ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rp(){return{controller:new Bj,data:new Map,refCount:0}}function $u(i){i.refCount--,i.refCount===0&&Hj(qj,function(){i.controller.abort()})}var Gu=null,Ip=0,Nc=0,Cc=null;function $j(i,s){if(Gu===null){var c=Gu=[];Ip=0,Nc=Mg(),Cc={status:"pending",value:void 0,then:function(h){c.push(h)}}}return Ip++,s.then(Bv,Bv),s}function Bv(){if(--Ip===0&&Gu!==null){Cc!==null&&(Cc.status="fulfilled");var i=Gu;Gu=null,Nc=0,Cc=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function Gj(i,s){var c=[],h={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return i.then(function(){h.status="fulfilled",h.value=s;for(var g=0;g<c.length;g++)(0,c[g])(s)},function(g){for(h.status="rejected",h.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),h}var Hv=Y.S;Y.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&$j(i,s),Hv!==null&&Hv(i,s)};var Ul=W(null);function Pp(){var i=Ul.current;return i!==null?i:Yn.pooledCache}function $h(i,s){s===null?te(Ul,Ul.current):te(Ul,s.pool)}function qv(){var i=Pp();return i===null?null:{parent:qi._currentValue,pool:i}}var Zu=Error(r(460)),$v=Error(r(474)),Gh=Error(r(542)),Mp={then:function(){}};function Gv(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Zh(){}function Zv(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(Zh,Zh),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Wv(i),i;default:if(typeof s.status=="string")s.then(Zh,Zh);else{if(i=Yn,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=s,i.status="pending",i.then(function(h){if(s.status==="pending"){var g=s;g.status="fulfilled",g.value=h}},function(h){if(s.status==="pending"){var g=s;g.status="rejected",g.reason=h}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Wv(i),i}throw Ku=s,Zu}}var Ku=null;function Kv(){if(Ku===null)throw Error(r(459));var i=Ku;return Ku=null,i}function Wv(i){if(i===Zu||i===Gh)throw Error(r(483))}var Co=!1;function kp(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Op(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ro(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Io(i,s,c){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,(jn&2)!==0){var g=h.pending;return g===null?s.next=s:(s.next=g.next,g.next=s),h.pending=s,s=la(i),Ml(i,null,c),s}return Pl(i,h,s,c),la(i)}function Wu(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var h=s.lanes;h&=i.pendingLanes,c|=h,s.lanes=c,bn(i,c)}}function Dp(i,s){var c=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,b=null;if(c=c.firstBaseUpdate,c!==null){do{var C={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};b===null?g=b=C:b=b.next=C,c=c.next}while(c!==null);b===null?g=b=s:b=b.next=s}else g=b=s;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:b,shared:h.shared,callbacks:h.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var Lp=!1;function Yu(){if(Lp){var i=Cc;if(i!==null)throw i}}function Qu(i,s,c,h){Lp=!1;var g=i.updateQueue;Co=!1;var b=g.firstBaseUpdate,C=g.lastBaseUpdate,V=g.shared.pending;if(V!==null){g.shared.pending=null;var ne=V,ve=ne.next;ne.next=null,C===null?b=ve:C.next=ve,C=ne;var Ie=i.alternate;Ie!==null&&(Ie=Ie.updateQueue,V=Ie.lastBaseUpdate,V!==C&&(V===null?Ie.firstBaseUpdate=ve:V.next=ve,Ie.lastBaseUpdate=ne))}if(b!==null){var De=g.baseState;C=0,Ie=ve=ne=null,V=b;do{var Te=V.lane&-536870913,Ee=Te!==V.lane;if(Ee?(ln&Te)===Te:(h&Te)===Te){Te!==0&&Te===Nc&&(Lp=!0),Ie!==null&&(Ie=Ie.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var At=i,xt=V;Te=s;var Mn=c;switch(xt.tag){case 1:if(At=xt.payload,typeof At=="function"){De=At.call(Mn,De,Te);break e}De=At;break e;case 3:At.flags=At.flags&-65537|128;case 0:if(At=xt.payload,Te=typeof At=="function"?At.call(Mn,De,Te):At,Te==null)break e;De=w({},De,Te);break e;case 2:Co=!0}}Te=V.callback,Te!==null&&(i.flags|=64,Ee&&(i.flags|=8192),Ee=g.callbacks,Ee===null?g.callbacks=[Te]:Ee.push(Te))}else Ee={lane:Te,tag:V.tag,payload:V.payload,callback:V.callback,next:null},Ie===null?(ve=Ie=Ee,ne=De):Ie=Ie.next=Ee,C|=Te;if(V=V.next,V===null){if(V=g.shared.pending,V===null)break;Ee=V,V=Ee.next,Ee.next=null,g.lastBaseUpdate=Ee,g.shared.pending=null}}while(!0);Ie===null&&(ne=De),g.baseState=ne,g.firstBaseUpdate=ve,g.lastBaseUpdate=Ie,b===null&&(g.shared.lanes=0),Uo|=C,i.lanes=C,i.memoizedState=De}}function Yv(i,s){if(typeof i!="function")throw Error(r(191,i));i.call(s)}function Qv(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)Yv(c[i],s)}var Rc=W(null),Kh=W(0);function Xv(i,s){i=qa,te(Kh,i),te(Rc,s),qa=i|s.baseLanes}function Vp(){te(Kh,qa),te(Rc,Rc.current)}function Up(){qa=Kh.current,$(Rc),$(Kh)}var Po=0,qt=null,In=null,Oi=null,Wh=!1,Ic=!1,Fl=!1,Yh=0,Xu=0,Pc=null,Zj=0;function Ni(){throw Error(r(321))}function Fp(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!Mr(i[c],s[c]))return!1;return!0}function zp(i,s,c,h,g,b){return Po=b,qt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Y.H=i===null||i.memoizedState===null?Ob:Db,Fl=!1,b=c(h,g),Fl=!1,Ic&&(b=eb(s,c,h,g)),Jv(i),b}function Jv(i){Y.H=nf;var s=In!==null&&In.next!==null;if(Po=0,Oi=In=qt=null,Wh=!1,Xu=0,Pc=null,s)throw Error(r(300));i===null||Ji||(i=i.dependencies,i!==null&&Hh(i)&&(Ji=!0))}function eb(i,s,c,h){qt=i;var g=0;do{if(Ic&&(Pc=null),Xu=0,Ic=!1,25<=g)throw Error(r(301));if(g+=1,Oi=In=null,i.updateQueue!=null){var b=i.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}Y.H=eA,b=s(c,h)}while(Ic);return b}function Kj(){var i=Y.H,s=i.useState()[0];return s=typeof s.then=="function"?Ju(s):s,i=i.useState()[0],(In!==null?In.memoizedState:null)!==i&&(qt.flags|=1024),s}function Bp(){var i=Yh!==0;return Yh=0,i}function Hp(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function qp(i){if(Wh){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Wh=!1}Po=0,Oi=In=qt=null,Ic=!1,Xu=Yh=0,Pc=null}function $r(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?qt.memoizedState=Oi=i:Oi=Oi.next=i,Oi}function Di(){if(In===null){var i=qt.alternate;i=i!==null?i.memoizedState:null}else i=In.next;var s=Oi===null?qt.memoizedState:Oi.next;if(s!==null)Oi=s,In=i;else{if(i===null)throw qt.alternate===null?Error(r(467)):Error(r(310));In=i,i={memoizedState:In.memoizedState,baseState:In.baseState,baseQueue:In.baseQueue,queue:In.queue,next:null},Oi===null?qt.memoizedState=Oi=i:Oi=Oi.next=i}return Oi}function $p(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ju(i){var s=Xu;return Xu+=1,Pc===null&&(Pc=[]),i=Zv(Pc,i,s),s=qt,(Oi===null?s.memoizedState:Oi.next)===null&&(s=s.alternate,Y.H=s===null||s.memoizedState===null?Ob:Db),i}function Qh(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Ju(i);if(i.$$typeof===ue)return Tr(i)}throw Error(r(438,String(i)))}function Gp(i){var s=null,c=qt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var h=qt.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(s={data:h.data.map(function(g){return g.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=$p(),qt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),h=0;h<i;h++)c[h]=U;return s.index++,c}function Va(i,s){return typeof s=="function"?s(i):s}function Xh(i){var s=Di();return Zp(s,In,i)}function Zp(i,s,c){var h=i.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=c;var g=i.baseQueue,b=h.pending;if(b!==null){if(g!==null){var C=g.next;g.next=b.next,b.next=C}s.baseQueue=g=b,h.pending=null}if(b=i.baseState,g===null)i.memoizedState=b;else{s=g.next;var V=C=null,ne=null,ve=s,Ie=!1;do{var De=ve.lane&-536870913;if(De!==ve.lane?(ln&De)===De:(Po&De)===De){var Te=ve.revertLane;if(Te===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),De===Nc&&(Ie=!0);else if((Po&Te)===Te){ve=ve.next,Te===Nc&&(Ie=!0);continue}else De={lane:0,revertLane:ve.revertLane,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},ne===null?(V=ne=De,C=b):ne=ne.next=De,qt.lanes|=Te,Uo|=Te;De=ve.action,Fl&&c(b,De),b=ve.hasEagerState?ve.eagerState:c(b,De)}else Te={lane:De,revertLane:ve.revertLane,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},ne===null?(V=ne=Te,C=b):ne=ne.next=Te,qt.lanes|=De,Uo|=De;ve=ve.next}while(ve!==null&&ve!==s);if(ne===null?C=b:ne.next=V,!Mr(b,i.memoizedState)&&(Ji=!0,Ie&&(c=Cc,c!==null)))throw c;i.memoizedState=b,i.baseState=C,i.baseQueue=ne,h.lastRenderedState=b}return g===null&&(h.lanes=0),[i.memoizedState,h.dispatch]}function Kp(i){var s=Di(),c=s.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=i;var h=c.dispatch,g=c.pending,b=s.memoizedState;if(g!==null){c.pending=null;var C=g=g.next;do b=i(b,C.action),C=C.next;while(C!==g);Mr(b,s.memoizedState)||(Ji=!0),s.memoizedState=b,s.baseQueue===null&&(s.baseState=b),c.lastRenderedState=b}return[b,h]}function tb(i,s,c){var h=qt,g=Di(),b=Rt;if(b){if(c===void 0)throw Error(r(407));c=c()}else c=s();var C=!Mr((In||g).memoizedState,c);C&&(g.memoizedState=c,Ji=!0),g=g.queue;var V=rb.bind(null,h,g,i);if(ed(2048,8,V,[i]),g.getSnapshot!==s||C||Oi!==null&&Oi.memoizedState.tag&1){if(h.flags|=2048,Mc(9,Jh(),ib.bind(null,h,g,c,s),null),Yn===null)throw Error(r(349));b||(Po&124)!==0||nb(h,s,c)}return c}function nb(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=qt.updateQueue,s===null?(s=$p(),qt.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function ib(i,s,c,h){s.value=c,s.getSnapshot=h,sb(s)&&ab(i)}function rb(i,s,c){return c(function(){sb(s)&&ab(i)})}function sb(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!Mr(i,c)}catch{return!0}}function ab(i){var s=So(i,2);s!==null&&fs(s,i,2)}function Wp(i){var s=$r();if(typeof i=="function"){var c=i;if(i=c(),Fl){$t(!0);try{c()}finally{$t(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:i},s}function ob(i,s,c,h){return i.baseState=c,Zp(i,In,typeof h=="function"?h:Va)}function Wj(i,s,c,h,g){if(tf(i))throw Error(r(485));if(i=s.action,i!==null){var b={payload:g,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){b.listeners.push(C)}};Y.T!==null?c(!0):b.isTransition=!1,h(b),c=s.pending,c===null?(b.next=s.pending=b,lb(s,b)):(b.next=c.next,s.pending=c.next=b)}}function lb(i,s){var c=s.action,h=s.payload,g=i.state;if(s.isTransition){var b=Y.T,C={};Y.T=C;try{var V=c(g,h),ne=Y.S;ne!==null&&ne(C,V),cb(i,s,V)}catch(ve){Yp(i,s,ve)}finally{Y.T=b}}else try{b=c(g,h),cb(i,s,b)}catch(ve){Yp(i,s,ve)}}function cb(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(h){ub(i,s,h)},function(h){return Yp(i,s,h)}):ub(i,s,c)}function ub(i,s,c){s.status="fulfilled",s.value=c,db(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,lb(i,c)))}function Yp(i,s,c){var h=i.pending;if(i.pending=null,h!==null){h=h.next;do s.status="rejected",s.reason=c,db(s),s=s.next;while(s!==h)}i.action=null}function db(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function hb(i,s){return s}function fb(i,s){if(Rt){var c=Yn.formState;if(c!==null){e:{var h=qt;if(Rt){if(lt){t:{for(var g=lt,b=ui;g.nodeType!==8;){if(!b){g=null;break t}if(g=Ks(g.nextSibling),g===null){g=null;break t}}b=g.data,g=b==="F!"||b==="F"?g:null}if(g){lt=Ks(g.nextSibling),h=g.data==="F!";break e}}qr(h)}h=!1}h&&(s=c[0])}}return c=$r(),c.memoizedState=c.baseState=s,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hb,lastRenderedState:s},c.queue=h,c=Pb.bind(null,qt,h),h.dispatch=c,h=Wp(!1),b=tg.bind(null,qt,!1,h.queue),h=$r(),g={state:s,dispatch:null,action:i,pending:null},h.queue=g,c=Wj.bind(null,qt,g,b,c),g.dispatch=c,h.memoizedState=i,[s,c,!1]}function mb(i){var s=Di();return pb(s,In,i)}function pb(i,s,c){if(s=Zp(i,s,hb)[0],i=Xh(Va)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var h=Ju(s)}catch(C){throw C===Zu?Gh:C}else h=s;s=Di();var g=s.queue,b=g.dispatch;return c!==s.memoizedState&&(qt.flags|=2048,Mc(9,Jh(),Yj.bind(null,g,c),null)),[h,b,i]}function Yj(i,s){i.action=s}function gb(i){var s=Di(),c=In;if(c!==null)return pb(s,c,i);Di(),s=s.memoizedState,c=Di();var h=c.queue.dispatch;return c.memoizedState=i,[s,h,!1]}function Mc(i,s,c,h){return i={tag:i,create:c,deps:h,inst:s,next:null},s=qt.updateQueue,s===null&&(s=$p(),qt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(h=c.next,c.next=i,i.next=h,s.lastEffect=i),i}function Jh(){return{destroy:void 0,resource:void 0}}function yb(){return Di().memoizedState}function ef(i,s,c,h){var g=$r();h=h===void 0?null:h,qt.flags|=i,g.memoizedState=Mc(1|s,Jh(),c,h)}function ed(i,s,c,h){var g=Di();h=h===void 0?null:h;var b=g.memoizedState.inst;In!==null&&h!==null&&Fp(h,In.memoizedState.deps)?g.memoizedState=Mc(s,b,c,h):(qt.flags|=i,g.memoizedState=Mc(1|s,b,c,h))}function _b(i,s){ef(8390656,8,i,s)}function vb(i,s){ed(2048,8,i,s)}function bb(i,s){return ed(4,2,i,s)}function xb(i,s){return ed(4,4,i,s)}function Tb(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function wb(i,s,c){c=c!=null?c.concat([i]):null,ed(4,4,Tb.bind(null,s,i),c)}function Qp(){}function Eb(i,s){var c=Di();s=s===void 0?null:s;var h=c.memoizedState;return s!==null&&Fp(s,h[1])?h[0]:(c.memoizedState=[i,s],i)}function Sb(i,s){var c=Di();s=s===void 0?null:s;var h=c.memoizedState;if(s!==null&&Fp(s,h[1]))return h[0];if(h=i(),Fl){$t(!0);try{i()}finally{$t(!1)}}return c.memoizedState=[h,s],h}function Xp(i,s,c){return c===void 0||(Po&1073741824)!==0?i.memoizedState=s:(i.memoizedState=c,i=Nx(),qt.lanes|=i,Uo|=i,c)}function jb(i,s,c,h){return Mr(c,s)?c:Rc.current!==null?(i=Xp(i,c,h),Mr(i,s)||(Ji=!0),i):(Po&42)===0?(Ji=!0,i.memoizedState=c):(i=Nx(),qt.lanes|=i,Uo|=i,s)}function Ab(i,s,c,h,g){var b=ye.p;ye.p=b!==0&&8>b?b:8;var C=Y.T,V={};Y.T=V,tg(i,!1,s,c);try{var ne=g(),ve=Y.S;if(ve!==null&&ve(V,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Ie=Gj(ne,h);td(i,s,Ie,hs(i))}else td(i,s,h,hs(i))}catch(De){td(i,s,{then:function(){},status:"rejected",reason:De},hs())}finally{ye.p=b,Y.T=C}}function Qj(){}function Jp(i,s,c,h){if(i.tag!==5)throw Error(r(476));var g=Nb(i).queue;Ab(i,g,s,ie,c===null?Qj:function(){return Cb(i),c(h)})}function Nb(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:ie,baseState:ie,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:ie},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Cb(i){var s=Nb(i).next.queue;td(i,s,{},hs())}function eg(){return Tr(vd)}function Rb(){return Di().memoizedState}function Ib(){return Di().memoizedState}function Xj(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=hs();i=Ro(c);var h=Io(s,i,c);h!==null&&(fs(h,s,c),Wu(h,s,c)),s={cache:Rp()},i.payload=s;return}s=s.return}}function Jj(i,s,c){var h=hs();c={lane:h,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},tf(i)?Mb(s,c):(c=Oa(i,s,c,h),c!==null&&(fs(c,i,h),kb(c,s,h)))}function Pb(i,s,c){var h=hs();td(i,s,c,h)}function td(i,s,c,h){var g={lane:h,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(tf(i))Mb(s,g);else{var b=i.alternate;if(i.lanes===0&&(b===null||b.lanes===0)&&(b=s.lastRenderedReducer,b!==null))try{var C=s.lastRenderedState,V=b(C,c);if(g.hasEagerState=!0,g.eagerState=V,Mr(V,C))return Pl(i,s,g,0),Yn===null&&Il(),!1}catch{}finally{}if(c=Oa(i,s,g,h),c!==null)return fs(c,i,h),kb(c,s,h),!0}return!1}function tg(i,s,c,h){if(h={lane:2,revertLane:Mg(),action:h,hasEagerState:!1,eagerState:null,next:null},tf(i)){if(s)throw Error(r(479))}else s=Oa(i,c,h,2),s!==null&&fs(s,i,2)}function tf(i){var s=i.alternate;return i===qt||s!==null&&s===qt}function Mb(i,s){Ic=Wh=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function kb(i,s,c){if((c&4194048)!==0){var h=s.lanes;h&=i.pendingLanes,c|=h,s.lanes=c,bn(i,c)}}var nf={readContext:Tr,use:Qh,useCallback:Ni,useContext:Ni,useEffect:Ni,useImperativeHandle:Ni,useLayoutEffect:Ni,useInsertionEffect:Ni,useMemo:Ni,useReducer:Ni,useRef:Ni,useState:Ni,useDebugValue:Ni,useDeferredValue:Ni,useTransition:Ni,useSyncExternalStore:Ni,useId:Ni,useHostTransitionStatus:Ni,useFormState:Ni,useActionState:Ni,useOptimistic:Ni,useMemoCache:Ni,useCacheRefresh:Ni},Ob={readContext:Tr,use:Qh,useCallback:function(i,s){return $r().memoizedState=[i,s===void 0?null:s],i},useContext:Tr,useEffect:_b,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,ef(4194308,4,Tb.bind(null,s,i),c)},useLayoutEffect:function(i,s){return ef(4194308,4,i,s)},useInsertionEffect:function(i,s){ef(4,2,i,s)},useMemo:function(i,s){var c=$r();s=s===void 0?null:s;var h=i();if(Fl){$t(!0);try{i()}finally{$t(!1)}}return c.memoizedState=[h,s],h},useReducer:function(i,s,c){var h=$r();if(c!==void 0){var g=c(s);if(Fl){$t(!0);try{c(s)}finally{$t(!1)}}}else g=s;return h.memoizedState=h.baseState=g,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:g},h.queue=i,i=i.dispatch=Jj.bind(null,qt,i),[h.memoizedState,i]},useRef:function(i){var s=$r();return i={current:i},s.memoizedState=i},useState:function(i){i=Wp(i);var s=i.queue,c=Pb.bind(null,qt,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:Qp,useDeferredValue:function(i,s){var c=$r();return Xp(c,i,s)},useTransition:function(){var i=Wp(!1);return i=Ab.bind(null,qt,i.queue,!0,!1),$r().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var h=qt,g=$r();if(Rt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=s(),Yn===null)throw Error(r(349));(ln&124)!==0||nb(h,s,c)}g.memoizedState=c;var b={value:c,getSnapshot:s};return g.queue=b,_b(rb.bind(null,h,b,i),[i]),h.flags|=2048,Mc(9,Jh(),ib.bind(null,h,b,c,s),null),c},useId:function(){var i=$r(),s=Yn.identifierPrefix;if(Rt){var c=ee,h=O;c=(h&~(1<<32-Ln(h)-1)).toString(32)+c,s="«"+s+"R"+c,c=Yh++,0<c&&(s+="H"+c.toString(32)),s+="»"}else c=Zj++,s="«"+s+"r"+c.toString(32)+"»";return i.memoizedState=s},useHostTransitionStatus:eg,useFormState:fb,useActionState:fb,useOptimistic:function(i){var s=$r();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=tg.bind(null,qt,!0,c),c.dispatch=s,[i,s]},useMemoCache:Gp,useCacheRefresh:function(){return $r().memoizedState=Xj.bind(null,qt)}},Db={readContext:Tr,use:Qh,useCallback:Eb,useContext:Tr,useEffect:vb,useImperativeHandle:wb,useInsertionEffect:bb,useLayoutEffect:xb,useMemo:Sb,useReducer:Xh,useRef:yb,useState:function(){return Xh(Va)},useDebugValue:Qp,useDeferredValue:function(i,s){var c=Di();return jb(c,In.memoizedState,i,s)},useTransition:function(){var i=Xh(Va)[0],s=Di().memoizedState;return[typeof i=="boolean"?i:Ju(i),s]},useSyncExternalStore:tb,useId:Rb,useHostTransitionStatus:eg,useFormState:mb,useActionState:mb,useOptimistic:function(i,s){var c=Di();return ob(c,In,i,s)},useMemoCache:Gp,useCacheRefresh:Ib},eA={readContext:Tr,use:Qh,useCallback:Eb,useContext:Tr,useEffect:vb,useImperativeHandle:wb,useInsertionEffect:bb,useLayoutEffect:xb,useMemo:Sb,useReducer:Kp,useRef:yb,useState:function(){return Kp(Va)},useDebugValue:Qp,useDeferredValue:function(i,s){var c=Di();return In===null?Xp(c,i,s):jb(c,In.memoizedState,i,s)},useTransition:function(){var i=Kp(Va)[0],s=Di().memoizedState;return[typeof i=="boolean"?i:Ju(i),s]},useSyncExternalStore:tb,useId:Rb,useHostTransitionStatus:eg,useFormState:gb,useActionState:gb,useOptimistic:function(i,s){var c=Di();return In!==null?ob(c,In,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:Gp,useCacheRefresh:Ib},kc=null,nd=0;function rf(i){var s=nd;return nd+=1,kc===null&&(kc=[]),Zv(kc,i,s)}function id(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function sf(i,s){throw s.$$typeof===R?Error(r(525)):(i=Object.prototype.toString.call(s),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Lb(i){var s=i._init;return s(i._payload)}function Vb(i){function s(fe,ce){if(i){var _e=fe.deletions;_e===null?(fe.deletions=[ce],fe.flags|=16):_e.push(ce)}}function c(fe,ce){if(!i)return null;for(;ce!==null;)s(fe,ce),ce=ce.sibling;return null}function h(fe){for(var ce=new Map;fe!==null;)fe.key!==null?ce.set(fe.key,fe):ce.set(fe.index,fe),fe=fe.sibling;return ce}function g(fe,ce){return fe=As(fe,ce),fe.index=0,fe.sibling=null,fe}function b(fe,ce,_e){return fe.index=_e,i?(_e=fe.alternate,_e!==null?(_e=_e.index,_e<ce?(fe.flags|=67108866,ce):_e):(fe.flags|=67108866,ce)):(fe.flags|=1048576,ce)}function C(fe){return i&&fe.alternate===null&&(fe.flags|=67108866),fe}function V(fe,ce,_e,Oe){return ce===null||ce.tag!==6?(ce=qu(_e,fe.mode,Oe),ce.return=fe,ce):(ce=g(ce,_e),ce.return=fe,ce)}function ne(fe,ce,_e,Oe){var rt=_e.type;return rt===H?Ie(fe,ce,_e.props.children,Oe,_e.key):ce!==null&&(ce.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===M&&Lb(rt)===ce.type)?(ce=g(ce,_e.props),id(ce,_e),ce.return=fe,ce):(ce=kl(_e.type,_e.key,_e.props,null,fe.mode,Oe),id(ce,_e),ce.return=fe,ce)}function ve(fe,ce,_e,Oe){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==_e.containerInfo||ce.stateNode.implementation!==_e.implementation?(ce=jc(_e,fe.mode,Oe),ce.return=fe,ce):(ce=g(ce,_e.children||[]),ce.return=fe,ce)}function Ie(fe,ce,_e,Oe,rt){return ce===null||ce.tag!==7?(ce=ca(_e,fe.mode,Oe,rt),ce.return=fe,ce):(ce=g(ce,_e),ce.return=fe,ce)}function De(fe,ce,_e){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=qu(""+ce,fe.mode,_e),ce.return=fe,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case I:return _e=kl(ce.type,ce.key,ce.props,null,fe.mode,_e),id(_e,ce),_e.return=fe,_e;case G:return ce=jc(ce,fe.mode,_e),ce.return=fe,ce;case M:var Oe=ce._init;return ce=Oe(ce._payload),De(fe,ce,_e)}if(ae(ce)||q(ce))return ce=ca(ce,fe.mode,_e,null),ce.return=fe,ce;if(typeof ce.then=="function")return De(fe,rf(ce),_e);if(ce.$$typeof===ue)return De(fe,qh(fe,ce),_e);sf(fe,ce)}return null}function Te(fe,ce,_e,Oe){var rt=ce!==null?ce.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return rt!==null?null:V(fe,ce,""+_e,Oe);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case I:return _e.key===rt?ne(fe,ce,_e,Oe):null;case G:return _e.key===rt?ve(fe,ce,_e,Oe):null;case M:return rt=_e._init,_e=rt(_e._payload),Te(fe,ce,_e,Oe)}if(ae(_e)||q(_e))return rt!==null?null:Ie(fe,ce,_e,Oe,null);if(typeof _e.then=="function")return Te(fe,ce,rf(_e),Oe);if(_e.$$typeof===ue)return Te(fe,ce,qh(fe,_e),Oe);sf(fe,_e)}return null}function Ee(fe,ce,_e,Oe,rt){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return fe=fe.get(_e)||null,V(ce,fe,""+Oe,rt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case I:return fe=fe.get(Oe.key===null?_e:Oe.key)||null,ne(ce,fe,Oe,rt);case G:return fe=fe.get(Oe.key===null?_e:Oe.key)||null,ve(ce,fe,Oe,rt);case M:var Gt=Oe._init;return Oe=Gt(Oe._payload),Ee(fe,ce,_e,Oe,rt)}if(ae(Oe)||q(Oe))return fe=fe.get(_e)||null,Ie(ce,fe,Oe,rt,null);if(typeof Oe.then=="function")return Ee(fe,ce,_e,rf(Oe),rt);if(Oe.$$typeof===ue)return Ee(fe,ce,_e,qh(ce,Oe),rt);sf(ce,Oe)}return null}function At(fe,ce,_e,Oe){for(var rt=null,Gt=null,ht=ce,Tt=ce=0,tr=null;ht!==null&&Tt<_e.length;Tt++){ht.index>Tt?(tr=ht,ht=null):tr=ht.sibling;var vn=Te(fe,ht,_e[Tt],Oe);if(vn===null){ht===null&&(ht=tr);break}i&&ht&&vn.alternate===null&&s(fe,ht),ce=b(vn,ce,Tt),Gt===null?rt=vn:Gt.sibling=vn,Gt=vn,ht=tr}if(Tt===_e.length)return c(fe,ht),Rt&&ge(fe,Tt),rt;if(ht===null){for(;Tt<_e.length;Tt++)ht=De(fe,_e[Tt],Oe),ht!==null&&(ce=b(ht,ce,Tt),Gt===null?rt=ht:Gt.sibling=ht,Gt=ht);return Rt&&ge(fe,Tt),rt}for(ht=h(ht);Tt<_e.length;Tt++)tr=Ee(ht,fe,Tt,_e[Tt],Oe),tr!==null&&(i&&tr.alternate!==null&&ht.delete(tr.key===null?Tt:tr.key),ce=b(tr,ce,Tt),Gt===null?rt=tr:Gt.sibling=tr,Gt=tr);return i&&ht.forEach(function(Ko){return s(fe,Ko)}),Rt&&ge(fe,Tt),rt}function xt(fe,ce,_e,Oe){if(_e==null)throw Error(r(151));for(var rt=null,Gt=null,ht=ce,Tt=ce=0,tr=null,vn=_e.next();ht!==null&&!vn.done;Tt++,vn=_e.next()){ht.index>Tt?(tr=ht,ht=null):tr=ht.sibling;var Ko=Te(fe,ht,vn.value,Oe);if(Ko===null){ht===null&&(ht=tr);break}i&&ht&&Ko.alternate===null&&s(fe,ht),ce=b(Ko,ce,Tt),Gt===null?rt=Ko:Gt.sibling=Ko,Gt=Ko,ht=tr}if(vn.done)return c(fe,ht),Rt&&ge(fe,Tt),rt;if(ht===null){for(;!vn.done;Tt++,vn=_e.next())vn=De(fe,vn.value,Oe),vn!==null&&(ce=b(vn,ce,Tt),Gt===null?rt=vn:Gt.sibling=vn,Gt=vn);return Rt&&ge(fe,Tt),rt}for(ht=h(ht);!vn.done;Tt++,vn=_e.next())vn=Ee(ht,fe,Tt,vn.value,Oe),vn!==null&&(i&&vn.alternate!==null&&ht.delete(vn.key===null?Tt:vn.key),ce=b(vn,ce,Tt),Gt===null?rt=vn:Gt.sibling=vn,Gt=vn);return i&&ht.forEach(function(tN){return s(fe,tN)}),Rt&&ge(fe,Tt),rt}function Mn(fe,ce,_e,Oe){if(typeof _e=="object"&&_e!==null&&_e.type===H&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case I:e:{for(var rt=_e.key;ce!==null;){if(ce.key===rt){if(rt=_e.type,rt===H){if(ce.tag===7){c(fe,ce.sibling),Oe=g(ce,_e.props.children),Oe.return=fe,fe=Oe;break e}}else if(ce.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===M&&Lb(rt)===ce.type){c(fe,ce.sibling),Oe=g(ce,_e.props),id(Oe,_e),Oe.return=fe,fe=Oe;break e}c(fe,ce);break}else s(fe,ce);ce=ce.sibling}_e.type===H?(Oe=ca(_e.props.children,fe.mode,Oe,_e.key),Oe.return=fe,fe=Oe):(Oe=kl(_e.type,_e.key,_e.props,null,fe.mode,Oe),id(Oe,_e),Oe.return=fe,fe=Oe)}return C(fe);case G:e:{for(rt=_e.key;ce!==null;){if(ce.key===rt)if(ce.tag===4&&ce.stateNode.containerInfo===_e.containerInfo&&ce.stateNode.implementation===_e.implementation){c(fe,ce.sibling),Oe=g(ce,_e.children||[]),Oe.return=fe,fe=Oe;break e}else{c(fe,ce);break}else s(fe,ce);ce=ce.sibling}Oe=jc(_e,fe.mode,Oe),Oe.return=fe,fe=Oe}return C(fe);case M:return rt=_e._init,_e=rt(_e._payload),Mn(fe,ce,_e,Oe)}if(ae(_e))return At(fe,ce,_e,Oe);if(q(_e)){if(rt=q(_e),typeof rt!="function")throw Error(r(150));return _e=rt.call(_e),xt(fe,ce,_e,Oe)}if(typeof _e.then=="function")return Mn(fe,ce,rf(_e),Oe);if(_e.$$typeof===ue)return Mn(fe,ce,qh(fe,_e),Oe);sf(fe,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint"?(_e=""+_e,ce!==null&&ce.tag===6?(c(fe,ce.sibling),Oe=g(ce,_e),Oe.return=fe,fe=Oe):(c(fe,ce),Oe=qu(_e,fe.mode,Oe),Oe.return=fe,fe=Oe),C(fe)):c(fe,ce)}return function(fe,ce,_e,Oe){try{nd=0;var rt=Mn(fe,ce,_e,Oe);return kc=null,rt}catch(ht){if(ht===Zu||ht===Gh)throw ht;var Gt=Lr(29,ht,null,fe.mode);return Gt.lanes=Oe,Gt.return=fe,Gt}finally{}}}var Oc=Vb(!0),Ub=Vb(!1),Cs=W(null),da=null;function Mo(i){var s=i.alternate;te($i,$i.current&1),te(Cs,i),da===null&&(s===null||Rc.current!==null||s.memoizedState!==null)&&(da=i)}function Fb(i){if(i.tag===22){if(te($i,$i.current),te(Cs,i),da===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(da=i)}}else ko()}function ko(){te($i,$i.current),te(Cs,Cs.current)}function Ua(i){$(Cs),da===i&&(da=null),$($i)}var $i=W(0);function af(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||$g(c)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function ng(i,s,c,h){s=i.memoizedState,c=c(h,s),c=c==null?s:w({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var ig={enqueueSetState:function(i,s,c){i=i._reactInternals;var h=hs(),g=Ro(h);g.payload=s,c!=null&&(g.callback=c),s=Io(i,g,h),s!==null&&(fs(s,i,h),Wu(s,i,h))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var h=hs(),g=Ro(h);g.tag=1,g.payload=s,c!=null&&(g.callback=c),s=Io(i,g,h),s!==null&&(fs(s,i,h),Wu(s,i,h))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=hs(),h=Ro(c);h.tag=2,s!=null&&(h.callback=s),s=Io(i,h,c),s!==null&&(fs(s,i,c),Wu(s,i,c))}};function zb(i,s,c,h,g,b,C){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,b,C):s.prototype&&s.prototype.isPureReactComponent?!kr(c,h)||!kr(g,b):!0}function Bb(i,s,c,h){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,h),s.state!==i&&ig.enqueueReplaceState(s,s.state,null)}function zl(i,s){var c=s;if("ref"in s){c={};for(var h in s)h!=="ref"&&(c[h]=s[h])}if(i=i.defaultProps){c===s&&(c=w({},c));for(var g in i)c[g]===void 0&&(c[g]=i[g])}return c}var of=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function Hb(i){of(i)}function qb(i){console.error(i)}function $b(i){of(i)}function lf(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(h){setTimeout(function(){throw h})}}function Gb(i,s,c){try{var h=i.onCaughtError;h(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function rg(i,s,c){return c=Ro(c),c.tag=3,c.payload={element:null},c.callback=function(){lf(i,s)},c}function Zb(i){return i=Ro(i),i.tag=3,i}function Kb(i,s,c,h){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var b=h.value;i.payload=function(){return g(b)},i.callback=function(){Gb(s,c,h)}}var C=c.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(i.callback=function(){Gb(s,c,h),typeof g!="function"&&(Fo===null?Fo=new Set([this]):Fo.add(this));var V=h.stack;this.componentDidCatch(h.value,{componentStack:V!==null?V:""})})}function tA(i,s,c,h,g){if(c.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(s=c.alternate,s!==null&&Ll(s,c,g,!0),c=Cs.current,c!==null){switch(c.tag){case 13:return da===null?Ng():c.alternate===null&&vi===0&&(vi=3),c.flags&=-257,c.flags|=65536,c.lanes=g,h===Mp?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([h]):s.add(h),Rg(i,h,g)),!1;case 22:return c.flags|=65536,h===Mp?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([h])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([h]):c.add(h)),Rg(i,h,g)),!1}throw Error(r(435,c.tag))}return Rg(i,h,g),Ng(),!1}if(Rt)return s=Cs.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=g,h!==Xi&&(i=Error(r(422),{cause:h}),No(Or(i,c)))):(h!==Xi&&(s=Error(r(423),{cause:h}),No(Or(s,c))),i=i.current.alternate,i.flags|=65536,g&=-g,i.lanes|=g,h=Or(h,c),g=rg(i.stateNode,h,g),Dp(i,g),vi!==4&&(vi=2)),!1;var b=Error(r(520),{cause:h});if(b=Or(b,c),ud===null?ud=[b]:ud.push(b),vi!==4&&(vi=2),s===null)return!0;h=Or(h,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=g&-g,c.lanes|=i,i=rg(c.stateNode,h,i),Dp(c,i),!1;case 1:if(s=c.type,b=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Fo===null||!Fo.has(b))))return c.flags|=65536,g&=-g,c.lanes|=g,g=Zb(g),Kb(g,i,c,h),Dp(c,g),!1}c=c.return}while(c!==null);return!1}var Wb=Error(r(461)),Ji=!1;function lr(i,s,c,h){s.child=i===null?Ub(s,null,c,h):Oc(s,i.child,c,h)}function Yb(i,s,c,h,g){c=c.render;var b=s.ref;if("ref"in h){var C={};for(var V in h)V!=="ref"&&(C[V]=h[V])}else C=h;return Vl(s),h=zp(i,s,c,C,b,g),V=Bp(),i!==null&&!Ji?(Hp(i,s,g),Fa(i,s,g)):(Rt&&V&&Ve(s),s.flags|=1,lr(i,s,h,g),s.child)}function Qb(i,s,c,h,g){if(i===null){var b=c.type;return typeof b=="function"&&!Sc(b)&&b.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=b,Xb(i,s,b,h,g)):(i=kl(c.type,null,h,s,s.mode,g),i.ref=s.ref,i.return=s,s.child=i)}if(b=i.child,!hg(i,g)){var C=b.memoizedProps;if(c=c.compare,c=c!==null?c:kr,c(C,h)&&i.ref===s.ref)return Fa(i,s,g)}return s.flags|=1,i=As(b,h),i.ref=s.ref,i.return=s,s.child=i}function Xb(i,s,c,h,g){if(i!==null){var b=i.memoizedProps;if(kr(b,h)&&i.ref===s.ref)if(Ji=!1,s.pendingProps=h=b,hg(i,g))(i.flags&131072)!==0&&(Ji=!0);else return s.lanes=i.lanes,Fa(i,s,g)}return sg(i,s,c,h,g)}function Jb(i,s,c){var h=s.pendingProps,g=h.children,b=i!==null?i.memoizedState:null;if(h.mode==="hidden"){if((s.flags&128)!==0){if(h=b!==null?b.baseLanes|c:c,i!==null){for(g=s.child=i.child,b=0;g!==null;)b=b|g.lanes|g.childLanes,g=g.sibling;s.childLanes=b&~h}else s.childLanes=0,s.child=null;return ex(i,s,h,c)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&$h(s,b!==null?b.cachePool:null),b!==null?Xv(s,b):Vp(),Fb(s);else return s.lanes=s.childLanes=536870912,ex(i,s,b!==null?b.baseLanes|c:c,c)}else b!==null?($h(s,b.cachePool),Xv(s,b),ko(),s.memoizedState=null):(i!==null&&$h(s,null),Vp(),ko());return lr(i,s,g,c),s.child}function ex(i,s,c,h){var g=Pp();return g=g===null?null:{parent:qi._currentValue,pool:g},s.memoizedState={baseLanes:c,cachePool:g},i!==null&&$h(s,null),Vp(),Fb(s),i!==null&&Ll(i,s,h,!0),null}function cf(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function sg(i,s,c,h,g){return Vl(s),c=zp(i,s,c,h,void 0,g),h=Bp(),i!==null&&!Ji?(Hp(i,s,g),Fa(i,s,g)):(Rt&&h&&Ve(s),s.flags|=1,lr(i,s,c,g),s.child)}function tx(i,s,c,h,g,b){return Vl(s),s.updateQueue=null,c=eb(s,h,c,g),Jv(i),h=Bp(),i!==null&&!Ji?(Hp(i,s,b),Fa(i,s,b)):(Rt&&h&&Ve(s),s.flags|=1,lr(i,s,c,b),s.child)}function nx(i,s,c,h,g){if(Vl(s),s.stateNode===null){var b=Da,C=c.contextType;typeof C=="object"&&C!==null&&(b=Tr(C)),b=new c(h,b),s.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=ig,s.stateNode=b,b._reactInternals=s,b=s.stateNode,b.props=h,b.state=s.memoizedState,b.refs={},kp(s),C=c.contextType,b.context=typeof C=="object"&&C!==null?Tr(C):Da,b.state=s.memoizedState,C=c.getDerivedStateFromProps,typeof C=="function"&&(ng(s,c,C,h),b.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(C=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),C!==b.state&&ig.enqueueReplaceState(b,b.state,null),Qu(s,h,b,g),Yu(),b.state=s.memoizedState),typeof b.componentDidMount=="function"&&(s.flags|=4194308),h=!0}else if(i===null){b=s.stateNode;var V=s.memoizedProps,ne=zl(c,V);b.props=ne;var ve=b.context,Ie=c.contextType;C=Da,typeof Ie=="object"&&Ie!==null&&(C=Tr(Ie));var De=c.getDerivedStateFromProps;Ie=typeof De=="function"||typeof b.getSnapshotBeforeUpdate=="function",V=s.pendingProps!==V,Ie||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(V||ve!==C)&&Bb(s,b,h,C),Co=!1;var Te=s.memoizedState;b.state=Te,Qu(s,h,b,g),Yu(),ve=s.memoizedState,V||Te!==ve||Co?(typeof De=="function"&&(ng(s,c,De,h),ve=s.memoizedState),(ne=Co||zb(s,c,ne,h,Te,ve,C))?(Ie||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(s.flags|=4194308)):(typeof b.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=ve),b.props=h,b.state=ve,b.context=C,h=ne):(typeof b.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{b=s.stateNode,Op(i,s),C=s.memoizedProps,Ie=zl(c,C),b.props=Ie,De=s.pendingProps,Te=b.context,ve=c.contextType,ne=Da,typeof ve=="object"&&ve!==null&&(ne=Tr(ve)),V=c.getDerivedStateFromProps,(ve=typeof V=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C!==De||Te!==ne)&&Bb(s,b,h,ne),Co=!1,Te=s.memoizedState,b.state=Te,Qu(s,h,b,g),Yu();var Ee=s.memoizedState;C!==De||Te!==Ee||Co||i!==null&&i.dependencies!==null&&Hh(i.dependencies)?(typeof V=="function"&&(ng(s,c,V,h),Ee=s.memoizedState),(Ie=Co||zb(s,c,Ie,h,Te,Ee,ne)||i!==null&&i.dependencies!==null&&Hh(i.dependencies))?(ve||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(h,Ee,ne),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(h,Ee,ne)),typeof b.componentDidUpdate=="function"&&(s.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof b.componentDidUpdate!="function"||C===i.memoizedProps&&Te===i.memoizedState||(s.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&Te===i.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=Ee),b.props=h,b.state=Ee,b.context=ne,h=Ie):(typeof b.componentDidUpdate!="function"||C===i.memoizedProps&&Te===i.memoizedState||(s.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&Te===i.memoizedState||(s.flags|=1024),h=!1)}return b=h,cf(i,s),h=(s.flags&128)!==0,b||h?(b=s.stateNode,c=h&&typeof c.getDerivedStateFromError!="function"?null:b.render(),s.flags|=1,i!==null&&h?(s.child=Oc(s,i.child,null,g),s.child=Oc(s,null,c,g)):lr(i,s,c,g),s.memoizedState=b.state,i=s.child):i=Fa(i,s,g),i}function ix(i,s,c,h){return Ao(),s.flags|=256,lr(i,s,c,h),s.child}var ag={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function og(i){return{baseLanes:i,cachePool:qv()}}function lg(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=Rs),i}function rx(i,s,c){var h=s.pendingProps,g=!1,b=(s.flags&128)!==0,C;if((C=b)||(C=i!==null&&i.memoizedState===null?!1:($i.current&2)!==0),C&&(g=!0,s.flags&=-129),C=(s.flags&32)!==0,s.flags&=-33,i===null){if(Rt){if(g?Mo(s):ko(),Rt){var V=lt,ne;if(ne=V){e:{for(ne=V,V=ui;ne.nodeType!==8;){if(!V){V=null;break e}if(ne=Ks(ne.nextSibling),ne===null){V=null;break e}}V=ne}V!==null?(s.memoizedState={dehydrated:V,treeContext:S!==null?{id:O,overflow:ee}:null,retryLane:536870912,hydrationErrors:null},ne=Lr(18,null,null,0),ne.stateNode=V,ne.return=s,s.child=ne,it=s,lt=null,ne=!0):ne=!1}ne||qr(s)}if(V=s.memoizedState,V!==null&&(V=V.dehydrated,V!==null))return $g(V)?s.lanes=32:s.lanes=536870912,null;Ua(s)}return V=h.children,h=h.fallback,g?(ko(),g=s.mode,V=uf({mode:"hidden",children:V},g),h=ca(h,g,c,null),V.return=s,h.return=s,V.sibling=h,s.child=V,g=s.child,g.memoizedState=og(c),g.childLanes=lg(i,C,c),s.memoizedState=ag,h):(Mo(s),cg(s,V))}if(ne=i.memoizedState,ne!==null&&(V=ne.dehydrated,V!==null)){if(b)s.flags&256?(Mo(s),s.flags&=-257,s=ug(i,s,c)):s.memoizedState!==null?(ko(),s.child=i.child,s.flags|=128,s=null):(ko(),g=h.fallback,V=s.mode,h=uf({mode:"visible",children:h.children},V),g=ca(g,V,c,null),g.flags|=2,h.return=s,g.return=s,h.sibling=g,s.child=h,Oc(s,i.child,null,c),h=s.child,h.memoizedState=og(c),h.childLanes=lg(i,C,c),s.memoizedState=ag,s=g);else if(Mo(s),$g(V)){if(C=V.nextSibling&&V.nextSibling.dataset,C)var ve=C.dgst;C=ve,h=Error(r(419)),h.stack="",h.digest=C,No({value:h,source:null,stack:null}),s=ug(i,s,c)}else if(Ji||Ll(i,s,c,!1),C=(c&i.childLanes)!==0,Ji||C){if(C=Yn,C!==null&&(h=c&-c,h=(h&42)!==0?1:St(h),h=(h&(C.suspendedLanes|c))!==0?0:h,h!==0&&h!==ne.retryLane))throw ne.retryLane=h,So(i,h),fs(C,i,h),Wb;V.data==="$?"||Ng(),s=ug(i,s,c)}else V.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=ne.treeContext,lt=Ks(V.nextSibling),it=s,Rt=!0,Wn=null,ui=!1,i!==null&&(p[x++]=O,p[x++]=ee,p[x++]=S,O=i.id,ee=i.overflow,S=s),s=cg(s,h.children),s.flags|=4096);return s}return g?(ko(),g=h.fallback,V=s.mode,ne=i.child,ve=ne.sibling,h=As(ne,{mode:"hidden",children:h.children}),h.subtreeFlags=ne.subtreeFlags&65011712,ve!==null?g=As(ve,g):(g=ca(g,V,c,null),g.flags|=2),g.return=s,h.return=s,h.sibling=g,s.child=h,h=g,g=s.child,V=i.child.memoizedState,V===null?V=og(c):(ne=V.cachePool,ne!==null?(ve=qi._currentValue,ne=ne.parent!==ve?{parent:ve,pool:ve}:ne):ne=qv(),V={baseLanes:V.baseLanes|c,cachePool:ne}),g.memoizedState=V,g.childLanes=lg(i,C,c),s.memoizedState=ag,h):(Mo(s),c=i.child,i=c.sibling,c=As(c,{mode:"visible",children:h.children}),c.return=s,c.sibling=null,i!==null&&(C=s.deletions,C===null?(s.deletions=[i],s.flags|=16):C.push(i)),s.child=c,s.memoizedState=null,c)}function cg(i,s){return s=uf({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function uf(i,s){return i=Lr(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function ug(i,s,c){return Oc(s,i.child,null,c),i=cg(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function sx(i,s,c){i.lanes|=s;var h=i.alternate;h!==null&&(h.lanes|=s),Dl(i.return,s,c)}function dg(i,s,c,h,g){var b=i.memoizedState;b===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g}:(b.isBackwards=s,b.rendering=null,b.renderingStartTime=0,b.last=h,b.tail=c,b.tailMode=g)}function ax(i,s,c){var h=s.pendingProps,g=h.revealOrder,b=h.tail;if(lr(i,s,h.children,c),h=$i.current,(h&2)!==0)h=h&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&sx(i,c,s);else if(i.tag===19)sx(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}switch(te($i,h),g){case"forwards":for(c=s.child,g=null;c!==null;)i=c.alternate,i!==null&&af(i)===null&&(g=c),c=c.sibling;c=g,c===null?(g=s.child,s.child=null):(g=c.sibling,c.sibling=null),dg(s,!1,g,c,b);break;case"backwards":for(c=null,g=s.child,s.child=null;g!==null;){if(i=g.alternate,i!==null&&af(i)===null){s.child=g;break}i=g.sibling,g.sibling=c,c=g,g=i}dg(s,!0,c,null,b);break;case"together":dg(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Fa(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),Uo|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(Ll(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(r(153));if(s.child!==null){for(i=s.child,c=As(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=As(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function hg(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&Hh(i)))}function nA(i,s,c){switch(s.tag){case 3:he(s,s.stateNode.containerInfo),ua(s,qi,i.memoizedState.cache),Ao();break;case 27:case 5:K(s);break;case 4:he(s,s.stateNode.containerInfo);break;case 10:ua(s,s.type,s.memoizedProps.value);break;case 13:var h=s.memoizedState;if(h!==null)return h.dehydrated!==null?(Mo(s),s.flags|=128,null):(c&s.child.childLanes)!==0?rx(i,s,c):(Mo(s),i=Fa(i,s,c),i!==null?i.sibling:null);Mo(s);break;case 19:var g=(i.flags&128)!==0;if(h=(c&s.childLanes)!==0,h||(Ll(i,s,c,!1),h=(c&s.childLanes)!==0),g){if(h)return ax(i,s,c);s.flags|=128}if(g=s.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),te($i,$i.current),h)break;return null;case 22:case 23:return s.lanes=0,Jb(i,s,c);case 24:ua(s,qi,i.memoizedState.cache)}return Fa(i,s,c)}function ox(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)Ji=!0;else{if(!hg(i,c)&&(s.flags&128)===0)return Ji=!1,nA(i,s,c);Ji=(i.flags&131072)!==0}else Ji=!1,Rt&&(s.flags&1048576)!==0&&Se(s,d,s.index);switch(s.lanes=0,s.tag){case 16:e:{i=s.pendingProps;var h=s.elementType,g=h._init;if(h=g(h._payload),s.type=h,typeof h=="function")Sc(h)?(i=zl(h,i),s.tag=1,s=nx(null,s,h,i,c)):(s.tag=0,s=sg(null,s,h,i,c));else{if(h!=null){if(g=h.$$typeof,g===we){s.tag=11,s=Yb(null,s,h,i,c);break e}else if(g===P){s.tag=14,s=Qb(null,s,h,i,c);break e}}throw s=de(h)||h,Error(r(306,s,""))}}return s;case 0:return sg(i,s,s.type,s.pendingProps,c);case 1:return h=s.type,g=zl(h,s.pendingProps),nx(i,s,h,g,c);case 3:e:{if(he(s,s.stateNode.containerInfo),i===null)throw Error(r(387));h=s.pendingProps;var b=s.memoizedState;g=b.element,Op(i,s),Qu(s,h,null,c);var C=s.memoizedState;if(h=C.cache,ua(s,qi,h),h!==b.cache&&Ac(s,[qi],c,!0),Yu(),h=C.element,b.isDehydrated)if(b={element:h,isDehydrated:!1,cache:C.cache},s.updateQueue.baseState=b,s.memoizedState=b,s.flags&256){s=ix(i,s,h,c);break e}else if(h!==g){g=Or(Error(r(424)),s),No(g),s=ix(i,s,h,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(lt=Ks(i.firstChild),it=s,Rt=!0,Wn=null,ui=!0,c=Ub(s,null,h,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Ao(),h===g){s=Fa(i,s,c);break e}lr(i,s,h,c)}s=s.child}return s;case 26:return cf(i,s),i===null?(c=d0(s.type,null,s.pendingProps,null))?s.memoizedState=c:Rt||(c=s.type,i=s.pendingProps,h=Ef(oe.current).createElement(c),h[Mt]=s,h[ke]=i,ur(h,c,i),fn(h),s.stateNode=h):s.memoizedState=d0(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return K(s),i===null&&Rt&&(h=s.stateNode=l0(s.type,s.pendingProps,oe.current),it=s,ui=!0,g=lt,Ho(s.type)?(Gg=g,lt=Ks(h.firstChild)):lt=g),lr(i,s,s.pendingProps.children,c),cf(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Rt&&((g=h=lt)&&(h=RA(h,s.type,s.pendingProps,ui),h!==null?(s.stateNode=h,it=s,lt=Ks(h.firstChild),ui=!1,g=!0):g=!1),g||qr(s)),K(s),g=s.type,b=s.pendingProps,C=i!==null?i.memoizedProps:null,h=b.children,Bg(g,b)?h=null:C!==null&&Bg(g,C)&&(s.flags|=32),s.memoizedState!==null&&(g=zp(i,s,Kj,null,null,c),vd._currentValue=g),cf(i,s),lr(i,s,h,c),s.child;case 6:return i===null&&Rt&&((i=c=lt)&&(c=IA(c,s.pendingProps,ui),c!==null?(s.stateNode=c,it=s,lt=null,i=!0):i=!1),i||qr(s)),null;case 13:return rx(i,s,c);case 4:return he(s,s.stateNode.containerInfo),h=s.pendingProps,i===null?s.child=Oc(s,null,h,c):lr(i,s,h,c),s.child;case 11:return Yb(i,s,s.type,s.pendingProps,c);case 7:return lr(i,s,s.pendingProps,c),s.child;case 8:return lr(i,s,s.pendingProps.children,c),s.child;case 12:return lr(i,s,s.pendingProps.children,c),s.child;case 10:return h=s.pendingProps,ua(s,s.type,h.value),lr(i,s,h.children,c),s.child;case 9:return g=s.type._context,h=s.pendingProps.children,Vl(s),g=Tr(g),h=h(g),s.flags|=1,lr(i,s,h,c),s.child;case 14:return Qb(i,s,s.type,s.pendingProps,c);case 15:return Xb(i,s,s.type,s.pendingProps,c);case 19:return ax(i,s,c);case 31:return h=s.pendingProps,c=s.mode,h={mode:h.mode,children:h.children},i===null?(c=uf(h,c),c.ref=s.ref,s.child=c,c.return=s,s=c):(c=As(i.child,h),c.ref=s.ref,s.child=c,c.return=s,s=c),s;case 22:return Jb(i,s,c);case 24:return Vl(s),h=Tr(qi),i===null?(g=Pp(),g===null&&(g=Yn,b=Rp(),g.pooledCache=b,b.refCount++,b!==null&&(g.pooledCacheLanes|=c),g=b),s.memoizedState={parent:h,cache:g},kp(s),ua(s,qi,g)):((i.lanes&c)!==0&&(Op(i,s),Qu(s,null,null,c),Yu()),g=i.memoizedState,b=s.memoizedState,g.parent!==h?(g={parent:h,cache:h},s.memoizedState=g,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=g),ua(s,qi,h)):(h=b.cache,ua(s,qi,h),h!==g.cache&&Ac(s,[qi],c,!0))),lr(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(r(156,s.tag))}function za(i){i.flags|=4}function lx(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!g0(s)){if(s=Cs.current,s!==null&&((ln&4194048)===ln?da!==null:(ln&62914560)!==ln&&(ln&536870912)===0||s!==da))throw Ku=Mp,$v;i.flags|=8192}}function df(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Xn():536870912,i.lanes|=s,Uc|=s)}function rd(i,s){if(!Rt)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function di(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,h=0;if(s)for(var g=i.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=h,i.childLanes=c,s}function iA(i,s,c){var h=s.pendingProps;switch(Qe(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return di(s),null;case 1:return di(s),null;case 3:return c=s.stateNode,h=null,i!==null&&(h=i.memoizedState.cache),s.memoizedState.cache!==h&&(s.flags|=2048),Gs(qi),Ae(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Ol(s)?za(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Bh())),di(s),null;case 26:return c=s.memoizedState,i===null?(za(s),c!==null?(di(s),lx(s,c)):(di(s),s.flags&=-16777217)):c?c!==i.memoizedState?(za(s),di(s),lx(s,c)):(di(s),s.flags&=-16777217):(i.memoizedProps!==h&&za(s),di(s),s.flags&=-16777217),null;case 27:le(s),c=oe.current;var g=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==h&&za(s);else{if(!h){if(s.stateNode===null)throw Error(r(166));return di(s),null}i=me.current,Ol(s)?Fh(s):(i=l0(g,h,c),s.stateNode=i,za(s))}return di(s),null;case 5:if(le(s),c=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==h&&za(s);else{if(!h){if(s.stateNode===null)throw Error(r(166));return di(s),null}if(i=me.current,Ol(s))Fh(s);else{switch(g=Ef(oe.current),i){case 1:i=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:i=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":i=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":i=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":i=g.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof h.is=="string"?g.createElement("select",{is:h.is}):g.createElement("select"),h.multiple?i.multiple=!0:h.size&&(i.size=h.size);break;default:i=typeof h.is=="string"?g.createElement(c,{is:h.is}):g.createElement(c)}}i[Mt]=s,i[ke]=h;e:for(g=s.child;g!==null;){if(g.tag===5||g.tag===6)i.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===s)break e;for(;g.sibling===null;){if(g.return===null||g.return===s)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}s.stateNode=i;e:switch(ur(i,c,h),c){case"button":case"input":case"select":case"textarea":i=!!h.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&za(s)}}return di(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==h&&za(s);else{if(typeof h!="string"&&s.stateNode===null)throw Error(r(166));if(i=oe.current,Ol(s)){if(i=s.stateNode,c=s.memoizedProps,h=null,g=it,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}i[Mt]=s,i=!!(i.nodeValue===c||h!==null&&h.suppressHydrationWarning===!0||t0(i.nodeValue,c)),i||qr(s)}else i=Ef(i).createTextNode(h),i[Mt]=s,s.stateNode=i}return di(s),null;case 13:if(h=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(g=Ol(s),h!==null&&h.dehydrated!==null){if(i===null){if(!g)throw Error(r(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(r(317));g[Mt]=s}else Ao(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;di(s),g=!1}else g=Bh(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=g),g=!0;if(!g)return s.flags&256?(Ua(s),s):(Ua(s),null)}if(Ua(s),(s.flags&128)!==0)return s.lanes=c,s;if(c=h!==null,i=i!==null&&i.memoizedState!==null,c){h=s.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool);var b=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==g&&(h.flags|=2048)}return c!==i&&c&&(s.child.flags|=8192),df(s,s.updateQueue),di(s),null;case 4:return Ae(),i===null&&Lg(s.stateNode.containerInfo),di(s),null;case 10:return Gs(s.type),di(s),null;case 19:if($($i),g=s.memoizedState,g===null)return di(s),null;if(h=(s.flags&128)!==0,b=g.rendering,b===null)if(h)rd(g,!1);else{if(vi!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(b=af(i),b!==null){for(s.flags|=128,rd(g,!1),i=b.updateQueue,s.updateQueue=i,df(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Hu(c,i),c=c.sibling;return te($i,$i.current&1|2),s.child}i=i.sibling}g.tail!==null&&Ot()>mf&&(s.flags|=128,h=!0,rd(g,!1),s.lanes=4194304)}else{if(!h)if(i=af(b),i!==null){if(s.flags|=128,h=!0,i=i.updateQueue,s.updateQueue=i,df(s,i),rd(g,!0),g.tail===null&&g.tailMode==="hidden"&&!b.alternate&&!Rt)return di(s),null}else 2*Ot()-g.renderingStartTime>mf&&c!==536870912&&(s.flags|=128,h=!0,rd(g,!1),s.lanes=4194304);g.isBackwards?(b.sibling=s.child,s.child=b):(i=g.last,i!==null?i.sibling=b:s.child=b,g.last=b)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=Ot(),s.sibling=null,i=$i.current,te($i,h?i&1|2:i&1),s):(di(s),null);case 22:case 23:return Ua(s),Up(),h=s.memoizedState!==null,i!==null?i.memoizedState!==null!==h&&(s.flags|=8192):h&&(s.flags|=8192),h?(c&536870912)!==0&&(s.flags&128)===0&&(di(s),s.subtreeFlags&6&&(s.flags|=8192)):di(s),c=s.updateQueue,c!==null&&df(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),h=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(h=s.memoizedState.cachePool.pool),h!==c&&(s.flags|=2048),i!==null&&$(Ul),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Gs(qi),di(s),null;case 25:return null;case 30:return null}throw Error(r(156,s.tag))}function rA(i,s){switch(Qe(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Gs(qi),Ae(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return le(s),null;case 13:if(Ua(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(r(340));Ao()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return $($i),null;case 4:return Ae(),null;case 10:return Gs(s.type),null;case 22:case 23:return Ua(s),Up(),i!==null&&$(Ul),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Gs(qi),null;case 25:return null;default:return null}}function cx(i,s){switch(Qe(s),s.tag){case 3:Gs(qi),Ae();break;case 26:case 27:case 5:le(s);break;case 4:Ae();break;case 13:Ua(s);break;case 19:$($i);break;case 10:Gs(s.type);break;case 22:case 23:Ua(s),Up(),i!==null&&$(Ul);break;case 24:Gs(qi)}}function sd(i,s){try{var c=s.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var g=h.next;c=g;do{if((c.tag&i)===i){h=void 0;var b=c.create,C=c.inst;h=b(),C.destroy=h}c=c.next}while(c!==g)}}catch(V){Bn(s,s.return,V)}}function Oo(i,s,c){try{var h=s.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var b=g.next;h=b;do{if((h.tag&i)===i){var C=h.inst,V=C.destroy;if(V!==void 0){C.destroy=void 0,g=s;var ne=c,ve=V;try{ve()}catch(Ie){Bn(g,ne,Ie)}}}h=h.next}while(h!==b)}}catch(Ie){Bn(s,s.return,Ie)}}function ux(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{Qv(s,c)}catch(h){Bn(i,i.return,h)}}}function dx(i,s,c){c.props=zl(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(h){Bn(i,s,h)}}function ad(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var h=i.stateNode;break;case 30:h=i.stateNode;break;default:h=i.stateNode}typeof c=="function"?i.refCleanup=c(h):c.current=h}}catch(g){Bn(i,s,g)}}function ha(i,s){var c=i.ref,h=i.refCleanup;if(c!==null)if(typeof h=="function")try{h()}catch(g){Bn(i,s,g)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Bn(i,s,g)}else c.current=null}function hx(i){var s=i.type,c=i.memoizedProps,h=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&h.focus();break e;case"img":c.src?h.src=c.src:c.srcSet&&(h.srcset=c.srcSet)}}catch(g){Bn(i,i.return,g)}}function fg(i,s,c){try{var h=i.stateNode;SA(h,i.type,c,s),h[ke]=s}catch(g){Bn(i,i.return,g)}}function fx(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Ho(i.type)||i.tag===4}function mg(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||fx(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Ho(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function pg(i,s,c){var h=i.tag;if(h===5||h===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=wf));else if(h!==4&&(h===27&&Ho(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(pg(i,s,c),i=i.sibling;i!==null;)pg(i,s,c),i=i.sibling}function hf(i,s,c){var h=i.tag;if(h===5||h===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(h!==4&&(h===27&&Ho(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(hf(i,s,c),i=i.sibling;i!==null;)hf(i,s,c),i=i.sibling}function mx(i){var s=i.stateNode,c=i.memoizedProps;try{for(var h=i.type,g=s.attributes;g.length;)s.removeAttributeNode(g[0]);ur(s,h,c),s[Mt]=i,s[ke]=c}catch(b){Bn(i,i.return,b)}}var Ba=!1,Ci=!1,gg=!1,px=typeof WeakSet=="function"?WeakSet:Set,er=null;function sA(i,s){if(i=i.containerInfo,Fg=Rf,i=Nl(i),Cl(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,b=h.focusNode;h=h.focusOffset;try{c.nodeType,b.nodeType}catch{c=null;break e}var C=0,V=-1,ne=-1,ve=0,Ie=0,De=i,Te=null;t:for(;;){for(var Ee;De!==c||g!==0&&De.nodeType!==3||(V=C+g),De!==b||h!==0&&De.nodeType!==3||(ne=C+h),De.nodeType===3&&(C+=De.nodeValue.length),(Ee=De.firstChild)!==null;)Te=De,De=Ee;for(;;){if(De===i)break t;if(Te===c&&++ve===g&&(V=C),Te===b&&++Ie===h&&(ne=C),(Ee=De.nextSibling)!==null)break;De=Te,Te=De.parentNode}De=Ee}c=V===-1||ne===-1?null:{start:V,end:ne}}else c=null}c=c||{start:0,end:0}}else c=null;for(zg={focusedElem:i,selectionRange:c},Rf=!1,er=s;er!==null;)if(s=er,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,er=i;else for(;er!==null;){switch(s=er,b=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&b!==null){i=void 0,c=s,g=b.memoizedProps,b=b.memoizedState,h=c.stateNode;try{var At=zl(c.type,g,c.elementType===c.type);i=h.getSnapshotBeforeUpdate(At,b),h.__reactInternalSnapshotBeforeUpdate=i}catch(xt){Bn(c,c.return,xt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)qg(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":qg(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=s.sibling,i!==null){i.return=s.return,er=i;break}er=s.return}}function gx(i,s,c){var h=c.flags;switch(c.tag){case 0:case 11:case 15:Do(i,c),h&4&&sd(5,c);break;case 1:if(Do(i,c),h&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(C){Bn(c,c.return,C)}else{var g=zl(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(g,s,i.__reactInternalSnapshotBeforeUpdate)}catch(C){Bn(c,c.return,C)}}h&64&&ux(c),h&512&&ad(c,c.return);break;case 3:if(Do(i,c),h&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Qv(i,s)}catch(C){Bn(c,c.return,C)}}break;case 27:s===null&&h&4&&mx(c);case 26:case 5:Do(i,c),s===null&&h&4&&hx(c),h&512&&ad(c,c.return);break;case 12:Do(i,c);break;case 13:Do(i,c),h&4&&vx(i,c),h&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=mA.bind(null,c),PA(i,c))));break;case 22:if(h=c.memoizedState!==null||Ba,!h){s=s!==null&&s.memoizedState!==null||Ci,g=Ba;var b=Ci;Ba=h,(Ci=s)&&!b?Lo(i,c,(c.subtreeFlags&8772)!==0):Do(i,c),Ba=g,Ci=b}break;case 30:break;default:Do(i,c)}}function yx(i){var s=i.alternate;s!==null&&(i.alternate=null,yx(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&sr(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ai=null,Gr=!1;function Ha(i,s,c){for(c=c.child;c!==null;)_x(i,s,c),c=c.sibling}function _x(i,s,c){if(ct&&typeof ct.onCommitFiberUnmount=="function")try{ct.onCommitFiberUnmount(yt,c)}catch{}switch(c.tag){case 26:Ci||ha(c,s),Ha(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Ci||ha(c,s);var h=ai,g=Gr;Ho(c.type)&&(ai=c.stateNode,Gr=!1),Ha(i,s,c),pd(c.stateNode),ai=h,Gr=g;break;case 5:Ci||ha(c,s);case 6:if(h=ai,g=Gr,ai=null,Ha(i,s,c),ai=h,Gr=g,ai!==null)if(Gr)try{(ai.nodeType===9?ai.body:ai.nodeName==="HTML"?ai.ownerDocument.body:ai).removeChild(c.stateNode)}catch(b){Bn(c,s,b)}else try{ai.removeChild(c.stateNode)}catch(b){Bn(c,s,b)}break;case 18:ai!==null&&(Gr?(i=ai,a0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),wd(i)):a0(ai,c.stateNode));break;case 4:h=ai,g=Gr,ai=c.stateNode.containerInfo,Gr=!0,Ha(i,s,c),ai=h,Gr=g;break;case 0:case 11:case 14:case 15:Ci||Oo(2,c,s),Ci||Oo(4,c,s),Ha(i,s,c);break;case 1:Ci||(ha(c,s),h=c.stateNode,typeof h.componentWillUnmount=="function"&&dx(c,s,h)),Ha(i,s,c);break;case 21:Ha(i,s,c);break;case 22:Ci=(h=Ci)||c.memoizedState!==null,Ha(i,s,c),Ci=h;break;default:Ha(i,s,c)}}function vx(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{wd(i)}catch(c){Bn(s,s.return,c)}}function aA(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new px),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new px),s;default:throw Error(r(435,i.tag))}}function yg(i,s){var c=aA(i);s.forEach(function(h){var g=pA.bind(null,i,h);c.has(h)||(c.add(h),h.then(g,g))})}function cs(i,s){var c=s.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h],b=i,C=s,V=C;e:for(;V!==null;){switch(V.tag){case 27:if(Ho(V.type)){ai=V.stateNode,Gr=!1;break e}break;case 5:ai=V.stateNode,Gr=!1;break e;case 3:case 4:ai=V.stateNode.containerInfo,Gr=!0;break e}V=V.return}if(ai===null)throw Error(r(160));_x(b,C,g),ai=null,Gr=!1,b=g.alternate,b!==null&&(b.return=null),g.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)bx(s,i),s=s.sibling}var Zs=null;function bx(i,s){var c=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:cs(s,i),us(i),h&4&&(Oo(3,i,i.return),sd(3,i),Oo(5,i,i.return));break;case 1:cs(s,i),us(i),h&512&&(Ci||c===null||ha(c,c.return)),h&64&&Ba&&(i=i.updateQueue,i!==null&&(h=i.callbacks,h!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?h:c.concat(h))));break;case 26:var g=Zs;if(cs(s,i),us(i),h&512&&(Ci||c===null||ha(c,c.return)),h&4){var b=c!==null?c.memoizedState:null;if(h=i.memoizedState,c===null)if(h===null)if(i.stateNode===null){e:{h=i.type,c=i.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":b=g.getElementsByTagName("title")[0],(!b||b[Ti]||b[Mt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=g.createElement(h),g.head.insertBefore(b,g.querySelector("head > title"))),ur(b,h,c),b[Mt]=i,fn(b),h=b;break e;case"link":var C=m0("link","href",g).get(h+(c.href||""));if(C){for(var V=0;V<C.length;V++)if(b=C[V],b.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&b.getAttribute("rel")===(c.rel==null?null:c.rel)&&b.getAttribute("title")===(c.title==null?null:c.title)&&b.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){C.splice(V,1);break t}}b=g.createElement(h),ur(b,h,c),g.head.appendChild(b);break;case"meta":if(C=m0("meta","content",g).get(h+(c.content||""))){for(V=0;V<C.length;V++)if(b=C[V],b.getAttribute("content")===(c.content==null?null:""+c.content)&&b.getAttribute("name")===(c.name==null?null:c.name)&&b.getAttribute("property")===(c.property==null?null:c.property)&&b.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&b.getAttribute("charset")===(c.charSet==null?null:c.charSet)){C.splice(V,1);break t}}b=g.createElement(h),ur(b,h,c),g.head.appendChild(b);break;default:throw Error(r(468,h))}b[Mt]=i,fn(b),h=b}i.stateNode=h}else p0(g,i.type,i.stateNode);else i.stateNode=f0(g,h,i.memoizedProps);else b!==h?(b===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):b.count--,h===null?p0(g,i.type,i.stateNode):f0(g,h,i.memoizedProps)):h===null&&i.stateNode!==null&&fg(i,i.memoizedProps,c.memoizedProps)}break;case 27:cs(s,i),us(i),h&512&&(Ci||c===null||ha(c,c.return)),c!==null&&h&4&&fg(i,i.memoizedProps,c.memoizedProps);break;case 5:if(cs(s,i),us(i),h&512&&(Ci||c===null||ha(c,c.return)),i.flags&32){g=i.stateNode;try{et(g,"")}catch(Ee){Bn(i,i.return,Ee)}}h&4&&i.stateNode!=null&&(g=i.memoizedProps,fg(i,g,c!==null?c.memoizedProps:g)),h&1024&&(gg=!0);break;case 6:if(cs(s,i),us(i),h&4){if(i.stateNode===null)throw Error(r(162));h=i.memoizedProps,c=i.stateNode;try{c.nodeValue=h}catch(Ee){Bn(i,i.return,Ee)}}break;case 3:if(Af=null,g=Zs,Zs=Sf(s.containerInfo),cs(s,i),Zs=g,us(i),h&4&&c!==null&&c.memoizedState.isDehydrated)try{wd(s.containerInfo)}catch(Ee){Bn(i,i.return,Ee)}gg&&(gg=!1,xx(i));break;case 4:h=Zs,Zs=Sf(i.stateNode.containerInfo),cs(s,i),us(i),Zs=h;break;case 12:cs(s,i),us(i);break;case 13:cs(s,i),us(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(wg=Ot()),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,yg(i,h)));break;case 22:g=i.memoizedState!==null;var ne=c!==null&&c.memoizedState!==null,ve=Ba,Ie=Ci;if(Ba=ve||g,Ci=Ie||ne,cs(s,i),Ci=Ie,Ba=ve,us(i),h&8192)e:for(s=i.stateNode,s._visibility=g?s._visibility&-2:s._visibility|1,g&&(c===null||ne||Ba||Ci||Bl(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){ne=c=s;try{if(b=ne.stateNode,g)C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{V=ne.stateNode;var De=ne.memoizedProps.style,Te=De!=null&&De.hasOwnProperty("display")?De.display:null;V.style.display=Te==null||typeof Te=="boolean"?"":(""+Te).trim()}}catch(Ee){Bn(ne,ne.return,Ee)}}}else if(s.tag===6){if(c===null){ne=s;try{ne.stateNode.nodeValue=g?"":ne.memoizedProps}catch(Ee){Bn(ne,ne.return,Ee)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}h&4&&(h=i.updateQueue,h!==null&&(c=h.retryQueue,c!==null&&(h.retryQueue=null,yg(i,c))));break;case 19:cs(s,i),us(i),h&4&&(h=i.updateQueue,h!==null&&(i.updateQueue=null,yg(i,h)));break;case 30:break;case 21:break;default:cs(s,i),us(i)}}function us(i){var s=i.flags;if(s&2){try{for(var c,h=i.return;h!==null;){if(fx(h)){c=h;break}h=h.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var g=c.stateNode,b=mg(i);hf(i,b,g);break;case 5:var C=c.stateNode;c.flags&32&&(et(C,""),c.flags&=-33);var V=mg(i);hf(i,V,C);break;case 3:case 4:var ne=c.stateNode.containerInfo,ve=mg(i);pg(i,ve,ne);break;default:throw Error(r(161))}}catch(Ie){Bn(i,i.return,Ie)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function xx(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;xx(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function Do(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)gx(i,s.alternate,s),s=s.sibling}function Bl(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Oo(4,s,s.return),Bl(s);break;case 1:ha(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&dx(s,s.return,c),Bl(s);break;case 27:pd(s.stateNode);case 26:case 5:ha(s,s.return),Bl(s);break;case 22:s.memoizedState===null&&Bl(s);break;case 30:Bl(s);break;default:Bl(s)}i=i.sibling}}function Lo(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var h=s.alternate,g=i,b=s,C=b.flags;switch(b.tag){case 0:case 11:case 15:Lo(g,b,c),sd(4,b);break;case 1:if(Lo(g,b,c),h=b,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(ve){Bn(h,h.return,ve)}if(h=b,g=h.updateQueue,g!==null){var V=h.stateNode;try{var ne=g.shared.hiddenCallbacks;if(ne!==null)for(g.shared.hiddenCallbacks=null,g=0;g<ne.length;g++)Yv(ne[g],V)}catch(ve){Bn(h,h.return,ve)}}c&&C&64&&ux(b),ad(b,b.return);break;case 27:mx(b);case 26:case 5:Lo(g,b,c),c&&h===null&&C&4&&hx(b),ad(b,b.return);break;case 12:Lo(g,b,c);break;case 13:Lo(g,b,c),c&&C&4&&vx(g,b);break;case 22:b.memoizedState===null&&Lo(g,b,c),ad(b,b.return);break;case 30:break;default:Lo(g,b,c)}s=s.sibling}}function _g(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&$u(c))}function vg(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&$u(i))}function fa(i,s,c,h){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Tx(i,s,c,h),s=s.sibling}function Tx(i,s,c,h){var g=s.flags;switch(s.tag){case 0:case 11:case 15:fa(i,s,c,h),g&2048&&sd(9,s);break;case 1:fa(i,s,c,h);break;case 3:fa(i,s,c,h),g&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&$u(i)));break;case 12:if(g&2048){fa(i,s,c,h),i=s.stateNode;try{var b=s.memoizedProps,C=b.id,V=b.onPostCommit;typeof V=="function"&&V(C,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ne){Bn(s,s.return,ne)}}else fa(i,s,c,h);break;case 13:fa(i,s,c,h);break;case 23:break;case 22:b=s.stateNode,C=s.alternate,s.memoizedState!==null?b._visibility&2?fa(i,s,c,h):od(i,s):b._visibility&2?fa(i,s,c,h):(b._visibility|=2,Dc(i,s,c,h,(s.subtreeFlags&10256)!==0)),g&2048&&_g(C,s);break;case 24:fa(i,s,c,h),g&2048&&vg(s.alternate,s);break;default:fa(i,s,c,h)}}function Dc(i,s,c,h,g){for(g=g&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var b=i,C=s,V=c,ne=h,ve=C.flags;switch(C.tag){case 0:case 11:case 15:Dc(b,C,V,ne,g),sd(8,C);break;case 23:break;case 22:var Ie=C.stateNode;C.memoizedState!==null?Ie._visibility&2?Dc(b,C,V,ne,g):od(b,C):(Ie._visibility|=2,Dc(b,C,V,ne,g)),g&&ve&2048&&_g(C.alternate,C);break;case 24:Dc(b,C,V,ne,g),g&&ve&2048&&vg(C.alternate,C);break;default:Dc(b,C,V,ne,g)}s=s.sibling}}function od(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,h=s,g=h.flags;switch(h.tag){case 22:od(c,h),g&2048&&_g(h.alternate,h);break;case 24:od(c,h),g&2048&&vg(h.alternate,h);break;default:od(c,h)}s=s.sibling}}var ld=8192;function Lc(i){if(i.subtreeFlags&ld)for(i=i.child;i!==null;)wx(i),i=i.sibling}function wx(i){switch(i.tag){case 26:Lc(i),i.flags&ld&&i.memoizedState!==null&&$A(Zs,i.memoizedState,i.memoizedProps);break;case 5:Lc(i);break;case 3:case 4:var s=Zs;Zs=Sf(i.stateNode.containerInfo),Lc(i),Zs=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=ld,ld=16777216,Lc(i),ld=s):Lc(i));break;default:Lc(i)}}function Ex(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function cd(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var h=s[c];er=h,jx(h,i)}Ex(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Sx(i),i=i.sibling}function Sx(i){switch(i.tag){case 0:case 11:case 15:cd(i),i.flags&2048&&Oo(9,i,i.return);break;case 3:cd(i);break;case 12:cd(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,ff(i)):cd(i);break;default:cd(i)}}function ff(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var h=s[c];er=h,jx(h,i)}Ex(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Oo(8,s,s.return),ff(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,ff(s));break;default:ff(s)}i=i.sibling}}function jx(i,s){for(;er!==null;){var c=er;switch(c.tag){case 0:case 11:case 15:Oo(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var h=c.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:$u(c.memoizedState.cache)}if(h=c.child,h!==null)h.return=c,er=h;else e:for(c=i;er!==null;){h=er;var g=h.sibling,b=h.return;if(yx(h),h===c){er=null;break e}if(g!==null){g.return=b,er=g;break e}er=b}}}var oA={getCacheForType:function(i){var s=Tr(qi),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c}},lA=typeof WeakMap=="function"?WeakMap:Map,jn=0,Yn=null,Xt=null,ln=0,An=0,ds=null,Vo=!1,Vc=!1,bg=!1,qa=0,vi=0,Uo=0,Hl=0,xg=0,Rs=0,Uc=0,ud=null,Zr=null,Tg=!1,wg=0,mf=1/0,pf=null,Fo=null,cr=0,zo=null,Fc=null,zc=0,Eg=0,Sg=null,Ax=null,dd=0,jg=null;function hs(){if((jn&2)!==0&&ln!==0)return ln&-ln;if(Y.T!==null){var i=Nc;return i!==0?i:Mg()}return gn()}function Nx(){Rs===0&&(Rs=(ln&536870912)===0||Rt?$n():536870912);var i=Cs.current;return i!==null&&(i.flags|=32),Rs}function fs(i,s,c){(i===Yn&&(An===2||An===9)||i.cancelPendingCommit!==null)&&(Bc(i,0),Bo(i,ln,Rs,!1)),Yt(i,c),((jn&2)===0||i!==Yn)&&(i===Yn&&((jn&2)===0&&(Hl|=c),vi===4&&Bo(i,ln,Rs,!1)),ma(i))}function Cx(i,s,c){if((jn&6)!==0)throw Error(r(327));var h=!c&&(s&124)===0&&(s&i.expiredLanes)===0||st(i,s),g=h?dA(i,s):Cg(i,s,!0),b=h;do{if(g===0){Vc&&!h&&Bo(i,s,0,!1);break}else{if(c=i.current.alternate,b&&!cA(c)){g=Cg(i,s,!1),b=!1;continue}if(g===2){if(b=s,i.errorRecoveryDisabledLanes&b)var C=0;else C=i.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){s=C;e:{var V=i;g=ud;var ne=V.current.memoizedState.isDehydrated;if(ne&&(Bc(V,C).flags|=256),C=Cg(V,C,!1),C!==2){if(bg&&!ne){V.errorRecoveryDisabledLanes|=b,Hl|=b,g=4;break e}b=Zr,Zr=g,b!==null&&(Zr===null?Zr=b:Zr.push.apply(Zr,b))}g=C}if(b=!1,g!==2)continue}}if(g===1){Bc(i,0),Bo(i,s,0,!0);break}e:{switch(h=i,b=g,b){case 0:case 1:throw Error(r(345));case 4:if((s&4194048)!==s)break;case 6:Bo(h,s,Rs,!Vo);break e;case 2:Zr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((s&62914560)===s&&(g=wg+300-Ot(),10<g)){if(Bo(h,s,Rs,!Vo),Fe(h,0,!0)!==0)break e;h.timeoutHandle=r0(Rx.bind(null,h,c,Zr,pf,Tg,s,Rs,Hl,Uc,Vo,b,2,-0,0),g);break e}Rx(h,c,Zr,pf,Tg,s,Rs,Hl,Uc,Vo,b,0,-0,0)}}break}while(!0);ma(i)}function Rx(i,s,c,h,g,b,C,V,ne,ve,Ie,De,Te,Ee){if(i.timeoutHandle=-1,De=s.subtreeFlags,(De&8192||(De&16785408)===16785408)&&(_d={stylesheets:null,count:0,unsuspend:qA},wx(s),De=GA(),De!==null)){i.cancelPendingCommit=De(Lx.bind(null,i,s,b,c,h,g,C,V,ne,Ie,1,Te,Ee)),Bo(i,b,C,!ve);return}Lx(i,s,b,c,h,g,C,V,ne)}function cA(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var h=0;h<c.length;h++){var g=c[h],b=g.getSnapshot;g=g.value;try{if(!Mr(b(),g))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Bo(i,s,c,h){s&=~xg,s&=~Hl,i.suspendedLanes|=s,i.pingedLanes&=~s,h&&(i.warmLanes|=s),h=i.expirationTimes;for(var g=s;0<g;){var b=31-Ln(g),C=1<<b;h[b]=-1,g&=~C}c!==0&&dn(i,c,s)}function gf(){return(jn&6)===0?(hd(0),!1):!0}function Ag(){if(Xt!==null){if(An===0)var i=Xt.return;else i=Xt,$s=Ns=null,qp(i),kc=null,nd=0,i=Xt;for(;i!==null;)cx(i.alternate,i),i=i.return;Xt=null}}function Bc(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,AA(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),Ag(),Yn=i,Xt=c=As(i.current,null),ln=s,An=0,ds=null,Vo=!1,Vc=st(i,s),bg=!1,Uc=Rs=xg=Hl=Uo=vi=0,Zr=ud=null,Tg=!1,(s&8)!==0&&(s|=s&32);var h=i.entangledLanes;if(h!==0)for(i=i.entanglements,h&=s;0<h;){var g=31-Ln(h),b=1<<g;s|=i[g],h&=~b}return qa=s,Il(),c}function Ix(i,s){qt=null,Y.H=nf,s===Zu||s===Gh?(s=Kv(),An=3):s===$v?(s=Kv(),An=4):An=s===Wb?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,ds=s,Xt===null&&(vi=1,lf(i,Or(s,i.current)))}function Px(){var i=Y.H;return Y.H=nf,i===null?nf:i}function Mx(){var i=Y.A;return Y.A=oA,i}function Ng(){vi=4,Vo||(ln&4194048)!==ln&&Cs.current!==null||(Vc=!0),(Uo&134217727)===0&&(Hl&134217727)===0||Yn===null||Bo(Yn,ln,Rs,!1)}function Cg(i,s,c){var h=jn;jn|=2;var g=Px(),b=Mx();(Yn!==i||ln!==s)&&(pf=null,Bc(i,s)),s=!1;var C=vi;e:do try{if(An!==0&&Xt!==null){var V=Xt,ne=ds;switch(An){case 8:Ag(),C=6;break e;case 3:case 2:case 9:case 6:Cs.current===null&&(s=!0);var ve=An;if(An=0,ds=null,Hc(i,V,ne,ve),c&&Vc){C=0;break e}break;default:ve=An,An=0,ds=null,Hc(i,V,ne,ve)}}uA(),C=vi;break}catch(Ie){Ix(i,Ie)}while(!0);return s&&i.shellSuspendCounter++,$s=Ns=null,jn=h,Y.H=g,Y.A=b,Xt===null&&(Yn=null,ln=0,Il()),C}function uA(){for(;Xt!==null;)kx(Xt)}function dA(i,s){var c=jn;jn|=2;var h=Px(),g=Mx();Yn!==i||ln!==s?(pf=null,mf=Ot()+500,Bc(i,s)):Vc=st(i,s);e:do try{if(An!==0&&Xt!==null){s=Xt;var b=ds;t:switch(An){case 1:An=0,ds=null,Hc(i,s,b,1);break;case 2:case 9:if(Gv(b)){An=0,ds=null,Ox(s);break}s=function(){An!==2&&An!==9||Yn!==i||(An=7),ma(i)},b.then(s,s);break e;case 3:An=7;break e;case 4:An=5;break e;case 7:Gv(b)?(An=0,ds=null,Ox(s)):(An=0,ds=null,Hc(i,s,b,7));break;case 5:var C=null;switch(Xt.tag){case 26:C=Xt.memoizedState;case 5:case 27:var V=Xt;if(!C||g0(C)){An=0,ds=null;var ne=V.sibling;if(ne!==null)Xt=ne;else{var ve=V.return;ve!==null?(Xt=ve,yf(ve)):Xt=null}break t}}An=0,ds=null,Hc(i,s,b,5);break;case 6:An=0,ds=null,Hc(i,s,b,6);break;case 8:Ag(),vi=6;break e;default:throw Error(r(462))}}hA();break}catch(Ie){Ix(i,Ie)}while(!0);return $s=Ns=null,Y.H=h,Y.A=g,jn=c,Xt!==null?0:(Yn=null,ln=0,Il(),vi)}function hA(){for(;Xt!==null&&!Ze();)kx(Xt)}function kx(i){var s=ox(i.alternate,i,qa);i.memoizedProps=i.pendingProps,s===null?yf(i):Xt=s}function Ox(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=tx(c,s,s.pendingProps,s.type,void 0,ln);break;case 11:s=tx(c,s,s.pendingProps,s.type.render,s.ref,ln);break;case 5:qp(s);default:cx(c,s),s=Xt=Hu(s,qa),s=ox(c,s,qa)}i.memoizedProps=i.pendingProps,s===null?yf(i):Xt=s}function Hc(i,s,c,h){$s=Ns=null,qp(s),kc=null,nd=0;var g=s.return;try{if(tA(i,g,s,c,ln)){vi=1,lf(i,Or(c,i.current)),Xt=null;return}}catch(b){if(g!==null)throw Xt=g,b;vi=1,lf(i,Or(c,i.current)),Xt=null;return}s.flags&32768?(Rt||h===1?i=!0:Vc||(ln&536870912)!==0?i=!1:(Vo=i=!0,(h===2||h===9||h===3||h===6)&&(h=Cs.current,h!==null&&h.tag===13&&(h.flags|=16384))),Dx(s,i)):yf(s)}function yf(i){var s=i;do{if((s.flags&32768)!==0){Dx(s,Vo);return}i=s.return;var c=iA(s.alternate,s,qa);if(c!==null){Xt=c;return}if(s=s.sibling,s!==null){Xt=s;return}Xt=s=i}while(s!==null);vi===0&&(vi=5)}function Dx(i,s){do{var c=rA(i.alternate,i);if(c!==null){c.flags&=32767,Xt=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){Xt=i;return}Xt=i=c}while(i!==null);vi=6,Xt=null}function Lx(i,s,c,h,g,b,C,V,ne){i.cancelPendingCommit=null;do _f();while(cr!==0);if((jn&6)!==0)throw Error(r(327));if(s!==null){if(s===i.current)throw Error(r(177));if(b=s.lanes|s.childLanes,b|=ls,En(i,c,b,C,V,ne),i===Yn&&(Xt=Yn=null,ln=0),Fc=s,zo=i,zc=c,Eg=b,Sg=g,Ax=h,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,gA(Hn,function(){return Bx(),null})):(i.callbackNode=null,i.callbackPriority=0),h=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||h){h=Y.T,Y.T=null,g=ye.p,ye.p=2,C=jn,jn|=4;try{sA(i,s,c)}finally{jn=C,ye.p=g,Y.T=h}}cr=1,Vx(),Ux(),Fx()}}function Vx(){if(cr===1){cr=0;var i=zo,s=Fc,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Y.T,Y.T=null;var h=ye.p;ye.p=2;var g=jn;jn|=4;try{bx(s,i);var b=zg,C=Nl(i.containerInfo),V=b.focusedElem,ne=b.selectionRange;if(C!==V&&V&&V.ownerDocument&&bc(V.ownerDocument.documentElement,V)){if(ne!==null&&Cl(V)){var ve=ne.start,Ie=ne.end;if(Ie===void 0&&(Ie=ve),"selectionStart"in V)V.selectionStart=ve,V.selectionEnd=Math.min(Ie,V.value.length);else{var De=V.ownerDocument||document,Te=De&&De.defaultView||window;if(Te.getSelection){var Ee=Te.getSelection(),At=V.textContent.length,xt=Math.min(ne.start,At),Mn=ne.end===void 0?xt:Math.min(ne.end,At);!Ee.extend&&xt>Mn&&(C=Mn,Mn=xt,xt=C);var fe=zu(V,xt),ce=zu(V,Mn);if(fe&&ce&&(Ee.rangeCount!==1||Ee.anchorNode!==fe.node||Ee.anchorOffset!==fe.offset||Ee.focusNode!==ce.node||Ee.focusOffset!==ce.offset)){var _e=De.createRange();_e.setStart(fe.node,fe.offset),Ee.removeAllRanges(),xt>Mn?(Ee.addRange(_e),Ee.extend(ce.node,ce.offset)):(_e.setEnd(ce.node,ce.offset),Ee.addRange(_e))}}}}for(De=[],Ee=V;Ee=Ee.parentNode;)Ee.nodeType===1&&De.push({element:Ee,left:Ee.scrollLeft,top:Ee.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<De.length;V++){var Oe=De[V];Oe.element.scrollLeft=Oe.left,Oe.element.scrollTop=Oe.top}}Rf=!!Fg,zg=Fg=null}finally{jn=g,ye.p=h,Y.T=c}}i.current=s,cr=2}}function Ux(){if(cr===2){cr=0;var i=zo,s=Fc,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Y.T,Y.T=null;var h=ye.p;ye.p=2;var g=jn;jn|=4;try{gx(i,s.alternate,s)}finally{jn=g,ye.p=h,Y.T=c}}cr=3}}function Fx(){if(cr===4||cr===3){cr=0,Ct();var i=zo,s=Fc,c=zc,h=Ax;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?cr=5:(cr=0,Fc=zo=null,zx(i,i.pendingLanes));var g=i.pendingLanes;if(g===0&&(Fo=null),hn(c),s=s.stateNode,ct&&typeof ct.onCommitFiberRoot=="function")try{ct.onCommitFiberRoot(yt,s,void 0,(s.current.flags&128)===128)}catch{}if(h!==null){s=Y.T,g=ye.p,ye.p=2,Y.T=null;try{for(var b=i.onRecoverableError,C=0;C<h.length;C++){var V=h[C];b(V.value,{componentStack:V.stack})}}finally{Y.T=s,ye.p=g}}(zc&3)!==0&&_f(),ma(i),g=i.pendingLanes,(c&4194090)!==0&&(g&42)!==0?i===jg?dd++:(dd=0,jg=i):dd=0,hd(0)}}function zx(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,$u(s)))}function _f(i){return Vx(),Ux(),Fx(),Bx()}function Bx(){if(cr!==5)return!1;var i=zo,s=Eg;Eg=0;var c=hn(zc),h=Y.T,g=ye.p;try{ye.p=32>c?32:c,Y.T=null,c=Sg,Sg=null;var b=zo,C=zc;if(cr=0,Fc=zo=null,zc=0,(jn&6)!==0)throw Error(r(331));var V=jn;if(jn|=4,Sx(b.current),Tx(b,b.current,C,c),jn=V,hd(0,!1),ct&&typeof ct.onPostCommitFiberRoot=="function")try{ct.onPostCommitFiberRoot(yt,b)}catch{}return!0}finally{ye.p=g,Y.T=h,zx(i,s)}}function Hx(i,s,c){s=Or(c,s),s=rg(i.stateNode,s,2),i=Io(i,s,2),i!==null&&(Yt(i,2),ma(i))}function Bn(i,s,c){if(i.tag===3)Hx(i,i,c);else for(;s!==null;){if(s.tag===3){Hx(s,i,c);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Fo===null||!Fo.has(h))){i=Or(c,i),c=Zb(2),h=Io(s,c,2),h!==null&&(Kb(c,h,s,i),Yt(h,2),ma(h));break}}s=s.return}}function Rg(i,s,c){var h=i.pingCache;if(h===null){h=i.pingCache=new lA;var g=new Set;h.set(s,g)}else g=h.get(s),g===void 0&&(g=new Set,h.set(s,g));g.has(c)||(bg=!0,g.add(c),i=fA.bind(null,i,s,c),s.then(i,i))}function fA(i,s,c){var h=i.pingCache;h!==null&&h.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Yn===i&&(ln&c)===c&&(vi===4||vi===3&&(ln&62914560)===ln&&300>Ot()-wg?(jn&2)===0&&Bc(i,0):xg|=c,Uc===ln&&(Uc=0)),ma(i)}function qx(i,s){s===0&&(s=Xn()),i=So(i,s),i!==null&&(Yt(i,s),ma(i))}function mA(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),qx(i,c)}function pA(i,s){var c=0;switch(i.tag){case 13:var h=i.stateNode,g=i.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=i.stateNode;break;case 22:h=i.stateNode._retryCache;break;default:throw Error(r(314))}h!==null&&h.delete(s),qx(i,c)}function gA(i,s){return Ge(i,s)}var vf=null,qc=null,Ig=!1,bf=!1,Pg=!1,ql=0;function ma(i){i!==qc&&i.next===null&&(qc===null?vf=qc=i:qc=qc.next=i),bf=!0,Ig||(Ig=!0,_A())}function hd(i,s){if(!Pg&&bf){Pg=!0;do for(var c=!1,h=vf;h!==null;){if(i!==0){var g=h.pendingLanes;if(g===0)var b=0;else{var C=h.suspendedLanes,V=h.pingedLanes;b=(1<<31-Ln(42|i)+1)-1,b&=g&~(C&~V),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(c=!0,Kx(h,b))}else b=ln,b=Fe(h,h===Yn?b:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(b&3)===0||st(h,b)||(c=!0,Kx(h,b));h=h.next}while(c);Pg=!1}}function yA(){$x()}function $x(){bf=Ig=!1;var i=0;ql!==0&&(jA()&&(i=ql),ql=0);for(var s=Ot(),c=null,h=vf;h!==null;){var g=h.next,b=Gx(h,s);b===0?(h.next=null,c===null?vf=g:c.next=g,g===null&&(qc=c)):(c=h,(i!==0||(b&3)!==0)&&(bf=!0)),h=g}hd(i)}function Gx(i,s){for(var c=i.suspendedLanes,h=i.pingedLanes,g=i.expirationTimes,b=i.pendingLanes&-62914561;0<b;){var C=31-Ln(b),V=1<<C,ne=g[C];ne===-1?((V&c)===0||(V&h)!==0)&&(g[C]=zt(V,s)):ne<=s&&(i.expiredLanes|=V),b&=~V}if(s=Yn,c=ln,c=Fe(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h=i.callbackNode,c===0||i===s&&(An===2||An===9)||i.cancelPendingCommit!==null)return h!==null&&h!==null&&Je(h),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||st(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(h!==null&&Je(h),hn(c)){case 2:case 8:c=Wt;break;case 32:c=Hn;break;case 268435456:c=qn;break;default:c=Hn}return h=Zx.bind(null,i),c=Ge(c,h),i.callbackPriority=s,i.callbackNode=c,s}return h!==null&&h!==null&&Je(h),i.callbackPriority=2,i.callbackNode=null,2}function Zx(i,s){if(cr!==0&&cr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(_f()&&i.callbackNode!==c)return null;var h=ln;return h=Fe(i,i===Yn?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),h===0?null:(Cx(i,h,s),Gx(i,Ot()),i.callbackNode!=null&&i.callbackNode===c?Zx.bind(null,i):null)}function Kx(i,s){if(_f())return null;Cx(i,s,!0)}function _A(){NA(function(){(jn&6)!==0?Ge(ft,yA):$x()})}function Mg(){return ql===0&&(ql=$n()),ql}function Wx(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:ci(""+i)}function Yx(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function vA(i,s,c,h,g){if(s==="submit"&&c&&c.stateNode===g){var b=Wx((g[ke]||null).action),C=h.submitter;C&&(s=(s=C[ke]||null)?Wx(s.formAction):C.getAttribute("formAction"),s!==null&&(b=s,C=null));var V=new Na("action","action",null,h,g);i.push({event:V,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(ql!==0){var ne=C?Yx(g,C):new FormData(g);Jp(c,{pending:!0,data:ne,method:g.method,action:b},null,ne)}}else typeof b=="function"&&(V.preventDefault(),ne=C?Yx(g,C):new FormData(g),Jp(c,{pending:!0,data:ne,method:g.method,action:b},b,ne))},currentTarget:g}]})}}for(var kg=0;kg<Ma.length;kg++){var Og=Ma[kg],bA=Og.toLowerCase(),xA=Og[0].toUpperCase()+Og.slice(1);os(bA,"on"+xA)}os(Lh,"onAnimationEnd"),os(as,"onAnimationIteration"),os(Rl,"onAnimationStart"),os("dblclick","onDoubleClick"),os("focusin","onFocus"),os("focusout","onBlur"),os(Np,"onTransitionRun"),os(Ec,"onTransitionStart"),os(Cp,"onTransitionCancel"),os(Bu,"onTransitionEnd"),Bi("onMouseEnter",["mouseout","mouseover"]),Bi("onMouseLeave",["mouseout","mouseover"]),Bi("onPointerEnter",["pointerout","pointerover"]),Bi("onPointerLeave",["pointerout","pointerover"]),Vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fd));function Qx(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var h=i[c],g=h.event;h=h.listeners;e:{var b=void 0;if(s)for(var C=h.length-1;0<=C;C--){var V=h[C],ne=V.instance,ve=V.currentTarget;if(V=V.listener,ne!==b&&g.isPropagationStopped())break e;b=V,g.currentTarget=ve;try{b(g)}catch(Ie){of(Ie)}g.currentTarget=null,b=ne}else for(C=0;C<h.length;C++){if(V=h[C],ne=V.instance,ve=V.currentTarget,V=V.listener,ne!==b&&g.isPropagationStopped())break e;b=V,g.currentTarget=ve;try{b(g)}catch(Ie){of(Ie)}g.currentTarget=null,b=ne}}}}function Jt(i,s){var c=s[Gn];c===void 0&&(c=s[Gn]=new Set);var h=i+"__bubble";c.has(h)||(Xx(s,i,2,!1),c.add(h))}function Dg(i,s,c){var h=0;s&&(h|=4),Xx(c,i,h,s)}var xf="_reactListening"+Math.random().toString(36).slice(2);function Lg(i){if(!i[xf]){i[xf]=!0,Ls.forEach(function(c){c!=="selectionchange"&&(TA.has(c)||Dg(c,!1,i),Dg(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[xf]||(s[xf]=!0,Dg("selectionchange",!1,s))}}function Xx(i,s,c,h){switch(T0(s)){case 2:var g=WA;break;case 8:g=YA;break;default:g=Qg}c=g.bind(null,s,c,i),g=void 0,!Wi||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(g=!0),h?g!==void 0?i.addEventListener(s,c,{capture:!0,passive:g}):i.addEventListener(s,c,!0):g!==void 0?i.addEventListener(s,c,{passive:g}):i.addEventListener(s,c,!1)}function Vg(i,s,c,h,g){var b=h;if((s&1)===0&&(s&2)===0&&h!==null)e:for(;;){if(h===null)return;var C=h.tag;if(C===3||C===4){var V=h.stateNode.containerInfo;if(V===g)break;if(C===4)for(C=h.return;C!==null;){var ne=C.tag;if((ne===3||ne===4)&&C.stateNode.containerInfo===g)return;C=C.return}for(;V!==null;){if(C=wi(V),C===null)return;if(ne=C.tag,ne===5||ne===6||ne===26||ne===27){h=b=C;continue e}V=V.parentNode}}h=h.return}or(function(){var ve=b,Ie=Ei(c),De=[];e:{var Te=Vh.get(i);if(Te!==void 0){var Ee=Na,At=i;switch(i){case"keypress":if(wn(c)===0)break e;case"keydown":case"keyup":Ee=go;break;case"focusin":At="focus",Ee=uo;break;case"focusout":At="blur",Ee=uo;break;case"beforeblur":case"afterblur":Ee=uo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=Qi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=Du;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=gc;break;case Lh:case as:case Rl:Ee=fo;break;case Bu:Ee=yc;break;case"scroll":case"scrollend":Ee=mc;break;case"wheel":Ee=Ia;break;case"copy":case"cut":case"paste":Ee=sa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=yo;break;case"toggle":case"beforetoggle":Ee=ws}var xt=(s&4)!==0,Mn=!xt&&(i==="scroll"||i==="scrollend"),fe=xt?Te!==null?Te+"Capture":null:Te;xt=[];for(var ce=ve,_e;ce!==null;){var Oe=ce;if(_e=Oe.stateNode,Oe=Oe.tag,Oe!==5&&Oe!==26&&Oe!==27||_e===null||fe===null||(Oe=tn(ce,fe),Oe!=null&&xt.push(md(ce,Oe,_e))),Mn)break;ce=ce.return}0<xt.length&&(Te=new Ee(Te,At,null,c,Ie),De.push({event:Te,listeners:xt}))}}if((s&7)===0){e:{if(Te=i==="mouseover"||i==="pointerover",Ee=i==="mouseout"||i==="pointerout",Te&&c!==Mi&&(At=c.relatedTarget||c.fromElement)&&(wi(At)||At[at]))break e;if((Ee||Te)&&(Te=Ie.window===Ie?Ie:(Te=Ie.ownerDocument)?Te.defaultView||Te.parentWindow:window,Ee?(At=c.relatedTarget||c.toElement,Ee=ve,At=At?wi(At):null,At!==null&&(Mn=u(At),xt=At.tag,At!==Mn||xt!==5&&xt!==27&&xt!==6)&&(At=null)):(Ee=null,At=ve),Ee!==At)){if(xt=Qi,Oe="onMouseLeave",fe="onMouseEnter",ce="mouse",(i==="pointerout"||i==="pointerover")&&(xt=yo,Oe="onPointerLeave",fe="onPointerEnter",ce="pointer"),Mn=Ee==null?Te:_t(Ee),_e=At==null?Te:_t(At),Te=new xt(Oe,ce+"leave",Ee,c,Ie),Te.target=Mn,Te.relatedTarget=_e,Oe=null,wi(Ie)===ve&&(xt=new xt(fe,ce+"enter",At,c,Ie),xt.target=_e,xt.relatedTarget=Mn,Oe=xt),Mn=Oe,Ee&&At)t:{for(xt=Ee,fe=At,ce=0,_e=xt;_e;_e=$c(_e))ce++;for(_e=0,Oe=fe;Oe;Oe=$c(Oe))_e++;for(;0<ce-_e;)xt=$c(xt),ce--;for(;0<_e-ce;)fe=$c(fe),_e--;for(;ce--;){if(xt===fe||fe!==null&&xt===fe.alternate)break t;xt=$c(xt),fe=$c(fe)}xt=null}else xt=null;Ee!==null&&Jx(De,Te,Ee,xt,!1),At!==null&&Mn!==null&&Jx(De,Mn,At,xt,!0)}}e:{if(Te=ve?_t(ve):window,Ee=Te.nodeName&&Te.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&Te.type==="file")var rt=vo;else if(Kn(Te))if(Vu)rt=Ap;else{rt=jp;var Gt=Fu}else Ee=Te.nodeName,!Ee||Ee.toLowerCase()!=="input"||Te.type!=="checkbox"&&Te.type!=="radio"?ve&&mt(ve.elementType)&&(rt=vo):rt=qs;if(rt&&(rt=rt(i,ve))){Bs(De,rt,c,Ie);break e}Gt&&Gt(i,Te,ve),i==="focusout"&&ve&&Te.type==="number"&&ve.memoizedProps.value!=null&&xe(Te,"number",Te.value)}switch(Gt=ve?_t(ve):window,i){case"focusin":(Kn(Gt)||Gt.contentEditable==="true")&&(ss=Gt,To=ve,Pa=null);break;case"focusout":Pa=To=ss=null;break;case"mousedown":Tc=!0;break;case"contextmenu":case"mouseup":case"dragend":Tc=!1,Oh(De,c,Ie);break;case"selectionchange":if(xc)break;case"keydown":case"keyup":Oh(De,c,Ie)}var ht;if(xr)e:{switch(i){case"compositionstart":var Tt="onCompositionStart";break e;case"compositionend":Tt="onCompositionEnd";break e;case"compositionupdate":Tt="onCompositionUpdate";break e}Tt=void 0}else nn?je(i,c)&&(Tt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Tt="onCompositionStart");Tt&&(N&&c.locale!=="ko"&&(nn||Tt!=="onCompositionStart"?Tt==="onCompositionEnd"&&nn&&(ht=Pr()):(yn=Ie,ri="value"in yn?yn.value:yn.textContent,nn=!0)),Gt=Tf(ve,Tt),0<Gt.length&&(Tt=new br(Tt,i,null,c,Ie),De.push({event:Tt,listeners:Gt}),ht?Tt.data=ht:(ht=qe(c),ht!==null&&(Tt.data=ht)))),(ht=T?_i(i,c):rn(i,c))&&(Tt=Tf(ve,"onBeforeInput"),0<Tt.length&&(Gt=new br("onBeforeInput","beforeinput",null,c,Ie),De.push({event:Gt,listeners:Tt}),Gt.data=ht)),vA(De,i,ve,c,Ie)}Qx(De,s)})}function md(i,s,c){return{instance:i,listener:s,currentTarget:c}}function Tf(i,s){for(var c=s+"Capture",h=[];i!==null;){var g=i,b=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||b===null||(g=tn(i,c),g!=null&&h.unshift(md(i,g,b)),g=tn(i,s),g!=null&&h.push(md(i,g,b))),i.tag===3)return h;i=i.return}return[]}function $c(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Jx(i,s,c,h,g){for(var b=s._reactName,C=[];c!==null&&c!==h;){var V=c,ne=V.alternate,ve=V.stateNode;if(V=V.tag,ne!==null&&ne===h)break;V!==5&&V!==26&&V!==27||ve===null||(ne=ve,g?(ve=tn(c,b),ve!=null&&C.unshift(md(c,ve,ne))):g||(ve=tn(c,b),ve!=null&&C.push(md(c,ve,ne)))),c=c.return}C.length!==0&&i.push({event:s,listeners:C})}var wA=/\r\n?/g,EA=/\u0000|\uFFFD/g;function e0(i){return(typeof i=="string"?i:""+i).replace(wA,`
`).replace(EA,"")}function t0(i,s){return s=e0(s),e0(i)===s}function wf(){}function Pn(i,s,c,h,g,b){switch(c){case"children":typeof h=="string"?s==="body"||s==="textarea"&&h===""||et(i,h):(typeof h=="number"||typeof h=="bigint")&&s!=="body"&&et(i,""+h);break;case"className":ei(i,"class",h);break;case"tabIndex":ei(i,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":ei(i,c,h);break;case"style":We(i,h,b);break;case"data":if(s!=="object"){ei(i,"data",h);break}case"src":case"href":if(h===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(c);break}h=ci(""+h),i.setAttribute(c,h);break;case"action":case"formAction":if(typeof h=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(c==="formAction"?(s!=="input"&&Pn(i,s,"name",g.name,g,null),Pn(i,s,"formEncType",g.formEncType,g,null),Pn(i,s,"formMethod",g.formMethod,g,null),Pn(i,s,"formTarget",g.formTarget,g,null)):(Pn(i,s,"encType",g.encType,g,null),Pn(i,s,"method",g.method,g,null),Pn(i,s,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){i.removeAttribute(c);break}h=ci(""+h),i.setAttribute(c,h);break;case"onClick":h!=null&&(i.onclick=wf);break;case"onScroll":h!=null&&Jt("scroll",i);break;case"onScrollEnd":h!=null&&Jt("scrollend",i);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(r(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(r(60));i.innerHTML=c}}break;case"multiple":i.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":i.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){i.removeAttribute("xlink:href");break}c=ci(""+h),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(c,""+h):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":h===!0?i.setAttribute(c,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?i.setAttribute(c,h):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?i.setAttribute(c,h):i.removeAttribute(c);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?i.removeAttribute(c):i.setAttribute(c,h);break;case"popover":Jt("beforetoggle",i),Jt("toggle",i),li(i,"popover",h);break;case"xlinkActuate":xn(i,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":xn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":xn(i,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":xn(i,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":xn(i,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":xn(i,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":xn(i,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":xn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":xn(i,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":li(i,"is",h);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Qt.get(c)||c,li(i,c,h))}}function Ug(i,s,c,h,g,b){switch(c){case"style":We(i,h,b);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(r(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(r(60));i.innerHTML=c}}break;case"children":typeof h=="string"?et(i,h):(typeof h=="number"||typeof h=="bigint")&&et(i,""+h);break;case"onScroll":h!=null&&Jt("scroll",i);break;case"onScrollEnd":h!=null&&Jt("scrollend",i);break;case"onClick":h!=null&&(i.onclick=wf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!yr.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),s=c.slice(2,g?c.length-7:void 0),b=i[ke]||null,b=b!=null?b[c]:null,typeof b=="function"&&i.removeEventListener(s,b,g),typeof h=="function")){typeof b!="function"&&b!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,h,g);break e}c in i?i[c]=h:h===!0?i.setAttribute(c,""):li(i,c,h)}}}function ur(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Jt("error",i),Jt("load",i);var h=!1,g=!1,b;for(b in c)if(c.hasOwnProperty(b)){var C=c[b];if(C!=null)switch(b){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,s));default:Pn(i,s,b,C,c,null)}}g&&Pn(i,s,"srcSet",c.srcSet,c,null),h&&Pn(i,s,"src",c.src,c,null);return;case"input":Jt("invalid",i);var V=b=C=g=null,ne=null,ve=null;for(h in c)if(c.hasOwnProperty(h)){var Ie=c[h];if(Ie!=null)switch(h){case"name":g=Ie;break;case"type":C=Ie;break;case"checked":ne=Ie;break;case"defaultChecked":ve=Ie;break;case"value":b=Ie;break;case"defaultValue":V=Ie;break;case"children":case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(r(137,s));break;default:Pn(i,s,h,Ie,c,null)}}z(i,b,V,ne,ve,C,g,!1),is(i);return;case"select":Jt("invalid",i),h=C=b=null;for(g in c)if(c.hasOwnProperty(g)&&(V=c[g],V!=null))switch(g){case"value":b=V;break;case"defaultValue":C=V;break;case"multiple":h=V;default:Pn(i,s,g,V,c,null)}s=b,c=C,i.multiple=!!h,s!=null?He(i,!!h,s,!1):c!=null&&He(i,!!h,c,!0);return;case"textarea":Jt("invalid",i),b=g=h=null;for(C in c)if(c.hasOwnProperty(C)&&(V=c[C],V!=null))switch(C){case"value":h=V;break;case"defaultValue":g=V;break;case"children":b=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(r(91));break;default:Pn(i,s,C,V,c,null)}ot(i,h,g,b),is(i);return;case"option":for(ne in c)if(c.hasOwnProperty(ne)&&(h=c[ne],h!=null))switch(ne){case"selected":i.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Pn(i,s,ne,h,c,null)}return;case"dialog":Jt("beforetoggle",i),Jt("toggle",i),Jt("cancel",i),Jt("close",i);break;case"iframe":case"object":Jt("load",i);break;case"video":case"audio":for(h=0;h<fd.length;h++)Jt(fd[h],i);break;case"image":Jt("error",i),Jt("load",i);break;case"details":Jt("toggle",i);break;case"embed":case"source":case"link":Jt("error",i),Jt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ve in c)if(c.hasOwnProperty(ve)&&(h=c[ve],h!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,s));default:Pn(i,s,ve,h,c,null)}return;default:if(mt(s)){for(Ie in c)c.hasOwnProperty(Ie)&&(h=c[Ie],h!==void 0&&Ug(i,s,Ie,h,c,void 0));return}}for(V in c)c.hasOwnProperty(V)&&(h=c[V],h!=null&&Pn(i,s,V,h,c,null))}function SA(i,s,c,h){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,b=null,C=null,V=null,ne=null,ve=null,Ie=null;for(Ee in c){var De=c[Ee];if(c.hasOwnProperty(Ee)&&De!=null)switch(Ee){case"checked":break;case"value":break;case"defaultValue":ne=De;default:h.hasOwnProperty(Ee)||Pn(i,s,Ee,null,h,De)}}for(var Te in h){var Ee=h[Te];if(De=c[Te],h.hasOwnProperty(Te)&&(Ee!=null||De!=null))switch(Te){case"type":b=Ee;break;case"name":g=Ee;break;case"checked":ve=Ee;break;case"defaultChecked":Ie=Ee;break;case"value":C=Ee;break;case"defaultValue":V=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,s));break;default:Ee!==De&&Pn(i,s,Te,Ee,h,De)}}mn(i,C,V,ne,ve,Ie,b,g);return;case"select":Ee=C=V=Te=null;for(b in c)if(ne=c[b],c.hasOwnProperty(b)&&ne!=null)switch(b){case"value":break;case"multiple":Ee=ne;default:h.hasOwnProperty(b)||Pn(i,s,b,null,h,ne)}for(g in h)if(b=h[g],ne=c[g],h.hasOwnProperty(g)&&(b!=null||ne!=null))switch(g){case"value":Te=b;break;case"defaultValue":V=b;break;case"multiple":C=b;default:b!==ne&&Pn(i,s,g,b,h,ne)}s=V,c=C,h=Ee,Te!=null?He(i,!!c,Te,!1):!!h!=!!c&&(s!=null?He(i,!!c,s,!0):He(i,!!c,c?[]:"",!1));return;case"textarea":Ee=Te=null;for(V in c)if(g=c[V],c.hasOwnProperty(V)&&g!=null&&!h.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:Pn(i,s,V,null,h,g)}for(C in h)if(g=h[C],b=c[C],h.hasOwnProperty(C)&&(g!=null||b!=null))switch(C){case"value":Te=g;break;case"defaultValue":Ee=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(r(91));break;default:g!==b&&Pn(i,s,C,g,h,b)}Ne(i,Te,Ee);return;case"option":for(var At in c)if(Te=c[At],c.hasOwnProperty(At)&&Te!=null&&!h.hasOwnProperty(At))switch(At){case"selected":i.selected=!1;break;default:Pn(i,s,At,null,h,Te)}for(ne in h)if(Te=h[ne],Ee=c[ne],h.hasOwnProperty(ne)&&Te!==Ee&&(Te!=null||Ee!=null))switch(ne){case"selected":i.selected=Te&&typeof Te!="function"&&typeof Te!="symbol";break;default:Pn(i,s,ne,Te,h,Ee)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xt in c)Te=c[xt],c.hasOwnProperty(xt)&&Te!=null&&!h.hasOwnProperty(xt)&&Pn(i,s,xt,null,h,Te);for(ve in h)if(Te=h[ve],Ee=c[ve],h.hasOwnProperty(ve)&&Te!==Ee&&(Te!=null||Ee!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,s));break;default:Pn(i,s,ve,Te,h,Ee)}return;default:if(mt(s)){for(var Mn in c)Te=c[Mn],c.hasOwnProperty(Mn)&&Te!==void 0&&!h.hasOwnProperty(Mn)&&Ug(i,s,Mn,void 0,h,Te);for(Ie in h)Te=h[Ie],Ee=c[Ie],!h.hasOwnProperty(Ie)||Te===Ee||Te===void 0&&Ee===void 0||Ug(i,s,Ie,Te,h,Ee);return}}for(var fe in c)Te=c[fe],c.hasOwnProperty(fe)&&Te!=null&&!h.hasOwnProperty(fe)&&Pn(i,s,fe,null,h,Te);for(De in h)Te=h[De],Ee=c[De],!h.hasOwnProperty(De)||Te===Ee||Te==null&&Ee==null||Pn(i,s,De,Te,h,Ee)}var Fg=null,zg=null;function Ef(i){return i.nodeType===9?i:i.ownerDocument}function n0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function i0(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Bg(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Hg=null;function jA(){var i=window.event;return i&&i.type==="popstate"?i===Hg?!1:(Hg=i,!0):(Hg=null,!1)}var r0=typeof setTimeout=="function"?setTimeout:void 0,AA=typeof clearTimeout=="function"?clearTimeout:void 0,s0=typeof Promise=="function"?Promise:void 0,NA=typeof queueMicrotask=="function"?queueMicrotask:typeof s0<"u"?function(i){return s0.resolve(null).then(i).catch(CA)}:r0;function CA(i){setTimeout(function(){throw i})}function Ho(i){return i==="head"}function a0(i,s){var c=s,h=0,g=0;do{var b=c.nextSibling;if(i.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"){if(0<h&&8>h){c=h;var C=i.ownerDocument;if(c&1&&pd(C.documentElement),c&2&&pd(C.body),c&4)for(c=C.head,pd(c),C=c.firstChild;C;){var V=C.nextSibling,ne=C.nodeName;C[Ti]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&C.rel.toLowerCase()==="stylesheet"||c.removeChild(C),C=V}}if(g===0){i.removeChild(b),wd(s);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:h=c.charCodeAt(0)-48;else h=0;c=b}while(c);wd(s)}function qg(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":qg(c),sr(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function RA(i,s,c,h){for(;i.nodeType===1;){var g=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!h&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(h){if(!i[Ti])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(b=i.getAttribute("rel"),b==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(b!==g.rel||i.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||i.getAttribute("title")!==(g.title==null?null:g.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(b=i.getAttribute("src"),(b!==(g.src==null?null:g.src)||i.getAttribute("type")!==(g.type==null?null:g.type)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&b&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var b=g.name==null?null:""+g.name;if(g.type==="hidden"&&i.getAttribute("name")===b)return i}else return i;if(i=Ks(i.nextSibling),i===null)break}return null}function IA(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Ks(i.nextSibling),i===null))return null;return i}function $g(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function PA(i,s){var c=i.ownerDocument;if(i.data!=="$?"||c.readyState==="complete")s();else{var h=function(){s(),c.removeEventListener("DOMContentLoaded",h)};c.addEventListener("DOMContentLoaded",h),i._reactRetry=h}}function Ks(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var Gg=null;function o0(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(s===0)return i;s--}else c==="/$"&&s++}i=i.previousSibling}return null}function l0(i,s,c){switch(s=Ef(c),i){case"html":if(i=s.documentElement,!i)throw Error(r(452));return i;case"head":if(i=s.head,!i)throw Error(r(453));return i;case"body":if(i=s.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}function pd(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);sr(i)}var Is=new Map,c0=new Set;function Sf(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var $a=ye.d;ye.d={f:MA,r:kA,D:OA,C:DA,L:LA,m:VA,X:FA,S:UA,M:zA};function MA(){var i=$a.f(),s=gf();return i||s}function kA(i){var s=Cn(i);s!==null&&s.tag===5&&s.type==="form"?Cb(s):$a.r(i)}var Gc=typeof document>"u"?null:document;function u0(i,s,c){var h=Gc;if(h&&typeof s=="string"&&s){var g=Fn(s);g='link[rel="'+i+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),c0.has(g)||(c0.add(g),i={rel:i,crossOrigin:c,href:s},h.querySelector(g)===null&&(s=h.createElement("link"),ur(s,"link",i),fn(s),h.head.appendChild(s)))}}function OA(i){$a.D(i),u0("dns-prefetch",i,null)}function DA(i,s){$a.C(i,s),u0("preconnect",i,s)}function LA(i,s,c){$a.L(i,s,c);var h=Gc;if(h&&i&&s){var g='link[rel="preload"][as="'+Fn(s)+'"]';s==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+Fn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+Fn(c.imageSizes)+'"]')):g+='[href="'+Fn(i)+'"]';var b=g;switch(s){case"style":b=Zc(i);break;case"script":b=Kc(i)}Is.has(b)||(i=w({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),Is.set(b,i),h.querySelector(g)!==null||s==="style"&&h.querySelector(gd(b))||s==="script"&&h.querySelector(yd(b))||(s=h.createElement("link"),ur(s,"link",i),fn(s),h.head.appendChild(s)))}}function VA(i,s){$a.m(i,s);var c=Gc;if(c&&i){var h=s&&typeof s.as=="string"?s.as:"script",g='link[rel="modulepreload"][as="'+Fn(h)+'"][href="'+Fn(i)+'"]',b=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Kc(i)}if(!Is.has(b)&&(i=w({rel:"modulepreload",href:i},s),Is.set(b,i),c.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(yd(b)))return}h=c.createElement("link"),ur(h,"link",i),fn(h),c.head.appendChild(h)}}}function UA(i,s,c){$a.S(i,s,c);var h=Gc;if(h&&i){var g=Rn(h).hoistableStyles,b=Zc(i);s=s||"default";var C=g.get(b);if(!C){var V={loading:0,preload:null};if(C=h.querySelector(gd(b)))V.loading=5;else{i=w({rel:"stylesheet",href:i,"data-precedence":s},c),(c=Is.get(b))&&Zg(i,c);var ne=C=h.createElement("link");fn(ne),ur(ne,"link",i),ne._p=new Promise(function(ve,Ie){ne.onload=ve,ne.onerror=Ie}),ne.addEventListener("load",function(){V.loading|=1}),ne.addEventListener("error",function(){V.loading|=2}),V.loading|=4,jf(C,s,h)}C={type:"stylesheet",instance:C,count:1,state:V},g.set(b,C)}}}function FA(i,s){$a.X(i,s);var c=Gc;if(c&&i){var h=Rn(c).hoistableScripts,g=Kc(i),b=h.get(g);b||(b=c.querySelector(yd(g)),b||(i=w({src:i,async:!0},s),(s=Is.get(g))&&Kg(i,s),b=c.createElement("script"),fn(b),ur(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(g,b))}}function zA(i,s){$a.M(i,s);var c=Gc;if(c&&i){var h=Rn(c).hoistableScripts,g=Kc(i),b=h.get(g);b||(b=c.querySelector(yd(g)),b||(i=w({src:i,async:!0,type:"module"},s),(s=Is.get(g))&&Kg(i,s),b=c.createElement("script"),fn(b),ur(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(g,b))}}function d0(i,s,c,h){var g=(g=oe.current)?Sf(g):null;if(!g)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=Zc(c.href),c=Rn(g).hoistableStyles,h=c.get(s),h||(h={type:"style",instance:null,count:0,state:null},c.set(s,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=Zc(c.href);var b=Rn(g).hoistableStyles,C=b.get(i);if(C||(g=g.ownerDocument||g,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(i,C),(b=g.querySelector(gd(i)))&&!b._p&&(C.instance=b,C.state.loading=5),Is.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Is.set(i,c),b||BA(g,i,c,C.state))),s&&h===null)throw Error(r(528,""));return C}if(s&&h!==null)throw Error(r(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Kc(c),c=Rn(g).hoistableScripts,h=c.get(s),h||(h={type:"script",instance:null,count:0,state:null},c.set(s,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function Zc(i){return'href="'+Fn(i)+'"'}function gd(i){return'link[rel="stylesheet"]['+i+"]"}function h0(i){return w({},i,{"data-precedence":i.precedence,precedence:null})}function BA(i,s,c,h){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?h.loading=1:(s=i.createElement("link"),h.preload=s,s.addEventListener("load",function(){return h.loading|=1}),s.addEventListener("error",function(){return h.loading|=2}),ur(s,"link",c),fn(s),i.head.appendChild(s))}function Kc(i){return'[src="'+Fn(i)+'"]'}function yd(i){return"script[async]"+i}function f0(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var h=i.querySelector('style[data-href~="'+Fn(c.href)+'"]');if(h)return s.instance=h,fn(h),h;var g=w({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return h=(i.ownerDocument||i).createElement("style"),fn(h),ur(h,"style",g),jf(h,c.precedence,i),s.instance=h;case"stylesheet":g=Zc(c.href);var b=i.querySelector(gd(g));if(b)return s.state.loading|=4,s.instance=b,fn(b),b;h=h0(c),(g=Is.get(g))&&Zg(h,g),b=(i.ownerDocument||i).createElement("link"),fn(b);var C=b;return C._p=new Promise(function(V,ne){C.onload=V,C.onerror=ne}),ur(b,"link",h),s.state.loading|=4,jf(b,c.precedence,i),s.instance=b;case"script":return b=Kc(c.src),(g=i.querySelector(yd(b)))?(s.instance=g,fn(g),g):(h=c,(g=Is.get(b))&&(h=w({},c),Kg(h,g)),i=i.ownerDocument||i,g=i.createElement("script"),fn(g),ur(g,"link",h),i.head.appendChild(g),s.instance=g);case"void":return null;default:throw Error(r(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(h=s.instance,s.state.loading|=4,jf(h,c.precedence,i));return s.instance}function jf(i,s,c){for(var h=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,b=g,C=0;C<h.length;C++){var V=h[C];if(V.dataset.precedence===s)b=V;else if(b!==g)break}b?b.parentNode.insertBefore(i,b.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function Zg(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function Kg(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var Af=null;function m0(i,s,c){if(Af===null){var h=new Map,g=Af=new Map;g.set(c,h)}else g=Af,h=g.get(c),h||(h=new Map,g.set(c,h));if(h.has(i))return h;for(h.set(i,null),c=c.getElementsByTagName(i),g=0;g<c.length;g++){var b=c[g];if(!(b[Ti]||b[Mt]||i==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var C=b.getAttribute(s)||"";C=i+C;var V=h.get(C);V?V.push(b):h.set(C,[b])}}return h}function p0(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function HA(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function g0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var _d=null;function qA(){}function $A(i,s,c){if(_d===null)throw Error(r(475));var h=_d;if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var g=Zc(c.href),b=i.querySelector(gd(g));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(h.count++,h=Nf.bind(h),i.then(h,h)),s.state.loading|=4,s.instance=b,fn(b);return}b=i.ownerDocument||i,c=h0(c),(g=Is.get(g))&&Zg(c,g),b=b.createElement("link"),fn(b);var C=b;C._p=new Promise(function(V,ne){C.onload=V,C.onerror=ne}),ur(b,"link",c),s.instance=b}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(h.count++,s=Nf.bind(h),i.addEventListener("load",s),i.addEventListener("error",s))}}function GA(){if(_d===null)throw Error(r(475));var i=_d;return i.stylesheets&&i.count===0&&Wg(i,i.stylesheets),0<i.count?function(s){var c=setTimeout(function(){if(i.stylesheets&&Wg(i,i.stylesheets),i.unsuspend){var h=i.unsuspend;i.unsuspend=null,h()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(c)}}:null}function Nf(){if(this.count--,this.count===0){if(this.stylesheets)Wg(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Cf=null;function Wg(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Cf=new Map,s.forEach(ZA,i),Cf=null,Nf.call(i))}function ZA(i,s){if(!(s.state.loading&4)){var c=Cf.get(i);if(c)var h=c.get(null);else{c=new Map,Cf.set(i,c);for(var g=i.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<g.length;b++){var C=g[b];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(c.set(C.dataset.precedence,C),h=C)}h&&c.set(null,h)}g=s.instance,C=g.getAttribute("data-precedence"),b=c.get(C)||h,b===h&&c.set(null,g),c.set(C,g),this.count++,h=Nf.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),b?b.parentNode.insertBefore(g,b.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(g,i.firstChild)),s.state.loading|=4}}var vd={$$typeof:ue,Provider:null,Consumer:null,_currentValue:ie,_currentValue2:ie,_threadCount:0};function KA(i,s,c,h,g,b,C,V){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nn(0),this.hiddenUpdates=Nn(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=b,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function y0(i,s,c,h,g,b,C,V,ne,ve,Ie,De){return i=new KA(i,s,c,C,V,ne,ve,De),s=1,b===!0&&(s|=24),b=Lr(3,null,null,s),i.current=b,b.stateNode=i,s=Rp(),s.refCount++,i.pooledCache=s,s.refCount++,b.memoizedState={element:h,isDehydrated:c,cache:s},kp(b),i}function _0(i){return i?(i=Da,i):Da}function v0(i,s,c,h,g,b){g=_0(g),h.context===null?h.context=g:h.pendingContext=g,h=Ro(s),h.payload={element:c},b=b===void 0?null:b,b!==null&&(h.callback=b),c=Io(i,h,s),c!==null&&(fs(c,i,s),Wu(c,i,s))}function b0(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function Yg(i,s){b0(i,s),(i=i.alternate)&&b0(i,s)}function x0(i){if(i.tag===13){var s=So(i,67108864);s!==null&&fs(s,i,67108864),Yg(i,67108864)}}var Rf=!0;function WA(i,s,c,h){var g=Y.T;Y.T=null;var b=ye.p;try{ye.p=2,Qg(i,s,c,h)}finally{ye.p=b,Y.T=g}}function YA(i,s,c,h){var g=Y.T;Y.T=null;var b=ye.p;try{ye.p=8,Qg(i,s,c,h)}finally{ye.p=b,Y.T=g}}function Qg(i,s,c,h){if(Rf){var g=Xg(h);if(g===null)Vg(i,s,h,If,c),w0(i,h);else if(XA(g,i,s,c,h))h.stopPropagation();else if(w0(i,h),s&4&&-1<QA.indexOf(i)){for(;g!==null;){var b=Cn(g);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var C=X(b.pendingLanes);if(C!==0){var V=b;for(V.pendingLanes|=2,V.entangledLanes|=2;C;){var ne=1<<31-Ln(C);V.entanglements[1]|=ne,C&=~ne}ma(b),(jn&6)===0&&(mf=Ot()+500,hd(0))}}break;case 13:V=So(b,2),V!==null&&fs(V,b,2),gf(),Yg(b,2)}if(b=Xg(h),b===null&&Vg(i,s,h,If,c),b===g)break;g=b}g!==null&&h.stopPropagation()}else Vg(i,s,h,null,c)}}function Xg(i){return i=Ei(i),Jg(i)}var If=null;function Jg(i){if(If=null,i=wi(i),i!==null){var s=u(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=f(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return If=i,null}function T0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ke()){case ft:return 2;case Wt:return 8;case Hn:case pn:return 32;case qn:return 268435456;default:return 32}default:return 32}}var ey=!1,qo=null,$o=null,Go=null,bd=new Map,xd=new Map,Zo=[],QA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function w0(i,s){switch(i){case"focusin":case"focusout":qo=null;break;case"dragenter":case"dragleave":$o=null;break;case"mouseover":case"mouseout":Go=null;break;case"pointerover":case"pointerout":bd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":xd.delete(s.pointerId)}}function Td(i,s,c,h,g,b){return i===null||i.nativeEvent!==b?(i={blockedOn:s,domEventName:c,eventSystemFlags:h,nativeEvent:b,targetContainers:[g]},s!==null&&(s=Cn(s),s!==null&&x0(s)),i):(i.eventSystemFlags|=h,s=i.targetContainers,g!==null&&s.indexOf(g)===-1&&s.push(g),i)}function XA(i,s,c,h,g){switch(s){case"focusin":return qo=Td(qo,i,s,c,h,g),!0;case"dragenter":return $o=Td($o,i,s,c,h,g),!0;case"mouseover":return Go=Td(Go,i,s,c,h,g),!0;case"pointerover":var b=g.pointerId;return bd.set(b,Td(bd.get(b)||null,i,s,c,h,g)),!0;case"gotpointercapture":return b=g.pointerId,xd.set(b,Td(xd.get(b)||null,i,s,c,h,g)),!0}return!1}function E0(i){var s=wi(i.target);if(s!==null){var c=u(s);if(c!==null){if(s=c.tag,s===13){if(s=f(c),s!==null){i.blockedOn=s,Pi(i.priority,function(){if(c.tag===13){var h=hs();h=St(h);var g=So(c,h);g!==null&&fs(g,c,h),Yg(c,h)}});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Pf(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=Xg(i.nativeEvent);if(c===null){c=i.nativeEvent;var h=new c.constructor(c.type,c);Mi=h,c.target.dispatchEvent(h),Mi=null}else return s=Cn(c),s!==null&&x0(s),i.blockedOn=c,!1;s.shift()}return!0}function S0(i,s,c){Pf(i)&&c.delete(s)}function JA(){ey=!1,qo!==null&&Pf(qo)&&(qo=null),$o!==null&&Pf($o)&&($o=null),Go!==null&&Pf(Go)&&(Go=null),bd.forEach(S0),xd.forEach(S0)}function Mf(i,s){i.blockedOn===s&&(i.blockedOn=null,ey||(ey=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,JA)))}var kf=null;function j0(i){kf!==i&&(kf=i,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){kf===i&&(kf=null);for(var s=0;s<i.length;s+=3){var c=i[s],h=i[s+1],g=i[s+2];if(typeof h!="function"){if(Jg(h||c)===null)continue;break}var b=Cn(c);b!==null&&(i.splice(s,3),s-=3,Jp(b,{pending:!0,data:g,method:c.method,action:h},h,g))}}))}function wd(i){function s(ne){return Mf(ne,i)}qo!==null&&Mf(qo,i),$o!==null&&Mf($o,i),Go!==null&&Mf(Go,i),bd.forEach(s),xd.forEach(s);for(var c=0;c<Zo.length;c++){var h=Zo[c];h.blockedOn===i&&(h.blockedOn=null)}for(;0<Zo.length&&(c=Zo[0],c.blockedOn===null);)E0(c),c.blockedOn===null&&Zo.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(h=0;h<c.length;h+=3){var g=c[h],b=c[h+1],C=g[ke]||null;if(typeof b=="function")C||j0(c);else if(C){var V=null;if(b&&b.hasAttribute("formAction")){if(g=b,C=b[ke]||null)V=C.formAction;else if(Jg(g)!==null)continue}else V=C.action;typeof V=="function"?c[h+1]=V:(c.splice(h,3),h-=3),j0(c)}}}function ty(i){this._internalRoot=i}Of.prototype.render=ty.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(r(409));var c=s.current,h=hs();v0(c,h,i,s,null,null)},Of.prototype.unmount=ty.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;v0(i.current,2,null,i,null,null),gf(),s[at]=null}};function Of(i){this._internalRoot=i}Of.prototype.unstable_scheduleHydration=function(i){if(i){var s=gn();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Zo.length&&s!==0&&s<Zo[c].priority;c++);Zo.splice(c,0,i),c===0&&E0(i)}};var A0=e.version;if(A0!=="19.1.0")throw Error(r(527,A0,"19.1.0"));ye.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=_(s),i=i!==null?v(i):null,i=i===null?null:i.stateNode,i};var eN={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Df=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Df.isDisabled&&Df.supportsFiber)try{yt=Df.inject(eN),ct=Df}catch{}}return Sd.createRoot=function(i,s){if(!l(i))throw Error(r(299));var c=!1,h="",g=Hb,b=qb,C=$b,V=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onUncaughtError!==void 0&&(g=s.onUncaughtError),s.onCaughtError!==void 0&&(b=s.onCaughtError),s.onRecoverableError!==void 0&&(C=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(V=s.unstable_transitionCallbacks)),s=y0(i,1,!1,null,null,c,h,g,b,C,V,null),i[at]=s.current,Lg(i),new ty(s)},Sd.hydrateRoot=function(i,s,c){if(!l(i))throw Error(r(299));var h=!1,g="",b=Hb,C=qb,V=$b,ne=null,ve=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(b=c.onUncaughtError),c.onCaughtError!==void 0&&(C=c.onCaughtError),c.onRecoverableError!==void 0&&(V=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(ne=c.unstable_transitionCallbacks),c.formState!==void 0&&(ve=c.formState)),s=y0(i,1,!0,s,c??null,h,g,b,C,V,ne,ve),s.context=_0(null),c=s.current,h=hs(),h=St(h),g=Ro(h),g.callback=null,Io(c,g,h),c=h,s.current.lanes=c,Yt(s,c),ma(s),i[at]=s.current,Lg(i),new Of(s)},Sd.version="19.1.0",Sd}var L0;function cN(){if(L0)return ry.exports;L0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ry.exports=lN(),ry.exports}var uN=cN();/**
 * react-router v7.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var V0="popstate";function dN(n={}){function e(r,l){let{pathname:u,search:f,hash:y}=r.location;return Hy("",{pathname:u,search:f,hash:y},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function t(r,l){return typeof l=="string"?l:nh(l)}return fN(e,t,null,n)}function oi(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Ds(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hN(){return Math.random().toString(36).substring(2,10)}function U0(n,e){return{usr:n.state,key:n.key,idx:e}}function Hy(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Tu(e):e,state:t,key:e&&e.key||r||hN()}}function nh({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Tu(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function fN(n,e,t,r={}){let{window:l=document.defaultView,v5Compat:u=!1}=r,f=l.history,y="POP",_=null,v=w();v==null&&(v=0,f.replaceState({...f.state,idx:v},""));function w(){return(f.state||{idx:null}).idx}function R(){y="POP";let F=w(),Q=F==null?null:F-v;v=F,_&&_({action:y,location:Z.location,delta:Q})}function I(F,Q){y="PUSH";let se=Hy(Z.location,F,Q);v=w()+1;let ue=U0(se,v),we=Z.createHref(se);try{f.pushState(ue,"",we)}catch(Ce){if(Ce instanceof DOMException&&Ce.name==="DataCloneError")throw Ce;l.location.assign(we)}u&&_&&_({action:y,location:Z.location,delta:1})}function G(F,Q){y="REPLACE";let se=Hy(Z.location,F,Q);v=w();let ue=U0(se,v),we=Z.createHref(se);f.replaceState(ue,"",we),u&&_&&_({action:y,location:Z.location,delta:0})}function H(F){return mN(F)}let Z={get action(){return y},get location(){return n(l,f)},listen(F){if(_)throw new Error("A history only accepts one active listener");return l.addEventListener(V0,R),_=F,()=>{l.removeEventListener(V0,R),_=null}},createHref(F){return e(l,F)},createURL:H,encodeLocation(F){let Q=H(F);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:I,replace:G,go(F){return f.go(F)}};return Z}function mN(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),oi(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:nh(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function bE(n,e,t="/"){return pN(n,e,t,!1)}function pN(n,e,t,r){let l=typeof e=="string"?Tu(e):e,u=Xa(l.pathname||"/",t);if(u==null)return null;let f=xE(n);gN(f);let y=null;for(let _=0;y==null&&_<f.length;++_){let v=AN(u);y=SN(f[_],v,r)}return y}function xE(n,e=[],t=[],r=""){let l=(u,f,y)=>{let _={relativePath:y===void 0?u.path||"":y,caseSensitive:u.caseSensitive===!0,childrenIndex:f,route:u};_.relativePath.startsWith("/")&&(oi(_.relativePath.startsWith(r),`Absolute route path "${_.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),_.relativePath=_.relativePath.slice(r.length));let v=Ya([r,_.relativePath]),w=t.concat(_);u.children&&u.children.length>0&&(oi(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),xE(u.children,e,w,v)),!(u.path==null&&!u.index)&&e.push({path:v,score:wN(v,u.index),routesMeta:w})};return n.forEach((u,f)=>{if(u.path===""||!u.path?.includes("?"))l(u,f);else for(let y of TE(u.path))l(u,f,y)}),e}function TE(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,l=t.endsWith("?"),u=t.replace(/\?$/,"");if(r.length===0)return l?[u,""]:[u];let f=TE(r.join("/")),y=[];return y.push(...f.map(_=>_===""?u:[u,_].join("/"))),l&&y.push(...f),y.map(_=>n.startsWith("/")&&_===""?"/":_)}function gN(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:EN(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var yN=/^:[\w-]+$/,_N=3,vN=2,bN=1,xN=10,TN=-2,F0=n=>n==="*";function wN(n,e){let t=n.split("/"),r=t.length;return t.some(F0)&&(r+=TN),e&&(r+=vN),t.filter(l=>!F0(l)).reduce((l,u)=>l+(yN.test(u)?_N:u===""?bN:xN),r)}function EN(n,e){return n.length===e.length&&n.slice(0,-1).every((r,l)=>r===e[l])?n[n.length-1]-e[e.length-1]:0}function SN(n,e,t=!1){let{routesMeta:r}=n,l={},u="/",f=[];for(let y=0;y<r.length;++y){let _=r[y],v=y===r.length-1,w=u==="/"?e:e.slice(u.length)||"/",R=Em({path:_.relativePath,caseSensitive:_.caseSensitive,end:v},w),I=_.route;if(!R&&v&&t&&!r[r.length-1].route.index&&(R=Em({path:_.relativePath,caseSensitive:_.caseSensitive,end:!1},w)),!R)return null;Object.assign(l,R.params),f.push({params:l,pathname:Ya([u,R.pathname]),pathnameBase:IN(Ya([u,R.pathnameBase])),route:I}),R.pathnameBase!=="/"&&(u=Ya([u,R.pathnameBase]))}return f}function Em(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=jN(n.path,n.caseSensitive,n.end),l=e.match(t);if(!l)return null;let u=l[0],f=u.replace(/(.)\/+$/,"$1"),y=l.slice(1);return{params:r.reduce((v,{paramName:w,isOptional:R},I)=>{if(w==="*"){let H=y[I]||"";f=u.slice(0,u.length-H.length).replace(/(.)\/+$/,"$1")}const G=y[I];return R&&!G?v[w]=void 0:v[w]=(G||"").replace(/%2F/g,"/"),v},{}),pathname:u,pathnameBase:f,pattern:n}}function jN(n,e=!1,t=!0){Ds(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],l="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,y,_)=>(r.push({paramName:y,isOptional:_!=null}),_?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),l+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?l+="\\/*$":n!==""&&n!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,e?void 0:"i"),r]}function AN(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ds(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Xa(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function NN(n,e="/"){let{pathname:t,search:r="",hash:l=""}=typeof n=="string"?Tu(n):n;return{pathname:t?t.startsWith("/")?t:CN(t,e):e,search:PN(r),hash:MN(l)}}function CN(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(l=>{l===".."?t.length>1&&t.pop():l!=="."&&t.push(l)}),t.length>1?t.join("/"):"/"}function ly(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function RN(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function x_(n){let e=RN(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function T_(n,e,t,r=!1){let l;typeof n=="string"?l=Tu(n):(l={...n},oi(!l.pathname||!l.pathname.includes("?"),ly("?","pathname","search",l)),oi(!l.pathname||!l.pathname.includes("#"),ly("#","pathname","hash",l)),oi(!l.search||!l.search.includes("#"),ly("#","search","hash",l)));let u=n===""||l.pathname==="",f=u?"/":l.pathname,y;if(f==null)y=t;else{let R=e.length-1;if(!r&&f.startsWith("..")){let I=f.split("/");for(;I[0]==="..";)I.shift(),R-=1;l.pathname=I.join("/")}y=R>=0?e[R]:"/"}let _=NN(l,y),v=f&&f!=="/"&&f.endsWith("/"),w=(u||f===".")&&t.endsWith("/");return!_.pathname.endsWith("/")&&(v||w)&&(_.pathname+="/"),_}var Ya=n=>n.join("/").replace(/\/\/+/g,"/"),IN=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),PN=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,MN=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function kN(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var wE=["POST","PUT","PATCH","DELETE"];new Set(wE);var ON=["GET",...wE];new Set(ON);var wu=E.createContext(null);wu.displayName="DataRouter";var Km=E.createContext(null);Km.displayName="DataRouterState";E.createContext(!1);var EE=E.createContext({isTransitioning:!1});EE.displayName="ViewTransition";var DN=E.createContext(new Map);DN.displayName="Fetchers";var LN=E.createContext(null);LN.displayName="Await";var Js=E.createContext(null);Js.displayName="Navigation";var mh=E.createContext(null);mh.displayName="Location";var ea=E.createContext({outlet:null,matches:[],isDataRoute:!1});ea.displayName="Route";var w_=E.createContext(null);w_.displayName="RouteError";function VN(n,{relative:e}={}){oi(Eu(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=E.useContext(Js),{hash:l,pathname:u,search:f}=ph(n,{relative:e}),y=u;return t!=="/"&&(y=u==="/"?t:Ya([t,u])),r.createHref({pathname:y,search:f,hash:l})}function Eu(){return E.useContext(mh)!=null}function es(){return oi(Eu(),"useLocation() may be used only in the context of a <Router> component."),E.useContext(mh).location}var SE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function jE(n){E.useContext(Js).static||E.useLayoutEffect(n)}function rr(){let{isDataRoute:n}=E.useContext(ea);return n?QN():UN()}function UN(){oi(Eu(),"useNavigate() may be used only in the context of a <Router> component.");let n=E.useContext(wu),{basename:e,navigator:t}=E.useContext(Js),{matches:r}=E.useContext(ea),{pathname:l}=es(),u=JSON.stringify(x_(r)),f=E.useRef(!1);return jE(()=>{f.current=!0}),E.useCallback((_,v={})=>{if(Ds(f.current,SE),!f.current)return;if(typeof _=="number"){t.go(_);return}let w=T_(_,JSON.parse(u),l,v.relative==="path");n==null&&e!=="/"&&(w.pathname=w.pathname==="/"?e:Ya([e,w.pathname])),(v.replace?t.replace:t.push)(w,v.state,v)},[e,t,u,l,n])}E.createContext(null);function Su(){let{matches:n}=E.useContext(ea),e=n[n.length-1];return e?e.params:{}}function ph(n,{relative:e}={}){let{matches:t}=E.useContext(ea),{pathname:r}=es(),l=JSON.stringify(x_(t));return E.useMemo(()=>T_(n,JSON.parse(l),r,e==="path"),[n,l,r,e])}function FN(n,e){return AE(n,e)}function AE(n,e,t,r){oi(Eu(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=E.useContext(Js),{matches:u}=E.useContext(ea),f=u[u.length-1],y=f?f.params:{},_=f?f.pathname:"/",v=f?f.pathnameBase:"/",w=f&&f.route;{let Q=w&&w.path||"";NE(_,!w||Q.endsWith("*")||Q.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${_}" (under <Route path="${Q}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Q}"> to <Route path="${Q==="/"?"*":`${Q}/*`}">.`)}let R=es(),I;if(e){let Q=typeof e=="string"?Tu(e):e;oi(v==="/"||Q.pathname?.startsWith(v),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${v}" but pathname "${Q.pathname}" was given in the \`location\` prop.`),I=Q}else I=R;let G=I.pathname||"/",H=G;if(v!=="/"){let Q=v.replace(/^\//,"").split("/");H="/"+G.replace(/^\//,"").split("/").slice(Q.length).join("/")}let Z=bE(n,{pathname:H});Ds(w||Z!=null,`No routes matched location "${I.pathname}${I.search}${I.hash}" `),Ds(Z==null||Z[Z.length-1].route.element!==void 0||Z[Z.length-1].route.Component!==void 0||Z[Z.length-1].route.lazy!==void 0,`Matched leaf route at location "${I.pathname}${I.search}${I.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let F=$N(Z&&Z.map(Q=>Object.assign({},Q,{params:Object.assign({},y,Q.params),pathname:Ya([v,l.encodeLocation?l.encodeLocation(Q.pathname).pathname:Q.pathname]),pathnameBase:Q.pathnameBase==="/"?v:Ya([v,l.encodeLocation?l.encodeLocation(Q.pathnameBase).pathname:Q.pathnameBase])})),u,t,r);return e&&F?E.createElement(mh.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...I},navigationType:"POP"}},F):F}function zN(){let n=YN(),e=kN(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:r},u={padding:"2px 4px",backgroundColor:r},f=null;return console.error("Error handled by React Router default ErrorBoundary:",n),f=E.createElement(E.Fragment,null,E.createElement("p",null,"💿 Hey developer 👋"),E.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",E.createElement("code",{style:u},"ErrorBoundary")," or"," ",E.createElement("code",{style:u},"errorElement")," prop on your route.")),E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),t?E.createElement("pre",{style:l},t):null,f)}var BN=E.createElement(zN,null),HN=class extends E.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?E.createElement(ea.Provider,{value:this.props.routeContext},E.createElement(w_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function qN({routeContext:n,match:e,children:t}){let r=E.useContext(wu);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),E.createElement(ea.Provider,{value:n},t)}function $N(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let l=n,u=t?.errors;if(u!=null){let _=l.findIndex(v=>v.route.id&&u?.[v.route.id]!==void 0);oi(_>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),l=l.slice(0,Math.min(l.length,_+1))}let f=!1,y=-1;if(t)for(let _=0;_<l.length;_++){let v=l[_];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(y=_),v.route.id){let{loaderData:w,errors:R}=t,I=v.route.loader&&!w.hasOwnProperty(v.route.id)&&(!R||R[v.route.id]===void 0);if(v.route.lazy||I){f=!0,y>=0?l=l.slice(0,y+1):l=[l[0]];break}}}return l.reduceRight((_,v,w)=>{let R,I=!1,G=null,H=null;t&&(R=u&&v.route.id?u[v.route.id]:void 0,G=v.route.errorElement||BN,f&&(y<0&&w===0?(NE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),I=!0,H=null):y===w&&(I=!0,H=v.route.hydrateFallbackElement||null)));let Z=e.concat(l.slice(0,w+1)),F=()=>{let Q;return R?Q=G:I?Q=H:v.route.Component?Q=E.createElement(v.route.Component,null):v.route.element?Q=v.route.element:Q=_,E.createElement(qN,{match:v,routeContext:{outlet:_,matches:Z,isDataRoute:t!=null},children:Q})};return t&&(v.route.ErrorBoundary||v.route.errorElement||w===0)?E.createElement(HN,{location:t.location,revalidation:t.revalidation,component:G,error:R,children:F(),routeContext:{outlet:null,matches:Z,isDataRoute:!0}}):F()},null)}function E_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GN(n){let e=E.useContext(wu);return oi(e,E_(n)),e}function ZN(n){let e=E.useContext(Km);return oi(e,E_(n)),e}function KN(n){let e=E.useContext(ea);return oi(e,E_(n)),e}function S_(n){let e=KN(n),t=e.matches[e.matches.length-1];return oi(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function WN(){return S_("useRouteId")}function YN(){let n=E.useContext(w_),e=ZN("useRouteError"),t=S_("useRouteError");return n!==void 0?n:e.errors?.[t]}function QN(){let{router:n}=GN("useNavigate"),e=S_("useNavigate"),t=E.useRef(!1);return jE(()=>{t.current=!0}),E.useCallback(async(l,u={})=>{Ds(t.current,SE),t.current&&(typeof l=="number"?n.navigate(l):await n.navigate(l,{fromRouteId:e,...u}))},[n,e])}var z0={};function NE(n,e,t){!e&&!z0[n]&&(z0[n]=!0,Ds(!1,t))}E.memo(XN);function XN({routes:n,future:e,state:t}){return AE(n,void 0,t,e)}function Ws({to:n,replace:e,state:t,relative:r}){oi(Eu(),"<Navigate> may be used only in the context of a <Router> component.");let{static:l}=E.useContext(Js);Ds(!l,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:u}=E.useContext(ea),{pathname:f}=es(),y=rr(),_=T_(n,x_(u),f,r==="path"),v=JSON.stringify(_);return E.useEffect(()=>{y(JSON.parse(v),{replace:e,state:t,relative:r})},[y,v,r,e,t]),null}function Xe(n){oi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function JN({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:l,static:u=!1}){oi(!Eu(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),y=E.useMemo(()=>({basename:f,navigator:l,static:u,future:{}}),[f,l,u]);typeof t=="string"&&(t=Tu(t));let{pathname:_="/",search:v="",hash:w="",state:R=null,key:I="default"}=t,G=E.useMemo(()=>{let H=Xa(_,f);return H==null?null:{location:{pathname:H,search:v,hash:w,state:R,key:I},navigationType:r}},[f,_,v,w,R,I,r]);return Ds(G!=null,`<Router basename="${f}"> is not able to match the URL "${_}${v}${w}" because it does not start with the basename, so the <Router> won't render anything.`),G==null?null:E.createElement(Js.Provider,{value:y},E.createElement(mh.Provider,{children:e,value:G}))}function eC({children:n,location:e}){return FN(qy(n),e)}function qy(n,e=[]){let t=[];return E.Children.forEach(n,(r,l)=>{if(!E.isValidElement(r))return;let u=[...e,l];if(r.type===E.Fragment){t.push.apply(t,qy(r.props.children,u));return}oi(r.type===Xe,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),oi(!r.props.index||!r.props.children,"An index route cannot have child routes.");let f={id:r.props.id||u.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(f.children=qy(r.props.children,u)),t.push(f)}),t}var um="get",dm="application/x-www-form-urlencoded";function Wm(n){return n!=null&&typeof n.tagName=="string"}function tC(n){return Wm(n)&&n.tagName.toLowerCase()==="button"}function nC(n){return Wm(n)&&n.tagName.toLowerCase()==="form"}function iC(n){return Wm(n)&&n.tagName.toLowerCase()==="input"}function rC(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function sC(n,e){return n.button===0&&(!e||e==="_self")&&!rC(n)}function $y(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(l=>[t,l]):[[t,r]])},[]))}function aC(n,e){let t=$y(n);return e&&e.forEach((r,l)=>{t.has(l)||e.getAll(l).forEach(u=>{t.append(l,u)})}),t}var Lf=null;function oC(){if(Lf===null)try{new FormData(document.createElement("form"),0),Lf=!1}catch{Lf=!0}return Lf}var lC=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cy(n){return n!=null&&!lC.has(n)?(Ds(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${dm}"`),null):n}function cC(n,e){let t,r,l,u,f;if(nC(n)){let y=n.getAttribute("action");r=y?Xa(y,e):null,t=n.getAttribute("method")||um,l=cy(n.getAttribute("enctype"))||dm,u=new FormData(n)}else if(tC(n)||iC(n)&&(n.type==="submit"||n.type==="image")){let y=n.form;if(y==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let _=n.getAttribute("formaction")||y.getAttribute("action");if(r=_?Xa(_,e):null,t=n.getAttribute("formmethod")||y.getAttribute("method")||um,l=cy(n.getAttribute("formenctype"))||cy(y.getAttribute("enctype"))||dm,u=new FormData(y,n),!oC()){let{name:v,type:w,value:R}=n;if(w==="image"){let I=v?`${v}.`:"";u.append(`${I}x`,"0"),u.append(`${I}y`,"0")}else v&&u.append(v,R)}}else{if(Wm(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=um,r=null,l=dm,f=n}return u&&l==="text/plain"&&(f=u,u=void 0),{action:r,method:t.toLowerCase(),encType:l,formData:u,body:f}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function j_(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function uC(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&Xa(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function dC(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function hC(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function fC(n,e,t){let r=await Promise.all(n.map(async l=>{let u=e.routes[l.route.id];if(u){let f=await dC(u,t);return f.links?f.links():[]}return[]}));return yC(r.flat(1).filter(hC).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function B0(n,e,t,r,l,u){let f=(_,v)=>t[v]?_.route.id!==t[v].route.id:!0,y=(_,v)=>t[v].pathname!==_.pathname||t[v].route.path?.endsWith("*")&&t[v].params["*"]!==_.params["*"];return u==="assets"?e.filter((_,v)=>f(_,v)||y(_,v)):u==="data"?e.filter((_,v)=>{let w=r.routes[_.route.id];if(!w||!w.hasLoader)return!1;if(f(_,v)||y(_,v))return!0;if(_.route.shouldRevalidate){let R=_.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:_.params,defaultShouldRevalidate:!0});if(typeof R=="boolean")return R}return!0}):[]}function mC(n,e,{includeHydrateFallback:t}={}){return pC(n.map(r=>{let l=e.routes[r.route.id];if(!l)return[];let u=[l.module];return l.clientActionModule&&(u=u.concat(l.clientActionModule)),l.clientLoaderModule&&(u=u.concat(l.clientLoaderModule)),t&&l.hydrateFallbackModule&&(u=u.concat(l.hydrateFallbackModule)),l.imports&&(u=u.concat(l.imports)),u}).flat(1))}function pC(n){return[...new Set(n)]}function gC(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function yC(n,e){let t=new Set;return new Set(e),n.reduce((r,l)=>{let u=JSON.stringify(gC(l));return t.has(u)||(t.add(u),r.push({key:u,link:l})),r},[])}function CE(){let n=E.useContext(wu);return j_(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function _C(){let n=E.useContext(Km);return j_(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var A_=E.createContext(void 0);A_.displayName="FrameworkContext";function RE(){let n=E.useContext(A_);return j_(n,"You must render this element inside a <HydratedRouter> element"),n}function vC(n,e){let t=E.useContext(A_),[r,l]=E.useState(!1),[u,f]=E.useState(!1),{onFocus:y,onBlur:_,onMouseEnter:v,onMouseLeave:w,onTouchStart:R}=e,I=E.useRef(null);E.useEffect(()=>{if(n==="render"&&f(!0),n==="viewport"){let Z=Q=>{Q.forEach(se=>{f(se.isIntersecting)})},F=new IntersectionObserver(Z,{threshold:.5});return I.current&&F.observe(I.current),()=>{F.disconnect()}}},[n]),E.useEffect(()=>{if(r){let Z=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(Z)}}},[r]);let G=()=>{l(!0)},H=()=>{l(!1),f(!1)};return t?n!=="intent"?[u,I,{}]:[u,I,{onFocus:jd(y,G),onBlur:jd(_,H),onMouseEnter:jd(v,G),onMouseLeave:jd(w,H),onTouchStart:jd(R,G)}]:[!1,I,{}]}function jd(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function bC({page:n,...e}){let{router:t}=CE(),r=E.useMemo(()=>bE(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?E.createElement(TC,{page:n,matches:r,...e}):null}function xC(n){let{manifest:e,routeModules:t}=RE(),[r,l]=E.useState([]);return E.useEffect(()=>{let u=!1;return fC(n,e,t).then(f=>{u||l(f)}),()=>{u=!0}},[n,e,t]),r}function TC({page:n,matches:e,...t}){let r=es(),{manifest:l,routeModules:u}=RE(),{basename:f}=CE(),{loaderData:y,matches:_}=_C(),v=E.useMemo(()=>B0(n,e,_,l,r,"data"),[n,e,_,l,r]),w=E.useMemo(()=>B0(n,e,_,l,r,"assets"),[n,e,_,l,r]),R=E.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let H=new Set,Z=!1;if(e.forEach(Q=>{let se=l.routes[Q.route.id];!se||!se.hasLoader||(!v.some(ue=>ue.route.id===Q.route.id)&&Q.route.id in y&&u[Q.route.id]?.shouldRevalidate||se.hasClientLoader?Z=!0:H.add(Q.route.id))}),H.size===0)return[];let F=uC(n,f,"data");return Z&&H.size>0&&F.searchParams.set("_routes",e.filter(Q=>H.has(Q.route.id)).map(Q=>Q.route.id).join(",")),[F.pathname+F.search]},[f,y,r,l,v,e,n,u]),I=E.useMemo(()=>mC(w,l),[w,l]),G=xC(w);return E.createElement(E.Fragment,null,R.map(H=>E.createElement("link",{key:H,rel:"prefetch",as:"fetch",href:H,...t})),I.map(H=>E.createElement("link",{key:H,rel:"modulepreload",href:H,...t})),G.map(({key:H,link:Z})=>E.createElement("link",{key:H,...Z})))}function wC(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var IE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{IE&&(window.__reactRouterVersion="7.7.0")}catch{}function EC({basename:n,children:e,window:t}){let r=E.useRef();r.current==null&&(r.current=dN({window:t,v5Compat:!0}));let l=r.current,[u,f]=E.useState({action:l.action,location:l.location}),y=E.useCallback(_=>{E.startTransition(()=>f(_))},[f]);return E.useLayoutEffect(()=>l.listen(y),[l,y]),E.createElement(JN,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:l})}var PE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Zt=E.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:l,reloadDocument:u,replace:f,state:y,target:_,to:v,preventScrollReset:w,viewTransition:R,...I},G){let{basename:H}=E.useContext(Js),Z=typeof v=="string"&&PE.test(v),F,Q=!1;if(typeof v=="string"&&Z&&(F=v,IE))try{let D=new URL(window.location.href),U=v.startsWith("//")?new URL(D.protocol+v):new URL(v),k=Xa(U.pathname,H);U.origin===D.origin&&k!=null?v=k+U.search+U.hash:Q=!0}catch{Ds(!1,`<Link to="${v}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let se=VN(v,{relative:l}),[ue,we,Ce]=vC(r,I),Ue=NC(v,{replace:f,state:y,target:_,preventScrollReset:w,relative:l,viewTransition:R});function P(D){e&&e(D),D.defaultPrevented||Ue(D)}let M=E.createElement("a",{...I,...Ce,href:F||se,onClick:Q||u?e:P,ref:wC(G,we),target:_,"data-discover":!Z&&t==="render"?"true":void 0});return ue&&!Z?E.createElement(E.Fragment,null,M,E.createElement(bC,{page:se})):M});Zt.displayName="Link";var SC=E.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:l=!1,style:u,to:f,viewTransition:y,children:_,...v},w){let R=ph(f,{relative:v.relative}),I=es(),G=E.useContext(Km),{navigator:H,basename:Z}=E.useContext(Js),F=G!=null&&MC(R)&&y===!0,Q=H.encodeLocation?H.encodeLocation(R).pathname:R.pathname,se=I.pathname,ue=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;t||(se=se.toLowerCase(),ue=ue?ue.toLowerCase():null,Q=Q.toLowerCase()),ue&&Z&&(ue=Xa(ue,Z)||ue);const we=Q!=="/"&&Q.endsWith("/")?Q.length-1:Q.length;let Ce=se===Q||!l&&se.startsWith(Q)&&se.charAt(we)==="/",Ue=ue!=null&&(ue===Q||!l&&ue.startsWith(Q)&&ue.charAt(Q.length)==="/"),P={isActive:Ce,isPending:Ue,isTransitioning:F},M=Ce?e:void 0,D;typeof r=="function"?D=r(P):D=[r,Ce?"active":null,Ue?"pending":null,F?"transitioning":null].filter(Boolean).join(" ");let U=typeof u=="function"?u(P):u;return E.createElement(Zt,{...v,"aria-current":M,className:D,ref:w,style:U,to:f,viewTransition:y},typeof _=="function"?_(P):_)});SC.displayName="NavLink";var jC=E.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:l,state:u,method:f=um,action:y,onSubmit:_,relative:v,preventScrollReset:w,viewTransition:R,...I},G)=>{let H=IC(),Z=PC(y,{relative:v}),F=f.toLowerCase()==="get"?"get":"post",Q=typeof y=="string"&&PE.test(y),se=ue=>{if(_&&_(ue),ue.defaultPrevented)return;ue.preventDefault();let we=ue.nativeEvent.submitter,Ce=we?.getAttribute("formmethod")||f;H(we||ue.currentTarget,{fetcherKey:e,method:Ce,navigate:t,replace:l,state:u,relative:v,preventScrollReset:w,viewTransition:R})};return E.createElement("form",{ref:G,method:F,action:Z,onSubmit:r?_:se,...I,"data-discover":!Q&&n==="render"?"true":void 0})});jC.displayName="Form";function AC(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ME(n){let e=E.useContext(wu);return oi(e,AC(n)),e}function NC(n,{target:e,replace:t,state:r,preventScrollReset:l,relative:u,viewTransition:f}={}){let y=rr(),_=es(),v=ph(n,{relative:u});return E.useCallback(w=>{if(sC(w,e)){w.preventDefault();let R=t!==void 0?t:nh(_)===nh(v);y(n,{replace:R,state:r,preventScrollReset:l,relative:u,viewTransition:f})}},[_,y,v,t,r,e,n,l,u,f])}function N_(n){Ds(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=E.useRef($y(n)),t=E.useRef(!1),r=es(),l=E.useMemo(()=>aC(r.search,t.current?null:e.current),[r.search]),u=rr(),f=E.useCallback((y,_)=>{const v=$y(typeof y=="function"?y(new URLSearchParams(l)):y);t.current=!0,u("?"+v,_)},[u,l]);return[l,f]}var CC=0,RC=()=>`__${String(++CC)}__`;function IC(){let{router:n}=ME("useSubmit"),{basename:e}=E.useContext(Js),t=WN();return E.useCallback(async(r,l={})=>{let{action:u,method:f,encType:y,formData:_,body:v}=cC(r,e);if(l.navigate===!1){let w=l.fetcherKey||RC();await n.fetch(w,t,l.action||u,{preventScrollReset:l.preventScrollReset,formData:_,body:v,formMethod:l.method||f,formEncType:l.encType||y,flushSync:l.flushSync})}else await n.navigate(l.action||u,{preventScrollReset:l.preventScrollReset,formData:_,body:v,formMethod:l.method||f,formEncType:l.encType||y,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[n,e,t])}function PC(n,{relative:e}={}){let{basename:t}=E.useContext(Js),r=E.useContext(ea);oi(r,"useFormAction must be used inside a RouteContext");let[l]=r.matches.slice(-1),u={...ph(n||".",{relative:e})},f=es();if(n==null){u.search=f.search;let y=new URLSearchParams(u.search),_=y.getAll("index");if(_.some(w=>w==="")){y.delete("index"),_.filter(R=>R).forEach(R=>y.append("index",R));let w=y.toString();u.search=w?`?${w}`:""}}return(!n||n===".")&&l.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(u.pathname=u.pathname==="/"?t:Ya([t,u.pathname])),nh(u)}function MC(n,e={}){let t=E.useContext(EE);oi(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=ME("useViewTransitionState"),l=ph(n,{relative:e.relative});if(!t.isTransitioning)return!1;let u=Xa(t.currentLocation.pathname,r)||t.currentLocation.pathname,f=Xa(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Em(l.pathname,f)!=null||Em(l.pathname,u)!=null}var kC=vE();function OC(){const[n,e]=E.useState(()=>localStorage.getItem("theme")||"light");return E.useEffect(()=>{document.documentElement.setAttribute("data-theme",n==="dark"?"dark":"light"),localStorage.setItem("theme",n)},[n]),a.jsx("button",{className:"btn",onClick:()=>e(t=>t==="dark"?"light":"dark"),title:"Tema",children:n==="dark"?"🌙":"☀️"})}const DC=()=>{};var H0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let l=n.charCodeAt(r);l<128?e[t++]=l:l<2048?(e[t++]=l>>6|192,e[t++]=l&63|128):(l&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=l>>18|240,e[t++]=l>>12&63|128,e[t++]=l>>6&63|128,e[t++]=l&63|128):(e[t++]=l>>12|224,e[t++]=l>>6&63|128,e[t++]=l&63|128)}return e},LC=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const l=n[t++];if(l<128)e[r++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[t++];e[r++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[t++],f=n[t++],y=n[t++],_=((l&7)<<18|(u&63)<<12|(f&63)<<6|y&63)-65536;e[r++]=String.fromCharCode(55296+(_>>10)),e[r++]=String.fromCharCode(56320+(_&1023))}else{const u=n[t++],f=n[t++];e[r++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},OE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,y=f?n[l+1]:0,_=l+2<n.length,v=_?n[l+2]:0,w=u>>2,R=(u&3)<<4|y>>4;let I=(y&15)<<2|v>>6,G=v&63;_||(G=64,f||(I=64)),r.push(t[w],t[R],t[I],t[G])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(kE(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):LC(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let l=0;l<n.length;){const u=t[n.charAt(l++)],y=l<n.length?t[n.charAt(l)]:0;++l;const v=l<n.length?t[n.charAt(l)]:64;++l;const R=l<n.length?t[n.charAt(l)]:64;if(++l,u==null||y==null||v==null||R==null)throw new VC;const I=u<<2|y>>4;if(r.push(I),v!==64){const G=y<<4&240|v>>2;if(r.push(G),R!==64){const H=v<<6&192|R;r.push(H)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class VC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const UC=function(n){const e=kE(n);return OE.encodeByteArray(e,!0)},Sm=function(n){return UC(n).replace(/\./g,"")},DE=function(n){try{return OE.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=()=>FC().__FIREBASE_DEFAULTS__,BC=()=>{if(typeof process>"u"||typeof H0>"u")return;const n=H0.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},HC=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&DE(n[1]);return e&&JSON.parse(e)},Ym=()=>{try{return DC()||zC()||BC()||HC()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},LE=n=>Ym()?.emulatorHosts?.[n],C_=n=>{const e=LE(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},VE=()=>Ym()?.config,UE=n=>Ym()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ao(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Qm(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FE(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f={iss:`https://securetoken.google.com/${r}`,aud:r,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Sm(JSON.stringify(t)),Sm(JSON.stringify(f)),""].join(".")}const Kd={};function $C(){const n={prod:[],emulator:[]};for(const e of Object.keys(Kd))Kd[e]?n.emulator.push(e):n.prod.push(e);return n}function GC(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let q0=!1;function Xm(n,e){if(typeof window>"u"||typeof document>"u"||!ao(window.location.host)||Kd[n]===e||Kd[n]||q0)return;Kd[n]=e;function t(I){return`__firebase__banner__${I}`}const r="__firebase__banner",u=$C().prod.length>0;function f(){const I=document.getElementById(r);I&&I.remove()}function y(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function _(I,G){I.setAttribute("width","24"),I.setAttribute("id",G),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function v(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{q0=!0,f()},I}function w(I,G){I.setAttribute("id",G),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function R(){const I=GC(r),G=t("text"),H=document.getElementById(G)||document.createElement("span"),Z=t("learnmore"),F=document.getElementById(Z)||document.createElement("a"),Q=t("preprendIcon"),se=document.getElementById(Q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const ue=I.element;y(ue),w(F,Z);const we=v();_(se,Q),ue.append(se,H,F,we),document.body.appendChild(ue)}u?(H.innerText="Preview backend disconnected.",se.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(se.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,H.innerText="Preview backend running in this workspace."),H.setAttribute("id",G)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",R):R()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ZC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cr())}function KC(){const n=Ym()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function YC(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function QC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function XC(){const n=Cr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function JC(){return!KC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eR(){try{return typeof indexedDB=="object"}catch{return!1}}function tR(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(r);l.onsuccess=()=>{l.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},l.onupgradeneeded=()=>{t=!1},l.onerror=()=>{e(l.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nR="FirebaseError";class ta extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=nR,Object.setPrototypeOf(this,ta.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,gh.prototype.create)}}class gh{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?iR(u,r):"Error",y=`${this.serviceName}: ${f} (${l}).`;return new ta(l,y,r)}}function iR(n,e){return n.replace(rR,(t,r)=>{const l=e[r];return l!=null?String(l):`<${r}?>`})}const rR=/\{\$([^}]+)}/g;function sR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nc(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const l of t){if(!r.includes(l))return!1;const u=n[l],f=e[l];if($0(u)&&$0(f)){if(!nc(u,f))return!1}else if(u!==f)return!1}for(const l of r)if(!t.includes(l))return!1;return!0}function $0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(l=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fd(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[l,u]=r.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function zd(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function aR(n,e){const t=new oR(n,e);return t.subscribe.bind(t)}class oR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let l;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");lR(e,["next","error","complete"])?l=e:l={next:e,error:t,complete:r},l.next===void 0&&(l.next=uy),l.error===void 0&&(l.error=uy),l.complete===void 0&&(l.complete=uy);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function uy(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(n){return n&&n._delegate?n._delegate:n}class Ja{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ql="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new qC;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:t});l&&r.resolve(l)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(l){if(r)return null;throw l}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(dR(e))try{this.getOrInitializeService({instanceIdentifier:Ql})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(t);try{const u=this.getOrInitializeService({instanceIdentifier:l});r.resolve(u)}catch{}}}}clearInstance(e=Ql){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ql){return this.instances.has(e)}getOptions(e=Ql){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[u,f]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(u);r===y&&f.resolve(l)}return l}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),l=this.onInitCallbacks.get(r)??new Set;l.add(e),this.onInitCallbacks.set(r,l);const u=this.instances.get(r);return u&&e(u,r),()=>{l.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const l of r)try{l(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:uR(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ql){return this.component?this.component.multipleInstances?e:Ql:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function uR(n){return n===Ql?void 0:n}function dR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new cR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sn;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(sn||(sn={}));const fR={debug:sn.DEBUG,verbose:sn.VERBOSE,info:sn.INFO,warn:sn.WARN,error:sn.ERROR,silent:sn.SILENT},mR=sn.INFO,pR={[sn.DEBUG]:"log",[sn.VERBOSE]:"log",[sn.INFO]:"info",[sn.WARN]:"warn",[sn.ERROR]:"error"},gR=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),l=pR[e];if(l)console[l](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class R_{constructor(e){this.name=e,this._logLevel=mR,this._logHandler=gR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in sn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?fR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,sn.DEBUG,...e),this._logHandler(this,sn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,sn.VERBOSE,...e),this._logHandler(this,sn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,sn.INFO,...e),this._logHandler(this,sn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,sn.WARN,...e),this._logHandler(this,sn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,sn.ERROR,...e),this._logHandler(this,sn.ERROR,...e)}}const yR=(n,e)=>e.some(t=>n instanceof t);let G0,Z0;function _R(){return G0||(G0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vR(){return Z0||(Z0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zE=new WeakMap,Gy=new WeakMap,BE=new WeakMap,dy=new WeakMap,I_=new WeakMap;function bR(n){const e=new Promise((t,r)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{t(rl(n.result)),l()},f=()=>{r(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(t=>{t instanceof IDBCursor&&zE.set(t,n)}).catch(()=>{}),I_.set(e,n),e}function xR(n){if(Gy.has(n))return;const e=new Promise((t,r)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{t(),l()},f=()=>{r(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});Gy.set(n,e)}let Zy={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Gy.get(n);if(e==="objectStoreNames")return n.objectStoreNames||BE.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return rl(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function TR(n){Zy=n(Zy)}function wR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(hy(this),e,...t);return BE.set(r,e.sort?e.sort():[e]),rl(r)}:vR().includes(n)?function(...e){return n.apply(hy(this),e),rl(zE.get(this))}:function(...e){return rl(n.apply(hy(this),e))}}function ER(n){return typeof n=="function"?wR(n):(n instanceof IDBTransaction&&xR(n),yR(n,_R())?new Proxy(n,Zy):n)}function rl(n){if(n instanceof IDBRequest)return bR(n);if(dy.has(n))return dy.get(n);const e=ER(n);return e!==n&&(dy.set(n,e),I_.set(e,n)),e}const hy=n=>I_.get(n);function SR(n,e,{blocked:t,upgrade:r,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),y=rl(f);return r&&f.addEventListener("upgradeneeded",_=>{r(rl(f.result),_.oldVersion,_.newVersion,rl(f.transaction),_)}),t&&f.addEventListener("blocked",_=>t(_.oldVersion,_.newVersion,_)),y.then(_=>{u&&_.addEventListener("close",()=>u()),l&&_.addEventListener("versionchange",v=>l(v.oldVersion,v.newVersion,v))}).catch(()=>{}),y}const jR=["get","getKey","getAll","getAllKeys","count"],AR=["put","add","delete","clear"],fy=new Map;function K0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(fy.get(e))return fy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,l=AR.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(l||jR.includes(t)))return;const u=async function(f,...y){const _=this.transaction(f,l?"readwrite":"readonly");let v=_.store;return r&&(v=v.index(y.shift())),(await Promise.all([v[t](...y),l&&_.done]))[0]};return fy.set(e,u),u}TR(n=>({...n,get:(e,t,r)=>K0(e,t)||n.get(e,t,r),has:(e,t)=>!!K0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(CR(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function CR(n){return n.getComponent()?.type==="VERSION"}const Ky="@firebase/app",W0="0.14.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo=new R_("@firebase/app"),RR="@firebase/app-compat",IR="@firebase/analytics-compat",PR="@firebase/analytics",MR="@firebase/app-check-compat",kR="@firebase/app-check",OR="@firebase/auth",DR="@firebase/auth-compat",LR="@firebase/database",VR="@firebase/data-connect",UR="@firebase/database-compat",FR="@firebase/functions",zR="@firebase/functions-compat",BR="@firebase/installations",HR="@firebase/installations-compat",qR="@firebase/messaging",$R="@firebase/messaging-compat",GR="@firebase/performance",ZR="@firebase/performance-compat",KR="@firebase/remote-config",WR="@firebase/remote-config-compat",YR="@firebase/storage",QR="@firebase/storage-compat",XR="@firebase/firestore",JR="@firebase/ai",eI="@firebase/firestore-compat",tI="firebase",nI="12.0.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy="[DEFAULT]",iI={[Ky]:"fire-core",[RR]:"fire-core-compat",[PR]:"fire-analytics",[IR]:"fire-analytics-compat",[kR]:"fire-app-check",[MR]:"fire-app-check-compat",[OR]:"fire-auth",[DR]:"fire-auth-compat",[LR]:"fire-rtdb",[VR]:"fire-data-connect",[UR]:"fire-rtdb-compat",[FR]:"fire-fn",[zR]:"fire-fn-compat",[BR]:"fire-iid",[HR]:"fire-iid-compat",[qR]:"fire-fcm",[$R]:"fire-fcm-compat",[GR]:"fire-perf",[ZR]:"fire-perf-compat",[KR]:"fire-rc",[WR]:"fire-rc-compat",[YR]:"fire-gcs",[QR]:"fire-gcs-compat",[XR]:"fire-fst",[eI]:"fire-fst-compat",[JR]:"fire-vertex","fire-js":"fire-js",[tI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ih=new Map,rI=new Map,Yy=new Map;function Y0(n,e){try{n.container.addComponent(e)}catch(t){eo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function dl(n){const e=n.name;if(Yy.has(e))return eo.debug(`There were multiple attempts to register component ${e}.`),!1;Yy.set(e,n);for(const t of ih.values())Y0(t,n);for(const t of rI.values())Y0(t,n);return!0}function _h(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Yr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sl=new gh("app","Firebase",sI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ja("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cc=nI;function HE(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Wy,automaticDataCollectionEnabled:!0,...e},l=r.name;if(typeof l!="string"||!l)throw sl.create("bad-app-name",{appName:String(l)});if(t||(t=VE()),!t)throw sl.create("no-options");const u=ih.get(l);if(u){if(nc(t,u.options)&&nc(r,u.config))return u;throw sl.create("duplicate-app",{appName:l})}const f=new hR(l);for(const _ of Yy.values())f.addComponent(_);const y=new aI(t,r,f);return ih.set(l,y),y}function vh(n=Wy){const e=ih.get(n);if(!e&&n===Wy&&VE())return HE();if(!e)throw sl.create("no-app",{appName:n});return e}function oI(){return Array.from(ih.values())}function Os(n,e,t){let r=iI[n]??n;t&&(r+=`-${t}`);const l=r.match(/\s|\//),u=e.match(/\s|\//);if(l||u){const f=[`Unable to register library "${r}" with version "${e}":`];l&&f.push(`library name "${r}" contains illegal characters (whitespace or "/")`),l&&u&&f.push("and"),u&&f.push(`version name "${e}" contains illegal characters (whitespace or "/")`),eo.warn(f.join(" "));return}dl(new Ja(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lI="firebase-heartbeat-database",cI=1,rh="firebase-heartbeat-store";let my=null;function qE(){return my||(my=SR(lI,cI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(rh)}catch(t){console.warn(t)}}}}).catch(n=>{throw sl.create("idb-open",{originalErrorMessage:n.message})})),my}async function uI(n){try{const t=(await qE()).transaction(rh),r=await t.objectStore(rh).get($E(n));return await t.done,r}catch(e){if(e instanceof ta)eo.warn(e.message);else{const t=sl.create("idb-get",{originalErrorMessage:e?.message});eo.warn(t.message)}}}async function Q0(n,e){try{const r=(await qE()).transaction(rh,"readwrite");await r.objectStore(rh).put(e,$E(n)),await r.done}catch(t){if(t instanceof ta)eo.warn(t.message);else{const r=sl.create("idb-set",{originalErrorMessage:t?.message});eo.warn(r.message)}}}function $E(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dI=1024,hI=30;class fI{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new pI(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=X0();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(l=>l.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>hI){const l=gI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eo.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=X0(),{heartbeatsToSend:t,unsentEntries:r}=mI(this._heartbeatsCache.heartbeats),l=Sm(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(e){return eo.warn(e),""}}}function X0(){return new Date().toISOString().substring(0,10)}function mI(n,e=dI){const t=[];let r=n.slice();for(const l of n){const u=t.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),J0(t)>e){u.dates.pop();break}}else if(t.push({agent:l.agent,dates:[l.date]}),J0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class pI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eR()?tR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await uI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Q0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Q0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function J0(n){return Sm(JSON.stringify({version:2,heartbeats:n})).length}function gI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n){dl(new Ja("platform-logger",e=>new NR(e),"PRIVATE")),dl(new Ja("heartbeat",e=>new fI(e),"PRIVATE")),Os(Ky,W0,n),Os(Ky,W0,"esm2020"),Os("fire-js","")}yI("");var _I="firebase",vI="12.0.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Os(_I,vI,"app");function GE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bI=GE,ZE=new gh("auth","Firebase",GE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm=new R_("@firebase/auth");function xI(n,...e){jm.logLevel<=sn.WARN&&jm.warn(`Auth (${cc}): ${n}`,...e)}function hm(n,...e){jm.logLevel<=sn.ERROR&&jm.error(`Auth (${cc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(n,...e){throw P_(n,...e)}function va(n,...e){return P_(n,...e)}function KE(n,e,t){const r={...bI(),[e]:t};return new gh("auth","Firebase",r).create(e,{appName:n.name})}function Qa(n){return KE(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function P_(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ZE.create(n,...e)}function Et(n,e,...t){if(!n)throw P_(e,...t)}function Ka(n){const e="INTERNAL ASSERTION FAILED: "+n;throw hm(e),new Error(e)}function to(n,e){n||Ka(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(){return typeof self<"u"&&self.location?.href||""}function TI(){return eT()==="http:"||eT()==="https:"}function eT(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(TI()||YC()||"connection"in navigator)?navigator.onLine:!0}function EI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t){this.shortDelay=e,this.longDelay=t,to(t>e,"Short delay should be less than long delay!"),this.isMobile=ZC()||QC()}get(){return wI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M_(n,e){to(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ka("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ka("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ka("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],AI=new bh(3e4,6e4);function _l(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function oo(n,e,t,r,l={}){return YE(n,l,async()=>{let u={},f={};r&&(e==="GET"?f=r:u={body:JSON.stringify(r)});const y=yh({key:n.config.apiKey,...f}).slice(1),_=await n._getAdditionalHeaders();_["Content-Type"]="application/json",n.languageCode&&(_["X-Firebase-Locale"]=n.languageCode);const v={method:e,headers:_,...u};return WC()||(v.referrerPolicy="no-referrer"),n.emulatorConfig&&ao(n.emulatorConfig.host)&&(v.credentials="include"),WE.fetch()(await QE(n,n.config.apiHost,t,y),v)})}async function YE(n,e,t){n._canInitEmulator=!1;const r={...SI,...e};try{const l=new CI(n),u=await Promise.race([t(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw Vf(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const y=u.ok?f.errorMessage:f.error.message,[_,v]=y.split(" : ");if(_==="FEDERATED_USER_ID_ALREADY_LINKED")throw Vf(n,"credential-already-in-use",f);if(_==="EMAIL_EXISTS")throw Vf(n,"email-already-in-use",f);if(_==="USER_DISABLED")throw Vf(n,"user-disabled",f);const w=r[_]||_.toLowerCase().replace(/[_\s]+/g,"-");if(v)throw KE(n,w,v);Qs(n,w)}}catch(l){if(l instanceof ta)throw l;Qs(n,"network-request-failed",{message:String(l)})}}async function xh(n,e,t,r,l={}){const u=await oo(n,e,t,r,l);return"mfaPendingCredential"in u&&Qs(n,"multi-factor-auth-required",{_serverResponse:u}),u}async function QE(n,e,t,r){const l=`${e}${t}?${r}`,u=n,f=u.config.emulator?M_(n.config,l):`${n.config.apiScheme}://${l}`;return jI.includes(t)&&(await u._persistenceManagerAvailable,u._getPersistenceType()==="COOKIE")?u._getPersistence()._getFinalTarget(f).toString():f}function NI(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(va(this.auth,"network-request-failed")),AI.get())})}}function Vf(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const l=va(n,e,r);return l.customData._tokenResponse=t,l}function tT(n){return n!==void 0&&n.enterprise!==void 0}class RI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return NI(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function II(n,e){return oo(n,"GET","/v2/recaptchaConfig",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PI(n,e){return oo(n,"POST","/v1/accounts:delete",e)}async function Am(n,e){return oo(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function MI(n,e=!1){const t=Dn(n),r=await t.getIdToken(e),l=k_(r);Et(l&&l.exp&&l.auth_time&&l.iat,t.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u?.sign_in_provider;return{claims:l,token:r,authTime:Wd(py(l.auth_time)),issuedAtTime:Wd(py(l.iat)),expirationTime:Wd(py(l.exp)),signInProvider:f||null,signInSecondFactor:u?.sign_in_second_factor||null}}function py(n){return Number(n)*1e3}function k_(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hm("JWT malformed, contained fewer than 3 sections"),null;try{const l=DE(t);return l?JSON.parse(l):(hm("Failed to decode base64 JWT payload"),null)}catch(l){return hm("Caught error parsing JWT payload as JSON",l?.toString()),null}}function nT(n){const e=k_(n);return Et(e,"internal-error"),Et(typeof e.exp<"u","internal-error"),Et(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fu(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ta&&kI(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function kI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wd(this.lastLoginAt),this.creationTime=Wd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nm(n){const e=n.auth,t=await n.getIdToken(),r=await fu(n,Am(e,{idToken:t}));Et(r?.users.length,e,"internal-error");const l=r.users[0];n._notifyReloadListener(l);const u=l.providerUserInfo?.length?XE(l.providerUserInfo):[],f=LI(n.providerData,u),y=n.isAnonymous,_=!(n.email&&l.passwordHash)&&!f?.length,v=y?_:!1,w={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:f,metadata:new Xy(l.createdAt,l.lastLoginAt),isAnonymous:v};Object.assign(n,w)}async function DI(n){const e=Dn(n);await Nm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function LI(n,e){return[...n.filter(r=>!e.some(l=>l.providerId===r.providerId)),...e]}function XE(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VI(n,e){const t=await YE(n,{},async()=>{const r=yh({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=await QE(n,l,"/v1/token",`key=${u}`),y=await n._getAdditionalHeaders();y["Content-Type"]="application/x-www-form-urlencoded";const _={method:"POST",headers:y,body:r};return n.emulatorConfig&&ao(n.emulatorConfig.host)&&(_.credentials="include"),WE.fetch()(f,_)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function UI(n,e){return oo(n,"POST","/v2/accounts:revokeToken",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Et(e.idToken,"internal-error"),Et(typeof e.idToken<"u","internal-error"),Et(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):nT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Et(e.length!==0,"internal-error");const t=nT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Et(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:l,expiresIn:u}=await VI(e,t);this.updateTokensAndExpiration(r,l,Number(u))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:l,expirationTime:u}=t,f=new au;return r&&(Et(typeof r=="string","internal-error",{appName:e}),f.refreshToken=r),l&&(Et(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Et(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new au,this.toJSON())}_performRefresh(){return Ka("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wo(n,e){Et(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ys{constructor({uid:e,auth:t,stsTokenManager:r,...l}){this.providerId="firebase",this.proactiveRefresh=new OI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new Xy(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(e){const t=await fu(this,this.stsTokenManager.getToken(this.auth,e));return Et(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return MI(this,e)}reload(){return DI(this)}_assign(e){this!==e&&(Et(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ys({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Et(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Nm(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Yr(this.auth.app))return Promise.reject(Qa(this.auth));const e=await this.getIdToken();return await fu(this,PI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,l=t.email??void 0,u=t.phoneNumber??void 0,f=t.photoURL??void 0,y=t.tenantId??void 0,_=t._redirectEventId??void 0,v=t.createdAt??void 0,w=t.lastLoginAt??void 0,{uid:R,emailVerified:I,isAnonymous:G,providerData:H,stsTokenManager:Z}=t;Et(R&&Z,e,"internal-error");const F=au.fromJSON(this.name,Z);Et(typeof R=="string",e,"internal-error"),Wo(r,e.name),Wo(l,e.name),Et(typeof I=="boolean",e,"internal-error"),Et(typeof G=="boolean",e,"internal-error"),Wo(u,e.name),Wo(f,e.name),Wo(y,e.name),Wo(_,e.name),Wo(v,e.name),Wo(w,e.name);const Q=new Ys({uid:R,auth:e,email:l,emailVerified:I,displayName:r,isAnonymous:G,photoURL:f,phoneNumber:u,tenantId:y,stsTokenManager:F,createdAt:v,lastLoginAt:w});return H&&Array.isArray(H)&&(Q.providerData=H.map(se=>({...se}))),_&&(Q._redirectEventId=_),Q}static async _fromIdTokenResponse(e,t,r=!1){const l=new au;l.updateFromServerResponse(t);const u=new Ys({uid:t.localId,auth:e,stsTokenManager:l,isAnonymous:r});return await Nm(u),u}static async _fromGetAccountInfoResponse(e,t,r){const l=t.users[0];Et(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?XE(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!u?.length,y=new au;y.updateFromIdToken(r);const _=new Ys({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:f}),v={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new Xy(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!u?.length};return Object.assign(_,v),_}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT=new Map;function Wa(n){to(n instanceof Function,"Expected a class definition");let e=iT.get(n);return e?(to(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,iT.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}JE.type="NONE";const rT=JE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(n,e,t){return`firebase:${n}:${e}:${t}`}class ou{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:l,name:u}=this.auth;this.fullUserKey=fm(this.userKey,l.apiKey,u),this.fullPersistenceKey=fm("persistence",l.apiKey,u),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Am(this.auth,{idToken:e}).catch(()=>{});return t?Ys._fromGetAccountInfoResponse(this.auth,t,e):null}return Ys._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ou(Wa(rT),e,r);const l=(await Promise.all(t.map(async v=>{if(await v._isAvailable())return v}))).filter(v=>v);let u=l[0]||Wa(rT);const f=fm(r,e.config.apiKey,e.name);let y=null;for(const v of t)try{const w=await v._get(f);if(w){let R;if(typeof w=="string"){const I=await Am(e,{idToken:w}).catch(()=>{});if(!I)break;R=await Ys._fromGetAccountInfoResponse(e,I,w)}else R=Ys._fromJSON(e,w);v!==u&&(y=R),u=v;break}}catch{}const _=l.filter(v=>v._shouldAllowMigration);return!u._shouldAllowMigration||!_.length?new ou(u,e,r):(u=_[0],y&&await u._set(f,y.toJSON()),await Promise.all(t.map(async v=>{if(v!==u)try{await v._remove(f)}catch{}})),new ou(u,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(i1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(e1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(s1(e))return"Blackberry";if(a1(e))return"Webos";if(t1(e))return"Safari";if((e.includes("chrome/")||n1(e))&&!e.includes("edge/"))return"Chrome";if(r1(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function e1(n=Cr()){return/firefox\//i.test(n)}function t1(n=Cr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function n1(n=Cr()){return/crios\//i.test(n)}function i1(n=Cr()){return/iemobile/i.test(n)}function r1(n=Cr()){return/android/i.test(n)}function s1(n=Cr()){return/blackberry/i.test(n)}function a1(n=Cr()){return/webos/i.test(n)}function O_(n=Cr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function FI(n=Cr()){return O_(n)&&!!window.navigator?.standalone}function zI(){return XC()&&document.documentMode===10}function o1(n=Cr()){return O_(n)||r1(n)||a1(n)||s1(n)||/windows phone/i.test(n)||i1(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(n,e=[]){let t;switch(n){case"Browser":t=sT(Cr());break;case"Worker":t=`${sT(Cr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${cc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=u=>new Promise((f,y)=>{try{const _=e(u);f(_)}catch(_){y(_)}});r.onAbort=t,this.queue.push(r);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const l of t)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HI(n,e={}){return oo(n,"GET","/v2/passwordPolicy",_l(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qI=6;class $I{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??qI,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),l&&(t.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let l=0;l<e.length;l++)r=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GI{constructor(e,t,r,l){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new aT(this),this.idTokenSubscription=new aT(this),this.beforeStateQueue=new BI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ZE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion,this._persistenceManagerAvailable=new Promise(u=>this._resolvePersistenceManagerAvailable=u)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Wa(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ou.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Am(this,{idToken:e}),r=await Ys._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Yr(this.app)){const u=this.app.settings.authIdToken;return u?new Promise(f=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(u).then(f,f))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,l=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const u=this.redirectUser?._redirectEventId,f=r?._redirectEventId,y=await this.tryRedirectSignIn(e);(!u||u===f)&&y?.user&&(r=y.user,l=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(r)}catch(u){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(u))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Et(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Nm(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=EI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Yr(this.app))return Promise.reject(Qa(this));const t=e?Dn(e):null;return t&&Et(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Et(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Yr(this.app)?Promise.reject(Qa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Yr(this.app)?Promise.reject(Qa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Wa(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await HI(this),t=new $I(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new gh("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await UI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Wa(e)||this._popupRedirectResolver;Et(t,this,"argument-error"),this.redirectPersistenceManager=await ou.create(this,[Wa(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,l){if(this._deleted)return()=>{};const u=typeof t=="function"?t:t.next.bind(t);let f=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Et(y,this,"internal-error"),y.then(()=>{f||u(this.currentUser)}),typeof t=="function"){const _=e.addObserver(t,r,l);return()=>{f=!0,_()}}else{const _=e.addObserver(t);return()=>{f=!0,_()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Et(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=l1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Yr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&xI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function uc(n){return Dn(n)}class aT{constructor(e){this.auth=e,this.observer=null,this.addObserver=aR(t=>this.observer=t)}get next(){return Et(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ZI(n){Jm=n}function c1(n){return Jm.loadJS(n)}function KI(){return Jm.recaptchaEnterpriseScript}function WI(){return Jm.gapiScript}function YI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class QI{constructor(){this.enterprise=new XI}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class XI{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const JI="recaptcha-enterprise",u1="NO_RECAPTCHA";class e2{constructor(e){this.type=JI,this.auth=uc(e)}async verify(e="verify",t=!1){async function r(u){if(!t){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,y)=>{II(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(_=>{if(_.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const v=new RI(_);return u.tenantId==null?u._agentRecaptchaConfig=v:u._tenantRecaptchaConfigs[u.tenantId]=v,f(v.siteKey)}}).catch(_=>{y(_)})})}function l(u,f,y){const _=window.grecaptcha;tT(_)?_.enterprise.ready(()=>{_.enterprise.execute(u,{action:e}).then(v=>{f(v)}).catch(()=>{f(u1)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new QI().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{r(this.auth).then(y=>{if(!t&&tT(window.grecaptcha))l(y,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let _=KI();_.length!==0&&(_+=y),c1(_).then(()=>{l(y,u,f)}).catch(v=>{f(v)})}}).catch(y=>{f(y)})})}}async function oT(n,e,t,r=!1,l=!1){const u=new e2(n);let f;if(l)f=u1;else try{f=await u.verify(t)}catch{f=await u.verify(t,!0)}const y={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const _=y.phoneEnrollmentInfo.phoneNumber,v=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:_,recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const _=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:_,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return r?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function Jy(n,e,t,r,l){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await oT(n,e,t,t==="getOobCode");return r(n,u)}else return r(n,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const f=await oT(n,e,t,t==="getOobCode");return r(n,f)}else return Promise.reject(u)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(n,e){const t=_h(n,"auth");if(t.isInitialized()){const l=t.getImmediate(),u=t.getOptions();if(nc(u,e??{}))return l;Qs(l,"already-initialized")}return t.initialize({options:e})}function n2(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Wa);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function i2(n,e,t){const r=uc(n);Et(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const l=!1,u=d1(e),{host:f,port:y}=r2(e),_=y===null?"":`:${y}`,v={url:`${u}//${f}${_}/`},w=Object.freeze({host:f,port:y,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!r._canInitEmulator){Et(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Et(nc(v,r.config.emulator)&&nc(w,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=v,r.emulatorConfig=w,r.settings.appVerificationDisabledForTesting=!0,ao(f)?(Qm(`${u}//${f}${_}`),Xm("Auth",!0)):s2()}function d1(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function r2(n){const e=d1(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(r);if(l){const u=l[1];return{host:u,port:lT(r.substr(u.length+1))}}else{const[u,f]=r.split(":");return{host:u,port:lT(f)}}}function lT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function s2(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ka("not implemented")}_getIdTokenResponse(e){return Ka("not implemented")}_linkToIdToken(e,t){return Ka("not implemented")}_getReauthenticationResolver(e){return Ka("not implemented")}}async function a2(n,e){return oo(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o2(n,e){return xh(n,"POST","/v1/accounts:signInWithPassword",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l2(n,e){return xh(n,"POST","/v1/accounts:signInWithEmailLink",_l(n,e))}async function c2(n,e){return xh(n,"POST","/v1/accounts:signInWithEmailLink",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh extends D_{constructor(e,t,r,l=null){super("password",r),this._email=e,this._password=t,this._tenantId=l}static _fromEmailAndPassword(e,t){return new sh(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new sh(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jy(e,t,"signInWithPassword",o2);case"emailLink":return l2(e,{email:this._email,oobCode:this._password});default:Qs(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Jy(e,r,"signUpPassword",a2);case"emailLink":return c2(e,{idToken:t,email:this._email,oobCode:this._password});default:Qs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lu(n,e){return xh(n,"POST","/v1/accounts:signInWithIdp",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2="http://localhost";class ic extends D_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ic(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:l,...u}=t;if(!r||!l)return null;const f=new ic(r,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const t=this.buildRequest();return lu(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,lu(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,lu(e,t)}buildRequest(){const e={requestUri:u2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=yh(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d2(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function h2(n){const e=Fd(zd(n)).link,t=e?Fd(zd(e)).deep_link_id:null,r=Fd(zd(n)).deep_link_id;return(r?Fd(zd(r)).link:null)||r||t||e||n}class L_{constructor(e){const t=Fd(zd(e)),r=t.apiKey??null,l=t.oobCode??null,u=d2(t.mode??null);Et(r&&l&&u,"argument-error"),this.apiKey=r,this.operation=u,this.code=l,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=h2(e);try{return new L_(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(){this.providerId=ju.PROVIDER_ID}static credential(e,t){return sh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=L_.parseLink(t);return Et(r,"argument-error"),sh._fromEmailAndCode(e,r.code,r.tenantId)}}ju.PROVIDER_ID="password";ju.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ju.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th extends h1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo extends Th{constructor(){super("facebook.com")}static credential(e){return ic._fromParams({providerId:Xo.PROVIDER_ID,signInMethod:Xo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xo.credentialFromTaggedObject(e)}static credentialFromError(e){return Xo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xo.credential(e.oauthAccessToken)}catch{return null}}}Xo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo extends Th{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ic._fromParams({providerId:Jo.PROVIDER_ID,signInMethod:Jo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Jo.credentialFromTaggedObject(e)}static credentialFromError(e){return Jo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Jo.credential(t,r)}catch{return null}}}Jo.GOOGLE_SIGN_IN_METHOD="google.com";Jo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el extends Th{constructor(){super("github.com")}static credential(e){return ic._fromParams({providerId:el.PROVIDER_ID,signInMethod:el.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return el.credentialFromTaggedObject(e)}static credentialFromError(e){return el.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return el.credential(e.oauthAccessToken)}catch{return null}}}el.GITHUB_SIGN_IN_METHOD="github.com";el.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl extends Th{constructor(){super("twitter.com")}static credential(e,t){return ic._fromParams({providerId:tl.PROVIDER_ID,signInMethod:tl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tl.credentialFromTaggedObject(e)}static credentialFromError(e){return tl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return tl.credential(t,r)}catch{return null}}}tl.TWITTER_SIGN_IN_METHOD="twitter.com";tl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f2(n,e){return xh(n,"POST","/v1/accounts:signUp",_l(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,l=!1){const u=await Ys._fromIdTokenResponse(e,r,l),f=cT(r);return new rc({user:u,providerId:f,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const l=cT(r);return new rc({user:e,providerId:l,_tokenResponse:r,operationType:t})}}function cT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm extends ta{constructor(e,t,r,l){super(t.code,t.message),this.operationType=r,this.user=l,Object.setPrototypeOf(this,Cm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,l){return new Cm(e,t,r,l)}}function f1(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?Cm._fromErrorAndOperation(n,u,e,r):u})}async function m2(n,e,t=!1){const r=await fu(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return rc._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p2(n,e,t=!1){const{auth:r}=n;if(Yr(r.app))return Promise.reject(Qa(r));const l="reauthenticate";try{const u=await fu(n,f1(r,l,e,n),t);Et(u.idToken,r,"internal-error");const f=k_(u.idToken);Et(f,r,"internal-error");const{sub:y}=f;return Et(n.uid===y,r,"user-mismatch"),rc._forOperation(n,l,u)}catch(u){throw u?.code==="auth/user-not-found"&&Qs(r,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m1(n,e,t=!1){if(Yr(n.app))return Promise.reject(Qa(n));const r="signIn",l=await f1(n,r,e),u=await rc._fromIdTokenResponse(n,r,l);return t||await n._updateCurrentUser(u.user),u}async function g2(n,e){return m1(uc(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p1(n){const e=uc(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Au(n,e,t){if(Yr(n.app))return Promise.reject(Qa(n));const r=uc(n),f=await Jy(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",f2).catch(_=>{throw _.code==="auth/password-does-not-meet-requirements"&&p1(n),_}),y=await rc._fromIdTokenResponse(r,"signIn",f);return await r._updateCurrentUser(y.user),y}function V_(n,e,t){return Yr(n.app)?Promise.reject(Qa(n)):g2(Dn(n),ju.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&p1(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y2(n,e){return oo(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g1(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Dn(n),u={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},f=await fu(r,y2(r.auth,u));r.displayName=f.displayName||null,r.photoURL=f.photoUrl||null;const y=r.providerData.find(({providerId:_})=>_==="password");y&&(y.displayName=r.displayName,y.photoURL=r.photoURL),await r._updateTokensIfNecessary(f)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2(n,e){return Dn(n).setPersistence(e)}function v2(n,e,t,r){return Dn(n).onIdTokenChanged(e,t,r)}function b2(n,e,t){return Dn(n).beforeAuthStateChanged(e,t)}const Rm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Rm,"1"),this.storage.removeItem(Rm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2=1e3,T2=10;class _1 extends y1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=o1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),l=this.localCache[t];r!==l&&e(t,l,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((f,y,_)=>{this.notifyListeners(f,_)});return}const r=e.key;t?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(r);!t&&this.localCache[r]===f||this.notifyListeners(r,f)},u=this.storage.getItem(r);zI()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,T2):l()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const l of Array.from(r))l(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},x2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}_1.type="LOCAL";const v1=_1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1 extends y1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}b1.type="SESSION";const x1=b1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(l=>l.isListeningto(e));if(t)return t;const r=new ep(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:l,data:u}=t.data,f=this.handlersMap[l];if(!f?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:l});const y=Array.from(f).map(async v=>v(t.origin,u)),_=await w2(y);t.ports[0].postMessage({status:"done",eventId:r,eventType:l,response:_})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ep.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U_(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((y,_)=>{const v=U_("",20);l.port1.start();const w=setTimeout(()=>{_(new Error("unsupported_event"))},r);f={messageChannel:l,onMessage(R){const I=R;if(I.data.eventId===v)switch(I.data.status){case"ack":clearTimeout(w),u=setTimeout(()=>{_(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),y(I.data.response);break;default:clearTimeout(w),clearTimeout(u),_(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:v,data:t},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(){return window}function S2(n){ba().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T1(){return typeof ba().WorkerGlobalScope<"u"&&typeof ba().importScripts=="function"}async function j2(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function A2(){return navigator?.serviceWorker?.controller||null}function N2(){return T1()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1="firebaseLocalStorageDb",C2=1,Im="firebaseLocalStorage",E1="fbase_key";class wh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tp(n,e){return n.transaction([Im],e?"readwrite":"readonly").objectStore(Im)}function R2(){const n=indexedDB.deleteDatabase(w1);return new wh(n).toPromise()}function e_(){const n=indexedDB.open(w1,C2);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Im,{keyPath:E1})}catch(l){t(l)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Im)?e(r):(r.close(),await R2(),e(await e_()))})})}async function uT(n,e,t){const r=tp(n,!0).put({[E1]:e,value:t});return new wh(r).toPromise()}async function I2(n,e){const t=tp(n,!1).get(e),r=await new wh(t).toPromise();return r===void 0?null:r.value}function dT(n,e){const t=tp(n,!0).delete(e);return new wh(t).toPromise()}const P2=800,M2=3;class S1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await e_(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>M2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return T1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ep._getInstance(N2()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await j2(),!this.activeServiceWorker)return;this.sender=new E2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||A2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await e_();return await uT(e,Rm,"1"),await dT(e,Rm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>uT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>I2(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>dT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=tp(l,!1).getAll();return new wh(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)r.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),t.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!r.has(l)&&(this.notifyListeners(l,null),t.push(l));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const l of Array.from(r))l(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),P2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}S1.type="LOCAL";const k2=S1;new bh(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O2(n,e){return e?Wa(e):(Et(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_ extends D_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return lu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return lu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return lu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function D2(n){return m1(n.auth,new F_(n),n.bypassAuthState)}function L2(n){const{auth:e,user:t}=n;return Et(t,e,"internal-error"),p2(t,new F_(n),n.bypassAuthState)}async function V2(n){const{auth:e,user:t}=n;return Et(t,e,"internal-error"),m2(t,new F_(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e,t,r,l,u=!1){this.auth=e,this.resolver=r,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:l,tenantId:u,error:f,type:y}=e;if(f){this.reject(f);return}const _={auth:this.auth,requestUri:t,sessionId:r,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(_))}catch(v){this.reject(v)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return D2;case"linkViaPopup":case"linkViaRedirect":return V2;case"reauthViaPopup":case"reauthViaRedirect":return L2;default:Qs(this.auth,"internal-error")}}resolve(e){to(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){to(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U2=new bh(2e3,1e4);class ru extends j1{constructor(e,t,r,l,u){super(e,t,l,u),this.provider=r,this.authWindow=null,this.pollId=null,ru.currentPopupAction&&ru.currentPopupAction.cancel(),ru.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Et(e,this.auth,"internal-error"),e}async onExecution(){to(this.filter.length===1,"Popup operations only handle one event");const e=U_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(va(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(va(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ru.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(va(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,U2.get())};e()}}ru.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2="pendingRedirect",mm=new Map;class z2 extends j1{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=mm.get(this.auth._key());if(!e){try{const r=await B2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}mm.set(this.auth._key(),e)}return this.bypassAuthState||mm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function B2(n,e){const t=$2(e),r=q2(n);if(!await r._isAvailable())return!1;const l=await r._get(t)==="true";return await r._remove(t),l}function H2(n,e){mm.set(n._key(),e)}function q2(n){return Wa(n._redirectPersistence)}function $2(n){return fm(F2,n.config.apiKey,n.name)}async function G2(n,e,t=!1){if(Yr(n.app))return Promise.reject(Qa(n));const r=uc(n),l=O2(r,e),f=await new z2(r,l,t).execute();return f&&!t&&(delete f.user._redirectEventId,await r._persistUserIfCurrent(f.user),await r._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=600*1e3;class K2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!W2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!A1(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(va(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Z2&&this.cachedEventUids.clear(),this.cachedEventUids.has(hT(e))}saveEventToCache(e){this.cachedEventUids.add(hT(e)),this.lastProcessedEventTime=Date.now()}}function hT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function A1({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function W2(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return A1(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y2(n,e={}){return oo(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,X2=/^https?/;async function J2(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Y2(n);for(const t of e)try{if(eP(t))return}catch{}Qs(n,"unauthorized-domain")}function eP(n){const e=Qy(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&f.hostname===r}if(!X2.test(t))return!1;if(Q2.test(n))return r===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=new bh(3e4,6e4);function fT(){const n=ba().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function nP(n){return new Promise((e,t)=>{function r(){fT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fT(),t(va(n,"network-request-failed"))},timeout:tP.get()})}if(ba().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ba().gapi?.load)r();else{const l=YI("iframefcb");return ba()[l]=()=>{gapi.load?r():t(va(n,"network-request-failed"))},c1(`${WI()}?onload=${l}`).catch(u=>t(u))}}).catch(e=>{throw pm=null,e})}let pm=null;function iP(n){return pm=pm||nP(n),pm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP=new bh(5e3,15e3),sP="__/auth/iframe",aP="emulator/auth/iframe",oP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cP(n){const e=n.config;Et(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?M_(e,aP):`https://${n.config.authDomain}/${sP}`,r={apiKey:e.apiKey,appName:n.name,v:cc},l=lP.get(n.config.apiHost);l&&(r.eid=l);const u=n._getFrameworks();return u.length&&(r.fw=u.join(",")),`${t}?${yh(r).slice(1)}`}async function uP(n){const e=await iP(n),t=ba().gapi;return Et(t,n,"internal-error"),e.open({where:document.body,url:cP(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oP,dontclear:!0},r=>new Promise(async(l,u)=>{await r.restyle({setHideOnLeave:!1});const f=va(n,"network-request-failed"),y=ba().setTimeout(()=>{u(f)},rP.get());function _(){ba().clearTimeout(y),l(r)}r.ping(_).then(_,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hP=500,fP=600,mP="_blank",pP="http://localhost";class mT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function gP(n,e,t,r=hP,l=fP){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-r)/2,0).toString();let y="";const _={...dP,width:r.toString(),height:l.toString(),top:u,left:f},v=Cr().toLowerCase();t&&(y=n1(v)?mP:t),e1(v)&&(e=e||pP,_.scrollbars="yes");const w=Object.entries(_).reduce((I,[G,H])=>`${I}${G}=${H},`,"");if(FI(v)&&y!=="_self")return yP(e||"",y),new mT(null);const R=window.open(e||"",y,w);Et(R,n,"popup-blocked");try{R.focus()}catch{}return new mT(R)}function yP(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P="__/auth/handler",vP="emulator/auth/handler",bP=encodeURIComponent("fac");async function pT(n,e,t,r,l,u){Et(n.config.authDomain,n,"auth-domain-config-required"),Et(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:cc,eventId:l};if(e instanceof h1){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",sR(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[w,R]of Object.entries({}))f[w]=R}if(e instanceof Th){const w=e.getScopes().filter(R=>R!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const y=f;for(const w of Object.keys(y))y[w]===void 0&&delete y[w];const _=await n._getAppCheckToken(),v=_?`#${bP}=${encodeURIComponent(_)}`:"";return`${xP(n)}?${yh(y).slice(1)}${v}`}function xP({config:n}){return n.emulator?M_(n,vP):`https://${n.authDomain}/${_P}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy="webStorageSupport";class TP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=x1,this._completeRedirectFn=G2,this._overrideRedirectResult=H2}async _openPopup(e,t,r,l){to(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const u=await pT(e,t,r,Qy(),l);return gP(e,u,U_())}async _openRedirect(e,t,r,l){await this._originValidation(e);const u=await pT(e,t,r,Qy(),l);return S2(u),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:l,promise:u}=this.eventManagers[t];return l?Promise.resolve(l):(to(u,"If manager is not set, promise should be"),u)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await uP(e),r=new K2(e);return t.register("authEvent",l=>(Et(l?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(gy,{type:gy},l=>{const u=l?.[0]?.[gy];u!==void 0&&t(!!u),Qs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=J2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return o1()||t1()||O_()}}const wP=TP;var gT="@firebase/auth",yT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Et(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SP(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function jP(n){dl(new Ja("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:y}=r.options;Et(f&&!f.includes(":"),"invalid-api-key",{appName:r.name});const _={apiKey:f,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:l1(n)},v=new GI(r,l,u,_);return n2(v,t),v},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),dl(new Ja("auth-internal",e=>{const t=uc(e.getProvider("auth").getImmediate());return(r=>new EP(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Os(gT,yT,SP(n)),Os(gT,yT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP=300,NP=UE("authIdTokenMaxAge")||AP;let _T=null;const CP=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>NP)return;const l=t?.token;_T!==l&&(_T=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function np(n=vh()){const e=_h(n,"auth");if(e.isInitialized())return e.getImmediate();const t=t2(n,{popupRedirectResolver:wP,persistence:[k2,v1,x1]}),r=UE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(r,location.origin);if(location.origin===u.origin){const f=CP(u.toString());b2(t,f,()=>f(t.currentUser)),v2(t,y=>f(y))}}const l=LE("auth");return l&&i2(t,`http://${l}`),t}function RP(){return document.getElementsByTagName("head")?.[0]??document}ZI({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=l=>{const u=va("internal-error");u.customData=l,t(u)},r.type="text/javascript",r.charset="UTF-8",RP().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});jP("Browser");var vT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var al,N1;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,M){function D(){}D.prototype=M.prototype,P.D=M.prototype,P.prototype=new D,P.prototype.constructor=P,P.C=function(U,k,q){for(var j=Array(arguments.length-2),de=2;de<arguments.length;de++)j[de-2]=arguments[de];return M.prototype[k].apply(U,j)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(P,M,D){D||(D=0);var U=Array(16);if(typeof M=="string")for(var k=0;16>k;++k)U[k]=M.charCodeAt(D++)|M.charCodeAt(D++)<<8|M.charCodeAt(D++)<<16|M.charCodeAt(D++)<<24;else for(k=0;16>k;++k)U[k]=M[D++]|M[D++]<<8|M[D++]<<16|M[D++]<<24;M=P.g[0],D=P.g[1],k=P.g[2];var q=P.g[3],j=M+(q^D&(k^q))+U[0]+3614090360&4294967295;M=D+(j<<7&4294967295|j>>>25),j=q+(k^M&(D^k))+U[1]+3905402710&4294967295,q=M+(j<<12&4294967295|j>>>20),j=k+(D^q&(M^D))+U[2]+606105819&4294967295,k=q+(j<<17&4294967295|j>>>15),j=D+(M^k&(q^M))+U[3]+3250441966&4294967295,D=k+(j<<22&4294967295|j>>>10),j=M+(q^D&(k^q))+U[4]+4118548399&4294967295,M=D+(j<<7&4294967295|j>>>25),j=q+(k^M&(D^k))+U[5]+1200080426&4294967295,q=M+(j<<12&4294967295|j>>>20),j=k+(D^q&(M^D))+U[6]+2821735955&4294967295,k=q+(j<<17&4294967295|j>>>15),j=D+(M^k&(q^M))+U[7]+4249261313&4294967295,D=k+(j<<22&4294967295|j>>>10),j=M+(q^D&(k^q))+U[8]+1770035416&4294967295,M=D+(j<<7&4294967295|j>>>25),j=q+(k^M&(D^k))+U[9]+2336552879&4294967295,q=M+(j<<12&4294967295|j>>>20),j=k+(D^q&(M^D))+U[10]+4294925233&4294967295,k=q+(j<<17&4294967295|j>>>15),j=D+(M^k&(q^M))+U[11]+2304563134&4294967295,D=k+(j<<22&4294967295|j>>>10),j=M+(q^D&(k^q))+U[12]+1804603682&4294967295,M=D+(j<<7&4294967295|j>>>25),j=q+(k^M&(D^k))+U[13]+4254626195&4294967295,q=M+(j<<12&4294967295|j>>>20),j=k+(D^q&(M^D))+U[14]+2792965006&4294967295,k=q+(j<<17&4294967295|j>>>15),j=D+(M^k&(q^M))+U[15]+1236535329&4294967295,D=k+(j<<22&4294967295|j>>>10),j=M+(k^q&(D^k))+U[1]+4129170786&4294967295,M=D+(j<<5&4294967295|j>>>27),j=q+(D^k&(M^D))+U[6]+3225465664&4294967295,q=M+(j<<9&4294967295|j>>>23),j=k+(M^D&(q^M))+U[11]+643717713&4294967295,k=q+(j<<14&4294967295|j>>>18),j=D+(q^M&(k^q))+U[0]+3921069994&4294967295,D=k+(j<<20&4294967295|j>>>12),j=M+(k^q&(D^k))+U[5]+3593408605&4294967295,M=D+(j<<5&4294967295|j>>>27),j=q+(D^k&(M^D))+U[10]+38016083&4294967295,q=M+(j<<9&4294967295|j>>>23),j=k+(M^D&(q^M))+U[15]+3634488961&4294967295,k=q+(j<<14&4294967295|j>>>18),j=D+(q^M&(k^q))+U[4]+3889429448&4294967295,D=k+(j<<20&4294967295|j>>>12),j=M+(k^q&(D^k))+U[9]+568446438&4294967295,M=D+(j<<5&4294967295|j>>>27),j=q+(D^k&(M^D))+U[14]+3275163606&4294967295,q=M+(j<<9&4294967295|j>>>23),j=k+(M^D&(q^M))+U[3]+4107603335&4294967295,k=q+(j<<14&4294967295|j>>>18),j=D+(q^M&(k^q))+U[8]+1163531501&4294967295,D=k+(j<<20&4294967295|j>>>12),j=M+(k^q&(D^k))+U[13]+2850285829&4294967295,M=D+(j<<5&4294967295|j>>>27),j=q+(D^k&(M^D))+U[2]+4243563512&4294967295,q=M+(j<<9&4294967295|j>>>23),j=k+(M^D&(q^M))+U[7]+1735328473&4294967295,k=q+(j<<14&4294967295|j>>>18),j=D+(q^M&(k^q))+U[12]+2368359562&4294967295,D=k+(j<<20&4294967295|j>>>12),j=M+(D^k^q)+U[5]+4294588738&4294967295,M=D+(j<<4&4294967295|j>>>28),j=q+(M^D^k)+U[8]+2272392833&4294967295,q=M+(j<<11&4294967295|j>>>21),j=k+(q^M^D)+U[11]+1839030562&4294967295,k=q+(j<<16&4294967295|j>>>16),j=D+(k^q^M)+U[14]+4259657740&4294967295,D=k+(j<<23&4294967295|j>>>9),j=M+(D^k^q)+U[1]+2763975236&4294967295,M=D+(j<<4&4294967295|j>>>28),j=q+(M^D^k)+U[4]+1272893353&4294967295,q=M+(j<<11&4294967295|j>>>21),j=k+(q^M^D)+U[7]+4139469664&4294967295,k=q+(j<<16&4294967295|j>>>16),j=D+(k^q^M)+U[10]+3200236656&4294967295,D=k+(j<<23&4294967295|j>>>9),j=M+(D^k^q)+U[13]+681279174&4294967295,M=D+(j<<4&4294967295|j>>>28),j=q+(M^D^k)+U[0]+3936430074&4294967295,q=M+(j<<11&4294967295|j>>>21),j=k+(q^M^D)+U[3]+3572445317&4294967295,k=q+(j<<16&4294967295|j>>>16),j=D+(k^q^M)+U[6]+76029189&4294967295,D=k+(j<<23&4294967295|j>>>9),j=M+(D^k^q)+U[9]+3654602809&4294967295,M=D+(j<<4&4294967295|j>>>28),j=q+(M^D^k)+U[12]+3873151461&4294967295,q=M+(j<<11&4294967295|j>>>21),j=k+(q^M^D)+U[15]+530742520&4294967295,k=q+(j<<16&4294967295|j>>>16),j=D+(k^q^M)+U[2]+3299628645&4294967295,D=k+(j<<23&4294967295|j>>>9),j=M+(k^(D|~q))+U[0]+4096336452&4294967295,M=D+(j<<6&4294967295|j>>>26),j=q+(D^(M|~k))+U[7]+1126891415&4294967295,q=M+(j<<10&4294967295|j>>>22),j=k+(M^(q|~D))+U[14]+2878612391&4294967295,k=q+(j<<15&4294967295|j>>>17),j=D+(q^(k|~M))+U[5]+4237533241&4294967295,D=k+(j<<21&4294967295|j>>>11),j=M+(k^(D|~q))+U[12]+1700485571&4294967295,M=D+(j<<6&4294967295|j>>>26),j=q+(D^(M|~k))+U[3]+2399980690&4294967295,q=M+(j<<10&4294967295|j>>>22),j=k+(M^(q|~D))+U[10]+4293915773&4294967295,k=q+(j<<15&4294967295|j>>>17),j=D+(q^(k|~M))+U[1]+2240044497&4294967295,D=k+(j<<21&4294967295|j>>>11),j=M+(k^(D|~q))+U[8]+1873313359&4294967295,M=D+(j<<6&4294967295|j>>>26),j=q+(D^(M|~k))+U[15]+4264355552&4294967295,q=M+(j<<10&4294967295|j>>>22),j=k+(M^(q|~D))+U[6]+2734768916&4294967295,k=q+(j<<15&4294967295|j>>>17),j=D+(q^(k|~M))+U[13]+1309151649&4294967295,D=k+(j<<21&4294967295|j>>>11),j=M+(k^(D|~q))+U[4]+4149444226&4294967295,M=D+(j<<6&4294967295|j>>>26),j=q+(D^(M|~k))+U[11]+3174756917&4294967295,q=M+(j<<10&4294967295|j>>>22),j=k+(M^(q|~D))+U[2]+718787259&4294967295,k=q+(j<<15&4294967295|j>>>17),j=D+(q^(k|~M))+U[9]+3951481745&4294967295,P.g[0]=P.g[0]+M&4294967295,P.g[1]=P.g[1]+(k+(j<<21&4294967295|j>>>11))&4294967295,P.g[2]=P.g[2]+k&4294967295,P.g[3]=P.g[3]+q&4294967295}r.prototype.u=function(P,M){M===void 0&&(M=P.length);for(var D=M-this.blockSize,U=this.B,k=this.h,q=0;q<M;){if(k==0)for(;q<=D;)l(this,P,q),q+=this.blockSize;if(typeof P=="string"){for(;q<M;)if(U[k++]=P.charCodeAt(q++),k==this.blockSize){l(this,U),k=0;break}}else for(;q<M;)if(U[k++]=P[q++],k==this.blockSize){l(this,U),k=0;break}}this.h=k,this.o+=M},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var M=1;M<P.length-8;++M)P[M]=0;var D=8*this.o;for(M=P.length-8;M<P.length;++M)P[M]=D&255,D/=256;for(this.u(P),P=Array(16),M=D=0;4>M;++M)for(var U=0;32>U;U+=8)P[D++]=this.g[M]>>>U&255;return P};function u(P,M){var D=y;return Object.prototype.hasOwnProperty.call(D,P)?D[P]:D[P]=M(P)}function f(P,M){this.h=M;for(var D=[],U=!0,k=P.length-1;0<=k;k--){var q=P[k]|0;U&&q==M||(D[k]=q,U=!1)}this.g=D}var y={};function _(P){return-128<=P&&128>P?u(P,function(M){return new f([M|0],0>M?-1:0)}):new f([P|0],0>P?-1:0)}function v(P){if(isNaN(P)||!isFinite(P))return R;if(0>P)return F(v(-P));for(var M=[],D=1,U=0;P>=D;U++)M[U]=P/D|0,D*=4294967296;return new f(M,0)}function w(P,M){if(P.length==0)throw Error("number format error: empty string");if(M=M||10,2>M||36<M)throw Error("radix out of range: "+M);if(P.charAt(0)=="-")return F(w(P.substring(1),M));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=v(Math.pow(M,8)),U=R,k=0;k<P.length;k+=8){var q=Math.min(8,P.length-k),j=parseInt(P.substring(k,k+q),M);8>q?(q=v(Math.pow(M,q)),U=U.j(q).add(v(j))):(U=U.j(D),U=U.add(v(j)))}return U}var R=_(0),I=_(1),G=_(16777216);n=f.prototype,n.m=function(){if(Z(this))return-F(this).m();for(var P=0,M=1,D=0;D<this.g.length;D++){var U=this.i(D);P+=(0<=U?U:4294967296+U)*M,M*=4294967296}return P},n.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(H(this))return"0";if(Z(this))return"-"+F(this).toString(P);for(var M=v(Math.pow(P,6)),D=this,U="";;){var k=we(D,M).g;D=Q(D,k.j(M));var q=((0<D.g.length?D.g[0]:D.h)>>>0).toString(P);if(D=k,H(D))return q+U;for(;6>q.length;)q="0"+q;U=q+U}},n.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function H(P){if(P.h!=0)return!1;for(var M=0;M<P.g.length;M++)if(P.g[M]!=0)return!1;return!0}function Z(P){return P.h==-1}n.l=function(P){return P=Q(this,P),Z(P)?-1:H(P)?0:1};function F(P){for(var M=P.g.length,D=[],U=0;U<M;U++)D[U]=~P.g[U];return new f(D,~P.h).add(I)}n.abs=function(){return Z(this)?F(this):this},n.add=function(P){for(var M=Math.max(this.g.length,P.g.length),D=[],U=0,k=0;k<=M;k++){var q=U+(this.i(k)&65535)+(P.i(k)&65535),j=(q>>>16)+(this.i(k)>>>16)+(P.i(k)>>>16);U=j>>>16,q&=65535,j&=65535,D[k]=j<<16|q}return new f(D,D[D.length-1]&-2147483648?-1:0)};function Q(P,M){return P.add(F(M))}n.j=function(P){if(H(this)||H(P))return R;if(Z(this))return Z(P)?F(this).j(F(P)):F(F(this).j(P));if(Z(P))return F(this.j(F(P)));if(0>this.l(G)&&0>P.l(G))return v(this.m()*P.m());for(var M=this.g.length+P.g.length,D=[],U=0;U<2*M;U++)D[U]=0;for(U=0;U<this.g.length;U++)for(var k=0;k<P.g.length;k++){var q=this.i(U)>>>16,j=this.i(U)&65535,de=P.i(k)>>>16,ae=P.i(k)&65535;D[2*U+2*k]+=j*ae,se(D,2*U+2*k),D[2*U+2*k+1]+=q*ae,se(D,2*U+2*k+1),D[2*U+2*k+1]+=j*de,se(D,2*U+2*k+1),D[2*U+2*k+2]+=q*de,se(D,2*U+2*k+2)}for(U=0;U<M;U++)D[U]=D[2*U+1]<<16|D[2*U];for(U=M;U<2*M;U++)D[U]=0;return new f(D,0)};function se(P,M){for(;(P[M]&65535)!=P[M];)P[M+1]+=P[M]>>>16,P[M]&=65535,M++}function ue(P,M){this.g=P,this.h=M}function we(P,M){if(H(M))throw Error("division by zero");if(H(P))return new ue(R,R);if(Z(P))return M=we(F(P),M),new ue(F(M.g),F(M.h));if(Z(M))return M=we(P,F(M)),new ue(F(M.g),M.h);if(30<P.g.length){if(Z(P)||Z(M))throw Error("slowDivide_ only works with positive integers.");for(var D=I,U=M;0>=U.l(P);)D=Ce(D),U=Ce(U);var k=Ue(D,1),q=Ue(U,1);for(U=Ue(U,2),D=Ue(D,2);!H(U);){var j=q.add(U);0>=j.l(P)&&(k=k.add(D),q=j),U=Ue(U,1),D=Ue(D,1)}return M=Q(P,k.j(M)),new ue(k,M)}for(k=R;0<=P.l(M);){for(D=Math.max(1,Math.floor(P.m()/M.m())),U=Math.ceil(Math.log(D)/Math.LN2),U=48>=U?1:Math.pow(2,U-48),q=v(D),j=q.j(M);Z(j)||0<j.l(P);)D-=U,q=v(D),j=q.j(M);H(q)&&(q=I),k=k.add(q),P=Q(P,j)}return new ue(k,P)}n.A=function(P){return we(this,P).h},n.and=function(P){for(var M=Math.max(this.g.length,P.g.length),D=[],U=0;U<M;U++)D[U]=this.i(U)&P.i(U);return new f(D,this.h&P.h)},n.or=function(P){for(var M=Math.max(this.g.length,P.g.length),D=[],U=0;U<M;U++)D[U]=this.i(U)|P.i(U);return new f(D,this.h|P.h)},n.xor=function(P){for(var M=Math.max(this.g.length,P.g.length),D=[],U=0;U<M;U++)D[U]=this.i(U)^P.i(U);return new f(D,this.h^P.h)};function Ce(P){for(var M=P.g.length+1,D=[],U=0;U<M;U++)D[U]=P.i(U)<<1|P.i(U-1)>>>31;return new f(D,P.h)}function Ue(P,M){var D=M>>5;M%=32;for(var U=P.g.length-D,k=[],q=0;q<U;q++)k[q]=0<M?P.i(q+D)>>>M|P.i(q+D+1)<<32-M:P.i(q+D);return new f(k,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,N1=r,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=v,f.fromString=w,al=f}).apply(typeof vT<"u"?vT:typeof self<"u"?self:typeof window<"u"?window:{});var Uf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var C1,Bd,R1,gm,t_,I1,P1,M1;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(m,T,N){return m==Array.prototype||m==Object.prototype||(m[T]=N.value),m};function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof Uf=="object"&&Uf];for(var T=0;T<m.length;++T){var N=m[T];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var r=t(this);function l(m,T){if(T)e:{var N=r;m=m.split(".");for(var B=0;B<m.length-1;B++){var pe=m[B];if(!(pe in N))break e;N=N[pe]}m=m[m.length-1],B=N[m],T=T(B),T!=B&&T!=null&&e(N,m,{configurable:!0,writable:!0,value:T})}}function u(m,T){m instanceof String&&(m+="");var N=0,B=!1,pe={next:function(){if(!B&&N<m.length){var je=N++;return{value:T(je,m[je]),done:!1}}return B=!0,{done:!0,value:void 0}}};return pe[Symbol.iterator]=function(){return pe},pe}l("Array.prototype.values",function(m){return m||function(){return u(this,function(T,N){return N})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},y=this||self;function _(m){var T=typeof m;return T=T!="object"?T:m?Array.isArray(m)?"array":T:"null",T=="array"||T=="object"&&typeof m.length=="number"}function v(m){var T=typeof m;return T=="object"&&m!=null||T=="function"}function w(m,T,N){return m.call.apply(m.bind,arguments)}function R(m,T,N){if(!m)throw Error();if(2<arguments.length){var B=Array.prototype.slice.call(arguments,2);return function(){var pe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(pe,B),m.apply(T,pe)}}return function(){return m.apply(T,arguments)}}function I(m,T,N){return I=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:R,I.apply(null,arguments)}function G(m,T){var N=Array.prototype.slice.call(arguments,1);return function(){var B=N.slice();return B.push.apply(B,arguments),m.apply(this,B)}}function H(m,T){function N(){}N.prototype=T.prototype,m.aa=T.prototype,m.prototype=new N,m.prototype.constructor=m,m.Qb=function(B,pe,je){for(var qe=Array(arguments.length-2),nn=2;nn<arguments.length;nn++)qe[nn-2]=arguments[nn];return T.prototype[pe].apply(B,qe)}}function Z(m){const T=m.length;if(0<T){const N=Array(T);for(let B=0;B<T;B++)N[B]=m[B];return N}return[]}function F(m,T){for(let N=1;N<arguments.length;N++){const B=arguments[N];if(_(B)){const pe=m.length||0,je=B.length||0;m.length=pe+je;for(let qe=0;qe<je;qe++)m[pe+qe]=B[qe]}else m.push(B)}}class Q{constructor(T,N){this.i=T,this.j=N,this.h=0,this.g=null}get(){let T;return 0<this.h?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function se(m){return/^[\s\xa0]*$/.test(m)}function ue(){var m=y.navigator;return m&&(m=m.userAgent)?m:""}function we(m){return we[" "](m),m}we[" "]=function(){};var Ce=ue().indexOf("Gecko")!=-1&&!(ue().toLowerCase().indexOf("webkit")!=-1&&ue().indexOf("Edge")==-1)&&!(ue().indexOf("Trident")!=-1||ue().indexOf("MSIE")!=-1)&&ue().indexOf("Edge")==-1;function Ue(m,T,N){for(const B in m)T.call(N,m[B],B,m)}function P(m,T){for(const N in m)T.call(void 0,m[N],N,m)}function M(m){const T={};for(const N in m)T[N]=m[N];return T}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(m,T){let N,B;for(let pe=1;pe<arguments.length;pe++){B=arguments[pe];for(N in B)m[N]=B[N];for(let je=0;je<D.length;je++)N=D[je],Object.prototype.hasOwnProperty.call(B,N)&&(m[N]=B[N])}}function k(m){var T=1;m=m.split(":");const N=[];for(;0<T&&m.length;)N.push(m.shift()),T--;return m.length&&N.push(m.join(":")),N}function q(m){y.setTimeout(()=>{throw m},0)}function j(){var m=be;let T=null;return m.g&&(T=m.g,m.g=m.g.next,m.g||(m.h=null),T.next=null),T}class de{constructor(){this.h=this.g=null}add(T,N){const B=ae.get();B.set(T,N),this.h?this.h.next=B:this.g=B,this.h=B}}var ae=new Q(()=>new Y,m=>m.reset());class Y{constructor(){this.next=this.g=this.h=null}set(T,N){this.h=T,this.g=N,this.next=null}reset(){this.next=this.g=this.h=null}}let ye,ie=!1,be=new de,A=()=>{const m=y.Promise.resolve(void 0);ye=()=>{m.then(W)}};var W=()=>{for(var m;m=j();){try{m.h.call(m.g)}catch(N){q(N)}var T=ae;T.j(m),100>T.h&&(T.h++,m.next=T.g,T.g=m)}ie=!1};function $(){this.s=this.s,this.C=this.C}$.prototype.s=!1,$.prototype.ma=function(){this.s||(this.s=!0,this.N())},$.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function te(m,T){this.type=m,this.g=this.target=T,this.defaultPrevented=!1}te.prototype.h=function(){this.defaultPrevented=!0};var me=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var m=!1,T=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const N=()=>{};y.addEventListener("test",N,T),y.removeEventListener("test",N,T)}catch{}return m}();function J(m,T){if(te.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m){var N=this.type=m.type,B=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;if(this.target=m.target||m.srcElement,this.g=T,T=m.relatedTarget){if(Ce){e:{try{we(T.nodeName);var pe=!0;break e}catch{}pe=!1}pe||(T=null)}}else N=="mouseover"?T=m.fromElement:N=="mouseout"&&(T=m.toElement);this.relatedTarget=T,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=typeof m.pointerType=="string"?m.pointerType:oe[m.pointerType]||"",this.state=m.state,this.i=m,m.defaultPrevented&&J.aa.h.call(this)}}H(J,te);var oe={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.aa.h.call(this);var m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var re="closure_listenable_"+(1e6*Math.random()|0),he=0;function Ae(m,T,N,B,pe){this.listener=m,this.proxy=null,this.src=T,this.type=N,this.capture=!!B,this.ha=pe,this.key=++he,this.da=this.fa=!1}function K(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function le(m){this.src=m,this.g={},this.h=0}le.prototype.add=function(m,T,N,B,pe){var je=m.toString();m=this.g[je],m||(m=this.g[je]=[],this.h++);var qe=Ge(m,T,B,pe);return-1<qe?(T=m[qe],N||(T.fa=!1)):(T=new Ae(T,this.src,je,!!B,pe),T.fa=N,m.push(T)),T};function Re(m,T){var N=T.type;if(N in m.g){var B=m.g[N],pe=Array.prototype.indexOf.call(B,T,void 0),je;(je=0<=pe)&&Array.prototype.splice.call(B,pe,1),je&&(K(T),m.g[N].length==0&&(delete m.g[N],m.h--))}}function Ge(m,T,N,B){for(var pe=0;pe<m.length;++pe){var je=m[pe];if(!je.da&&je.listener==T&&je.capture==!!N&&je.ha==B)return pe}return-1}var Je="closure_lm_"+(1e6*Math.random()|0),Ze={};function Ct(m,T,N,B,pe){if(Array.isArray(T)){for(var je=0;je<T.length;je++)Ct(m,T[je],N,B,pe);return null}return N=kt(N),m&&m[re]?m.K(T,N,v(B)?!!B.capture:!1,pe):Ot(m,T,N,!1,B,pe)}function Ot(m,T,N,B,pe,je){if(!T)throw Error("Invalid event type");var qe=v(pe)?!!pe.capture:!!pe,nn=qn(m);if(nn||(m[Je]=nn=new le(m)),N=nn.add(T,N,B,qe,je),N.proxy)return N;if(B=Ke(),N.proxy=B,B.src=m,B.listener=N,m.addEventListener)me||(pe=qe),pe===void 0&&(pe=!1),m.addEventListener(T.toString(),B,pe);else if(m.attachEvent)m.attachEvent(Hn(T.toString()),B);else if(m.addListener&&m.removeListener)m.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return N}function Ke(){function m(N){return T.call(m.src,m.listener,N)}const T=pn;return m}function ft(m,T,N,B,pe){if(Array.isArray(T))for(var je=0;je<T.length;je++)ft(m,T[je],N,B,pe);else B=v(B)?!!B.capture:!!B,N=kt(N),m&&m[re]?(m=m.i,T=String(T).toString(),T in m.g&&(je=m.g[T],N=Ge(je,N,B,pe),-1<N&&(K(je[N]),Array.prototype.splice.call(je,N,1),je.length==0&&(delete m.g[T],m.h--)))):m&&(m=qn(m))&&(T=m.g[T.toString()],m=-1,T&&(m=Ge(T,N,B,pe)),(N=-1<m?T[m]:null)&&Wt(N))}function Wt(m){if(typeof m!="number"&&m&&!m.da){var T=m.src;if(T&&T[re])Re(T.i,m);else{var N=m.type,B=m.proxy;T.removeEventListener?T.removeEventListener(N,B,m.capture):T.detachEvent?T.detachEvent(Hn(N),B):T.addListener&&T.removeListener&&T.removeListener(B),(N=qn(T))?(Re(N,m),N.h==0&&(N.src=null,T[Je]=null)):K(m)}}}function Hn(m){return m in Ze?Ze[m]:Ze[m]="on"+m}function pn(m,T){if(m.da)m=!0;else{T=new J(T,this);var N=m.listener,B=m.ha||m.src;m.fa&&Wt(m),m=N.call(B,T)}return m}function qn(m){return m=m[Je],m instanceof le?m:null}var gr="__closure_events_fn_"+(1e9*Math.random()>>>0);function kt(m){return typeof m=="function"?m:(m[gr]||(m[gr]=function(T){return m.handleEvent(T)}),m[gr])}function yt(){$.call(this),this.i=new le(this),this.M=this,this.F=null}H(yt,$),yt.prototype[re]=!0,yt.prototype.removeEventListener=function(m,T,N,B){ft(this,m,T,N,B)};function ct(m,T){var N,B=m.F;if(B)for(N=[];B;B=B.F)N.push(B);if(m=m.M,B=T.type||T,typeof T=="string")T=new te(T,m);else if(T instanceof te)T.target=T.target||m;else{var pe=T;T=new te(B,m),U(T,pe)}if(pe=!0,N)for(var je=N.length-1;0<=je;je--){var qe=T.g=N[je];pe=$t(qe,B,!0,T)&&pe}if(qe=T.g=m,pe=$t(qe,B,!0,T)&&pe,pe=$t(qe,B,!1,T)&&pe,N)for(je=0;je<N.length;je++)qe=T.g=N[je],pe=$t(qe,B,!1,T)&&pe}yt.prototype.N=function(){if(yt.aa.N.call(this),this.i){var m=this.i,T;for(T in m.g){for(var N=m.g[T],B=0;B<N.length;B++)K(N[B]);delete m.g[T],m.h--}}this.F=null},yt.prototype.K=function(m,T,N,B){return this.i.add(String(m),T,!1,N,B)},yt.prototype.L=function(m,T,N,B){return this.i.add(String(m),T,!0,N,B)};function $t(m,T,N,B){if(T=m.i.g[String(T)],!T)return!0;T=T.concat();for(var pe=!0,je=0;je<T.length;++je){var qe=T[je];if(qe&&!qe.da&&qe.capture==N){var nn=qe.listener,_i=qe.ha||qe.src;qe.fa&&Re(m.i,qe),pe=nn.call(_i,B)!==!1&&pe}}return pe&&!B.defaultPrevented}function Ln(m,T,N){if(typeof m=="function")N&&(m=I(m,N));else if(m&&typeof m.handleEvent=="function")m=I(m.handleEvent,m);else throw Error("Invalid listener argument");return 2147483647<Number(T)?-1:y.setTimeout(m,T||0)}function ts(m){m.g=Ln(()=>{m.g=null,m.i&&(m.i=!1,ts(m))},m.l);const T=m.h;m.h=null,m.m.apply(null,T)}class ia extends ${constructor(T,N){super(),this.m=T,this.l=N,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:ts(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rr(m){$.call(this),this.h=m,this.g={}}H(Rr,$);var zr=[];function Ki(m){Ue(m.g,function(T,N){this.g.hasOwnProperty(N)&&Wt(T)},m),m.g={}}Rr.prototype.N=function(){Rr.aa.N.call(this),Ki(this)},Rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var X=y.JSON.stringify,Fe=y.JSON.parse,st=class{stringify(m){return y.JSON.stringify(m,void 0)}parse(m){return y.JSON.parse(m,void 0)}};function zt(){}zt.prototype.h=null;function $n(m){return m.h||(m.h=m.i())}function Xn(){}var Nn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Yt(){te.call(this,"d")}H(Yt,te);function En(){te.call(this,"c")}H(En,te);var dn={},bn=null;function St(){return bn=bn||new yt}dn.La="serverreachability";function hn(m){te.call(this,dn.La,m)}H(hn,te);function gn(m){const T=St();ct(T,new hn(T))}dn.STAT_EVENT="statevent";function Pi(m,T){te.call(this,dn.STAT_EVENT,m),this.stat=T}H(Pi,te);function Ht(m){const T=St();ct(T,new Pi(T,m))}dn.Ma="timingevent";function Mt(m,T){te.call(this,dn.Ma,m),this.size=T}H(Mt,te);function ke(m,T){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){m()},T)}function at(){this.g=!0}at.prototype.xa=function(){this.g=!1};function Gn(m,T,N,B,pe,je){m.info(function(){if(m.g)if(je)for(var qe="",nn=je.split("&"),_i=0;_i<nn.length;_i++){var rn=nn[_i].split("=");if(1<rn.length){var Sn=rn[0];rn=rn[1];var Kn=Sn.split("_");qe=2<=Kn.length&&Kn[1]=="type"?qe+(Sn+"="+rn+"&"):qe+(Sn+"=redacted&")}}else qe=null;else qe=je;return"XMLHTTP REQ ("+B+") [attempt "+pe+"]: "+T+`
`+N+`
`+qe})}function nt(m,T,N,B,pe,je,qe){m.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+pe+"]: "+T+`
`+N+`
`+je+" "+qe})}function ni(m,T,N,B){m.info(function(){return"XMLHTTP TEXT ("+T+"): "+Ti(m,N)+(B?" "+B:"")})}function Ir(m,T){m.info(function(){return"TIMEOUT: "+T})}at.prototype.info=function(){};function Ti(m,T){if(!m.g)return T;if(!T)return null;try{var N=JSON.parse(T);if(N){for(m=0;m<N.length;m++)if(Array.isArray(N[m])){var B=N[m];if(!(2>B.length)){var pe=B[1];if(Array.isArray(pe)&&!(1>pe.length)){var je=pe[0];if(je!="noop"&&je!="stop"&&je!="close")for(var qe=1;qe<pe.length;qe++)pe[qe]=""}}}}return X(N)}catch{return T}}var sr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},wi={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Cn;function _t(){}H(_t,zt),_t.prototype.g=function(){return new XMLHttpRequest},_t.prototype.i=function(){return{}},Cn=new _t;function Rn(m,T,N,B){this.j=m,this.i=T,this.l=N,this.R=B||1,this.U=new Rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new fn}function fn(){this.i=null,this.g="",this.h=!1}var Ls={},yr={};function Vn(m,T,N){m.L=1,m.v=ot(mn(T)),m.m=N,m.P=!0,Bi(m,null)}function Bi(m,T){m.F=Date.now(),Un(m),m.A=mn(m.v);var N=m.A,B=m.R;Array.isArray(B)||(B=[String(B)]),ra(N.i,"t",B),m.C=0,N=m.j.J,m.h=new fn,m.g=yc(m.j,N?T:null,!m.m),0<m.O&&(m.M=new ia(I(m.Y,m,m.g),m.O)),T=m.U,N=m.g,B=m.ca;var pe="readystatechange";Array.isArray(pe)||(pe&&(zr[0]=pe.toString()),pe=zr);for(var je=0;je<pe.length;je++){var qe=Ct(N,pe[je],B||T.handleEvent,!1,T.h||T);if(!qe)break;T.g[qe.key]=qe}T=m.H?M(m.H):{},m.m?(m.u||(m.u="POST"),T["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.A,m.u,m.m,T)):(m.u="GET",m.g.ea(m.A,m.u,null,T)),gn(),Gn(m.i,m.u,m.A,m.l,m.R,m.m)}Rn.prototype.ca=function(m){m=m.target;const T=this.M;T&&Qi(m)==3?T.j():this.Y(m)},Rn.prototype.Y=function(m){try{if(m==this.g)e:{const Kn=Qi(this.g);var T=this.g.Ba();const Bs=this.g.Z();if(!(3>Kn)&&(Kn!=3||this.g&&(this.h.h||this.g.oa()||Tl(this.g)))){this.J||Kn!=4||T==7||(T==8||0>=Bs?gn(3):gn(2)),li(this);var N=this.g.Z();this.X=N;t:if(bs(this)){var B=Tl(this.g);m="";var pe=B.length,je=Qi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){xn(this),ei(this);var qe="";break t}this.h.i=new y.TextDecoder}for(T=0;T<pe;T++)this.h.h=!0,m+=this.h.i.decode(B[T],{stream:!(je&&T==pe-1)});B.length=0,this.h.g+=m,this.C=0,qe=this.h.g}else qe=this.g.oa();if(this.o=N==200,nt(this.i,this.u,this.A,this.l,this.R,Kn,N),this.o){if(this.T&&!this.K){t:{if(this.g){var nn,_i=this.g;if((nn=_i.g?_i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!se(nn)){var rn=nn;break t}}rn=null}if(N=rn)ni(this.i,this.l,N,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gi(this,N);else{this.o=!1,this.s=3,Ht(12),xn(this),ei(this);break e}}if(this.P){N=!0;let zn;for(;!this.J&&this.C<qe.length;)if(zn=Jn(this,qe),zn==yr){Kn==4&&(this.s=4,Ht(14),N=!1),ni(this.i,this.l,null,"[Incomplete Response]");break}else if(zn==Ls){this.s=4,Ht(15),ni(this.i,this.l,qe,"[Invalid Chunk]"),N=!1;break}else ni(this.i,this.l,zn,null),gi(this,zn);if(bs(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kn!=4||qe.length!=0||this.h.h||(this.s=1,Ht(16),N=!1),this.o=this.o&&N,!N)ni(this.i,this.l,qe,"[Invalid Chunked Response]"),xn(this),ei(this);else if(0<qe.length&&!this.W){this.W=!0;var Sn=this.j;Sn.g==this&&Sn.ba&&!Sn.M&&(Sn.j.info("Great, no buffering proxy detected. Bytes received: "+qe.length),aa(Sn),Sn.M=!0,Ht(11))}}else ni(this.i,this.l,qe,null),gi(this,qe);Kn==4&&xn(this),this.o&&!this.J&&(Kn==4?El(this.j,this):(this.o=!1,Un(this)))}else Du(this.g),N==400&&0<qe.indexOf("Unknown SID")?(this.s=3,Ht(12)):(this.s=0,Ht(13)),xn(this),ei(this)}}}catch{}finally{}};function bs(m){return m.g?m.u=="GET"&&m.L!=2&&m.j.Ca:!1}function Jn(m,T){var N=m.C,B=T.indexOf(`
`,N);return B==-1?yr:(N=Number(T.substring(N,B)),isNaN(N)?Ls:(B+=1,B+N>T.length?yr:(T=T.slice(B,B+N),m.C=B+N,T)))}Rn.prototype.cancel=function(){this.J=!0,xn(this)};function Un(m){m.S=Date.now()+m.I,ii(m,m.I)}function ii(m,T){if(m.B!=null)throw Error("WatchDog timer not null");m.B=ke(I(m.ba,m),T)}function li(m){m.B&&(y.clearTimeout(m.B),m.B=null)}Rn.prototype.ba=function(){this.B=null;const m=Date.now();0<=m-this.S?(Ir(this.i,this.A),this.L!=2&&(gn(),Ht(17)),xn(this),this.s=2,ei(this)):ii(this,this.S-m)};function ei(m){m.j.G==0||m.J||El(m.j,m)}function xn(m){li(m);var T=m.M;T&&typeof T.ma=="function"&&T.ma(),m.M=null,Ki(m.U),m.g&&(T=m.g,m.g=null,T.abort(),T.ma())}function gi(m,T){try{var N=m.j;if(N.G!=0&&(N.g==m||Dt(N.h,m))){if(!m.K&&Dt(N.h,m)&&N.G==3){try{var B=N.Da.g.parse(T)}catch{B=null}if(Array.isArray(B)&&B.length==3){var pe=B;if(pe[0]==0){e:if(!N.u){if(N.g)if(N.g.F+3e3<m.F)go(N),fo(N);else break e;mo(N),Ht(18)}}else N.za=pe[1],0<N.za-N.T&&37500>pe[2]&&N.F&&N.v==0&&!N.C&&(N.C=ke(I(N.Za,N),6e3));if(1>=Hr(N.h)&&N.ca){try{N.ca()}catch{}N.ca=void 0}}else zs(N,11)}else if((m.K||N.g==m)&&go(N),!se(T))for(pe=N.Da.g.parse(T),T=0;T<pe.length;T++){let rn=pe[T];if(N.T=rn[0],rn=rn[1],N.G==2)if(rn[0]=="c"){N.K=rn[1],N.ia=rn[2];const Sn=rn[3];Sn!=null&&(N.la=Sn,N.j.info("VER="+N.la));const Kn=rn[4];Kn!=null&&(N.Aa=Kn,N.j.info("SVER="+N.Aa));const Bs=rn[5];Bs!=null&&typeof Bs=="number"&&0<Bs&&(B=1.5*Bs,N.L=B,N.j.info("backChannelRequestTimeoutMs_="+B)),B=N;const zn=m.g;if(zn){const Es=zn.g?zn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Es){var je=B.h;je.g||Es.indexOf("spdy")==-1&&Es.indexOf("quic")==-1&&Es.indexOf("h2")==-1||(je.j=je.l,je.g=new Set,je.h&&(bt(je,je.h),je.h=null))}if(B.D){const Ss=zn.g?zn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ss&&(B.ya=Ss,Ne(B.I,B.D,Ss))}}N.G=3,N.l&&N.l.ua(),N.ba&&(N.R=Date.now()-m.F,N.j.info("Handshake RTT: "+N.R+"ms")),B=N;var qe=m;if(B.qa=_o(B,B.J?B.ia:null,B.W),qe.K){yi(B.h,qe);var nn=qe,_i=B.L;_i&&(nn.I=_i),nn.B&&(li(nn),Un(nn)),B.g=qe}else rs(B);0<N.i.length&&sa(N)}else rn[0]!="stop"&&rn[0]!="close"||zs(N,7);else N.G==3&&(rn[0]=="stop"||rn[0]=="close"?rn[0]=="stop"?zs(N,7):ho(N):rn[0]!="noop"&&N.l&&N.l.ta(rn),N.v=0)}}gn(4)}catch{}}var ns=class{constructor(m,T){this.g=m,this.map=T}};function Br(m){this.l=m||10,y.PerformanceNavigationTiming?(m=y.performance.getEntriesByType("navigation"),m=0<m.length&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Vs(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Hr(m){return m.h?1:m.g?m.g.size:0}function Dt(m,T){return m.h?m.h==T:m.g?m.g.has(T):!1}function bt(m,T){m.g?m.g.add(T):m.h=T}function yi(m,T){m.h&&m.h==T?m.h=null:m.g&&m.g.has(T)&&m.g.delete(T)}Br.prototype.cancel=function(){if(this.i=Pt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Pt(m){if(m.h!=null)return m.i.concat(m.h.D);if(m.g!=null&&m.g.size!==0){let T=m.i;for(const N of m.g.values())T=T.concat(N.D);return T}return Z(m.i)}function xs(m){if(m.V&&typeof m.V=="function")return m.V();if(typeof Map<"u"&&m instanceof Map||typeof Set<"u"&&m instanceof Set)return Array.from(m.values());if(typeof m=="string")return m.split("");if(_(m)){for(var T=[],N=m.length,B=0;B<N;B++)T.push(m[B]);return T}T=[],N=0;for(B in m)T[N++]=m[B];return T}function is(m){if(m.na&&typeof m.na=="function")return m.na();if(!m.V||typeof m.V!="function"){if(typeof Map<"u"&&m instanceof Map)return Array.from(m.keys());if(!(typeof Set<"u"&&m instanceof Set)){if(_(m)||typeof m=="string"){var T=[];m=m.length;for(var N=0;N<m;N++)T.push(N);return T}T=[],N=0;for(const B in m)T[N++]=B;return T}}}function jt(m,T){if(m.forEach&&typeof m.forEach=="function")m.forEach(T,void 0);else if(_(m)||typeof m=="string")Array.prototype.forEach.call(m,T,void 0);else for(var N=is(m),B=xs(m),pe=B.length,je=0;je<pe;je++)T.call(void 0,B[je],N&&N[je],m)}var Tn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Aa(m,T){if(m){m=m.split("&");for(var N=0;N<m.length;N++){var B=m[N].indexOf("="),pe=null;if(0<=B){var je=m[N].substring(0,B);pe=m[N].substring(B+1)}else je=m[N];T(je,pe?decodeURIComponent(pe.replace(/\+/g," ")):"")}}}function Fn(m){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,m instanceof Fn){this.h=m.h,z(this,m.j),this.o=m.o,this.g=m.g,xe(this,m.s),this.l=m.l;var T=m.i,N=new Mi;N.i=T.i,T.g&&(N.g=new Map(T.g),N.h=T.h),He(this,N),this.m=m.m}else m&&(T=String(m).match(Tn))?(this.h=!1,z(this,T[1]||"",!0),this.o=et(T[2]||""),this.g=et(T[3]||"",!0),xe(this,T[4]),this.l=et(T[5]||"",!0),He(this,T[6]||"",!0),this.m=et(T[7]||"")):(this.h=!1,this.i=new Mi(null,this.h))}Fn.prototype.toString=function(){var m=[],T=this.j;T&&m.push(Be(T,We,!0),":");var N=this.g;return(N||T=="file")&&(m.push("//"),(T=this.o)&&m.push(Be(T,We,!0),"@"),m.push(encodeURIComponent(String(N)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N=this.s,N!=null&&m.push(":",String(N))),(N=this.l)&&(this.g&&N.charAt(0)!="/"&&m.push("/"),m.push(Be(N,N.charAt(0)=="/"?Qt:mt,!0))),(N=this.i.toString())&&m.push("?",N),(N=this.m)&&m.push("#",Be(N,ci)),m.join("")};function mn(m){return new Fn(m)}function z(m,T,N){m.j=N?et(T,!0):T,m.j&&(m.j=m.j.replace(/:$/,""))}function xe(m,T){if(T){if(T=Number(T),isNaN(T)||0>T)throw Error("Bad port number "+T);m.s=T}else m.s=null}function He(m,T,N){T instanceof Mi?(m.i=T,or(m.i,m.h)):(N||(T=Be(T,Zn)),m.i=new Mi(T,m.h))}function Ne(m,T,N){m.i.set(T,N)}function ot(m){return Ne(m,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),m}function et(m,T){return m?T?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function Be(m,T,N){return typeof m=="string"?(m=encodeURI(m).replace(T,Ye),N&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Ye(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var We=/[#\/\?@]/g,mt=/[#\?:]/g,Qt=/[#\?]/g,Zn=/[#\?@]/g,ci=/#/g;function Mi(m,T){this.h=this.g=null,this.i=m||null,this.j=!!T}function Ei(m){m.g||(m.g=new Map,m.h=0,m.i&&Aa(m.i,function(T,N){m.add(decodeURIComponent(T.replace(/\+/g," ")),N)}))}n=Mi.prototype,n.add=function(m,T){Ei(this),this.i=null,m=dt(this,m);var N=this.g.get(m);return N||this.g.set(m,N=[]),N.push(T),this.h+=1,this};function _r(m,T){Ei(m),T=dt(m,T),m.g.has(T)&&(m.i=null,m.h-=m.g.get(T).length,m.g.delete(T))}function ar(m,T){return Ei(m),T=dt(m,T),m.g.has(T)}n.forEach=function(m,T){Ei(this),this.g.forEach(function(N,B){N.forEach(function(pe){m.call(T,pe,B,this)},this)},this)},n.na=function(){Ei(this);const m=Array.from(this.g.values()),T=Array.from(this.g.keys()),N=[];for(let B=0;B<T.length;B++){const pe=m[B];for(let je=0;je<pe.length;je++)N.push(T[B])}return N},n.V=function(m){Ei(this);let T=[];if(typeof m=="string")ar(this,m)&&(T=T.concat(this.g.get(dt(this,m))));else{m=Array.from(this.g.values());for(let N=0;N<m.length;N++)T=T.concat(m[N])}return T},n.set=function(m,T){return Ei(this),this.i=null,m=dt(this,m),ar(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[T]),this.h+=1,this},n.get=function(m,T){return m?(m=this.V(m),0<m.length?String(m[0]):T):T};function ra(m,T,N){_r(m,T),0<N.length&&(m.i=null,m.g.set(dt(m,T),Z(N)),m.h+=N.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],T=Array.from(this.g.keys());for(var N=0;N<T.length;N++){var B=T[N];const je=encodeURIComponent(String(B)),qe=this.V(B);for(B=0;B<qe.length;B++){var pe=je;qe[B]!==""&&(pe+="="+encodeURIComponent(String(qe[B]))),m.push(pe)}}return this.i=m.join("&")};function dt(m,T){return T=String(T),m.j&&(T=T.toLowerCase()),T}function or(m,T){T&&!m.j&&(Ei(m),m.i=null,m.g.forEach(function(N,B){var pe=B.toLowerCase();B!=pe&&(_r(this,B),ra(this,pe,N))},m)),m.j=T}function tn(m,T){const N=new at;if(y.Image){const B=new Image;B.onload=G(Wi,N,"TestLoadImage: loaded",!0,T,B),B.onerror=G(Wi,N,"TestLoadImage: error",!1,T,B),B.onabort=G(Wi,N,"TestLoadImage: abort",!1,T,B),B.ontimeout=G(Wi,N,"TestLoadImage: timeout",!1,T,B),y.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=m}else T(!1)}function vr(m,T){const N=new at,B=new AbortController,pe=setTimeout(()=>{B.abort(),Wi(N,"TestPingServer: timeout",!1,T)},1e4);fetch(m,{signal:B.signal}).then(je=>{clearTimeout(pe),je.ok?Wi(N,"TestPingServer: ok",!0,T):Wi(N,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(pe),Wi(N,"TestPingServer: error",!1,T)})}function Wi(m,T,N,B,pe){try{pe&&(pe.onload=null,pe.onerror=null,pe.onabort=null,pe.ontimeout=null),B(N)}catch{}}function Si(){this.g=new st}function yn(m,T,N){const B=N||"";try{jt(m,function(pe,je){let qe=pe;v(pe)&&(qe=X(pe)),T.push(B+je+"="+encodeURIComponent(qe))})}catch(pe){throw T.push(B+"type="+encodeURIComponent("_badmap")),pe}}function ri(m){this.l=m.Ub||null,this.j=m.eb||!1}H(ri,zt),ri.prototype.g=function(){return new Yi(this.l,this.j)},ri.prototype.i=function(m){return function(){return m}}({});function Yi(m,T){yt.call(this),this.D=m,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}H(Yi,yt),n=Yi.prototype,n.open=function(m,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=m,this.A=T,this.readyState=1,ji(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const T={headers:this.u,method:this.B,credentials:this.m,cache:void 0};m&&(T.body=m),(this.D||y).fetch(new Request(this.A,T)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,wn(this)),this.readyState=0},n.Sa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,ji(this)),this.g&&(this.readyState=3,ji(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pr(this)}else m.text().then(this.Ra.bind(this),this.ga.bind(this))};function Pr(m){m.j.read().then(m.Pa.bind(m)).catch(m.ga.bind(m))}n.Pa=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var T=m.value?m.value:new Uint8Array(0);(T=this.v.decode(T,{stream:!m.done}))&&(this.response=this.responseText+=T)}m.done?wn(this):ji(this),this.readyState==3&&Pr(this)}},n.Ra=function(m){this.g&&(this.response=this.responseText=m,wn(this))},n.Qa=function(m){this.g&&(this.response=m,wn(this))},n.ga=function(){this.g&&wn(this)};function wn(m){m.readyState=4,m.l=null,m.j=null,m.v=null,ji(m)}n.setRequestHeader=function(m,T){this.u.append(m,T)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],T=this.h.entries();for(var N=T.next();!N.done;)N=N.value,m.push(N[0]+": "+N[1]),N=T.next();return m.join(`\r
`)};function ji(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(Yi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function co(m){let T="";return Ue(m,function(N,B){T+=B,T+=":",T+=N,T+=`\r
`}),T}function Ai(m,T,N){e:{for(B in N){var B=!1;break e}B=!0}B||(N=co(N),typeof m=="string"?N!=null&&encodeURIComponent(String(N)):Ne(m,T,N))}function _n(m){yt.call(this),this.headers=new Map,this.o=m||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}H(_n,yt);var Na=/^https?$/i,Us=["POST","PUT"];n=_n.prototype,n.Ha=function(m){this.J=m},n.ea=function(m,T,N,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);T=T?T.toUpperCase():"GET",this.D=m,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Cn.g(),this.v=this.o?$n(this.o):$n(Cn),this.g.onreadystatechange=I(this.Ea,this);try{this.B=!0,this.g.open(T,String(m),!0),this.B=!1}catch(je){mc(this,je);return}if(m=N||"",N=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var pe in B)N.set(pe,B[pe]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const je of B.keys())N.set(je,B.get(je));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(N.keys()).find(je=>je.toLowerCase()=="content-type"),pe=y.FormData&&m instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Us,T,void 0))||B||pe||N.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[je,qe]of N)this.g.setRequestHeader(je,qe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hi(this),this.u=!0,this.g.send(m),this.u=!1}catch(je){mc(this,je)}};function mc(m,T){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=T,m.m=5,Ca(m),Ts(m)}function Ca(m){m.A||(m.A=!0,ct(m,"complete"),ct(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=m||7,ct(this,"complete"),ct(this,"abort"),Ts(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ts(this,!0)),_n.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Lt(this):this.bb())},n.bb=function(){Lt(this)};function Lt(m){if(m.h&&typeof f<"u"&&(!m.v[1]||Qi(m)!=4||m.Z()!=2)){if(m.u&&Qi(m)==4)Ln(m.Ea,0,m);else if(ct(m,"readystatechange"),Qi(m)==4){m.h=!1;try{const qe=m.Z();e:switch(qe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var N;if(!(N=T)){var B;if(B=qe===0){var pe=String(m.D).match(Tn)[1]||null;!pe&&y.self&&y.self.location&&(pe=y.self.location.protocol.slice(0,-1)),B=!Na.test(pe?pe.toLowerCase():"")}N=B}if(N)ct(m,"complete"),ct(m,"success");else{m.m=6;try{var je=2<Qi(m)?m.g.statusText:""}catch{je=""}m.l=je+" ["+m.Z()+"]",Ca(m)}}finally{Ts(m)}}}}function Ts(m,T){if(m.g){Hi(m);const N=m.g,B=m.v[0]?()=>{}:null;m.g=null,m.v=null,T||ct(m,"ready");try{N.onreadystatechange=B}catch{}}}function Hi(m){m.I&&(y.clearTimeout(m.I),m.I=null)}n.isActive=function(){return!!this.g};function Qi(m){return m.g?m.g.readyState:0}n.Z=function(){try{return 2<Qi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(m){if(this.g){var T=this.g.responseText;return m&&T.indexOf(m)==0&&(T=T.substring(m.length)),Fe(T)}};function Tl(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.H){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Du(m){const T={};m=(m.g&&2<=Qi(m)&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<m.length;B++){if(se(m[B]))continue;var N=k(m[B]);const pe=N[0];if(N=N[1],typeof N!="string")continue;N=N.trim();const je=T[pe]||[];T[pe]=je,je.push(N)}P(T,function(B){return B.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Fs(m,T,N){return N&&N.internalChannelParams&&N.internalChannelParams[m]||T}function uo(m){this.Aa=0,this.i=[],this.j=new at,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Fs("failFast",!1,m),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Fs("baseRetryDelayMs",5e3,m),this.cb=Fs("retryDelaySeedMs",1e4,m),this.Wa=Fs("forwardChannelMaxRetries",2,m),this.wa=Fs("forwardChannelRequestTimeoutMs",2e4,m),this.pa=m&&m.xmlHttpFactory||void 0,this.Xa=m&&m.Tb||void 0,this.Ca=m&&m.useFetchStreams||!1,this.L=void 0,this.J=m&&m.supportsCrossDomainXhr||!1,this.K="",this.h=new Br(m&&m.concurrentRequestLimit),this.Da=new Si,this.P=m&&m.fastHandshake||!1,this.O=m&&m.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=m&&m.Rb||!1,m&&m.xa&&this.j.xa(),m&&m.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&m&&m.detectBufferingProxy||!1,this.ja=void 0,m&&m.longPollingTimeout&&0<m.longPollingTimeout&&(this.ja=m.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=uo.prototype,n.la=8,n.G=1,n.connect=function(m,T,N,B){Ht(0),this.W=m,this.H=T||{},N&&B!==void 0&&(this.H.OSID=N,this.H.OAID=B),this.F=this.X,this.I=_o(this,null,this.W),sa(this)};function ho(m){if(pc(m),m.G==3){var T=m.U++,N=mn(m.I);if(Ne(N,"SID",m.K),Ne(N,"RID",T),Ne(N,"TYPE","terminate"),Ra(m,N),T=new Rn(m,m.j,T),T.L=2,T.v=ot(mn(N)),N=!1,y.navigator&&y.navigator.sendBeacon)try{N=y.navigator.sendBeacon(T.v.toString(),"")}catch{}!N&&y.Image&&(new Image().src=T.v,N=!0),N||(T.g=yc(T.j,null),T.g.ea(T.v)),T.F=Date.now(),Un(T)}gc(m)}function fo(m){m.g&&(aa(m),m.g.cancel(),m.g=null)}function pc(m){fo(m),m.u&&(y.clearTimeout(m.u),m.u=null),go(m),m.h.cancel(),m.s&&(typeof m.s=="number"&&y.clearTimeout(m.s),m.s=null)}function sa(m){if(!Vs(m.h)&&!m.s){m.s=!0;var T=m.Ga;ye||A(),ie||(ye(),ie=!0),be.add(T,m),m.B=0}}function Lu(m,T){return Hr(m.h)>=m.h.j-(m.s?1:0)?!1:m.s?(m.i=T.D.concat(m.i),!0):m.G==1||m.G==2||m.B>=(m.Va?0:m.Wa)?!1:(m.s=ke(I(m.Ga,m,T),yo(m,m.B)),m.B++,!0)}n.Ga=function(m){if(this.s)if(this.s=null,this.G==1){if(!m){this.U=Math.floor(1e5*Math.random()),m=this.U++;const pe=new Rn(this,this.j,m);let je=this.o;if(this.S&&(je?(je=M(je),U(je,this.S)):je=this.S),this.m!==null||this.O||(pe.H=je,je=null),this.P)e:{for(var T=0,N=0;N<this.i.length;N++){t:{var B=this.i[N];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(T+=B,4096<T){T=N;break e}if(T===4096||N===this.i.length-1){T=N+1;break e}}T=1e3}else T=1e3;T=wl(this,pe,T),N=mn(this.I),Ne(N,"RID",m),Ne(N,"CVER",22),this.D&&Ne(N,"X-HTTP-Session-Id",this.D),Ra(this,N),je&&(this.O?T="headers="+encodeURIComponent(String(co(je)))+"&"+T:this.m&&Ai(N,this.m,je)),bt(this.h,pe),this.Ua&&Ne(N,"TYPE","init"),this.P?(Ne(N,"$req",T),Ne(N,"SID","null"),pe.T=!0,Vn(pe,N,null)):Vn(pe,N,T),this.G=2}}else this.G==3&&(m?br(this,m):this.i.length==0||Vs(this.h)||br(this))};function br(m,T){var N;T?N=T.l:N=m.U++;const B=mn(m.I);Ne(B,"SID",m.K),Ne(B,"RID",N),Ne(B,"AID",m.T),Ra(m,B),m.m&&m.o&&Ai(B,m.m,m.o),N=new Rn(m,m.j,N,m.B+1),m.m===null&&(N.H=m.o),T&&(m.i=T.D.concat(m.i)),T=wl(m,N,1e3),N.I=Math.round(.5*m.wa)+Math.round(.5*m.wa*Math.random()),bt(m.h,N),Vn(N,B,T)}function Ra(m,T){m.H&&Ue(m.H,function(N,B){Ne(T,B,N)}),m.l&&jt({},function(N,B){Ne(T,B,N)})}function wl(m,T,N){N=Math.min(m.i.length,N);var B=m.l?I(m.l.Na,m.l,m):null;e:{var pe=m.i;let je=-1;for(;;){const qe=["count="+N];je==-1?0<N?(je=pe[0].g,qe.push("ofs="+je)):je=0:qe.push("ofs="+je);let nn=!0;for(let _i=0;_i<N;_i++){let rn=pe[_i].g;const Sn=pe[_i].map;if(rn-=je,0>rn)je=Math.max(0,pe[_i].g-100),nn=!1;else try{yn(Sn,qe,"req"+rn+"_")}catch{B&&B(Sn)}}if(nn){B=qe.join("&");break e}}}return m=m.i.splice(0,N),T.D=m,B}function rs(m){if(!m.g&&!m.u){m.Y=1;var T=m.Fa;ye||A(),ie||(ye(),ie=!0),be.add(T,m),m.v=0}}function mo(m){return m.g||m.u||3<=m.v?!1:(m.Y++,m.u=ke(I(m.Fa,m),yo(m,m.v)),m.v++,!0)}n.Fa=function(){if(this.u=null,po(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var m=2*this.R;this.j.info("BP detection timer enabled: "+m),this.A=ke(I(this.ab,this),m)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ht(10),fo(this),po(this))};function aa(m){m.A!=null&&(y.clearTimeout(m.A),m.A=null)}function po(m){m.g=new Rn(m,m.j,"rpc",m.Y),m.m===null&&(m.g.H=m.o),m.g.O=0;var T=mn(m.qa);Ne(T,"RID","rpc"),Ne(T,"SID",m.K),Ne(T,"AID",m.T),Ne(T,"CI",m.F?"0":"1"),!m.F&&m.ja&&Ne(T,"TO",m.ja),Ne(T,"TYPE","xmlhttp"),Ra(m,T),m.m&&m.o&&Ai(T,m.m,m.o),m.L&&(m.g.I=m.L);var N=m.g;m=m.ia,N.L=1,N.v=ot(mn(T)),N.m=null,N.P=!0,Bi(N,m)}n.Za=function(){this.C!=null&&(this.C=null,fo(this),mo(this),Ht(19))};function go(m){m.C!=null&&(y.clearTimeout(m.C),m.C=null)}function El(m,T){var N=null;if(m.g==T){go(m),aa(m),m.g=null;var B=2}else if(Dt(m.h,T))N=T.D,yi(m.h,T),B=1;else return;if(m.G!=0){if(T.o)if(B==1){N=T.m?T.m.length:0,T=Date.now()-T.F;var pe=m.B;B=St(),ct(B,new Mt(B,N)),sa(m)}else rs(m);else if(pe=T.s,pe==3||pe==0&&0<T.X||!(B==1&&Lu(m,T)||B==2&&mo(m)))switch(N&&0<N.length&&(T=m.h,T.i=T.i.concat(N)),pe){case 1:zs(m,5);break;case 4:zs(m,10);break;case 3:zs(m,6);break;default:zs(m,2)}}}function yo(m,T){let N=m.Ta+Math.floor(Math.random()*m.cb);return m.isActive()||(N*=2),N*T}function zs(m,T){if(m.j.info("Error code "+T),T==2){var N=I(m.fb,m),B=m.Xa;const pe=!B;B=new Fn(B||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||z(B,"https"),ot(B),pe?tn(B.toString(),N):vr(B.toString(),N)}else Ht(2);m.G=0,m.l&&m.l.sa(T),gc(m),pc(m)}n.fb=function(m){m?(this.j.info("Successfully pinged google.com"),Ht(2)):(this.j.info("Failed to ping google.com"),Ht(1))};function gc(m){if(m.G=0,m.ka=[],m.l){const T=Pt(m.h);(T.length!=0||m.i.length!=0)&&(F(m.ka,T),F(m.ka,m.i),m.h.i.length=0,Z(m.i),m.i.length=0),m.l.ra()}}function _o(m,T,N){var B=N instanceof Fn?mn(N):new Fn(N);if(B.g!="")T&&(B.g=T+"."+B.g),xe(B,B.s);else{var pe=y.location;B=pe.protocol,T=T?T+"."+pe.hostname:pe.hostname,pe=+pe.port;var je=new Fn(null);B&&z(je,B),T&&(je.g=T),pe&&xe(je,pe),N&&(je.l=N),B=je}return N=m.D,T=m.ya,N&&T&&Ne(B,N,T),Ne(B,"VER",m.la),Ra(m,B),B}function yc(m,T,N){if(T&&!m.J)throw Error("Can't create secondary domain capable XhrIo object.");return T=m.Ca&&!m.pa?new _n(new ri({eb:N})):new _n(m.pa),T.Ha(m.J),T}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Sl(){}n=Sl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ia(){}Ia.prototype.g=function(m,T){return new ki(m,T)};function ki(m,T){yt.call(this),this.g=new uo(T),this.l=m,this.h=T&&T.messageUrlParams||null,m=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(m?m["X-WebChannel-Content-Type"]=T.messageContentType:m={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.va&&(m?m["X-WebChannel-Client-Profile"]=T.va:m={"X-WebChannel-Client-Profile":T.va}),this.g.S=m,(m=T&&T.Sb)&&!se(m)&&(this.g.m=m),this.v=T&&T.supportsCrossDomainXhr||!1,this.u=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!se(T)&&(this.g.D=T,m=this.h,m!==null&&T in m&&(m=this.h,T in m&&delete m[T])),this.j=new xr(this)}H(ki,yt),ki.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ki.prototype.close=function(){ho(this.g)},ki.prototype.o=function(m){var T=this.g;if(typeof m=="string"){var N={};N.__data__=m,m=N}else this.u&&(N={},N.__data__=X(m),m=N);T.i.push(new ns(T.Ya++,m)),T.G==3&&sa(T)},ki.prototype.N=function(){this.g.l=null,delete this.j,ho(this.g),delete this.g,ki.aa.N.call(this)};function ws(m){Yt.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var T=m.__sm__;if(T){e:{for(const N in T){m=N;break e}m=void 0}(this.i=m)&&(m=this.i,T=T!==null&&m in T?T[m]:void 0),this.data=T}else this.data=m}H(ws,Yt);function _c(){En.call(this),this.status=1}H(_c,En);function xr(m){this.g=m}H(xr,Sl),xr.prototype.ua=function(){ct(this.g,"a")},xr.prototype.ta=function(m){ct(this.g,new ws(m))},xr.prototype.sa=function(m){ct(this.g,new _c)},xr.prototype.ra=function(){ct(this.g,"b")},Ia.prototype.createWebChannel=Ia.prototype.g,ki.prototype.send=ki.prototype.o,ki.prototype.open=ki.prototype.m,ki.prototype.close=ki.prototype.close,M1=function(){return new Ia},P1=function(){return St()},I1=dn,t_={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sr.NO_ERROR=0,sr.TIMEOUT=8,sr.HTTP_ERROR=6,gm=sr,wi.COMPLETE="complete",R1=wi,Xn.EventType=Nn,Nn.OPEN="a",Nn.CLOSE="b",Nn.ERROR="c",Nn.MESSAGE="d",yt.prototype.listen=yt.prototype.K,Bd=Xn,_n.prototype.listenOnce=_n.prototype.L,_n.prototype.getLastError=_n.prototype.Ka,_n.prototype.getLastErrorCode=_n.prototype.Ba,_n.prototype.getStatus=_n.prototype.Z,_n.prototype.getResponseJson=_n.prototype.Oa,_n.prototype.getResponseText=_n.prototype.oa,_n.prototype.send=_n.prototype.ea,_n.prototype.setWithCredentials=_n.prototype.Ha,C1=_n}).apply(typeof Uf<"u"?Uf:typeof self<"u"?self:typeof window<"u"?window:{});const bT="@firebase/firestore",xT="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ar.UNAUTHENTICATED=new Ar(null),Ar.GOOGLE_CREDENTIALS=new Ar("google-credentials-uid"),Ar.FIRST_PARTY=new Ar("first-party-uid"),Ar.MOCK_USER=new Ar("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nu="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc=new R_("@firebase/firestore");function eu(){return sc.logLevel}function tt(n,...e){if(sc.logLevel<=sn.DEBUG){const t=e.map(z_);sc.debug(`Firestore (${Nu}): ${n}`,...t)}}function no(n,...e){if(sc.logLevel<=sn.ERROR){const t=e.map(z_);sc.error(`Firestore (${Nu}): ${n}`,...t)}}function mu(n,...e){if(sc.logLevel<=sn.WARN){const t=e.map(z_);sc.warn(`Firestore (${Nu}): ${n}`,...t)}}function z_(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vt(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,k1(n,r,t)}function k1(n,e,t){let r=`FIRESTORE (${Nu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw no(r),new Error(r)}function un(n,e,t,r){let l="Unexpected state";typeof t=="string"?l=t:r=t,n||k1(e,l,r)}function It(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $e extends ta{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ar.UNAUTHENTICATED))}shutdown(){}}class PP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class MP{constructor(e){this.t=e,this.currentUser=Ar.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){un(this.o===void 0,42304);let r=this.i;const l=_=>this.i!==r?(r=this.i,t(_)):Promise.resolve();let u=new xa;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new xa,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const _=u;e.enqueueRetryable(async()=>{await _.promise,await l(this.currentUser)})},y=_=>{tt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=_,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(_=>y(_)),setTimeout(()=>{if(!this.auth){const _=this.t.getImmediate({optional:!0});_?y(_):(tt("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new xa)}},0),f()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(tt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(un(typeof r.accessToken=="string",31837,{l:r}),new O1(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return un(e===null||typeof e=="string",2055,{h:e}),new Ar(e)}}class kP{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Ar.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OP{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new kP(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ar.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class TT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class DP{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Yr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){un(this.o===void 0,3512);const r=u=>{u.error!=null&&tt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.m;return this.m=u.token,tt("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?t(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>r(u))};const l=u=>{tt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.V.getImmediate({optional:!0});u?l(u):tt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new TT(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(un(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new TT(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const l=LP(40);for(let u=0;u<l.length;++u)r.length<20&&l[u]<t&&(r+=e.charAt(l[u]%62))}return r}}function an(n,e){return n<e?-1:n>e?1:0}function n_(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const l=n.charAt(r),u=e.charAt(r);if(l!==u)return yy(l)===yy(u)?an(l,u):yy(l)?1:-1}return an(n.length,e.length)}const VP=55296,UP=57343;function yy(n){const e=n.charCodeAt(0);return e>=VP&&e<=UP}function pu(n,e,t){return n.length===e.length&&n.every((r,l)=>t(r,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT="__name__";class ga{constructor(e,t,r){t===void 0?t=0:t>e.length&&vt(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&vt(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ga.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ga?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let l=0;l<r;l++){const u=ga.compareSegments(e.get(l),t.get(l));if(u!==0)return u}return an(e.length,t.length)}static compareSegments(e,t){const r=ga.isNumericId(e),l=ga.isNumericId(t);return r&&!l?-1:!r&&l?1:r&&l?ga.extractNumericId(e).compare(ga.extractNumericId(t)):n_(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return al.fromString(e.substring(4,e.length-2))}}class On extends ga{construct(e,t,r){return new On(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new $e(Pe.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(l=>l.length>0))}return new On(t)}static emptyPath(){return new On([])}}const FP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fr extends ga{construct(e,t,r){return new fr(e,t,r)}static isValidIdentifier(e){return FP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wT}static keyField(){return new fr([wT])}static fromServerFormat(e){const t=[];let r="",l=0;const u=()=>{if(r.length===0)throw new $e(Pe.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let f=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new $e(Pe.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const _=e[l+1];if(_!=="\\"&&_!=="."&&_!=="`")throw new $e(Pe.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=_,l+=2}else y==="`"?(f=!f,l++):y!=="."||f?(r+=y,l++):(u(),l++)}if(u(),f)throw new $e(Pe.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fr(t)}static emptyPath(){return new fr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.path=e}static fromPath(e){return new pt(On.fromString(e))}static fromName(e){return new pt(On.fromString(e).popFirst(5))}static empty(){return new pt(On.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&On.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return On.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pt(new On(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D1(n,e,t){if(!t)throw new $e(Pe.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function zP(n,e,t,r){if(e===!0&&r===!0)throw new $e(Pe.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ET(n){if(!pt.isDocumentKey(n))throw new $e(Pe.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ST(n){if(pt.isDocumentKey(n))throw new $e(Pe.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function L1(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ip(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":vt(12329,{type:typeof n})}function Xr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new $e(Pe.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ip(n);throw new $e(Pe.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n,e){const t={typeString:n};return e&&(t.value=e),t}function Eh(n,e){if(!L1(n))throw new $e(Pe.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const l=e[r].typeString,u="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const f=n[r];if(l&&typeof f!==l){t=`JSON field '${r}' must be a ${l}.`;break}if(u!==void 0&&f!==u.value){t=`Expected '${r}' field to equal '${u.value}'`;break}}if(t)throw new $e(Pe.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT=-62135596800,AT=1e6;class ti{static now(){return ti.fromMillis(Date.now())}static fromDate(e){return ti.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*AT);return new ti(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $e(Pe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $e(Pe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jT)throw new $e(Pe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $e(Pe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/AT}_compareTo(e){return this.seconds===e.seconds?an(this.nanoseconds,e.nanoseconds):an(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ti._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Eh(e,ti._jsonSchema))return new ti(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-jT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ti._jsonSchemaVersion="firestore/timestamp/1.0",ti._jsonSchema={type:zi("string",ti._jsonSchemaVersion),seconds:zi("number"),nanoseconds:zi("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{static fromTimestamp(e){return new wt(e)}static min(){return new wt(new ti(0,0))}static max(){return new wt(new ti(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=-1;function BP(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,l=wt.fromTimestamp(r===1e9?new ti(t+1,0):new ti(t,r));return new hl(l,pt.empty(),e)}function HP(n){return new hl(n.readTime,n.key,ah)}class hl{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hl(wt.min(),pt.empty(),ah)}static max(){return new hl(wt.max(),pt.empty(),ah)}}function qP(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=pt.comparator(n.documentKey,e.documentKey),t!==0?t:an(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class GP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cu(n){if(n.code!==Pe.FAILED_PRECONDITION||n.message!==$P)throw n;tt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&vt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Le((r,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(r,l)},this.catchCallback=u=>{this.wrapFailure(t,u).next(r,l)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Le?t:Le.resolve(t)}catch(t){return Le.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Le.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Le.reject(t)}static resolve(e){return new Le((t,r)=>{t(e)})}static reject(e){return new Le((t,r)=>{r(e)})}static waitFor(e){return new Le((t,r)=>{let l=0,u=0,f=!1;e.forEach(y=>{++l,y.next(()=>{++u,f&&u===l&&t()},_=>r(_))}),f=!0,u===l&&t()})}static or(e){let t=Le.resolve(!1);for(const r of e)t=t.next(l=>l?Le.resolve(l):r());return t}static forEach(e,t){const r=[];return e.forEach((l,u)=>{r.push(t.call(this,l,u))}),this.waitFor(r)}static mapArray(e,t){return new Le((r,l)=>{const u=e.length,f=new Array(u);let y=0;for(let _=0;_<u;_++){const v=_;t(e[v]).next(w=>{f[v]=w,++y,y===u&&r(f)},w=>l(w))}})}static doWhile(e,t){return new Le((r,l)=>{const u=()=>{e()===!0?t().next(()=>{u()},l):r()};u()})}}function ZP(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ru(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}rp.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H_=-1;function Sh(n){return n==null}function Pm(n){return n===0&&1/n==-1/0}function KP(n){return typeof n=="number"&&Number.isInteger(n)&&!Pm(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V1="";function WP(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=NT(e)),e=YP(n.get(t),e);return NT(e)}function YP(n,e){let t=e;const r=n.length;for(let l=0;l<r;l++){const u=n.charAt(l);switch(u){case"\0":t+="";break;case V1:t+="";break;default:t+=u}}return t}function NT(n){return n+V1+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function vl(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function U1(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t){this.comparator=e,this.root=t||hr.EMPTY}insert(e,t){return new pi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hr.BLACK,null,null))}remove(e){return new pi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const l=this.comparator(e,r.key);if(l===0)return t+r.left.size;l<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ff(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ff(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ff(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ff(this.root,e,this.comparator,!0)}}class Ff{constructor(e,t,r,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=t?r(e.key,t):1,t&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hr{constructor(e,t,r,l,u){this.key=e,this.value=t,this.color=r??hr.RED,this.left=l??hr.EMPTY,this.right=u??hr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,l,u){return new hr(e??this.key,t??this.value,r??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let l=this;const u=r(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,t,r),null):u===0?l.copy(null,t,null,null,null):l.copy(null,null,null,null,l.right.insert(e,t,r)),l.fixUp()}removeMin(){if(this.left.isEmpty())return hr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,l=this;if(t(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,t),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),t(e,l.key)===0){if(l.right.isEmpty())return hr.EMPTY;r=l.right.min(),l=l.copy(r.key,r.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,t))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,hr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,hr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw vt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw vt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw vt(27949);return e+(this.isRed()?0:1)}}hr.EMPTY=null,hr.RED=!0,hr.BLACK=!1;hr.EMPTY=new class{constructor(){this.size=0}get key(){throw vt(57766)}get value(){throw vt(16141)}get color(){throw vt(16727)}get left(){throw vt(29726)}get right(){throw vt(36894)}copy(e,t,r,l,u){return this}insert(e,t,r){return new hr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e){this.comparator=e,this.data=new pi(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const l=r.getNext();if(this.comparator(l.key,e[1])>=0)return;t(l.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new RT(this.data.getIterator())}getIteratorFrom(e){return new RT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Zi)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const l=t.getNext().key,u=r.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Zi(this.comparator);return t.data=e,t}}class RT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e){this.fields=e,e.sort(fr.comparator)}static empty(){return new ys([])}unionWith(e){let t=new Zi(fr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ys(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pu(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new F1("Invalid base64 string: "+u):u}}(e);return new pr(t)}static fromUint8Array(e){const t=function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u}(e);return new pr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let l=0;l<t.length;l++)r[l]=t.charCodeAt(l);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return an(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pr.EMPTY_BYTE_STRING=new pr("");const QP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fl(n){if(un(!!n,39018),typeof n=="string"){let e=0;const t=QP.exec(n);if(un(!!t,46558,{timestamp:n}),t[1]){let l=t[1];l=(l+"000000000").substr(0,9),e=Number(l)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ii(n.seconds),nanos:Ii(n.nanos)}}function Ii(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ml(n){return typeof n=="string"?pr.fromBase64String(n):pr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1="server_timestamp",B1="__type__",H1="__previous_value__",q1="__local_write_time__";function q_(n){return(n?.mapValue?.fields||{})[B1]?.stringValue===z1}function sp(n){const e=n.mapValue.fields[H1];return q_(e)?sp(e):e}function oh(n){const e=fl(n.mapValue.fields[q1].timestampValue);return new ti(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e,t,r,l,u,f,y,_,v,w){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=y,this.longPollingOptions=_,this.useFetchStreams=v,this.isUsingEmulator=w}}const Mm="(default)";class lh{constructor(e,t){this.projectId=e,this.database=t||Mm}static empty(){return new lh("","")}get isDefaultDatabase(){return this.database===Mm}isEqual(e){return e instanceof lh&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1="__type__",JP="__max__",zf={mapValue:{}},G1="__vector__",km="value";function pl(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?q_(n)?4:tM(n)?9007199254740991:eM(n)?10:11:vt(28295,{value:n})}function ja(n,e){if(n===e)return!0;const t=pl(n);if(t!==pl(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return oh(n).isEqual(oh(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=fl(l.timestampValue),y=fl(u.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return ml(l.bytesValue).isEqual(ml(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return Ii(l.geoPointValue.latitude)===Ii(u.geoPointValue.latitude)&&Ii(l.geoPointValue.longitude)===Ii(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return Ii(l.integerValue)===Ii(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=Ii(l.doubleValue),y=Ii(u.doubleValue);return f===y?Pm(f)===Pm(y):isNaN(f)&&isNaN(y)}return!1}(n,e);case 9:return pu(n.arrayValue.values||[],e.arrayValue.values||[],ja);case 10:case 11:return function(l,u){const f=l.mapValue.fields||{},y=u.mapValue.fields||{};if(CT(f)!==CT(y))return!1;for(const _ in f)if(f.hasOwnProperty(_)&&(y[_]===void 0||!ja(f[_],y[_])))return!1;return!0}(n,e);default:return vt(52216,{left:n})}}function ch(n,e){return(n.values||[]).find(t=>ja(t,e))!==void 0}function gu(n,e){if(n===e)return 0;const t=pl(n),r=pl(e);if(t!==r)return an(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return an(n.booleanValue,e.booleanValue);case 2:return function(u,f){const y=Ii(u.integerValue||u.doubleValue),_=Ii(f.integerValue||f.doubleValue);return y<_?-1:y>_?1:y===_?0:isNaN(y)?isNaN(_)?0:-1:1}(n,e);case 3:return IT(n.timestampValue,e.timestampValue);case 4:return IT(oh(n),oh(e));case 5:return n_(n.stringValue,e.stringValue);case 6:return function(u,f){const y=ml(u),_=ml(f);return y.compareTo(_)}(n.bytesValue,e.bytesValue);case 7:return function(u,f){const y=u.split("/"),_=f.split("/");for(let v=0;v<y.length&&v<_.length;v++){const w=an(y[v],_[v]);if(w!==0)return w}return an(y.length,_.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,f){const y=an(Ii(u.latitude),Ii(f.latitude));return y!==0?y:an(Ii(u.longitude),Ii(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return PT(n.arrayValue,e.arrayValue);case 10:return function(u,f){const y=u.fields||{},_=f.fields||{},v=y[km]?.arrayValue,w=_[km]?.arrayValue,R=an(v?.values?.length||0,w?.values?.length||0);return R!==0?R:PT(v,w)}(n.mapValue,e.mapValue);case 11:return function(u,f){if(u===zf.mapValue&&f===zf.mapValue)return 0;if(u===zf.mapValue)return 1;if(f===zf.mapValue)return-1;const y=u.fields||{},_=Object.keys(y),v=f.fields||{},w=Object.keys(v);_.sort(),w.sort();for(let R=0;R<_.length&&R<w.length;++R){const I=n_(_[R],w[R]);if(I!==0)return I;const G=gu(y[_[R]],v[w[R]]);if(G!==0)return G}return an(_.length,w.length)}(n.mapValue,e.mapValue);default:throw vt(23264,{he:t})}}function IT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return an(n,e);const t=fl(n),r=fl(e),l=an(t.seconds,r.seconds);return l!==0?l:an(t.nanos,r.nanos)}function PT(n,e){const t=n.values||[],r=e.values||[];for(let l=0;l<t.length&&l<r.length;++l){const u=gu(t[l],r[l]);if(u)return u}return an(t.length,r.length)}function yu(n){return i_(n)}function i_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=fl(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ml(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return pt.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",l=!0;for(const u of t.values||[])l?l=!1:r+=",",r+=i_(u);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let l="{",u=!0;for(const f of r)u?u=!1:l+=",",l+=`${f}:${i_(t.fields[f])}`;return l+"}"}(n.mapValue):vt(61005,{value:n})}function ym(n){switch(pl(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=sp(n);return e?16+ym(e):16;case 5:return 2*n.stringValue.length;case 6:return ml(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((l,u)=>l+ym(u),0)}(n.arrayValue);case 10:case 11:return function(r){let l=0;return vl(r.fields,(u,f)=>{l+=u.length+ym(f)}),l}(n.mapValue);default:throw vt(13486,{value:n})}}function MT(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function r_(n){return!!n&&"integerValue"in n}function $_(n){return!!n&&"arrayValue"in n}function kT(n){return!!n&&"nullValue"in n}function OT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function _m(n){return!!n&&"mapValue"in n}function eM(n){return(n?.mapValue?.fields||{})[$1]?.stringValue===G1}function Yd(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return vl(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Yd(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Yd(n.arrayValue.values[t]);return e}return{...n}}function tM(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===JP}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e){this.value=e}static empty(){return new Ur({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!_m(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yd(t)}setAll(e){let t=fr.emptyPath(),r={},l=[];e.forEach((f,y)=>{if(!t.isImmediateParentOf(y)){const _=this.getFieldsMap(t);this.applyChanges(_,r,l),r={},l=[],t=y.popLast()}f?r[y.lastSegment()]=Yd(f):l.push(y.lastSegment())});const u=this.getFieldsMap(t);this.applyChanges(u,r,l)}delete(e){const t=this.field(e.popLast());_m(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ja(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let l=t.mapValue.fields[e.get(r)];_m(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=l),t=l}return t.mapValue.fields}applyChanges(e,t,r){vl(t,(l,u)=>e[l]=u);for(const l of r)delete e[l]}clone(){return new Ur(Yd(this.value))}}function Z1(n){const e=[];return vl(n.fields,(t,r)=>{const l=new fr([t]);if(_m(r)){const u=Z1(r.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)}),new ys(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t,r,l,u,f,y){this.key=e,this.documentType=t,this.version=r,this.readTime=l,this.createTime=u,this.data=f,this.documentState=y}static newInvalidDocument(e){return new ir(e,0,wt.min(),wt.min(),wt.min(),Ur.empty(),0)}static newFoundDocument(e,t,r,l){return new ir(e,1,t,wt.min(),r,l,0)}static newNoDocument(e,t){return new ir(e,2,t,wt.min(),wt.min(),Ur.empty(),0)}static newUnknownDocument(e,t){return new ir(e,3,t,wt.min(),wt.min(),Ur.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(wt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ur.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ur.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=wt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ir&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ir(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t){this.position=e,this.inclusive=t}}function DT(n,e,t){let r=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?r=pt.comparator(pt.fromName(f.referenceValue),t.key):r=gu(f,t.data.field(u.field)),u.dir==="desc"&&(r*=-1),r!==0)break}return r}function LT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ja(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t="asc"){this.field=e,this.dir=t}}function nM(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{}class Fi extends K1{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new rM(e,t,r):t==="array-contains"?new oM(e,r):t==="in"?new lM(e,r):t==="not-in"?new cM(e,r):t==="array-contains-any"?new uM(e,r):new Fi(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new sM(e,r):new aM(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gu(t,this.value)):t!==null&&pl(this.value)===pl(t)&&this.matchesComparison(gu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return vt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xs extends K1{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Xs(e,t)}matches(e){return W1(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function W1(n){return n.op==="and"}function Y1(n){return iM(n)&&W1(n)}function iM(n){for(const e of n.filters)if(e instanceof Xs)return!1;return!0}function s_(n){if(n instanceof Fi)return n.field.canonicalString()+n.op.toString()+yu(n.value);if(Y1(n))return n.filters.map(e=>s_(e)).join(",");{const e=n.filters.map(t=>s_(t)).join(",");return`${n.op}(${e})`}}function Q1(n,e){return n instanceof Fi?function(r,l){return l instanceof Fi&&r.op===l.op&&r.field.isEqual(l.field)&&ja(r.value,l.value)}(n,e):n instanceof Xs?function(r,l){return l instanceof Xs&&r.op===l.op&&r.filters.length===l.filters.length?r.filters.reduce((u,f,y)=>u&&Q1(f,l.filters[y]),!0):!1}(n,e):void vt(19439)}function X1(n){return n instanceof Fi?function(t){return`${t.field.canonicalString()} ${t.op} ${yu(t.value)}`}(n):n instanceof Xs?function(t){return t.op.toString()+" {"+t.getFilters().map(X1).join(" ,")+"}"}(n):"Filter"}class rM extends Fi{constructor(e,t,r){super(e,t,r),this.key=pt.fromName(r.referenceValue)}matches(e){const t=pt.comparator(e.key,this.key);return this.matchesComparison(t)}}class sM extends Fi{constructor(e,t){super(e,"in",t),this.keys=J1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aM extends Fi{constructor(e,t){super(e,"not-in",t),this.keys=J1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function J1(n,e){return(e.arrayValue?.values||[]).map(t=>pt.fromName(t.referenceValue))}class oM extends Fi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $_(t)&&ch(t.arrayValue,this.value)}}class lM extends Fi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ch(this.value.arrayValue,t)}}class cM extends Fi{constructor(e,t){super(e,"not-in",t)}matches(e){if(ch(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ch(this.value.arrayValue,t)}}class uM extends Fi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$_(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ch(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(e,t=null,r=[],l=[],u=null,f=null,y=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=l,this.limit=u,this.startAt=f,this.endAt=y,this.Te=null}}function VT(n,e=null,t=[],r=[],l=null,u=null,f=null){return new dM(n,e,t,r,l,u,f)}function G_(n){const e=It(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>s_(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(u){return u.field.canonicalString()+u.dir}(r)).join(","),Sh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>yu(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>yu(r)).join(",")),e.Te=t}return e.Te}function Z_(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nM(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Q1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!LT(n.startAt,e.startAt)&&LT(n.endAt,e.endAt)}function a_(n){return pt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t=null,r=[],l=[],u=null,f="F",y=null,_=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=l,this.limit=u,this.limitType=f,this.startAt=y,this.endAt=_,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function hM(n,e,t,r,l,u,f,y){return new Iu(n,e,t,r,l,u,f,y)}function ap(n){return new Iu(n)}function UT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function eS(n){return n.collectionGroup!==null}function Qd(n){const e=It(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const u of e.explicitOrderBy)e.Ie.push(u),t.add(u.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let y=new Zi(fr.comparator);return f.filters.forEach(_=>{_.getFlattenedFilters().forEach(v=>{v.isInequality()&&(y=y.add(v.field))})}),y})(e).forEach(u=>{t.has(u.canonicalString())||u.isKeyField()||e.Ie.push(new uh(u,r))}),t.has(fr.keyField().canonicalString())||e.Ie.push(new uh(fr.keyField(),r))}return e.Ie}function Ta(n){const e=It(n);return e.Ee||(e.Ee=fM(e,Qd(n))),e.Ee}function fM(n,e){if(n.limitType==="F")return VT(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new uh(l.field,u)});const t=n.endAt?new Om(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Om(n.startAt.position,n.startAt.inclusive):null;return VT(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function o_(n,e){const t=n.filters.concat([e]);return new Iu(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Dm(n,e,t){return new Iu(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function op(n,e){return Z_(Ta(n),Ta(e))&&n.limitType===e.limitType}function tS(n){return`${G_(Ta(n))}|lt:${n.limitType}`}function tu(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(l=>X1(l)).join(", ")}]`),Sh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(l=>yu(l)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(l=>yu(l)).join(",")),`Target(${r})`}(Ta(n))}; limitType=${n.limitType})`}function lp(n,e){return e.isFoundDocument()&&function(r,l){const u=l.key.path;return r.collectionGroup!==null?l.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(u):pt.isDocumentKey(r.path)?r.path.isEqual(u):r.path.isImmediateParentOf(u)}(n,e)&&function(r,l){for(const u of Qd(r))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(r,l){for(const u of r.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(r,l){return!(r.startAt&&!function(f,y,_){const v=DT(f,y,_);return f.inclusive?v<=0:v<0}(r.startAt,Qd(r),l)||r.endAt&&!function(f,y,_){const v=DT(f,y,_);return f.inclusive?v>=0:v>0}(r.endAt,Qd(r),l))}(n,e)}function mM(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function nS(n){return(e,t)=>{let r=!1;for(const l of Qd(n)){const u=pM(l,e,t);if(u!==0)return u;r=r||l.field.isKeyField()}return 0}}function pM(n,e,t){const r=n.field.isKeyField()?pt.comparator(e.key,t.key):function(u,f,y){const _=f.data.field(u),v=y.data.field(u);return _!==null&&v!==null?gu(_,v):vt(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return vt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[l,u]of r)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),l=this.inner[r];if(l===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,t]);l.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let l=0;l<r.length;l++)if(this.equalsFn(r[l][0],e))return r.length===1?delete this.inner[t]:r.splice(l,1),this.innerSize--,!0;return!1}forEach(e){vl(this.inner,(t,r)=>{for(const[l,u]of r)e(l,u)})}isEmpty(){return U1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gM=new pi(pt.comparator);function io(){return gM}const iS=new pi(pt.comparator);function Hd(...n){let e=iS;for(const t of n)e=e.insert(t.key,t);return e}function rS(n){let e=iS;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Jl(){return Xd()}function sS(){return Xd()}function Xd(){return new dc(n=>n.toString(),(n,e)=>n.isEqual(e))}const yM=new pi(pt.comparator),_M=new Zi(pt.comparator);function on(...n){let e=_M;for(const t of n)e=e.add(t);return e}const vM=new Zi(an);function bM(){return vM}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pm(e)?"-0":e}}function aS(n){return{integerValue:""+n}}function xM(n,e){return KP(e)?aS(e):K_(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(){this._=void 0}}function TM(n,e,t){return n instanceof dh?function(l,u){const f={fields:{[B1]:{stringValue:z1},[q1]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&q_(u)&&(u=sp(u)),u&&(f.fields[H1]=u),{mapValue:f}}(t,e):n instanceof hh?lS(n,e):n instanceof fh?cS(n,e):function(l,u){const f=oS(l,u),y=FT(f)+FT(l.Ae);return r_(f)&&r_(l.Ae)?aS(y):K_(l.serializer,y)}(n,e)}function wM(n,e,t){return n instanceof hh?lS(n,e):n instanceof fh?cS(n,e):t}function oS(n,e){return n instanceof Lm?function(r){return r_(r)||function(u){return!!u&&"doubleValue"in u}(r)}(e)?e:{integerValue:0}:null}class dh extends cp{}class hh extends cp{constructor(e){super(),this.elements=e}}function lS(n,e){const t=uS(e);for(const r of n.elements)t.some(l=>ja(l,r))||t.push(r);return{arrayValue:{values:t}}}class fh extends cp{constructor(e){super(),this.elements=e}}function cS(n,e){let t=uS(e);for(const r of n.elements)t=t.filter(l=>!ja(l,r));return{arrayValue:{values:t}}}class Lm extends cp{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function FT(n){return Ii(n.integerValue||n.doubleValue)}function uS(n){return $_(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(e,t){this.field=e,this.transform=t}}function SM(n,e){return n.field.isEqual(e.field)&&function(r,l){return r instanceof hh&&l instanceof hh||r instanceof fh&&l instanceof fh?pu(r.elements,l.elements,ja):r instanceof Lm&&l instanceof Lm?ja(r.Ae,l.Ae):r instanceof dh&&l instanceof dh}(n.transform,e.transform)}class jM{constructor(e,t){this.version=e,this.transformResults=t}}class Nr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Nr}static exists(e){return new Nr(void 0,e)}static updateTime(e){return new Nr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vm(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class up{}function dS(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new W_(n.key,Nr.none()):new jh(n.key,n.data,Nr.none());{const t=n.data,r=Ur.empty();let l=new Zi(fr.comparator);for(let u of e.fields)if(!l.has(u)){let f=t.field(u);f===null&&u.length>1&&(u=u.popLast(),f=t.field(u)),f===null?r.delete(u):r.set(u,f),l=l.add(u)}return new bl(n.key,r,new ys(l.toArray()),Nr.none())}}function AM(n,e,t){n instanceof jh?function(l,u,f){const y=l.value.clone(),_=BT(l.fieldTransforms,u,f.transformResults);y.setAll(_),u.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(n,e,t):n instanceof bl?function(l,u,f){if(!vm(l.precondition,u))return void u.convertToUnknownDocument(f.version);const y=BT(l.fieldTransforms,u,f.transformResults),_=u.data;_.setAll(hS(l)),_.setAll(y),u.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,t):function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,t)}function Jd(n,e,t,r){return n instanceof jh?function(u,f,y,_){if(!vm(u.precondition,f))return y;const v=u.value.clone(),w=HT(u.fieldTransforms,_,f);return v.setAll(w),f.convertToFoundDocument(f.version,v).setHasLocalMutations(),null}(n,e,t,r):n instanceof bl?function(u,f,y,_){if(!vm(u.precondition,f))return y;const v=HT(u.fieldTransforms,_,f),w=f.data;return w.setAll(hS(u)),w.setAll(v),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(R=>R.field))}(n,e,t,r):function(u,f,y){return vm(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y}(n,e,t)}function NM(n,e){let t=null;for(const r of n.fieldTransforms){const l=e.data.field(r.field),u=oS(r.transform,l||null);u!=null&&(t===null&&(t=Ur.empty()),t.set(r.field,u))}return t||null}function zT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,l){return r===void 0&&l===void 0||!(!r||!l)&&pu(r,l,(u,f)=>SM(u,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class jh extends up{constructor(e,t,r,l=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class bl extends up{constructor(e,t,r,l,u=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function hS(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function BT(n,e,t){const r=new Map;un(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let l=0;l<t.length;l++){const u=n[l],f=u.transform,y=e.data.field(u.field);r.set(u.field,wM(f,y,t[l]))}return r}function HT(n,e,t){const r=new Map;for(const l of n){const u=l.transform,f=t.data.field(l.field);r.set(l.field,TM(u,f,e))}return r}class W_ extends up{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fS extends up{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e,t,r,l){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=l}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&AM(u,e,r[l])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Jd(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Jd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=sS();return this.mutations.forEach(l=>{const u=e.get(l.key),f=u.overlayedDocument;let y=this.applyToLocalView(f,u.mutatedFields);y=t.has(l.key)?null:y;const _=dS(f,y);_!==null&&r.set(l.key,_),f.isValidDocument()||f.convertToNoDocument(wt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),on())}isEqual(e){return this.batchId===e.batchId&&pu(this.mutations,e.mutations,(t,r)=>zT(t,r))&&pu(this.baseMutations,e.baseMutations,(t,r)=>zT(t,r))}}class Y_{constructor(e,t,r,l){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=l}static from(e,t,r){un(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let l=function(){return yM}();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,r[f].version);return new Y_(e,t,r,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RM{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IM{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ui,cn;function mS(n){switch(n){case Pe.OK:return vt(64938);case Pe.CANCELLED:case Pe.UNKNOWN:case Pe.DEADLINE_EXCEEDED:case Pe.RESOURCE_EXHAUSTED:case Pe.INTERNAL:case Pe.UNAVAILABLE:case Pe.UNAUTHENTICATED:return!1;case Pe.INVALID_ARGUMENT:case Pe.NOT_FOUND:case Pe.ALREADY_EXISTS:case Pe.PERMISSION_DENIED:case Pe.FAILED_PRECONDITION:case Pe.ABORTED:case Pe.OUT_OF_RANGE:case Pe.UNIMPLEMENTED:case Pe.DATA_LOSS:return!0;default:return vt(15467,{code:n})}}function pS(n){if(n===void 0)return no("GRPC error has no .code"),Pe.UNKNOWN;switch(n){case Ui.OK:return Pe.OK;case Ui.CANCELLED:return Pe.CANCELLED;case Ui.UNKNOWN:return Pe.UNKNOWN;case Ui.DEADLINE_EXCEEDED:return Pe.DEADLINE_EXCEEDED;case Ui.RESOURCE_EXHAUSTED:return Pe.RESOURCE_EXHAUSTED;case Ui.INTERNAL:return Pe.INTERNAL;case Ui.UNAVAILABLE:return Pe.UNAVAILABLE;case Ui.UNAUTHENTICATED:return Pe.UNAUTHENTICATED;case Ui.INVALID_ARGUMENT:return Pe.INVALID_ARGUMENT;case Ui.NOT_FOUND:return Pe.NOT_FOUND;case Ui.ALREADY_EXISTS:return Pe.ALREADY_EXISTS;case Ui.PERMISSION_DENIED:return Pe.PERMISSION_DENIED;case Ui.FAILED_PRECONDITION:return Pe.FAILED_PRECONDITION;case Ui.ABORTED:return Pe.ABORTED;case Ui.OUT_OF_RANGE:return Pe.OUT_OF_RANGE;case Ui.UNIMPLEMENTED:return Pe.UNIMPLEMENTED;case Ui.DATA_LOSS:return Pe.DATA_LOSS;default:return vt(39323,{code:n})}}(cn=Ui||(Ui={}))[cn.OK=0]="OK",cn[cn.CANCELLED=1]="CANCELLED",cn[cn.UNKNOWN=2]="UNKNOWN",cn[cn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",cn[cn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",cn[cn.NOT_FOUND=5]="NOT_FOUND",cn[cn.ALREADY_EXISTS=6]="ALREADY_EXISTS",cn[cn.PERMISSION_DENIED=7]="PERMISSION_DENIED",cn[cn.UNAUTHENTICATED=16]="UNAUTHENTICATED",cn[cn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",cn[cn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",cn[cn.ABORTED=10]="ABORTED",cn[cn.OUT_OF_RANGE=11]="OUT_OF_RANGE",cn[cn.UNIMPLEMENTED=12]="UNIMPLEMENTED",cn[cn.INTERNAL=13]="INTERNAL",cn[cn.UNAVAILABLE=14]="UNAVAILABLE",cn[cn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PM(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MM=new al([4294967295,4294967295],0);function qT(n){const e=PM().encode(n),t=new N1;return t.update(e),new Uint8Array(t.digest())}function $T(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new al([t,r],0),new al([l,u],0)]}class Q_{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new qd(`Invalid padding: ${t}`);if(r<0)throw new qd(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new qd(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new qd(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=al.fromNumber(this.ge)}ye(e,t,r){let l=e.add(t.multiply(al.fromNumber(r)));return l.compare(MM)===1&&(l=new al([l.getBits(0),l.getBits(1)],0)),l.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=qT(e),[r,l]=$T(t);for(let u=0;u<this.hashCount;u++){const f=this.ye(r,l,u);if(!this.we(f))return!1}return!0}static create(e,t,r){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new Q_(u,l,t);return r.forEach(y=>f.insert(y)),f}insert(e){if(this.ge===0)return;const t=qT(e),[r,l]=$T(t);for(let u=0;u<this.hashCount;u++){const f=this.ye(r,l,u);this.Se(f)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class qd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e,t,r,l,u){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const l=new Map;return l.set(e,Ah.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new dp(wt.min(),l,new pi(an),io(),on())}}class Ah{constructor(e,t,r,l,u){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ah(r,t,on(),on(),on())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm{constructor(e,t,r,l){this.be=e,this.removedTargetIds=t,this.key=r,this.De=l}}class gS{constructor(e,t){this.targetId=e,this.Ce=t}}class yS{constructor(e,t,r=pr.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=l}}class GT{constructor(){this.ve=0,this.Fe=ZT(),this.Me=pr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=on(),t=on(),r=on();return this.Fe.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:t=t.add(l);break;case 1:r=r.add(l);break;default:vt(38017,{changeType:u})}}),new Ah(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=ZT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,un(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class kM{constructor(e){this.Ge=e,this.ze=new Map,this.je=io(),this.Je=Bf(),this.He=Bf(),this.Ye=new pi(an)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:vt(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,l)=>{this.rt(l)&&t(l)})}st(e){const t=e.targetId,r=e.Ce.count,l=this.ot(t);if(l){const u=l.target;if(a_(u))if(r===0){const f=new pt(u.path);this.et(t,f,ir.newNoDocument(f,wt.min()))}else un(r===1,20013,{expectedCount:r});else{const f=this._t(t);if(f!==r){const y=this.ut(e),_=y?this.ct(y,e,f):1;if(_!==0){this.it(t);const v=_===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,v)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:l=0},hashCount:u=0}=t;let f,y;try{f=ml(r).toUint8Array()}catch(_){if(_ instanceof F1)return mu("Decoding the base64 bloom filter in existence filter failed ("+_.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw _}try{y=new Q_(f,l,u)}catch(_){return mu(_ instanceof qd?"BloomFilter error: ":"Applying bloom filter failed: ",_),null}return y.ge===0?null:y}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let l=0;return r.forEach(u=>{const f=this.Ge.ht(),y=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(y)||(this.et(t,u,null),l++)}),l}Tt(e){const t=new Map;this.ze.forEach((u,f)=>{const y=this.ot(f);if(y){if(u.current&&a_(y.target)){const _=new pt(y.target.path);this.It(_).has(f)||this.Et(f,_)||this.et(f,_,ir.newNoDocument(_,e))}u.Be&&(t.set(f,u.ke()),u.qe())}});let r=on();this.He.forEach((u,f)=>{let y=!0;f.forEachWhile(_=>{const v=this.ot(_);return!v||v.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(r=r.add(u))}),this.je.forEach((u,f)=>f.setReadTime(e));const l=new dp(e,t,this.Ye,this.je,r);return this.je=io(),this.Je=Bf(),this.He=Bf(),this.Ye=new pi(an),l}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const l=this.nt(e);this.Et(e,t)?l.Qe(t,1):l.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new GT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Zi(an),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Zi(an),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||tt("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new GT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Bf(){return new pi(pt.comparator)}function ZT(){return new pi(pt.comparator)}const OM={asc:"ASCENDING",desc:"DESCENDING"},DM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},LM={and:"AND",or:"OR"};class VM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function l_(n,e){return n.useProto3Json||Sh(e)?e:{value:e}}function Vm(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _S(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function UM(n,e){return Vm(n,e.toTimestamp())}function vs(n){return un(!!n,49232),wt.fromTimestamp(function(t){const r=fl(t);return new ti(r.seconds,r.nanos)}(n))}function X_(n,e){return c_(n,e).canonicalString()}function c_(n,e){const t=function(l){return new On(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?t:t.child(e)}function vS(n){const e=On.fromString(n);return un(SS(e),10190,{key:e.toString()}),e}function Um(n,e){return X_(n.databaseId,e.path)}function eh(n,e){const t=vS(e);if(t.get(1)!==n.databaseId.projectId)throw new $e(Pe.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new $e(Pe.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new pt(xS(t))}function bS(n,e){return X_(n.databaseId,e)}function FM(n){const e=vS(n);return e.length===4?On.emptyPath():xS(e)}function u_(n){return new On(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xS(n){return un(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function KT(n,e,t){return{name:Um(n,e),fields:t.value.mapValue.fields}}function zM(n,e){return"found"in e?function(r,l){un(!!l.found,43571),l.found.name,l.found.updateTime;const u=eh(r,l.found.name),f=vs(l.found.updateTime),y=l.found.createTime?vs(l.found.createTime):wt.min(),_=new Ur({mapValue:{fields:l.found.fields}});return ir.newFoundDocument(u,f,y,_)}(n,e):"missing"in e?function(r,l){un(!!l.missing,3894),un(!!l.readTime,22933);const u=eh(r,l.missing),f=vs(l.readTime);return ir.newNoDocument(u,f)}(n,e):vt(7234,{result:e})}function BM(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(v){return v==="NO_CHANGE"?0:v==="ADD"?1:v==="REMOVE"?2:v==="CURRENT"?3:v==="RESET"?4:vt(39313,{state:v})}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(v,w){return v.useProto3Json?(un(w===void 0||typeof w=="string",58123),pr.fromBase64String(w||"")):(un(w===void 0||w instanceof Buffer||w instanceof Uint8Array,16193),pr.fromUint8Array(w||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,y=f&&function(v){const w=v.code===void 0?Pe.UNKNOWN:pS(v.code);return new $e(w,v.message||"")}(f);t=new yS(r,l,u,y||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const l=eh(n,r.document.name),u=vs(r.document.updateTime),f=r.document.createTime?vs(r.document.createTime):wt.min(),y=new Ur({mapValue:{fields:r.document.fields}}),_=ir.newFoundDocument(l,u,f,y),v=r.targetIds||[],w=r.removedTargetIds||[];t=new bm(v,w,_.key,_)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const l=eh(n,r.document),u=r.readTime?vs(r.readTime):wt.min(),f=ir.newNoDocument(l,u),y=r.removedTargetIds||[];t=new bm([],y,f.key,f)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const l=eh(n,r.document),u=r.removedTargetIds||[];t=new bm([],u,l,null)}else{if(!("filter"in e))return vt(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:l=0,unchangedNames:u}=r,f=new IM(l,u),y=r.targetId;t=new gS(y,f)}}return t}function TS(n,e){let t;if(e instanceof jh)t={update:KT(n,e.key,e.value)};else if(e instanceof W_)t={delete:Um(n,e.key)};else if(e instanceof bl)t={update:KT(n,e.key,e.data),updateMask:QM(e.fieldMask)};else{if(!(e instanceof fS))return vt(16599,{Vt:e.type});t={verify:Um(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(u,f){const y=f.transform;if(y instanceof dh)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof hh)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof fh)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Lm)return{fieldPath:f.field.canonicalString(),increment:y.Ae};throw vt(20930,{transform:f.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:UM(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:vt(27497)}(n,e.precondition)),t}function HM(n,e){return n&&n.length>0?(un(e!==void 0,14353),n.map(t=>function(l,u){let f=l.updateTime?vs(l.updateTime):vs(u);return f.isEqual(wt.min())&&(f=vs(u)),new jM(f,l.transformResults||[])}(t,e))):[]}function qM(n,e){return{documents:[bS(n,e.path)]}}function $M(n,e){const t={structuredQuery:{}},r=e.path;let l;e.collectionGroup!==null?(l=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=bS(n,l);const u=function(v){if(v.length!==0)return ES(Xs.create(v,"and"))}(e.filters);u&&(t.structuredQuery.where=u);const f=function(v){if(v.length!==0)return v.map(w=>function(I){return{field:nu(I.field),direction:KM(I.dir)}}(w))}(e.orderBy);f&&(t.structuredQuery.orderBy=f);const y=l_(n,e.limit);return y!==null&&(t.structuredQuery.limit=y),e.startAt&&(t.structuredQuery.startAt=function(v){return{before:v.inclusive,values:v.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(v){return{before:!v.inclusive,values:v.position}}(e.endAt)),{ft:t,parent:l}}function GM(n){let e=FM(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let l=null;if(r>0){un(r===1,65062);const w=t.from[0];w.allDescendants?l=w.collectionId:e=e.child(w.collectionId)}let u=[];t.where&&(u=function(R){const I=wS(R);return I instanceof Xs&&Y1(I)?I.getFilters():[I]}(t.where));let f=[];t.orderBy&&(f=function(R){return R.map(I=>function(H){return new uh(iu(H.field),function(F){switch(F){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(H.direction))}(I))}(t.orderBy));let y=null;t.limit&&(y=function(R){let I;return I=typeof R=="object"?R.value:R,Sh(I)?null:I}(t.limit));let _=null;t.startAt&&(_=function(R){const I=!!R.before,G=R.values||[];return new Om(G,I)}(t.startAt));let v=null;return t.endAt&&(v=function(R){const I=!R.before,G=R.values||[];return new Om(G,I)}(t.endAt)),hM(e,l,f,u,y,"F",_,v)}function ZM(n,e){const t=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return vt(28987,{purpose:l})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wS(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=iu(t.unaryFilter.field);return Fi.create(r,"==",{doubleValue:NaN});case"IS_NULL":const l=iu(t.unaryFilter.field);return Fi.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=iu(t.unaryFilter.field);return Fi.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=iu(t.unaryFilter.field);return Fi.create(f,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return vt(61313);default:return vt(60726)}}(n):n.fieldFilter!==void 0?function(t){return Fi.create(iu(t.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return vt(58110);default:return vt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Xs.create(t.compositeFilter.filters.map(r=>wS(r)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return vt(1026)}}(t.compositeFilter.op))}(n):vt(30097,{filter:n})}function KM(n){return OM[n]}function WM(n){return DM[n]}function YM(n){return LM[n]}function nu(n){return{fieldPath:n.canonicalString()}}function iu(n){return fr.fromServerFormat(n.fieldPath)}function ES(n){return n instanceof Fi?function(t){if(t.op==="=="){if(OT(t.value))return{unaryFilter:{field:nu(t.field),op:"IS_NAN"}};if(kT(t.value))return{unaryFilter:{field:nu(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(OT(t.value))return{unaryFilter:{field:nu(t.field),op:"IS_NOT_NAN"}};if(kT(t.value))return{unaryFilter:{field:nu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nu(t.field),op:WM(t.op),value:t.value}}}(n):n instanceof Xs?function(t){const r=t.getFilters().map(l=>ES(l));return r.length===1?r[0]:{compositeFilter:{op:YM(t.op),filters:r}}}(n):vt(54877,{filter:n})}function QM(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function SS(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,t,r,l,u=wt.min(),f=wt.min(),y=pr.EMPTY_BYTE_STRING,_=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=y,this.expectedCount=_}withSequenceNumber(e){return new il(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XM{constructor(e){this.yt=e}}function JM(n){const e=GM({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Dm(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(){this.Cn=new tk}addToCollectionParentIndex(e,t){return this.Cn.add(t),Le.resolve()}getCollectionParents(e,t){return Le.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Le.resolve()}deleteFieldIndex(e,t){return Le.resolve()}deleteAllFieldIndexes(e){return Le.resolve()}createTargetIndexes(e,t){return Le.resolve()}getDocumentsMatchingTarget(e,t){return Le.resolve(null)}getIndexType(e,t){return Le.resolve(0)}getFieldIndexes(e,t){return Le.resolve([])}getNextCollectionGroupToUpdate(e){return Le.resolve(null)}getMinOffset(e,t){return Le.resolve(hl.min())}getMinOffsetFromCollectionGroup(e,t){return Le.resolve(hl.min())}updateCollectionGroup(e,t,r){return Le.resolve()}updateIndexEntries(e,t){return Le.resolve()}}class tk{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),l=this.index[t]||new Zi(On.comparator),u=!l.has(r);return this.index[t]=l.add(r),u}has(e){const t=e.lastSegment(),r=e.popLast(),l=this.index[t];return l&&l.has(r)}getEntries(e){return(this.index[e]||new Zi(On.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jS=41943040;class Wr{static withCacheSize(e){return new Wr(e,Wr.DEFAULT_COLLECTION_PERCENTILE,Wr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Wr.DEFAULT_COLLECTION_PERCENTILE=10,Wr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wr.DEFAULT=new Wr(jS,Wr.DEFAULT_COLLECTION_PERCENTILE,Wr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wr.DISABLED=new Wr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new _u(0)}static cr(){return new _u(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YT="LruGarbageCollector",nk=1048576;function QT([n,e],[t,r]){const l=an(n,t);return l===0?an(e,r):l}class ik{constructor(e){this.Ir=e,this.buffer=new Zi(QT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();QT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rk{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){tt(YT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ru(t)?tt(YT,"Ignoring IndexedDB error during garbage collection: ",t):await Cu(t)}await this.Vr(3e5)})}}class sk{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return Le.resolve(rp.ce);const r=new ik(t);return this.mr.forEachTarget(e,l=>r.Ar(l.sequenceNumber)).next(()=>this.mr.pr(e,l=>r.Ar(l))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(tt("LruGarbageCollector","Garbage collection skipped; disabled"),Le.resolve(WT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tt("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),WT):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,l,u,f,y,_,v;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(R=>(R>this.params.maximumSequenceNumbersToCollect?(tt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${R}`),l=this.params.maximumSequenceNumbersToCollect):l=R,f=Date.now(),this.nthSequenceNumber(e,l))).next(R=>(r=R,y=Date.now(),this.removeTargets(e,r,t))).next(R=>(u=R,_=Date.now(),this.removeOrphanedDocuments(e,r))).next(R=>(v=Date.now(),eu()<=sn.DEBUG&&tt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(y-f)+`ms
	Removed ${u} targets in `+(_-y)+`ms
	Removed ${R} documents in `+(v-_)+`ms
Total Duration: ${v-w}ms`),Le.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:R})))}}function ak(n,e){return new sk(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(){this.changes=new dc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ir.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?Le.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,t,r,l){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=l}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(l=>(r=l,this.remoteDocumentCache.getEntry(e,t))).next(l=>(r!==null&&Jd(r.mutation,l,ys.empty(),ti.now()),l))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,on()).next(()=>r))}getLocalViewOfDocuments(e,t,r=on()){const l=Jl();return this.populateOverlays(e,l,t).next(()=>this.computeViews(e,t,l,r).next(u=>{let f=Hd();return u.forEach((y,_)=>{f=f.insert(y,_.overlayedDocument)}),f}))}getOverlayedDocuments(e,t){const r=Jl();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,on()))}populateOverlays(e,t,r){const l=[];return r.forEach(u=>{t.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((f,y)=>{t.set(f,y)})})}computeViews(e,t,r,l){let u=io();const f=Xd(),y=function(){return Xd()}();return t.forEach((_,v)=>{const w=r.get(v.key);l.has(v.key)&&(w===void 0||w.mutation instanceof bl)?u=u.insert(v.key,v):w!==void 0?(f.set(v.key,w.mutation.getFieldMask()),Jd(w.mutation,v,w.mutation.getFieldMask(),ti.now())):f.set(v.key,ys.empty())}),this.recalculateAndSaveOverlays(e,u).next(_=>(_.forEach((v,w)=>f.set(v,w)),t.forEach((v,w)=>y.set(v,new lk(w,f.get(v)??null))),y))}recalculateAndSaveOverlays(e,t){const r=Xd();let l=new pi((f,y)=>f-y),u=on();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(f=>{for(const y of f)y.keys().forEach(_=>{const v=t.get(_);if(v===null)return;let w=r.get(_)||ys.empty();w=y.applyToLocalView(v,w),r.set(_,w);const R=(l.get(y.batchId)||on()).add(_);l=l.insert(y.batchId,R)})}).next(()=>{const f=[],y=l.getReverseIterator();for(;y.hasNext();){const _=y.getNext(),v=_.key,w=_.value,R=sS();w.forEach(I=>{if(!u.has(I)){const G=dS(t.get(I),r.get(I));G!==null&&R.set(I,G),u=u.add(I)}}),f.push(this.documentOverlayCache.saveOverlays(e,v,R))}return Le.waitFor(f)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,l){return function(f){return pt.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):eS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,l):this.getDocumentsMatchingCollectionQuery(e,t,r,l)}getNextDocuments(e,t,r,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,l).next(u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,l-u.size):Le.resolve(Jl());let y=ah,_=u;return f.next(v=>Le.forEach(v,(w,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),u.get(w)?Le.resolve():this.remoteDocumentCache.getEntry(e,w).next(I=>{_=_.insert(w,I)}))).next(()=>this.populateOverlays(e,v,u)).next(()=>this.computeViews(e,_,v,on())).next(w=>({batchId:y,changes:rS(w)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new pt(t)).next(r=>{let l=Hd();return r.isFoundDocument()&&(l=l.insert(r.key,r)),l})}getDocumentsMatchingCollectionGroupQuery(e,t,r,l){const u=t.collectionGroup;let f=Hd();return this.indexManager.getCollectionParents(e,u).next(y=>Le.forEach(y,_=>{const v=function(R,I){return new Iu(I,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)}(t,_.child(u));return this.getDocumentsMatchingCollectionQuery(e,v,r,l).next(w=>{w.forEach((R,I)=>{f=f.insert(R,I)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,t,r,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,u,l))).next(f=>{u.forEach((_,v)=>{const w=v.getKey();f.get(w)===null&&(f=f.insert(w,ir.newInvalidDocument(w)))});let y=Hd();return f.forEach((_,v)=>{const w=u.get(_);w!==void 0&&Jd(w.mutation,v,ys.empty(),ti.now()),lp(t,v)&&(y=y.insert(_,v))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Le.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(l){return{id:l.id,version:l.version,createTime:vs(l.createTime)}}(t)),Le.resolve()}getNamedQuery(e,t){return Le.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(l){return{name:l.name,query:JM(l.bundledQuery),readTime:vs(l.readTime)}}(t)),Le.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(){this.overlays=new pi(pt.comparator),this.qr=new Map}getOverlay(e,t){return Le.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Jl();return Le.forEach(t,l=>this.getOverlay(e,l).next(u=>{u!==null&&r.set(l,u)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((l,u)=>{this.St(e,t,u)}),Le.resolve()}removeOverlaysForBatchId(e,t,r){const l=this.qr.get(r);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.qr.delete(r)),Le.resolve()}getOverlaysForCollection(e,t,r){const l=Jl(),u=t.length+1,f=new pt(t.child("")),y=this.overlays.getIteratorFrom(f);for(;y.hasNext();){const _=y.getNext().value,v=_.getKey();if(!t.isPrefixOf(v.path))break;v.path.length===u&&_.largestBatchId>r&&l.set(_.getKey(),_)}return Le.resolve(l)}getOverlaysForCollectionGroup(e,t,r,l){let u=new pi((v,w)=>v-w);const f=this.overlays.getIterator();for(;f.hasNext();){const v=f.getNext().value;if(v.getKey().getCollectionGroup()===t&&v.largestBatchId>r){let w=u.get(v.largestBatchId);w===null&&(w=Jl(),u=u.insert(v.largestBatchId,w)),w.set(v.getKey(),v)}}const y=Jl(),_=u.getIterator();for(;_.hasNext()&&(_.getNext().value.forEach((v,w)=>y.set(v,w)),!(y.size()>=l)););return Le.resolve(y)}St(e,t,r){const l=this.overlays.get(r.key);if(l!==null){const f=this.qr.get(l.largestBatchId).delete(r.key);this.qr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(r.key,new RM(t,r));let u=this.qr.get(t);u===void 0&&(u=on(),this.qr.set(t,u)),this.qr.set(t,u.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(){this.sessionToken=pr.EMPTY_BYTE_STRING}getSessionToken(e){return Le.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Le.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(){this.Qr=new Zi(nr.$r),this.Ur=new Zi(nr.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new nr(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new nr(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new pt(new On([])),r=new nr(t,e),l=new nr(t,e+1),u=[];return this.Ur.forEachInRange([r,l],f=>{this.Gr(f),u.push(f.key)}),u}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new pt(new On([])),r=new nr(t,e),l=new nr(t,e+1);let u=on();return this.Ur.forEachInRange([r,l],f=>{u=u.add(f.key)}),u}containsKey(e){const t=new nr(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class nr{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return pt.comparator(e.key,t.key)||an(e.Yr,t.Yr)}static Kr(e,t){return an(e.Yr,t.Yr)||pt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Zi(nr.$r)}checkEmpty(e){return Le.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,l){const u=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new CM(u,t,r,l);this.mutationQueue.push(f);for(const y of l)this.Zr=this.Zr.add(new nr(y.key,u)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return Le.resolve(f)}lookupMutationBatch(e,t){return Le.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,l=this.ei(r),u=l<0?0:l;return Le.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Le.resolve(this.mutationQueue.length===0?H_:this.tr-1)}getAllMutationBatches(e){return Le.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new nr(t,0),l=new nr(t,Number.POSITIVE_INFINITY),u=[];return this.Zr.forEachInRange([r,l],f=>{const y=this.Xr(f.Yr);u.push(y)}),Le.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Zi(an);return t.forEach(l=>{const u=new nr(l,0),f=new nr(l,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([u,f],y=>{r=r.add(y.Yr)})}),Le.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,l=r.length+1;let u=r;pt.isDocumentKey(u)||(u=u.child(""));const f=new nr(new pt(u),0);let y=new Zi(an);return this.Zr.forEachWhile(_=>{const v=_.key.path;return!!r.isPrefixOf(v)&&(v.length===l&&(y=y.add(_.Yr)),!0)},f),Le.resolve(this.ti(y))}ti(e){const t=[];return e.forEach(r=>{const l=this.Xr(r);l!==null&&t.push(l)}),t}removeMutationBatch(e,t){un(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Le.forEach(t.mutations,l=>{const u=new nr(l.key,t.batchId);return r=r.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new nr(t,0),l=this.Zr.firstAfterOrEqual(r);return Le.resolve(t.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Le.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e){this.ri=e,this.docs=function(){return new pi(pt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,l=this.docs.get(r),u=l?l.size:0,f=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return Le.resolve(r?r.document.mutableCopy():ir.newInvalidDocument(t))}getEntries(e,t){let r=io();return t.forEach(l=>{const u=this.docs.get(l);r=r.insert(l,u?u.document.mutableCopy():ir.newInvalidDocument(l))}),Le.resolve(r)}getDocumentsMatchingQuery(e,t,r,l){let u=io();const f=t.path,y=new pt(f.child("__id-9223372036854775808__")),_=this.docs.getIteratorFrom(y);for(;_.hasNext();){const{key:v,value:{document:w}}=_.getNext();if(!f.isPrefixOf(v.path))break;v.path.length>f.length+1||qP(HP(w),r)<=0||(l.has(w.key)||lp(t,w))&&(u=u.insert(w.key,w.mutableCopy()))}return Le.resolve(u)}getAllFromCollectionGroup(e,t,r,l){vt(9500)}ii(e,t){return Le.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new pk(this)}getSize(e){return Le.resolve(this.size)}}class pk extends ok{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,l)=>{l.isValidDocument()?t.push(this.Nr.addEntry(e,l)):this.Nr.removeEntry(r)}),Le.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e){this.persistence=e,this.si=new dc(t=>G_(t),Z_),this.lastRemoteSnapshotVersion=wt.min(),this.highestTargetId=0,this.oi=0,this._i=new J_,this.targetCount=0,this.ai=_u.ur()}forEachTarget(e,t){return this.si.forEach((r,l)=>t(l)),Le.resolve()}getLastRemoteSnapshotVersion(e){return Le.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Le.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Le.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),Le.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new _u(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Le.resolve()}updateTargetData(e,t){return this.Pr(t),Le.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Le.resolve()}removeTargets(e,t,r){let l=0;const u=[];return this.si.forEach((f,y)=>{y.sequenceNumber<=t&&r.get(y.targetId)===null&&(this.si.delete(f),u.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)}),Le.waitFor(u).next(()=>l)}getTargetCount(e){return Le.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return Le.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),Le.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const l=this.persistence.referenceDelegate,u=[];return l&&t.forEach(f=>{u.push(l.markPotentiallyOrphaned(e,f))}),Le.waitFor(u)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Le.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return Le.resolve(r)}containsKey(e,t){return Le.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{constructor(e,t){this.ui={},this.overlays={},this.ci=new rp(0),this.li=!1,this.li=!0,this.hi=new hk,this.referenceDelegate=e(this),this.Pi=new gk(this),this.indexManager=new ek,this.remoteDocumentCache=function(l){return new mk(l)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new XM(t),this.Ii=new uk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new fk(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){tt("MemoryPersistence","Starting transaction:",e);const l=new yk(this.ci.next());return this.referenceDelegate.Ei(),r(l).next(u=>this.referenceDelegate.di(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}Ai(e,t){return Le.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class yk extends GP{constructor(e){super(),this.currentSequenceNumber=e}}class ev{constructor(e){this.persistence=e,this.Ri=new J_,this.Vi=null}static mi(e){return new ev(e)}get fi(){if(this.Vi)return this.Vi;throw vt(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),Le.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),Le.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Le.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(l=>this.fi.add(l.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(l=>{l.forEach(u=>this.fi.add(u.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Le.forEach(this.fi,r=>{const l=pt.fromPath(r);return this.gi(e,l).next(u=>{u||t.removeEntry(l,wt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Le.or([()=>Le.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Fm{constructor(e,t){this.persistence=e,this.pi=new dc(r=>WP(r.path),(r,l)=>r.isEqual(l)),this.garbageCollector=ak(this,t)}static mi(e,t){return new Fm(e,t)}Ei(){}di(e){return Le.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(l=>r+l))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return Le.forEach(this.pi,(r,l)=>this.br(e,r,l).next(u=>u?Le.resolve():t(l)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.ii(e,f=>this.br(e,f,t).next(y=>{y||(r++,u.removeEntry(f,wt.min()))})).next(()=>u.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Le.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),Le.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),Le.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Le.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ym(e.data.value)),t}br(e,t,r){return Le.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const l=this.pi.get(t);return Le.resolve(l!==void 0&&l>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e,t,r,l){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=l}static As(e,t){let r=on(),l=on();for(const u of t.docChanges)switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new tv(e,t.fromCache,r,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return JC()?8:ZP(Cr())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,l){const u={result:null};return this.ys(e,t).next(f=>{u.result=f}).next(()=>{if(!u.result)return this.ws(e,t,l,r).next(f=>{u.result=f})}).next(()=>{if(u.result)return;const f=new _k;return this.Ss(e,t,f).next(y=>{if(u.result=y,this.Vs)return this.bs(e,t,f,y.size)})}).next(()=>u.result)}bs(e,t,r,l){return r.documentReadCount<this.fs?(eu()<=sn.DEBUG&&tt("QueryEngine","SDK will not create cache indexes for query:",tu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Le.resolve()):(eu()<=sn.DEBUG&&tt("QueryEngine","Query:",tu(t),"scans",r.documentReadCount,"local documents and returns",l,"documents as results."),r.documentReadCount>this.gs*l?(eu()<=sn.DEBUG&&tt("QueryEngine","The SDK decides to create cache indexes for query:",tu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ta(t))):Le.resolve())}ys(e,t){if(UT(t))return Le.resolve(null);let r=Ta(t);return this.indexManager.getIndexType(e,r).next(l=>l===0?null:(t.limit!==null&&l===1&&(t=Dm(t,null,"F"),r=Ta(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(u=>{const f=on(...u);return this.ps.getDocuments(e,f).next(y=>this.indexManager.getMinOffset(e,r).next(_=>{const v=this.Ds(t,y);return this.Cs(t,v,f,_.readTime)?this.ys(e,Dm(t,null,"F")):this.vs(e,v,t,_)}))})))}ws(e,t,r,l){return UT(t)||l.isEqual(wt.min())?Le.resolve(null):this.ps.getDocuments(e,r).next(u=>{const f=this.Ds(t,u);return this.Cs(t,f,r,l)?Le.resolve(null):(eu()<=sn.DEBUG&&tt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),tu(t)),this.vs(e,f,t,BP(l,ah)).next(y=>y))})}Ds(e,t){let r=new Zi(nS(e));return t.forEach((l,u)=>{lp(e,u)&&(r=r.add(u))}),r}Cs(e,t,r,l){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const u=e.limitType==="F"?t.last():t.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}Ss(e,t,r){return eu()<=sn.DEBUG&&tt("QueryEngine","Using full collection scan to execute query:",tu(t)),this.ps.getDocumentsMatchingQuery(e,t,hl.min(),r)}vs(e,t,r,l){return this.ps.getDocumentsMatchingQuery(e,r,l).next(u=>(t.forEach(f=>{u=u.insert(f.key,f)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nv="LocalStore",bk=3e8;class xk{constructor(e,t,r,l){this.persistence=e,this.Fs=t,this.serializer=l,this.Ms=new pi(an),this.xs=new dc(u=>G_(u),Z_),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ck(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Tk(n,e,t,r){return new xk(n,e,t,r)}async function NS(n,e){const t=It(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let l;return t.mutationQueue.getAllMutationBatches(r).next(u=>(l=u,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(u=>{const f=[],y=[];let _=on();for(const v of l){f.push(v.batchId);for(const w of v.mutations)_=_.add(w.key)}for(const v of u){y.push(v.batchId);for(const w of v.mutations)_=_.add(w.key)}return t.localDocuments.getDocuments(r,_).next(v=>({Ls:v,removedBatchIds:f,addedBatchIds:y}))})})}function wk(n,e){const t=It(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const l=e.batch.keys(),u=t.Ns.newChangeBuffer({trackRemovals:!0});return function(y,_,v,w){const R=v.batch,I=R.keys();let G=Le.resolve();return I.forEach(H=>{G=G.next(()=>w.getEntry(_,H)).next(Z=>{const F=v.docVersions.get(H);un(F!==null,48541),Z.version.compareTo(F)<0&&(R.applyToRemoteDocument(Z,v),Z.isValidDocument()&&(Z.setReadTime(v.commitVersion),w.addEntry(Z)))})}),G.next(()=>y.mutationQueue.removeMutationBatch(_,R))}(t,r,e,u).next(()=>u.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,l,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(y){let _=on();for(let v=0;v<y.mutationResults.length;++v)y.mutationResults[v].transformResults.length>0&&(_=_.add(y.batch.mutations[v].key));return _}(e))).next(()=>t.localDocuments.getDocuments(r,l))})}function CS(n){const e=It(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function Ek(n,e){const t=It(n),r=e.snapshotVersion;let l=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const f=t.Ns.newChangeBuffer({trackRemovals:!0});l=t.Ms;const y=[];e.targetChanges.forEach((w,R)=>{const I=l.get(R);if(!I)return;y.push(t.Pi.removeMatchingKeys(u,w.removedDocuments,R).next(()=>t.Pi.addMatchingKeys(u,w.addedDocuments,R)));let G=I.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?G=G.withResumeToken(pr.EMPTY_BYTE_STRING,wt.min()).withLastLimboFreeSnapshotVersion(wt.min()):w.resumeToken.approximateByteSize()>0&&(G=G.withResumeToken(w.resumeToken,r)),l=l.insert(R,G),function(Z,F,Q){return Z.resumeToken.approximateByteSize()===0||F.snapshotVersion.toMicroseconds()-Z.snapshotVersion.toMicroseconds()>=bk?!0:Q.addedDocuments.size+Q.modifiedDocuments.size+Q.removedDocuments.size>0}(I,G,w)&&y.push(t.Pi.updateTargetData(u,G))});let _=io(),v=on();if(e.documentUpdates.forEach(w=>{e.resolvedLimboDocuments.has(w)&&y.push(t.persistence.referenceDelegate.updateLimboDocument(u,w))}),y.push(Sk(u,f,e.documentUpdates).next(w=>{_=w.ks,v=w.qs})),!r.isEqual(wt.min())){const w=t.Pi.getLastRemoteSnapshotVersion(u).next(R=>t.Pi.setTargetsMetadata(u,u.currentSequenceNumber,r));y.push(w)}return Le.waitFor(y).next(()=>f.apply(u)).next(()=>t.localDocuments.getLocalViewOfDocuments(u,_,v)).next(()=>_)}).then(u=>(t.Ms=l,u))}function Sk(n,e,t){let r=on(),l=on();return t.forEach(u=>r=r.add(u)),e.getEntries(n,r).next(u=>{let f=io();return t.forEach((y,_)=>{const v=u.get(y);_.isFoundDocument()!==v.isFoundDocument()&&(l=l.add(y)),_.isNoDocument()&&_.version.isEqual(wt.min())?(e.removeEntry(y,_.readTime),f=f.insert(y,_)):!v.isValidDocument()||_.version.compareTo(v.version)>0||_.version.compareTo(v.version)===0&&v.hasPendingWrites?(e.addEntry(_),f=f.insert(y,_)):tt(nv,"Ignoring outdated watch update for ",y,". Current version:",v.version," Watch version:",_.version)}),{ks:f,qs:l}})}function jk(n,e){const t=It(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=H_),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ak(n,e){const t=It(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let l;return t.Pi.getTargetData(r,e).next(u=>u?(l=u,Le.resolve(l)):t.Pi.allocateTargetId(r).next(f=>(l=new il(e,f,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,l).next(()=>l))))}).then(r=>{const l=t.Ms.get(r.targetId);return(l===null||r.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function d_(n,e,t){const r=It(n),l=r.Ms.get(e),u=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",u,f=>r.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!Ru(f))throw f;tt(nv,`Failed to update sequence numbers for target ${e}: ${f}`)}r.Ms=r.Ms.remove(e),r.xs.delete(l.target)}function XT(n,e,t){const r=It(n);let l=wt.min(),u=on();return r.persistence.runTransaction("Execute query","readwrite",f=>function(_,v,w){const R=It(_),I=R.xs.get(w);return I!==void 0?Le.resolve(R.Ms.get(I)):R.Pi.getTargetData(v,w)}(r,f,Ta(e)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(f,y.targetId).next(_=>{u=_})}).next(()=>r.Fs.getDocumentsMatchingQuery(f,e,t?l:wt.min(),t?u:on())).next(y=>(Nk(r,mM(e),y),{documents:y,Qs:u})))}function Nk(n,e,t){let r=n.Os.get(e)||wt.min();t.forEach((l,u)=>{u.readTime.compareTo(r)>0&&(r=u.readTime)}),n.Os.set(e,r)}class JT{constructor(){this.activeTargetIds=bM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ck{constructor(){this.Mo=new JT,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new JT,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew="ConnectivityMonitor";class tw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){tt(ew,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){tt(ew,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hf=null;function h_(){return Hf===null?Hf=function(){return 268435456+Math.round(2147483648*Math.random())}():Hf++,"0x"+Hf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _y="RestConnection",Ik={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Pk{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${l}`,this.Wo=this.databaseId.database===Mm?`project_id=${r}`:`project_id=${r}&database_id=${l}`}Go(e,t,r,l,u){const f=h_(),y=this.zo(e,t.toUriEncodedString());tt(_y,`Sending RPC '${e}' ${f}:`,y,r);const _={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(_,l,u);const{host:v}=new URL(y),w=ao(v);return this.Jo(e,y,_,r,w).then(R=>(tt(_y,`Received RPC '${e}' ${f}: `,R),R),R=>{throw mu(_y,`RPC '${e}' ${f} failed with error: `,R,"url: ",y,"request:",r),R})}Ho(e,t,r,l,u,f){return this.Go(e,t,r,l,u)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Nu}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((l,u)=>e[u]=l),r&&r.headers.forEach((l,u)=>e[u]=l)}zo(e,t){const r=Ik[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er="WebChannelConnection";class kk extends Pk{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,l,u){const f=h_();return new Promise((y,_)=>{const v=new C1;v.setWithCredentials(!0),v.listenOnce(R1.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case gm.NO_ERROR:const R=v.getResponseJson();tt(Er,`XHR for RPC '${e}' ${f} received:`,JSON.stringify(R)),y(R);break;case gm.TIMEOUT:tt(Er,`RPC '${e}' ${f} timed out`),_(new $e(Pe.DEADLINE_EXCEEDED,"Request time out"));break;case gm.HTTP_ERROR:const I=v.getStatus();if(tt(Er,`RPC '${e}' ${f} failed with status:`,I,"response text:",v.getResponseText()),I>0){let G=v.getResponseJson();Array.isArray(G)&&(G=G[0]);const H=G?.error;if(H&&H.status&&H.message){const Z=function(Q){const se=Q.toLowerCase().replace(/_/g,"-");return Object.values(Pe).indexOf(se)>=0?se:Pe.UNKNOWN}(H.status);_(new $e(Z,H.message))}else _(new $e(Pe.UNKNOWN,"Server responded with status "+v.getStatus()))}else _(new $e(Pe.UNAVAILABLE,"Connection failed."));break;default:vt(9055,{l_:e,streamId:f,h_:v.getLastErrorCode(),P_:v.getLastError()})}}finally{tt(Er,`RPC '${e}' ${f} completed.`)}});const w=JSON.stringify(l);tt(Er,`RPC '${e}' ${f} sending request:`,l),v.send(t,"POST",w,r,15)})}T_(e,t,r){const l=h_(),u=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=M1(),y=P1(),_={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},v=this.longPollingOptions.timeoutSeconds;v!==void 0&&(_.longPollingTimeout=Math.round(1e3*v)),this.useFetchStreams&&(_.useFetchStreams=!0),this.jo(_.initMessageHeaders,t,r),_.encodeInitMessageHeaders=!0;const w=u.join("");tt(Er,`Creating RPC '${e}' stream ${l}: ${w}`,_);const R=f.createWebChannel(w,_);this.I_(R);let I=!1,G=!1;const H=new Mk({Yo:F=>{G?tt(Er,`Not sending because RPC '${e}' stream ${l} is closed:`,F):(I||(tt(Er,`Opening RPC '${e}' stream ${l} transport.`),R.open(),I=!0),tt(Er,`RPC '${e}' stream ${l} sending:`,F),R.send(F))},Zo:()=>R.close()}),Z=(F,Q,se)=>{F.listen(Q,ue=>{try{se(ue)}catch(we){setTimeout(()=>{throw we},0)}})};return Z(R,Bd.EventType.OPEN,()=>{G||(tt(Er,`RPC '${e}' stream ${l} transport opened.`),H.o_())}),Z(R,Bd.EventType.CLOSE,()=>{G||(G=!0,tt(Er,`RPC '${e}' stream ${l} transport closed`),H.a_(),this.E_(R))}),Z(R,Bd.EventType.ERROR,F=>{G||(G=!0,mu(Er,`RPC '${e}' stream ${l} transport errored. Name:`,F.name,"Message:",F.message),H.a_(new $e(Pe.UNAVAILABLE,"The operation could not be completed")))}),Z(R,Bd.EventType.MESSAGE,F=>{if(!G){const Q=F.data[0];un(!!Q,16349);const se=Q,ue=se?.error||se[0]?.error;if(ue){tt(Er,`RPC '${e}' stream ${l} received error:`,ue);const we=ue.status;let Ce=function(M){const D=Ui[M];if(D!==void 0)return pS(D)}(we),Ue=ue.message;Ce===void 0&&(Ce=Pe.INTERNAL,Ue="Unknown error status: "+we+" with message "+ue.message),G=!0,H.a_(new $e(Ce,Ue)),R.close()}else tt(Er,`RPC '${e}' stream ${l} received:`,Q),H.u_(Q)}}),Z(y,I1.STAT_EVENT,F=>{F.stat===t_.PROXY?tt(Er,`RPC '${e}' stream ${l} detected buffering proxy`):F.stat===t_.NOPROXY&&tt(Er,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{H.__()},0),H}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function vy(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(n){return new VM(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e,t,r=1e3,l=1.5,u=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=l,this.R_=u,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),l=Math.max(0,t-r);l>0&&tt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,l,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nw="PersistentStream";class RS{constructor(e,t,r,l,u,f,y,_){this.Mi=e,this.S_=r,this.b_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=y,this.listener=_,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new iv(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Pe.RESOURCE_EXHAUSTED?(no(t.toString()),no("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Pe.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,l])=>{this.D_===t&&this.G_(r,l)},r=>{e(()=>{const l=new $e(Pe.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(l)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(l=>{r(()=>this.z_(l))}),this.stream.onMessage(l=>{r(()=>++this.F_==1?this.J_(l):this.onNext(l))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tt(nw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tt(nw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ok extends RS{constructor(e,t,r,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,l,f),this.serializer=u}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=BM(this.serializer,e),r=function(u){if(!("targetChange"in u))return wt.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?wt.min():f.readTime?vs(f.readTime):wt.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=u_(this.serializer),t.addTarget=function(u,f){let y;const _=f.target;if(y=a_(_)?{documents:qM(u,_)}:{query:$M(u,_).ft},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){y.resumeToken=_S(u,f.resumeToken);const v=l_(u,f.expectedCount);v!==null&&(y.expectedCount=v)}else if(f.snapshotVersion.compareTo(wt.min())>0){y.readTime=Vm(u,f.snapshotVersion.toTimestamp());const v=l_(u,f.expectedCount);v!==null&&(y.expectedCount=v)}return y}(this.serializer,e);const r=ZM(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=u_(this.serializer),t.removeTarget=e,this.q_(t)}}class Dk extends RS{constructor(e,t,r,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,l,f),this.serializer=u}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return un(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,un(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){un(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=HM(e.writeResults,e.commitTime),r=vs(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=u_(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>TS(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{}class Vk extends Lk{constructor(e,t,r,l){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=l,this.ia=!1}sa(){if(this.ia)throw new $e(Pe.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.Go(e,c_(t,r),l,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===Pe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new $e(Pe.UNKNOWN,u.toString())})}Ho(e,t,r,l,u){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Ho(e,c_(t,r),l,f,y,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Pe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new $e(Pe.UNKNOWN,f.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Uk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(no(t),this.aa=!1):tt("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac="RemoteStore";class Fk{constructor(e,t,r,l,u){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=u,this.Aa.Oo(f=>{r.enqueueAndForget(async()=>{hc(this)&&(tt(ac,"Restarting streams for network reachability change."),await async function(_){const v=It(_);v.Ea.add(4),await Nh(v),v.Ra.set("Unknown"),v.Ea.delete(4),await fp(v)}(this))})}),this.Ra=new Uk(r,l)}}async function fp(n){if(hc(n))for(const e of n.da)await e(!0)}async function Nh(n){for(const e of n.da)await e(!1)}function IS(n,e){const t=It(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ov(t)?av(t):Pu(t).O_()&&sv(t,e))}function rv(n,e){const t=It(n),r=Pu(t);t.Ia.delete(e),r.O_()&&PS(t,e),t.Ia.size===0&&(r.O_()?r.L_():hc(t)&&t.Ra.set("Unknown"))}function sv(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(wt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Pu(n).Y_(e)}function PS(n,e){n.Va.Ue(e),Pu(n).Z_(e)}function av(n){n.Va=new kM({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Pu(n).start(),n.Ra.ua()}function ov(n){return hc(n)&&!Pu(n).x_()&&n.Ia.size>0}function hc(n){return It(n).Ea.size===0}function MS(n){n.Va=void 0}async function zk(n){n.Ra.set("Online")}async function Bk(n){n.Ia.forEach((e,t)=>{sv(n,e)})}async function Hk(n,e){MS(n),ov(n)?(n.Ra.ha(e),av(n)):n.Ra.set("Unknown")}async function qk(n,e,t){if(n.Ra.set("Online"),e instanceof yS&&e.state===2&&e.cause)try{await async function(l,u){const f=u.cause;for(const y of u.targetIds)l.Ia.has(y)&&(await l.remoteSyncer.rejectListen(y,f),l.Ia.delete(y),l.Va.removeTarget(y))}(n,e)}catch(r){tt(ac,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await zm(n,r)}else if(e instanceof bm?n.Va.Ze(e):e instanceof gS?n.Va.st(e):n.Va.tt(e),!t.isEqual(wt.min()))try{const r=await CS(n.localStore);t.compareTo(r)>=0&&await function(u,f){const y=u.Va.Tt(f);return y.targetChanges.forEach((_,v)=>{if(_.resumeToken.approximateByteSize()>0){const w=u.Ia.get(v);w&&u.Ia.set(v,w.withResumeToken(_.resumeToken,f))}}),y.targetMismatches.forEach((_,v)=>{const w=u.Ia.get(_);if(!w)return;u.Ia.set(_,w.withResumeToken(pr.EMPTY_BYTE_STRING,w.snapshotVersion)),PS(u,_);const R=new il(w.target,_,v,w.sequenceNumber);sv(u,R)}),u.remoteSyncer.applyRemoteEvent(y)}(n,t)}catch(r){tt(ac,"Failed to raise snapshot:",r),await zm(n,r)}}async function zm(n,e,t){if(!Ru(e))throw e;n.Ea.add(1),await Nh(n),n.Ra.set("Offline"),t||(t=()=>CS(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{tt(ac,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await fp(n)})}function kS(n,e){return e().catch(t=>zm(n,t,e))}async function mp(n){const e=It(n),t=gl(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:H_;for(;$k(e);)try{const l=await jk(e.localStore,r);if(l===null){e.Ta.length===0&&t.L_();break}r=l.batchId,Gk(e,l)}catch(l){await zm(e,l)}OS(e)&&DS(e)}function $k(n){return hc(n)&&n.Ta.length<10}function Gk(n,e){n.Ta.push(e);const t=gl(n);t.O_()&&t.X_&&t.ea(e.mutations)}function OS(n){return hc(n)&&!gl(n).x_()&&n.Ta.length>0}function DS(n){gl(n).start()}async function Zk(n){gl(n).ra()}async function Kk(n){const e=gl(n);for(const t of n.Ta)e.ea(t.mutations)}async function Wk(n,e,t){const r=n.Ta.shift(),l=Y_.from(r,e,t);await kS(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await mp(n)}async function Yk(n,e){e&&gl(n).X_&&await async function(r,l){if(function(f){return mS(f)&&f!==Pe.ABORTED}(l.code)){const u=r.Ta.shift();gl(r).B_(),await kS(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,l)),await mp(r)}}(n,e),OS(n)&&DS(n)}async function iw(n,e){const t=It(n);t.asyncQueue.verifyOperationInProgress(),tt(ac,"RemoteStore received new credentials");const r=hc(t);t.Ea.add(3),await Nh(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await fp(t)}async function Qk(n,e){const t=It(n);e?(t.Ea.delete(2),await fp(t)):e||(t.Ea.add(2),await Nh(t),t.Ra.set("Unknown"))}function Pu(n){return n.ma||(n.ma=function(t,r,l){const u=It(t);return u.sa(),new Ok(r,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{Xo:zk.bind(null,n),t_:Bk.bind(null,n),r_:Hk.bind(null,n),H_:qk.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),ov(n)?av(n):n.Ra.set("Unknown")):(await n.ma.stop(),MS(n))})),n.ma}function gl(n){return n.fa||(n.fa=function(t,r,l){const u=It(t);return u.sa(),new Dk(r,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Zk.bind(null,n),r_:Yk.bind(null,n),ta:Kk.bind(null,n),na:Wk.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await mp(n)):(await n.fa.stop(),n.Ta.length>0&&(tt(ac,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,t,r,l,u){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=l,this.removalCallback=u,this.deferred=new xa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,l,u){const f=Date.now()+r,y=new lv(e,t,f,l,u);return y.start(r),y}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $e(Pe.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cv(n,e){if(no("AsyncQueue",`${e}: ${n}`),Ru(n))return new $e(Pe.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{static emptySet(e){return new cu(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||pt.comparator(t.key,r.key):(t,r)=>pt.comparator(t.key,r.key),this.keyedMap=Hd(),this.sortedSet=new pi(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cu)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const l=t.getNext().key,u=r.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new cu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(){this.ga=new pi(pt.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):vt(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class vu{constructor(e,t,r,l,u,f,y,_,v){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=y,this.excludesMetadataChanges=_,this.hasCachedResults=v}static fromInitialDocuments(e,t,r,l,u){const f=[];return t.forEach(y=>{f.push({type:0,doc:y})}),new vu(e,t,cu.emptySet(t),f,r,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&op(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let l=0;l<t.length;l++)if(t[l].type!==r[l].type||!t[l].doc.isEqual(r[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Jk{constructor(){this.queries=sw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const l=It(t),u=l.queries;l.queries=sw(),u.forEach((f,y)=>{for(const _ of y.Sa)_.onError(r)})})(this,new $e(Pe.ABORTED,"Firestore shutting down"))}}function sw(){return new dc(n=>tS(n),op)}async function uv(n,e){const t=It(n);let r=3;const l=e.query;let u=t.queries.get(l);u?!u.ba()&&e.Da()&&(r=2):(u=new Xk,r=e.Da()?0:1);try{switch(r){case 0:u.wa=await t.onListen(l,!0);break;case 1:u.wa=await t.onListen(l,!1);break;case 2:await t.onFirstRemoteStoreListen(l)}}catch(f){const y=cv(f,`Initialization of query '${tu(e.query)}' failed`);return void e.onError(y)}t.queries.set(l,u),u.Sa.push(e),e.va(t.onlineState),u.wa&&e.Fa(u.wa)&&hv(t)}async function dv(n,e){const t=It(n),r=e.query;let l=3;const u=t.queries.get(r);if(u){const f=u.Sa.indexOf(e);f>=0&&(u.Sa.splice(f,1),u.Sa.length===0?l=e.Da()?0:1:!u.ba()&&e.Da()&&(l=2))}switch(l){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function eO(n,e){const t=It(n);let r=!1;for(const l of e){const u=l.query,f=t.queries.get(u);if(f){for(const y of f.Sa)y.Fa(l)&&(r=!0);f.wa=l}}r&&hv(t)}function tO(n,e,t){const r=It(n),l=r.queries.get(e);if(l)for(const u of l.Sa)u.onError(t);r.queries.delete(e)}function hv(n){n.Ca.forEach(e=>{e.next()})}var f_,aw;(aw=f_||(f_={})).Ma="default",aw.Cache="cache";class fv{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const l of e.docChanges)l.type!==3&&r.push(l);e=new vu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=vu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f_.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e){this.key=e}}class VS{constructor(e){this.key=e}}class nO{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=on(),this.mutatedKeys=on(),this.eu=nS(e),this.tu=new cu(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new rw,l=t?t.tu:this.tu;let u=t?t.mutatedKeys:this.mutatedKeys,f=l,y=!1;const _=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,v=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((w,R)=>{const I=l.get(w),G=lp(this.query,R)?R:null,H=!!I&&this.mutatedKeys.has(I.key),Z=!!G&&(G.hasLocalMutations||this.mutatedKeys.has(G.key)&&G.hasCommittedMutations);let F=!1;I&&G?I.data.isEqual(G.data)?H!==Z&&(r.track({type:3,doc:G}),F=!0):this.su(I,G)||(r.track({type:2,doc:G}),F=!0,(_&&this.eu(G,_)>0||v&&this.eu(G,v)<0)&&(y=!0)):!I&&G?(r.track({type:0,doc:G}),F=!0):I&&!G&&(r.track({type:1,doc:I}),F=!0,(_||v)&&(y=!0)),F&&(G?(f=f.add(G),u=Z?u.add(w):u.delete(w)):(f=f.delete(w),u=u.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),u=u.delete(w.key),r.track({type:1,doc:w})}return{tu:f,iu:r,Cs:y,mutatedKeys:u}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,l){const u=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const f=e.iu.ya();f.sort((w,R)=>function(G,H){const Z=F=>{switch(F){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vt(20277,{Rt:F})}};return Z(G)-Z(H)}(w.type,R.type)||this.eu(w.doc,R.doc)),this.ou(r),l=l??!1;const y=t&&!l?this._u():[],_=this.Xa.size===0&&this.current&&!l?1:0,v=_!==this.Za;return this.Za=_,f.length!==0||v?{snapshot:new vu(this.query,e.tu,u,f,e.mutatedKeys,_===0,v,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:y}:{au:y}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new rw,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=on(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new VS(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new LS(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=on();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return vu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const mv="SyncEngine";class iO{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class rO{constructor(e){this.key=e,this.hu=!1}}class sO{constructor(e,t,r,l,u,f){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.Pu={},this.Tu=new dc(y=>tS(y),op),this.Iu=new Map,this.Eu=new Set,this.du=new pi(pt.comparator),this.Au=new Map,this.Ru=new J_,this.Vu={},this.mu=new Map,this.fu=_u.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function aO(n,e,t=!0){const r=qS(n);let l;const u=r.Tu.get(e);return u?(r.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.lu()):l=await US(r,e,t,!0),l}async function oO(n,e){const t=qS(n);await US(t,e,!0,!1)}async function US(n,e,t,r){const l=await Ak(n.localStore,Ta(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,t);let y;return r&&(y=await lO(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&t&&IS(n.remoteStore,l),y}async function lO(n,e,t,r,l){n.pu=(R,I,G)=>async function(Z,F,Q,se){let ue=F.view.ru(Q);ue.Cs&&(ue=await XT(Z.localStore,F.query,!1).then(({documents:P})=>F.view.ru(P,ue)));const we=se&&se.targetChanges.get(F.targetId),Ce=se&&se.targetMismatches.get(F.targetId)!=null,Ue=F.view.applyChanges(ue,Z.isPrimaryClient,we,Ce);return lw(Z,F.targetId,Ue.au),Ue.snapshot}(n,R,I,G);const u=await XT(n.localStore,e,!0),f=new nO(e,u.Qs),y=f.ru(u.documents),_=Ah.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",l),v=f.applyChanges(y,n.isPrimaryClient,_);lw(n,t,v.au);const w=new iO(e,t,f);return n.Tu.set(e,w),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),v.snapshot}async function cO(n,e,t){const r=It(n),l=r.Tu.get(e),u=r.Iu.get(l.targetId);if(u.length>1)return r.Iu.set(l.targetId,u.filter(f=>!op(f,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(l.targetId),r.sharedClientState.isActiveQueryTarget(l.targetId)||await d_(r.localStore,l.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(l.targetId),t&&rv(r.remoteStore,l.targetId),m_(r,l.targetId)}).catch(Cu)):(m_(r,l.targetId),await d_(r.localStore,l.targetId,!0))}async function uO(n,e){const t=It(n),r=t.Tu.get(e),l=t.Iu.get(r.targetId);t.isPrimaryClient&&l.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),rv(t.remoteStore,r.targetId))}async function dO(n,e,t){const r=_O(n);try{const l=await function(f,y){const _=It(f),v=ti.now(),w=y.reduce((G,H)=>G.add(H.key),on());let R,I;return _.persistence.runTransaction("Locally write mutations","readwrite",G=>{let H=io(),Z=on();return _.Ns.getEntries(G,w).next(F=>{H=F,H.forEach((Q,se)=>{se.isValidDocument()||(Z=Z.add(Q))})}).next(()=>_.localDocuments.getOverlayedDocuments(G,H)).next(F=>{R=F;const Q=[];for(const se of y){const ue=NM(se,R.get(se.key).overlayedDocument);ue!=null&&Q.push(new bl(se.key,ue,Z1(ue.value.mapValue),Nr.exists(!0)))}return _.mutationQueue.addMutationBatch(G,v,Q,y)}).next(F=>{I=F;const Q=F.applyToLocalDocumentSet(R,Z);return _.documentOverlayCache.saveOverlays(G,F.batchId,Q)})}).then(()=>({batchId:I.batchId,changes:rS(R)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(l.batchId),function(f,y,_){let v=f.Vu[f.currentUser.toKey()];v||(v=new pi(an)),v=v.insert(y,_),f.Vu[f.currentUser.toKey()]=v}(r,l.batchId,t),await Ch(r,l.changes),await mp(r.remoteStore)}catch(l){const u=cv(l,"Failed to persist write");t.reject(u)}}async function FS(n,e){const t=It(n);try{const r=await Ek(t.localStore,e);e.targetChanges.forEach((l,u)=>{const f=t.Au.get(u);f&&(un(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1,22616),l.addedDocuments.size>0?f.hu=!0:l.modifiedDocuments.size>0?un(f.hu,14607):l.removedDocuments.size>0&&(un(f.hu,42227),f.hu=!1))}),await Ch(t,r,e)}catch(r){await Cu(r)}}function ow(n,e,t){const r=It(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const l=[];r.Tu.forEach((u,f)=>{const y=f.view.va(e);y.snapshot&&l.push(y.snapshot)}),function(f,y){const _=It(f);_.onlineState=y;let v=!1;_.queries.forEach((w,R)=>{for(const I of R.Sa)I.va(y)&&(v=!0)}),v&&hv(_)}(r.eventManager,e),l.length&&r.Pu.H_(l),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function hO(n,e,t){const r=It(n);r.sharedClientState.updateQueryState(e,"rejected",t);const l=r.Au.get(e),u=l&&l.key;if(u){let f=new pi(pt.comparator);f=f.insert(u,ir.newNoDocument(u,wt.min()));const y=on().add(u),_=new dp(wt.min(),new Map,new pi(an),f,y);await FS(r,_),r.du=r.du.remove(u),r.Au.delete(e),pv(r)}else await d_(r.localStore,e,!1).then(()=>m_(r,e,t)).catch(Cu)}async function fO(n,e){const t=It(n),r=e.batch.batchId;try{const l=await wk(t.localStore,e);BS(t,r,null),zS(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ch(t,l)}catch(l){await Cu(l)}}async function mO(n,e,t){const r=It(n);try{const l=await function(f,y){const _=It(f);return _.persistence.runTransaction("Reject batch","readwrite-primary",v=>{let w;return _.mutationQueue.lookupMutationBatch(v,y).next(R=>(un(R!==null,37113),w=R.keys(),_.mutationQueue.removeMutationBatch(v,R))).next(()=>_.mutationQueue.performConsistencyCheck(v)).next(()=>_.documentOverlayCache.removeOverlaysForBatchId(v,w,y)).next(()=>_.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(v,w)).next(()=>_.localDocuments.getDocuments(v,w))})}(r.localStore,e);BS(r,e,t),zS(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ch(r,l)}catch(l){await Cu(l)}}function zS(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function BS(n,e,t){const r=It(n);let l=r.Vu[r.currentUser.toKey()];if(l){const u=l.get(e);u&&(t?u.reject(t):u.resolve(),l=l.remove(e)),r.Vu[r.currentUser.toKey()]=l}}function m_(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||HS(n,r)})}function HS(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(rv(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),pv(n))}function lw(n,e,t){for(const r of t)r instanceof LS?(n.Ru.addReference(r.key,e),pO(n,r)):r instanceof VS?(tt(mv,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||HS(n,r.key)):vt(19791,{wu:r})}function pO(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(tt(mv,"New document in limbo: "+t),n.Eu.add(r),pv(n))}function pv(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new pt(On.fromString(e)),r=n.fu.next();n.Au.set(r,new rO(t)),n.du=n.du.insert(t,r),IS(n.remoteStore,new il(Ta(ap(t.path)),r,"TargetPurposeLimboResolution",rp.ce))}}async function Ch(n,e,t){const r=It(n),l=[],u=[],f=[];r.Tu.isEmpty()||(r.Tu.forEach((y,_)=>{f.push(r.pu(_,e,t).then(v=>{if((v||t)&&r.isPrimaryClient){const w=v?!v.fromCache:t?.targetChanges.get(_.targetId)?.current;r.sharedClientState.updateQueryState(_.targetId,w?"current":"not-current")}if(v){l.push(v);const w=tv.As(_.targetId,v);u.push(w)}}))}),await Promise.all(f),r.Pu.H_(l),await async function(_,v){const w=It(_);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>Le.forEach(v,I=>Le.forEach(I.Es,G=>w.persistence.referenceDelegate.addReference(R,I.targetId,G)).next(()=>Le.forEach(I.ds,G=>w.persistence.referenceDelegate.removeReference(R,I.targetId,G)))))}catch(R){if(!Ru(R))throw R;tt(nv,"Failed to update sequence numbers: "+R)}for(const R of v){const I=R.targetId;if(!R.fromCache){const G=w.Ms.get(I),H=G.snapshotVersion,Z=G.withLastLimboFreeSnapshotVersion(H);w.Ms=w.Ms.insert(I,Z)}}}(r.localStore,u))}async function gO(n,e){const t=It(n);if(!t.currentUser.isEqual(e)){tt(mv,"User change. New user:",e.toKey());const r=await NS(t.localStore,e);t.currentUser=e,function(u,f){u.mu.forEach(y=>{y.forEach(_=>{_.reject(new $e(Pe.CANCELLED,f))})}),u.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ch(t,r.Ls)}}function yO(n,e){const t=It(n),r=t.Au.get(e);if(r&&r.hu)return on().add(r.key);{let l=on();const u=t.Iu.get(e);if(!u)return l;for(const f of u){const y=t.Tu.get(f);l=l.unionWith(y.view.nu)}return l}}function qS(n){const e=It(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=FS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hO.bind(null,e),e.Pu.H_=eO.bind(null,e.eventManager),e.Pu.yu=tO.bind(null,e.eventManager),e}function _O(n){const e=It(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mO.bind(null,e),e}class Bm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hp(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Tk(this.persistence,new vk,e.initialUser,this.serializer)}Cu(e){return new AS(ev.mi,this.serializer)}Du(e){return new Ck}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Bm.provider={build:()=>new Bm};class vO extends Bm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){un(this.persistence.referenceDelegate instanceof Fm,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new rk(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Wr.withCacheSize(this.cacheSizeBytes):Wr.DEFAULT;return new AS(r=>Fm.mi(r,t),this.serializer)}}class p_{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ow(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=gO.bind(null,this.syncEngine),await Qk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Jk}()}createDatastore(e){const t=hp(e.databaseInfo.databaseId),r=function(u){return new kk(u)}(e.databaseInfo);return function(u,f,y,_){return new Vk(u,f,y,_)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,l,u,f,y){return new Fk(r,l,u,f,y)}(this.localStore,this.datastore,e.asyncQueue,t=>ow(this.syncEngine,t,0),function(){return tw.v()?new tw:new Rk}())}createSyncEngine(e,t){return function(l,u,f,y,_,v,w){const R=new sO(l,u,f,y,_,v);return w&&(R.gu=!0),R}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(t){const r=It(t);tt(ac,"RemoteStore shutting down."),r.Ea.add(5),await Nh(r),r.Aa.shutdown(),r.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}p_.provider={build:()=>new p_};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):no("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new $e(Pe.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(l,u){const f=It(l),y={documents:u.map(R=>Um(f.serializer,R))},_=await f.Ho("BatchGetDocuments",f.serializer.databaseId,On.emptyPath(),y,u.length),v=new Map;_.forEach(R=>{const I=zM(f.serializer,R);v.set(I.key.toString(),I)});const w=[];return u.forEach(R=>{const I=v.get(R.toString());un(!!I,55234,{key:R}),w.push(I)}),w}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new W_(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const l=pt.fromPath(r);this.mutations.push(new fS(l,this.precondition(l)))}),await async function(r,l){const u=It(r),f={writes:l.map(y=>TS(u.serializer,y))};await u.Go("Commit",u.serializer.databaseId,On.emptyPath(),f)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw vt(50498,{Gu:e.constructor.name});t=wt.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new $e(Pe.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(wt.min())?Nr.exists(!1):Nr.updateTime(t):Nr.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(wt.min()))throw new $e(Pe.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Nr.updateTime(t)}return Nr.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(e,t,r,l,u){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=l,this.deferred=u,this.zu=r.maxAttempts,this.M_=new iv(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new bO(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(l=>{this.Yu(l)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!Sh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!mS(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl="FirestoreClient";class TO{constructor(e,t,r,l,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=l,this.user=Ar.UNAUTHENTICATED,this.clientId=B_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(r,async f=>{tt(yl,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(r,f=>(tt(yl,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=cv(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function by(n,e){n.asyncQueue.verifyOperationInProgress(),tt(yl,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async l=>{r.isEqual(l)||(await NS(e.localStore,l),r=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function cw(n,e){n.asyncQueue.verifyOperationInProgress();const t=await wO(n);tt(yl,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>iw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,l)=>iw(e.remoteStore,l)),n._onlineComponents=e}async function wO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){tt(yl,"Using user provided OfflineComponentProvider");try{await by(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(l){return l.name==="FirebaseError"?l.code===Pe.FAILED_PRECONDITION||l.code===Pe.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(t))throw t;mu("Error using user provided cache. Falling back to memory cache: "+t),await by(n,new Bm)}}else tt(yl,"Using default OfflineComponentProvider"),await by(n,new vO(void 0));return n._offlineComponents}async function yv(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(tt(yl,"Using user provided OnlineComponentProvider"),await cw(n,n._uninitializedComponentsProvider._online)):(tt(yl,"Using default OnlineComponentProvider"),await cw(n,new p_))),n._onlineComponents}function EO(n){return yv(n).then(e=>e.syncEngine)}function SO(n){return yv(n).then(e=>e.datastore)}async function Hm(n){const e=await yv(n),t=e.eventManager;return t.onListen=aO.bind(null,e.syncEngine),t.onUnlisten=cO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=oO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=uO.bind(null,e.syncEngine),t}function jO(n,e,t={}){const r=new xa;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,y,_,v){const w=new gv({next:I=>{w.Nu(),f.enqueueAndForget(()=>dv(u,R));const G=I.docs.has(y);!G&&I.fromCache?v.reject(new $e(Pe.UNAVAILABLE,"Failed to get document because the client is offline.")):G&&I.fromCache&&_&&_.source==="server"?v.reject(new $e(Pe.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):v.resolve(I)},error:I=>v.reject(I)}),R=new fv(ap(y.path),w,{includeMetadataChanges:!0,qa:!0});return uv(u,R)}(await Hm(n),n.asyncQueue,e,t,r)),r.promise}function AO(n,e,t={}){const r=new xa;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,y,_,v){const w=new gv({next:I=>{w.Nu(),f.enqueueAndForget(()=>dv(u,R)),I.fromCache&&_.source==="server"?v.reject(new $e(Pe.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):v.resolve(I)},error:I=>v.reject(I)}),R=new fv(y,w,{includeMetadataChanges:!0,qa:!0});return uv(u,R)}(await Hm(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $S(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GS="firestore.googleapis.com",dw=!0;class hw{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new $e(Pe.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=GS,this.ssl=dw}else this.host=e.host,this.ssl=e.ssl??dw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=jS;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nk)throw new $e(Pe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$S(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new $e(Pe.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new $e(Pe.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new $e(Pe.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,l){return r.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pp{constructor(e,t,r,l){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $e(Pe.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new $e(Pe.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hw(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new IP;switch(r.type){case"firstParty":return new OP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new $e(Pe.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=uw.get(t);r&&(tt("ComponentProvider","Removing Datastore"),uw.delete(t),r.terminate())}(this),Promise.resolve()}}function NO(n,e,t,r={}){n=Xr(n,pp);const l=ao(e),u=n._getSettings(),f={...u,emulatorOptions:n._getEmulatorOptions()},y=`${e}:${t}`;l&&(Qm(`https://${y}`),Xm("Firestore",!0)),u.host!==GS&&u.host!==y&&mu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const _={...u,host:y,ssl:l,emulatorOptions:r};if(!nc(_,f)&&(n._setSettings(_),r.mockUserToken)){let v,w;if(typeof r.mockUserToken=="string")v=r.mockUserToken,w=Ar.MOCK_USER;else{v=FE(r.mockUserToken,n._app?.options.projectId);const R=r.mockUserToken.sub||r.mockUserToken.user_id;if(!R)throw new $e(Pe.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Ar(R)}n._authCredentials=new PP(new O1(v,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new lo(this.firestore,e,this._query)}}class fi{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ol(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fi(this.firestore,e,this._key)}toJSON(){return{type:fi._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Eh(t,fi._jsonSchema))return new fi(e,r||null,new pt(On.fromString(t.referencePath)))}}fi._jsonSchemaVersion="firestore/documentReference/1.0",fi._jsonSchema={type:zi("string",fi._jsonSchemaVersion),referencePath:zi("string")};class ol extends lo{constructor(e,t,r){super(e,t,ap(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fi(this.firestore,null,new pt(e))}withConverter(e){return new ol(this.firestore,e,this._path)}}function Bt(n,e,...t){if(n=Dn(n),D1("collection","path",e),n instanceof pp){const r=On.fromString(e,...t);return ST(r),new ol(n,null,r)}{if(!(n instanceof fi||n instanceof ol))throw new $e(Pe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(On.fromString(e,...t));return ST(r),new ol(n.firestore,null,r)}}function gt(n,e,...t){if(n=Dn(n),arguments.length===1&&(e=B_.newId()),D1("doc","path",e),n instanceof pp){const r=On.fromString(e,...t);return ET(r),new fi(n,null,new pt(r))}{if(!(n instanceof fi||n instanceof ol))throw new $e(Pe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(On.fromString(e,...t));return ET(r),new fi(n.firestore,n instanceof ol?n.converter:null,new pt(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw="AsyncQueue";class mw{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new iv(this,"async_queue_retry"),this._c=()=>{const r=vy();r&&tt(fw,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=vy();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=vy();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new xa;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ru(e))throw e;tt(fw,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,no("INTERNAL UNHANDLED ERROR: ",pw(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const l=lv.createAndSchedule(this,e,t,r,u=>this.hc(u));return this.tc.push(l),l}uc(){this.nc&&vt(47125,{Pc:pw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function pw(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const l=t;for(const u of r)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class ro extends pp{constructor(e,t,r,l){super(e,t,r,l),this.type="firestore",this._queue=new mw,this._persistenceKey=l?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new mw(e),this._firestoreClient=void 0,await e}}}function CO(n,e){const t=typeof n=="object"?n:vh(),r=typeof n=="string"?n:Mm,l=_h(t,"firestore").getImmediate({identifier:r});if(!l._initialized){const u=C_("firestore");u&&NO(l,...u)}return l}function Rh(n){if(n._terminated)throw new $e(Pe.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||RO(n),n._firestoreClient}function RO(n){const e=n._freezeSettings(),t=function(l,u,f,y){return new XP(l,u,f,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,$S(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new TO(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const u=l?._online.build();return{_offline:l?._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gs(pr.fromBase64String(e))}catch(t){throw new $e(Pe.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new gs(pr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:gs._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Eh(e,gs._jsonSchema))return gs.fromBase64String(e.bytes)}}gs._jsonSchemaVersion="firestore/bytes/1.0",gs._jsonSchema={type:zi("string",gs._jsonSchemaVersion),bytes:zi("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new $e(Pe.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $e(Pe.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $e(Pe.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return an(this._lat,e._lat)||an(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:wa._jsonSchemaVersion}}static fromJSON(e){if(Eh(e,wa._jsonSchema))return new wa(e.latitude,e.longitude)}}wa._jsonSchemaVersion="firestore/geoPoint/1.0",wa._jsonSchema={type:zi("string",wa._jsonSchemaVersion),latitude:zi("number"),longitude:zi("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,l){if(r.length!==l.length)return!1;for(let u=0;u<r.length;++u)if(r[u]!==l[u])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ea._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Eh(e,Ea._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Ea(e.vectorValues);throw new $e(Pe.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ea._jsonSchemaVersion="firestore/vectorValue/1.0",Ea._jsonSchema={type:zi("string",Ea._jsonSchemaVersion),vectorValues:zi("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=/^__.*__$/;class PO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new bl(e,this.data,this.fieldMask,t,this.fieldTransforms):new jh(e,this.data,t,this.fieldTransforms)}}class ZS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new bl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function KS(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw vt(40011,{Ac:n})}}class _v{constructor(e,t,r,l,u,f){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=l,u===void 0&&this.Rc(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new _v({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return qm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(KS(this.Ac)&&IO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class MO{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||hp(e)}Cc(e,t,r,l=!1){return new _v({Ac:e,methodName:t,Dc:r,path:fr.emptyPath(),fc:!1,bc:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ph(n){const e=n._freezeSettings(),t=hp(n._databaseId);return new MO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vv(n,e,t,r,l,u={}){const f=n.Cc(u.merge||u.mergeFields?2:0,e,t,l);xv("Data must be an object, but it was:",f,r);const y=QS(r,f);let _,v;if(u.merge)_=new ys(f.fieldMask),v=f.fieldTransforms;else if(u.mergeFields){const w=[];for(const R of u.mergeFields){const I=g_(e,R,t);if(!f.contains(I))throw new $e(Pe.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);JS(w,I)||w.push(I)}_=new ys(w),v=f.fieldTransforms.filter(R=>_.covers(R.field))}else _=null,v=f.fieldTransforms;return new PO(new Ur(y),_,v)}class yp extends gp{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yp}}class bv extends gp{_toFieldTransform(e){return new EM(e.path,new dh)}isEqual(e){return e instanceof bv}}function WS(n,e,t,r){const l=n.Cc(1,e,t);xv("Data must be an object, but it was:",l,r);const u=[],f=Ur.empty();vl(r,(_,v)=>{const w=Tv(e,_,t);v=Dn(v);const R=l.yc(w);if(v instanceof yp)u.push(w);else{const I=Mh(v,R);I!=null&&(u.push(w),f.set(w,I))}});const y=new ys(u);return new ZS(f,y,l.fieldTransforms)}function YS(n,e,t,r,l,u){const f=n.Cc(1,e,t),y=[g_(e,r,t)],_=[l];if(u.length%2!=0)throw new $e(Pe.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<u.length;I+=2)y.push(g_(e,u[I])),_.push(u[I+1]);const v=[],w=Ur.empty();for(let I=y.length-1;I>=0;--I)if(!JS(v,y[I])){const G=y[I];let H=_[I];H=Dn(H);const Z=f.yc(G);if(H instanceof yp)v.push(G);else{const F=Mh(H,Z);F!=null&&(v.push(G),w.set(G,F))}}const R=new ys(v);return new ZS(w,R,f.fieldTransforms)}function kO(n,e,t,r=!1){return Mh(t,n.Cc(r?4:3,e))}function Mh(n,e){if(XS(n=Dn(n)))return xv("Unsupported field value:",e,n),QS(n,e);if(n instanceof gp)return function(r,l){if(!KS(l.Ac))throw l.Sc(`${r._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Sc(`${r._methodName}() is not currently supported inside arrays`);const u=r._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,l){const u=[];let f=0;for(const y of r){let _=Mh(y,l.wc(f));_==null&&(_={nullValue:"NULL_VALUE"}),u.push(_),f++}return{arrayValue:{values:u}}}(n,e)}return function(r,l){if((r=Dn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return xM(l.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const u=ti.fromDate(r);return{timestampValue:Vm(l.serializer,u)}}if(r instanceof ti){const u=new ti(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Vm(l.serializer,u)}}if(r instanceof wa)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof gs)return{bytesValue:_S(l.serializer,r._byteString)};if(r instanceof fi){const u=l.databaseId,f=r.firestore._databaseId;if(!f.isEqual(u))throw l.Sc(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:X_(r.firestore._databaseId||l.databaseId,r._key.path)}}if(r instanceof Ea)return function(f,y){return{mapValue:{fields:{[$1]:{stringValue:G1},[km]:{arrayValue:{values:f.toArray().map(v=>{if(typeof v!="number")throw y.Sc("VectorValues must only contain numeric values.");return K_(y.serializer,v)})}}}}}}(r,l);throw l.Sc(`Unsupported field value: ${ip(r)}`)}(n,e)}function QS(n,e){const t={};return U1(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vl(n,(r,l)=>{const u=Mh(l,e.mc(r));u!=null&&(t[r]=u)}),{mapValue:{fields:t}}}function XS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ti||n instanceof wa||n instanceof gs||n instanceof fi||n instanceof gp||n instanceof Ea)}function xv(n,e,t){if(!XS(t)||!L1(t)){const r=ip(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function g_(n,e,t){if((e=Dn(e))instanceof Ih)return e._internalPath;if(typeof e=="string")return Tv(n,e);throw qm("Field path arguments must be of type string or ",n,!1,void 0,t)}const OO=new RegExp("[~\\*/\\[\\]]");function Tv(n,e,t){if(e.search(OO)>=0)throw qm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ih(...e.split("."))._internalPath}catch{throw qm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function qm(n,e,t,r,l){const u=r&&!r.isEmpty(),f=l!==void 0;let y=`Function ${e}() called with invalid data`;t&&(y+=" (via `toFirestore()`)"),y+=". ";let _="";return(u||f)&&(_+=" (found",u&&(_+=` in field ${r}`),f&&(_+=` in document ${l}`),_+=")"),new $e(Pe.INVALID_ARGUMENT,y+n+_)}function JS(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e,t,r,l,u){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new fi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(_p("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class DO extends $m{data(){return super.data()}}function _p(n,e){return typeof e=="string"?Tv(n,e):e instanceof Ih?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ej(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new $e(Pe.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wv{}class Ev extends wv{}function en(n,e,...t){let r=[];e instanceof wv&&r.push(e),r=r.concat(t),function(u){const f=u.filter(_=>_ instanceof Sv).length,y=u.filter(_=>_ instanceof vp).length;if(f>1||f>0&&y>0)throw new $e(Pe.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const l of r)n=l._apply(n);return n}class vp extends Ev{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vp(e,t,r)}_apply(e){const t=this._parse(e);return tj(e._query,t),new lo(e.firestore,e.converter,o_(e._query,t))}_parse(e){const t=Ph(e.firestore);return function(u,f,y,_,v,w,R){let I;if(v.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new $e(Pe.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){_w(R,w);const H=[];for(const Z of R)H.push(yw(_,u,Z));I={arrayValue:{values:H}}}else I=yw(_,u,R)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||_w(R,w),I=kO(y,f,R,w==="in"||w==="not-in");return Fi.create(v,w,I)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Nt(n,e,t){const r=e,l=_p("where",n);return vp._create(l,r,t)}class Sv extends wv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Sv(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Xs.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(l,u){let f=l;const y=u.getFlattenedFilters();for(const _ of y)tj(f,_),f=o_(f,_)}(e._query,t),new lo(e.firestore,e.converter,o_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class jv extends Ev{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new jv(e,t)}_apply(e){const t=function(l,u,f){if(l.startAt!==null)throw new $e(Pe.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new $e(Pe.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new uh(u,f)}(e._query,this._field,this._direction);return new lo(e.firestore,e.converter,function(l,u){const f=l.explicitOrderBy.concat([u]);return new Iu(l.path,l.collectionGroup,f,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,t))}}function Fr(n,e="asc"){const t=e,r=_p("orderBy",n);return jv._create(r,t)}class Av extends Ev{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Av(e,t,r)}_apply(e){return new lo(e.firestore,e.converter,Dm(e._query,this._limit,this._limitType))}}function LO(n){return Av._create("limit",n,"F")}function yw(n,e,t){if(typeof(t=Dn(t))=="string"){if(t==="")throw new $e(Pe.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eS(e)&&t.indexOf("/")!==-1)throw new $e(Pe.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(On.fromString(t));if(!pt.isDocumentKey(r))throw new $e(Pe.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return MT(n,new pt(r))}if(t instanceof fi)return MT(n,t._key);throw new $e(Pe.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ip(t)}.`)}function _w(n,e){if(!Array.isArray(n)||n.length===0)throw new $e(Pe.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tj(n,e){const t=function(l,u){for(const f of l)for(const y of f.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new $e(Pe.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new $e(Pe.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class nj{convertValue(e,t="none"){switch(pl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ii(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ml(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw vt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return vl(e,(l,u)=>{r[l]=this.convertValue(u,t)}),r}convertVectorValue(e){const t=e.fields?.[km].arrayValue?.values?.map(r=>Ii(r.doubleValue));return new Ea(t)}convertGeoPoint(e){return new wa(Ii(e.latitude),Ii(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=sp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(oh(e));default:return null}}convertTimestamp(e){const t=fl(e);return new ti(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=On.fromString(e);un(SS(r),9688,{name:e});const l=new lh(r.get(1),r.get(3)),u=new pt(r.popFirst(5));return l.isEqual(t)||no(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class VO extends nj{constructor(e){super(),this.firestore=e}convertBytes(e){return new gs(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fi(this.firestore,null,t)}}class su{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ll extends $m{constructor(e,t,r,l,u,f){super(e,t,r,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new xm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(_p("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new $e(Pe.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ll._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ll._jsonSchemaVersion="firestore/documentSnapshot/1.0",ll._jsonSchema={type:zi("string",ll._jsonSchemaVersion),bundleSource:zi("string","DocumentSnapshot"),bundleName:zi("string"),bundle:zi("string")};class xm extends ll{data(e={}){return super.data(e)}}class ec{constructor(e,t,r,l){this._firestore=e,this._userDataWriter=t,this._snapshot=l,this.metadata=new su(l.hasPendingWrites,l.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new xm(this._firestore,this._userDataWriter,r.key,r,new su(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $e(Pe.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(y=>{const _=new xm(l._firestore,l._userDataWriter,y.doc.key,y.doc,new su(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:_,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>u||y.type!==3).map(y=>{const _=new xm(l._firestore,l._userDataWriter,y.doc.key,y.doc,new su(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let v=-1,w=-1;return y.type!==0&&(v=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),w=f.indexOf(y.doc.key)),{type:UO(y.type),doc:_,oldIndex:v,newIndex:w}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new $e(Pe.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ec._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=B_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],l=[];return this.docs.forEach(u=>{u._document!==null&&(t.push(u._document),r.push(this._userDataWriter.convertObjectMap(u._document.data.value.mapValue.fields,"previous")),l.push(u.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function UO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vt(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jr(n){n=Xr(n,fi);const e=Xr(n.firestore,ro);return jO(Rh(e),n._key).then(t=>ij(e,n,t))}ec._jsonSchemaVersion="firestore/querySnapshot/1.0",ec._jsonSchema={type:zi("string",ec._jsonSchemaVersion),bundleSource:zi("string","QuerySnapshot"),bundleName:zi("string"),bundle:zi("string")};class bp extends nj{constructor(e){super(),this.firestore=e}convertBytes(e){return new gs(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fi(this.firestore,null,t)}}function uu(n){n=Xr(n,lo);const e=Xr(n.firestore,ro),t=Rh(e),r=new bp(e);return ej(n._query),AO(t,n._query).then(l=>new ec(e,r,n,l))}function mi(n,e,t){n=Xr(n,fi);const r=Xr(n.firestore,ro),l=Nv(n.converter,e,t);return Cv(r,[vv(Ph(r),"setDoc",n._key,l,n.converter!==null,t).toMutation(n._key,Nr.none())])}function mr(n,e,t,...r){n=Xr(n,fi);const l=Xr(n.firestore,ro),u=Ph(l);let f;return f=typeof(e=Dn(e))=="string"||e instanceof Ih?YS(u,"updateDoc",n._key,e,t,r):WS(u,"updateDoc",n._key,e),Cv(l,[f.toMutation(n._key,Nr.exists(!0))])}function so(n,e){const t=Xr(n.firestore,ro),r=gt(n),l=Nv(n.converter,e);return Cv(t,[vv(Ph(n.firestore),"addDoc",r._key,l,n.converter!==null,{}).toMutation(r._key,Nr.exists(!1))]).then(()=>r)}function Kt(n,...e){n=Dn(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||gw(e[r])||(t=e[r++]);const l={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(gw(e[r])){const _=e[r];e[r]=_.next?.bind(_),e[r+1]=_.error?.bind(_),e[r+2]=_.complete?.bind(_)}let u,f,y;if(n instanceof fi)f=Xr(n.firestore,ro),y=ap(n._key.path),u={next:_=>{e[r]&&e[r](ij(f,n,_))},error:e[r+1],complete:e[r+2]};else{const _=Xr(n,lo);f=Xr(_.firestore,ro),y=_._query;const v=new bp(f);u={next:w=>{e[r]&&e[r](new ec(f,v,_,w))},error:e[r+1],complete:e[r+2]},ej(n._query)}return function(v,w,R,I){const G=new gv(I),H=new fv(w,G,R);return v.asyncQueue.enqueueAndForget(async()=>uv(await Hm(v),H)),()=>{G.Nu(),v.asyncQueue.enqueueAndForget(async()=>dv(await Hm(v),H))}}(Rh(f),y,l,u)}function Cv(n,e){return function(r,l){const u=new xa;return r.asyncQueue.enqueueAndForget(async()=>dO(await EO(r),l,u)),u.promise}(Rh(n),e)}function ij(n,e,t){const r=t.docs.get(e._key),l=new bp(n);return new ll(n,l,e._key,r,new su(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FO={maxAttempts:5};function $d(n,e){if((n=Dn(n)).firestore!==e)throw new $e(Pe.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zO{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ph(e)}get(e){const t=$d(e,this._firestore),r=new VO(this._firestore);return this._transaction.lookup([t._key]).then(l=>{if(!l||l.length!==1)return vt(24041);const u=l[0];if(u.isFoundDocument())return new $m(this._firestore,r,u.key,u,t.converter);if(u.isNoDocument())return new $m(this._firestore,r,t._key,null,t.converter);throw vt(18433,{doc:u})})}set(e,t,r){const l=$d(e,this._firestore),u=Nv(l.converter,t,r),f=vv(this._dataReader,"Transaction.set",l._key,u,l.converter!==null,r);return this._transaction.set(l._key,f),this}update(e,t,r,...l){const u=$d(e,this._firestore);let f;return f=typeof(t=Dn(t))=="string"||t instanceof Ih?YS(this._dataReader,"Transaction.update",u._key,t,r,l):WS(this._dataReader,"Transaction.update",u._key,t),this._transaction.update(u._key,f),this}delete(e){const t=$d(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BO extends zO{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=$d(e,this._firestore),r=new bp(this._firestore);return super.get(e).then(l=>new ll(this._firestore,r,t._key,l._document,new su(!1,!1),t.converter))}}function HO(n,e,t){n=Xr(n,ro);const r={...FO,...t};return function(u){if(u.maxAttempts<1)throw new $e(Pe.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(u,f,y){const _=new xa;return u.asyncQueue.enqueueAndForget(async()=>{const v=await SO(u);new xO(u.asyncQueue,v,y,f,_).ju()}),_.promise}(Rh(n),l=>e(new BO(n,l)),r)}function ut(){return new bv("serverTimestamp")}(function(e,t=!0){(function(l){Nu=l})(cc),dl(new Ja("firestore",(r,{instanceIdentifier:l,options:u})=>{const f=r.getProvider("app").getImmediate(),y=new ro(new MP(r.getProvider("auth-internal")),new DP(f,r.getProvider("app-check-internal")),function(v,w){if(!Object.prototype.hasOwnProperty.apply(v.options,["projectId"]))throw new $e(Pe.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lh(v.options.projectId,w)}(f,l),f);return u={useFetchStreams:t,...u},y._setSettings(u),y},"PUBLIC").setMultipleInstances(!0)),Os(bT,xT,e),Os(bT,xT,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO="type.googleapis.com/google.protobuf.Int64Value",$O="type.googleapis.com/google.protobuf.UInt64Value";function rj(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function Gm(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Gm(e));if(typeof n=="function"||typeof n=="object")return rj(n,e=>Gm(e));throw new Error("Data cannot be encoded in JSON: "+n)}function bu(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case qO:case $O:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>bu(e)):typeof n=="function"||typeof n=="object"?rj(n,e=>bu(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qr extends ta{constructor(e,t,r){super(`${Rv}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Qr.prototype)}}function GO(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Zm(n,e){let t=GO(n),r=t,l;try{const u=e&&e.error;if(u){const f=u.status;if(typeof f=="string"){if(!vw[f])return new Qr("internal","internal");t=vw[f],r=f}const y=u.message;typeof y=="string"&&(r=y),l=u.details,l!==void 0&&(l=bu(l))}}catch{}return t==="ok"?null:new Qr(t,r,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZO{constructor(e,t,r,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Yr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(u=>this.auth=u,()=>{}),this.messaging||r.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l?.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_="us-central1",KO=/^data: (.*?)(?:\n|$)/;function WO(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Qr("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class YO{constructor(e,t,r,l,u=y_,f=(...y)=>fetch(...y)){this.app=e,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new ZO(e,t,r,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(u);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=y_}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function QO(n,e,t){const r=ao(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Qm(n.emulatorOrigin),Xm("Functions",!0))}function XO(n,e,t){const r=l=>eD(n,e,l,{});return r.stream=(l,u)=>nD(n,e,l,u),r}async function JO(n,e,t,r){t["Content-Type"]="application/json";let l;try{l=await r(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function sj(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function eD(n,e,t,r){const l=n._url(e);return tD(n,l,t,r)}async function tD(n,e,t,r){t=Gm(t);const l={data:t},u=await sj(n,r),f=r.timeout||7e4,y=WO(f),_=await Promise.race([JO(e,l,u,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!_)throw new Qr("cancelled","Firebase Functions instance was deleted.");const v=Zm(_.status,_.json);if(v)throw v;if(!_.json)throw new Qr("internal","Response is not valid JSON object.");let w=_.json.data;if(typeof w>"u"&&(w=_.json.result),typeof w>"u")throw new Qr("internal","Response is missing data field.");return{data:bu(w)}}function nD(n,e,t,r){const l=n._url(e);return iD(n,l,t,r||{})}async function iD(n,e,t,r){t=Gm(t);const l={data:t},u=await sj(n,r);u["Content-Type"]="application/json",u.Accept="text/event-stream";let f;try{f=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(l),headers:u,signal:r?.signal})}catch(I){if(I instanceof Error&&I.name==="AbortError"){const H=new Qr("cancelled","Request was cancelled.");return{data:Promise.reject(H),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(H)}}}}}}const G=Zm(0,null);return{data:Promise.reject(G),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(G)}}}}}}let y,_;const v=new Promise((I,G)=>{y=I,_=G});r?.signal?.addEventListener("abort",()=>{const I=new Qr("cancelled","Request was cancelled.");_(I)});const w=f.body.getReader(),R=rD(w,y,_,r?.signal);return{stream:{[Symbol.asyncIterator](){const I=R.getReader();return{async next(){const{value:G,done:H}=await I.read();return{value:G,done:H}},async return(){return await I.cancel(),{done:!0,value:void 0}}}}},data:v}}function rD(n,e,t,r){const l=(f,y)=>{const _=f.match(KO);if(!_)return;const v=_[1];try{const w=JSON.parse(v);if("result"in w){e(bu(w.result));return}if("message"in w){y.enqueue(bu(w.message));return}if("error"in w){const R=Zm(0,w);y.error(R),t(R);return}}catch(w){if(w instanceof Qr){y.error(w),t(w);return}}},u=new TextDecoder;return new ReadableStream({start(f){let y="";return _();async function _(){if(r?.aborted){const v=new Qr("cancelled","Request was cancelled");return f.error(v),t(v),Promise.resolve()}try{const{value:v,done:w}=await n.read();if(w){y.trim()&&l(y.trim(),f),f.close();return}if(r?.aborted){const I=new Qr("cancelled","Request was cancelled");f.error(I),t(I),await n.cancel();return}y+=u.decode(v,{stream:!0});const R=y.split(`
`);y=R.pop()||"";for(const I of R)I.trim()&&l(I.trim(),f);return _()}catch(v){const w=v instanceof Qr?v:Zm(0,null);f.error(w),t(w)}}},cancel(){return n.cancel()}})}const bw="@firebase/functions",xw="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="auth-internal",aD="app-check-internal",oD="messaging-internal";function lD(n){const e=(t,{instanceIdentifier:r})=>{const l=t.getProvider("app").getImmediate(),u=t.getProvider(sD),f=t.getProvider(oD),y=t.getProvider(aD);return new YO(l,u,f,y,r)};dl(new Ja(Rv,e,"PUBLIC").setMultipleInstances(!0)),Os(bw,xw,n),Os(bw,xw,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iv(n=vh(),e=y_){const r=_h(Dn(n),Rv).getImmediate({identifier:e}),l=C_("functions");return l&&cD(r,...l),r}function cD(n,e,t){QO(Dn(n),e,t)}function cl(n,e,t){return XO(Dn(n),e)}lD();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aj="firebasestorage.googleapis.com",oj="storageBucket",uD=120*1e3,dD=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi extends ta{constructor(e,t,r=0){super(xy(e),`Firebase Storage: ${t} (${xy(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,xi.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return xy(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bi;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bi||(bi={}));function xy(n){return"storage/"+n}function Pv(){const n="An unknown error occurred, please check the error payload for server response.";return new xi(bi.UNKNOWN,n)}function hD(n){return new xi(bi.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function fD(n){return new xi(bi.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function mD(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new xi(bi.UNAUTHENTICATED,n)}function pD(){return new xi(bi.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function gD(n){return new xi(bi.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function yD(){return new xi(bi.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function _D(){return new xi(bi.CANCELED,"User canceled the upload/download.")}function vD(n){return new xi(bi.INVALID_URL,"Invalid URL '"+n+"'.")}function bD(n){return new xi(bi.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function xD(){return new xi(bi.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+oj+"' property when initializing the app?")}function TD(){return new xi(bi.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function wD(){return new xi(bi.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ED(n){return new xi(bi.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function __(n){return new xi(bi.INVALID_ARGUMENT,n)}function lj(){return new xi(bi.APP_DELETED,"The Firebase app was deleted.")}function SD(n){return new xi(bi.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function th(n,e){return new xi(bi.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ad(n){throw new xi(bi.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=_s.makeFromUrl(e,t)}catch{return new _s(e,"")}if(r.path==="")return r;throw bD(e)}static makeFromUrl(e,t){let r=null;const l="([A-Za-z0-9.\\-_]+)";function u(we){we.path.charAt(we.path.length-1)==="/"&&(we.path_=we.path_.slice(0,-1))}const f="(/(.*))?$",y=new RegExp("^gs://"+l+f,"i"),_={bucket:1,path:3};function v(we){we.path_=decodeURIComponent(we.path)}const w="v[A-Za-z0-9_]+",R=t.replace(/[.]/g,"\\."),I="(/([^?#]*).*)?$",G=new RegExp(`^https?://${R}/${w}/b/${l}/o${I}`,"i"),H={bucket:1,path:3},Z=t===aj?"(?:storage.googleapis.com|storage.cloud.google.com)":t,F="([^?#]*)",Q=new RegExp(`^https?://${Z}/${l}/${F}`,"i"),ue=[{regex:y,indices:_,postModify:u},{regex:G,indices:H,postModify:v},{regex:Q,indices:{bucket:1,path:2},postModify:v}];for(let we=0;we<ue.length;we++){const Ce=ue[we],Ue=Ce.regex.exec(e);if(Ue){const P=Ue[Ce.indices.bucket];let M=Ue[Ce.indices.path];M||(M=""),r=new _s(P,M),Ce.postModify(r);break}}if(r==null)throw vD(e);return r}}class jD{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AD(n,e,t){let r=1,l=null,u=null,f=!1,y=0;function _(){return y===2}let v=!1;function w(...F){v||(v=!0,e.apply(null,F))}function R(F){l=setTimeout(()=>{l=null,n(G,_())},F)}function I(){u&&clearTimeout(u)}function G(F,...Q){if(v){I();return}if(F){I(),w.call(null,F,...Q);return}if(_()||f){I(),w.call(null,F,...Q);return}r<64&&(r*=2);let ue;y===1?(y=2,ue=0):ue=(r+Math.random())*1e3,R(ue)}let H=!1;function Z(F){H||(H=!0,I(),!v&&(l!==null?(F||(y=2),clearTimeout(l),R(0)):F||(y=1)))}return R(0),u=setTimeout(()=>{f=!0,Z(!0)},t),Z}function ND(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(n){return n!==void 0}function RD(n){return typeof n=="object"&&!Array.isArray(n)}function Mv(n){return typeof n=="string"||n instanceof String}function Tw(n){return kv()&&n instanceof Blob}function kv(){return typeof Blob<"u"}function ww(n,e,t,r){if(r<e)throw __(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw __(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function cj(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const l=e(r)+"="+e(n[r]);t=t+l+"&"}return t=t.slice(0,-1),t}var tc;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(tc||(tc={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ID(n,e){const t=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return t||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{constructor(e,t,r,l,u,f,y,_,v,w,R,I=!0,G=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=y,this.errorCallback_=_,this.timeout_=v,this.progressCallback_=w,this.connectionFactory_=R,this.retry=I,this.isUsingEmulator=G,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((H,Z)=>{this.resolve_=H,this.reject_=Z,this.start_()})}start_(){const e=(r,l)=>{if(l){r(!1,new qf(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=y=>{const _=y.loaded,v=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(_,v)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const y=u.getErrorCode()===tc.NO_ERROR,_=u.getStatus();if(!y||ID(_,this.additionalRetryCodes_)&&this.retry){const w=u.getErrorCode()===tc.ABORT;r(!1,new qf(!1,null,w));return}const v=this.successCodes_.indexOf(_)!==-1;r(!0,new qf(v,u))})},t=(r,l)=>{const u=this.resolve_,f=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const _=this.callback_(y,y.getResponse());CD(_)?u(_):u()}catch(_){f(_)}else if(y!==null){const _=Pv();_.serverResponse=y.getErrorText(),this.errorCallback_?f(this.errorCallback_(y,_)):f(_)}else if(l.canceled){const _=this.appDelete_?lj():_D();f(_)}else{const _=yD();f(_)}};this.canceled_?t(!1,new qf(!1,null,!0)):this.backoffId_=AD(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&ND(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class qf{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function MD(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function kD(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function OD(n,e){e&&(n["X-Firebase-GMPID"]=e)}function DD(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function LD(n,e,t,r,l,u,f=!0,y=!1){const _=cj(n.urlParams),v=n.url+_,w=Object.assign({},n.headers);return OD(w,e),MD(w,t),kD(w,u),DD(w,r),new PD(v,n.method,w,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f,y)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VD(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function UD(...n){const e=VD();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(kv())return new Blob(n);throw new xi(bi.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function FD(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zD(n){if(typeof atob>"u")throw ED("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Ty{constructor(e,t){this.data=e,this.contentType=t||null}}function BD(n,e){switch(n){case _a.RAW:return new Ty(uj(e));case _a.BASE64:case _a.BASE64URL:return new Ty(dj(n,e));case _a.DATA_URL:return new Ty(qD(e),$D(e))}throw Pv()}function uj(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const u=r,f=n.charCodeAt(++t);r=65536|(u&1023)<<10|f&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function HD(n){let e;try{e=decodeURIComponent(n)}catch{throw th(_a.DATA_URL,"Malformed data URL.")}return uj(e)}function dj(n,e){switch(n){case _a.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw th(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case _a.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw th(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=zD(e)}catch(l){throw l.message.includes("polyfill")?l:th(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let l=0;l<t.length;l++)r[l]=t.charCodeAt(l);return r}class hj{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw th(_a.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=GD(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function qD(n){const e=new hj(n);return e.base64?dj(_a.BASE64,e.rest):HD(e.rest)}function $D(n){return new hj(n).contentType}function GD(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,t){let r=0,l="";Tw(e)?(this.data_=e,r=e.size,l=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,t){if(Tw(this.data_)){const r=this.data_,l=FD(r,e,t);return l===null?null:new nl(l)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new nl(r,!0)}}static getBlob(...e){if(kv()){const t=e.map(r=>r instanceof nl?r.data_:r);return new nl(UD.apply(null,t))}else{const t=e.map(f=>Mv(f)?BD(_a.RAW,f).data:f.data_);let r=0;t.forEach(f=>{r+=f.byteLength});const l=new Uint8Array(r);let u=0;return t.forEach(f=>{for(let y=0;y<f.length;y++)l[u++]=f[y]}),new nl(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fj(n){let e;try{e=JSON.parse(n)}catch{return null}return RD(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function KD(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function mj(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WD(n,e){return e}class Vr{constructor(e,t,r,l){this.server=e,this.local=t||e,this.writable=!!r,this.xform=l||WD}}let $f=null;function YD(n){return!Mv(n)||n.length<2?n:mj(n)}function pj(){if($f)return $f;const n=[];n.push(new Vr("bucket")),n.push(new Vr("generation")),n.push(new Vr("metageneration")),n.push(new Vr("name","fullPath",!0));function e(u,f){return YD(f)}const t=new Vr("name");t.xform=e,n.push(t);function r(u,f){return f!==void 0?Number(f):f}const l=new Vr("size");return l.xform=r,n.push(l),n.push(new Vr("timeCreated")),n.push(new Vr("updated")),n.push(new Vr("md5Hash",null,!0)),n.push(new Vr("cacheControl",null,!0)),n.push(new Vr("contentDisposition",null,!0)),n.push(new Vr("contentEncoding",null,!0)),n.push(new Vr("contentLanguage",null,!0)),n.push(new Vr("contentType",null,!0)),n.push(new Vr("metadata","customMetadata",!0)),$f=n,$f}function QD(n,e){function t(){const r=n.bucket,l=n.fullPath,u=new _s(r,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:t})}function XD(n,e,t){const r={};r.type="file";const l=t.length;for(let u=0;u<l;u++){const f=t[u];r[f.local]=f.xform(r,e[f.server])}return QD(r,n),r}function gj(n,e,t){const r=fj(e);return r===null?null:XD(n,r,t)}function JD(n,e,t,r){const l=fj(e);if(l===null||!Mv(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(v=>{const w=n.bucket,R=n.fullPath,I="/b/"+f(w)+"/o/"+f(R),G=Ov(I,t,r),H=cj({alt:"media",token:v});return G+H})[0]}function eL(n,e){const t={},r=e.length;for(let l=0;l<r;l++){const u=e[l];u.writable&&(t[u.server]=n[u.local])}return JSON.stringify(t)}class yj{constructor(e,t,r,l){this.url=e,this.method=t,this.handler=r,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _j(n){if(!n)throw Pv()}function tL(n,e){function t(r,l){const u=gj(n,l,e);return _j(u!==null),u}return t}function nL(n,e){function t(r,l){const u=gj(n,l,e);return _j(u!==null),JD(u,l,n.host,n._protocol)}return t}function vj(n){function e(t,r){let l;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?l=pD():l=mD():t.getStatus()===402?l=fD(n.bucket):t.getStatus()===403?l=gD(n.path):l=r,l.status=t.getStatus(),l.serverResponse=r.serverResponse,l}return e}function iL(n){const e=vj(n);function t(r,l){let u=e(r,l);return r.getStatus()===404&&(u=hD(n.path)),u.serverResponse=l.serverResponse,u}return t}function rL(n,e,t){const r=e.fullServerUrl(),l=Ov(r,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,y=new yj(l,u,nL(n,t),f);return y.errorHandler=iL(e),y}function sL(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function aL(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=sL(null,e)),r}function oL(n,e,t,r,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function y(){let ue="";for(let we=0;we<2;we++)ue=ue+Math.random().toString().slice(2);return ue}const _=y();f["Content-Type"]="multipart/related; boundary="+_;const v=aL(e,r,l),w=eL(v,t),R="--"+_+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+_+`\r
Content-Type: `+v.contentType+`\r
\r
`,I=`\r
--`+_+"--",G=nl.getBlob(R,r,I);if(G===null)throw TD();const H={name:v.fullPath},Z=Ov(u,n.host,n._protocol),F="POST",Q=n.maxUploadRetryTime,se=new yj(Z,F,tL(n,t),Q);return se.urlParams=H,se.headers=f,se.body=G.uploadData(),se.errorHandler=vj(e),se}class lL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=tc.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=tc.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=tc.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,l,u){if(this.sent_)throw Ad("cannot .send() more than once");if(ao(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),u!==void 0)for(const f in u)u.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,u[f].toString());return l!==void 0?this.xhr_.send(l):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ad("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ad("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ad("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ad("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class cL extends lL{initXhr(){this.xhr_.responseType="text"}}function bj(){return new cL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e,t){this._service=e,t instanceof _s?this._location=t:this._location=_s.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new oc(e,t)}get root(){const e=new _s(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return mj(this._location.path)}get storage(){return this._service}get parent(){const e=ZD(this._location.path);if(e===null)return null;const t=new _s(this._location.bucket,e);return new oc(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw SD(e)}}function uL(n,e,t){n._throwIfRoot("uploadBytes");const r=oL(n.storage,n._location,pj(),new nl(e,!0),t);return n.storage.makeRequestWithTokens(r,bj).then(l=>({metadata:l,ref:n}))}function dL(n){n._throwIfRoot("getDownloadURL");const e=rL(n.storage,n._location,pj());return n.storage.makeRequestWithTokens(e,bj).then(t=>{if(t===null)throw wD();return t})}function hL(n,e){const t=KD(n._location.path,e),r=new _s(n._location.bucket,t);return new oc(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fL(n){return/^[A-Za-z]+:\/\//.test(n)}function mL(n,e){return new oc(n,e)}function xj(n,e){if(n instanceof Dv){const t=n;if(t._bucket==null)throw xD();const r=new oc(t,t._bucket);return e!=null?xj(r,e):r}else return e!==void 0?hL(n,e):n}function pL(n,e){if(e&&fL(e)){if(n instanceof Dv)return mL(n,e);throw __("To use ref(service, url), the first argument must be a Storage instance.")}else return xj(n,e)}function Ew(n,e){const t=e?.[oj];return t==null?null:_s.makeFromBucketSpec(t,n)}function gL(n,e,t,r={}){n.host=`${e}:${t}`;const l=ao(e);l&&(Qm(`https://${n.host}/b`),Xm("Storage",!0)),n._isUsingEmulator=!0,n._protocol=l?"https":"http";const{mockUserToken:u}=r;u&&(n._overrideAuthToken=typeof u=="string"?u:FE(u,n.app.options.projectId))}class Dv{constructor(e,t,r,l,u,f=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=l,this._firebaseVersion=u,this._isUsingEmulator=f,this._bucket=null,this._host=aj,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=uD,this._maxUploadRetryTime=dD,this._requests=new Set,l!=null?this._bucket=_s.makeFromBucketSpec(l,this._host):this._bucket=Ew(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=_s.makeFromBucketSpec(this._url,e):this._bucket=Ew(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ww("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ww("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Yr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new oc(this,e)}_makeRequest(e,t,r,l,u=!0){if(this._deleted)return new jD(lj());{const f=LD(e,this._appId,r,l,t,this._firebaseVersion,u,this._isUsingEmulator);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,t){const[r,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,l).getPromise()}}const Sw="@firebase/storage",jw="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj="storage";function wj(n,e,t){return n=Dn(n),uL(n,e,t)}function Ej(n){return n=Dn(n),dL(n)}function Sj(n,e){return n=Dn(n),pL(n,e)}function yL(n=vh(),e){n=Dn(n);const r=_h(n,Tj).getImmediate({identifier:e}),l=C_("storage");return l&&_L(r,...l),r}function _L(n,e,t,r={}){gL(n,e,t,r)}function vL(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new Dv(t,r,l,e,cc)}function bL(){dl(new Ja(Tj,vL,"PUBLIC").setMultipleInstances(!0)),Os(Sw,jw,""),Os(Sw,jw,"esm2020")}bL();const xL={apiKey:"AIzaSyDv4uaabwiRjMwO8nx5qqGoa2UgqWk0k2s",authDomain:"envios-realtime.firebaseapp.com",projectId:"envios-realtime",storageBucket:"envios-realtime.firebasestorage.app",messagingSenderId:"18006271860",appId:"1:18006271860:web:c404936210a95f2c436e21"},jj="us-central1".trim(),xp=oI().length?vh():HE(xL),du=np(xp),ze=CO(xp),hu=Iv(xp,jj),Aj=yL(xp);console.log("[Firebase] Functions region:",jj);async function Qn(){const e=(du.currentUser||null)?.uid||null;let t=null;try{t=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{t=null}const r=t?.uid||t?.id||null,l=t?.empresaId??null,u=e||r||null,f=l!=null?String(l):null;if(!u||!f)return console.warn("ensureUsuarioActivo: falta uid o empresaId",{uid:u,empresaId:f}),!1;const y=gt(ze,"usuarios",u),_=await Jr(y);if(!_.exists())await mi(y,{uid:u,empresaId:f,createdAt:ut(),updatedAt:ut()},{merge:!0});else{const w=_.data()||{};(!w.empresaId||String(w.empresaId)!==f)&&await mr(y,{empresaId:f,updatedAt:ut()})}const v={...t||{},uid:u,empresaId:f};return localStorage.setItem("usuarioActivo",JSON.stringify(v)),!0}let Aw=!1;function TL(){if(Aw)return;Aw=!0;const n=document.createElement("style");n.id="planbadge-css",n.innerHTML=`
    .plan-badge {
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid #e5e7eb; background:#f8fafc; color:#374151;
      font-size:12px; font-weight:600; text-decoration:none;
    }
    .plan-badge:hover { background:#eef2ff; }
  `,document.head.appendChild(n)}TL();function wL(){const[n,e]=E.useState(!0),[t,r]=E.useState(null);return E.useEffect(()=>{(async()=>{try{if(!await Qn()){e(!1);return}const u=Iv(),y=await cl(u,"getMyPlan")({});if(!y?.data?.ok){e(!1);return}const{catalog:_,consumo:v,plan:w}=y.data||{},R=_?.nombre||w?.planId||"Plan",I=_?.limites?.ordersPerMonth??null,G=Number(v?.ordenesCreadas||0),H=I!=null?`${R} · ${G}/${I}`:`${R}`;r(H)}catch{}finally{e(!1)}})()},[]),n||!t?null:a.jsxs(Zt,{to:"/planes",className:"plan-badge",title:"Ver/actualizar plan",children:["💳 ",t]})}function EL(){const[n,e]=E.useState({loading:!0,error:"",planName:"",limit:null,used:0,blocked:!1}),t=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),r=t?.empresaId!=null?String(t.empresaId):null;return E.useEffect(()=>{let l=!0;return(async()=>{if(e(v=>({...v,loading:!0,error:""})),!await Qn()||!r){l&&e(v=>({...v,loading:!1,error:"No autenticado o sin empresaId"}));return}const f=`planGate:${r}`,y=(()=>{try{return JSON.parse(sessionStorage.getItem(f)||"null")}catch{return null}})(),_=Date.now();if(y&&_-(y.ts||0)<3e4){l&&e({loading:!1,error:"",...y.data});return}try{const w=Iv(void 0,"us-central1"),I=await cl(w,"getMyPlan")({});if(!I?.data?.ok)throw new Error("Respuesta inválida de getMyPlan");const G=I.data.catalog||{},H=I.data.consumo||{},Z=Number(G?.limites?.ordersPerMonth??NaN),F=Number(H?.ordenesCreadas??0),Q={planName:G?.nombre||I.data.plan?.planId||"—",limit:Number.isFinite(Z)?Z:null,used:Number.isFinite(F)?F:0},se=Q.limit!=null&&Q.used>=Q.limit,ue={...Q,blocked:se};sessionStorage.setItem(f,JSON.stringify({ts:_,data:ue})),l&&e({loading:!1,error:"",...ue})}catch(v){l&&e(w=>({...w,loading:!1,error:v?.message||"Error consultando plan"}))}})(),()=>{l=!1}},[r]),n}function SL(n){const e=String(n||"").trim().toLowerCase();return{admin:"administrador",administrador:"administrador",administrator:"administrador",operador:"operador",operator:"operador",mensajero:"mensajero",rider:"mensajero",courier:"mensajero",delivery:"mensajero",deliveryman:"mensajero",repartidor:"mensajero",gerente:"gerente",manager:"gerente"}[e]||e}function jL(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const e=SL(n?.rol),t=es(),r=e==="administrador"||e==="operador",u=!!EL()?.blocked,[f,y]=E.useState(!1),_=E.useRef(null);E.useEffect(()=>{y(!1)},[t.pathname]),E.useEffect(()=>{function R(I){_.current&&!_.current.contains(I.target)&&y(!1)}return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[]);const v=(R,{prefixes:I=[],exact:G=!0}={})=>{const H=t.pathname||"/";return!G&&H.startsWith(R)||I.some(Z=>H.startsWith(Z))?!0:H===R},w=({to:R,children:I,activePrefixes:G=[],exact:H=!0})=>{const Z=v(R,{prefixes:G,exact:H});return a.jsx(Zt,{to:R,style:{display:"block",textDecoration:"none",padding:"8px 12px",borderRadius:8,fontWeight:Z?700:500,background:Z?"var(--menu-active-bg, #f3f4f6)":"transparent"},children:I})};return a.jsxs("nav",{style:{display:"flex",alignItems:"center",gap:12,padding:10,borderBottom:"1px solid #050505ff",background:"var(--menu-bg, #ffffffff)",position:"sticky",top:0,zIndex:10},children:[a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[(e==="administrador"||e==="operador"||e==="gerente")&&a.jsx(Zt,{to:"/dashboard",style:{textDecoration:"none",padding:"6px 10px",borderRadius:8,fontWeight:v("/dashboard")?700:500,background:v("/dashboard")?"var(--menu-active-bg, #f3f4f6)":"transparent"},children:"Dashboard"}),a.jsxs("div",{ref:_,style:{position:"relative"},children:[a.jsx("button",{onClick:()=>y(R=>!R),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #000000ff",background:"#56a299ff",cursor:"pointer",fontWeight:600},"aria-expanded":f,"aria-haspopup":"menu",children:"Menú ▾"}),f&&a.jsxs("div",{role:"menu",style:{position:"absolute",top:"110%",left:0,minWidth:260,background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:10,boxShadow:"0 10px 25px rgba(0,0,0,0.08)",padding:8},children:[e==="operador"&&a.jsxs(a.Fragment,{children:[a.jsx(w,{to:"/ordenes",exact:!1,activePrefixes:["/orden/","/orden/nueva","/seleccionar-destino/"],children:"📦 Gestión de Órdenes"}),a.jsx(w,{to:"/programas",children:"🚚 Programar Entregas"}),a.jsx(w,{to:"/seguimiento-rutas",exact:!1,activePrefixes:["/seguimiento"],children:"🚦 Seguimiento de Rutas"}),a.jsx(w,{to:"/alertas-sla",exact:!1,activePrefixes:["/alertas"],children:"📣 Alertas SLA"}),a.jsx(w,{to:"/estadisticas-operador",children:"📈 Estadísticas de Operador"}),a.jsx(w,{to:"/reportes",children:"📑 Reportes"}),a.jsx(w,{to:"/planes",children:"💳 Planes"})]}),e==="mensajero"&&a.jsx(a.Fragment,{children:a.jsx(w,{to:"/entregas",exact:!1,activePrefixes:["/orden/","/ruta-mensajero/"],children:"📝 Órdenes Pendientes"})}),e==="administrador"&&a.jsxs(a.Fragment,{children:[a.jsx(w,{to:"/estadisticas",children:"📊 Estadísticas"}),a.jsx(w,{to:"/ordenes",exact:!1,activePrefixes:["/orden/","/orden/nueva","/seleccionar-destino/"],children:"📦 Gestión de Órdenes"}),a.jsx(w,{to:"/programas",children:"🚚 Programar Entregas"}),a.jsx(w,{to:"/seguimiento-rutas",exact:!1,activePrefixes:["/seguimiento"],children:"🚦 Seguimiento de Rutas"}),a.jsx(w,{to:"/alertas-sla",exact:!1,activePrefixes:["/alertas"],children:"📣 Alertas SLA"}),a.jsx(w,{to:"/historial",children:"📜 Historial"}),a.jsx(w,{to:"/estadisticas-operador",children:"📈 Estadísticas de Operador"}),a.jsx(w,{to:"/mapa-mensajeros",exact:!1,activePrefixes:["/mapa/"],children:"🗺️ Mapa de Mensajeros"}),a.jsx(w,{to:"/reportes",children:"📑 Reportes"}),a.jsx(w,{to:"/planes",children:"💳 Planes"}),a.jsx(w,{to:"/equipo",children:"👥 Equipo"})]}),e==="gerente"&&a.jsxs(a.Fragment,{children:[a.jsx(w,{to:"/estadisticas",children:"📊 Estadísticas"}),a.jsx(w,{to:"/ordenes",exact:!1,activePrefixes:["/orden/","/seleccionar-destino/"],children:"📦 Órdenes de Entrega"}),a.jsx(w,{to:"/seguimiento-rutas",exact:!1,activePrefixes:["/seguimiento"],children:"🚦 Seguimiento de Rutas"}),a.jsx(w,{to:"/alertas-sla",exact:!1,activePrefixes:["/alertas"],children:"📣 Alertas SLA"}),a.jsx(w,{to:"/historial",children:"📜 Historial"}),a.jsx(w,{to:"/estadisticas-operador",children:"📈 Estadísticas de Operador"}),a.jsx(w,{to:"/mapa-mensajeros",exact:!1,activePrefixes:["/mapa/"],children:"🗺️ Mapa de Mensajeros"}),a.jsx(w,{to:"/reportes",children:"📑 Reportes"}),a.jsx(w,{to:"/equipo",children:"👥 Equipo"})]})]})]})]}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[a.jsx(wL,{}),r&&a.jsx(Zt,{to:u?"/planes":"/ordenes",onClick:R=>{u&&(R.preventDefault(),window.alert("Alcanzaste el límite de órdenes del plan. Revisa/actualiza tu plan."))},style:{textDecoration:"none",padding:"8px 12px",borderRadius:10,background:u?"#000000ff":"#221fd3ff",color:"#69b1adff",border:"1px solid "+(u?"#5b6677ff":"#345baeff"),fontWeight:600,cursor:"pointer",opacity:u?.85:1},title:u?"Límite alcanzado":"Crear una nueva orden",children:"+ Nueva orden"}),a.jsx(OC,{}),a.jsx("button",{onClick:()=>{localStorage.removeItem("usuarioActivo"),window.location.href="/"},style:{padding:"8px 12px",borderRadius:10,border:"1px solid #000000ff",background:"#810606ff",cursor:"pointer",color:"#fff"},children:"Cerrar sesión"})]})]})}function AL(n){return String(n||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")}function NL(n){switch(n?.code||""){case"auth/invalid-email":return"Email inválido.";case"auth/missing-password":return"Falta la contraseña.";case"auth/weak-password":return"La contraseña debe tener al menos 6 caracteres.";case"auth/user-disabled":return"El usuario está deshabilitado.";case"auth/user-not-found":return"Usuario no encontrado.";case"auth/wrong-password":return"Contraseña incorrecta.";case"auth/invalid-credential":return"Credenciales inválidas.";case"auth/network-request-failed":return"Error de red. Revisa tu conexión.";case"auth/too-many-requests":return"Demasiados intentos. Intenta más tarde.";case"auth/operation-not-allowed":return"Habilita Email/Password en Firebase Authentication.";case"auth/invalid-api-key":return"API Key inválida en firebaseConfig.";default:return n?.message||"Error al iniciar sesión."}}function CL(){const[n,e]=E.useState("Gomez"),[t,r]=E.useState("oziel"),[l,u]=E.useState(""),[f,y]=E.useState(""),[_,v]=E.useState("administrador"),[w,R]=E.useState(!1),[I,G]=E.useState(""),H=rr();async function Z(){if(G(""),!n.trim())return G("Escribe el nombre de la empresa.");if(!t.trim())return G("Escribe tu nombre.");if(!l.trim())return G("Escribe un email.");if(!/^[^@]+@[^@]+\.[^@]+$/.test(l))return G("Email inválido.");if(!f)return G("Escribe una contraseña.");if(f.length<6)return G("La contraseña debe tener al menos 6 caracteres.");R(!0);try{await _2(du,v1).catch(()=>{});let F=null;try{F=(await V_(du,l,f)).user.uid}catch(M){if(M?.code==="auth/user-not-found")F=(await Au(du,l,f)).user.uid;else throw M}const Q=String(AL(n)||"empresa"),se=String(_||"").toLowerCase(),ue=gt(ze,"usuarios",F);(await Jr(ue)).exists()?await mi(ue,{empresaId:Q,rol:se,nombre:t,email:l,updatedAt:ut()},{merge:!0}):await mi(ue,{uid:F,empresaId:Q,rol:se,nombre:t,email:l,createdAt:ut(),updatedAt:ut()});const Ce=gt(ze,"empresas",Q);(await Jr(Ce)).exists()?await mi(Ce,{updatedAt:ut()},{merge:!0}):await mi(Ce,{nombre:n,plan:"basic",ownerUid:F,createdAt:ut(),updatedAt:ut()});const P={id:F,uid:F,nombre:t,email:l,rol:se,empresaId:Q};switch(localStorage.setItem("usuarioActivo",JSON.stringify(P)),se){case"administrador":H("/dashboard");break;case"gerente":H("/dashboard");break;case"operador":H("/ordenes");break;case"mensajero":H("/entregas");break;default:H("/dashboard")}}catch(F){const Q=NL(F);G(Q),alert(Q)}finally{R(!1)}}return a.jsxs("div",{style:{padding:20,maxWidth:480,margin:"0 auto"},children:[a.jsx("h1",{children:"Acceso"}),a.jsxs("div",{style:{display:"grid",gap:10},children:[a.jsxs("label",{children:["Empresa",a.jsx("input",{type:"text",placeholder:"Nombre de la empresa",value:n,onChange:F=>e(F.target.value)})]}),a.jsxs("label",{children:["Tu nombre",a.jsx("input",{type:"text",placeholder:"Tu nombre",value:t,onChange:F=>r(F.target.value)})]}),a.jsxs("label",{children:["Email",a.jsx("input",{type:"email",placeholder:"tucorreo@dominio.com",value:l,onChange:F=>u(F.target.value)})]}),a.jsxs("label",{children:["Contraseña",a.jsx("input",{type:"password",placeholder:"•••••••• (mínimo 6)",value:f,onChange:F=>y(F.target.value)})]}),a.jsxs("label",{children:["Rol",a.jsxs("select",{value:_,onChange:F=>v(F.target.value),children:[a.jsx("option",{value:"administrador",children:"Administrador"}),a.jsx("option",{value:"gerente",children:"Gerente"}),a.jsx("option",{value:"operador",children:"Operador"}),a.jsx("option",{value:"mensajero",children:"Mensajero"})]})]}),I&&a.jsx("div",{style:{color:"#b00"},children:I}),a.jsx("button",{onClick:Z,disabled:w,children:w?"Procesando...":"Ingresar / Crear y vincular"})]}),a.jsxs("p",{style:{fontSize:12,color:"#666",marginTop:10},children:["Se vinculará tu usuario a la empresa ",a.jsx("b",{children:n||"—"}),"."]})]})}const RL=[{id:1,src:"/landing/hero-dashboard.jpg",title:"Panel de control"},{id:2,src:"/landing/live-tracking.jpg",title:"Tracking en vivo"},{id:3,src:"/landing/courier-map.jpg",title:"Mapa de mensajeros"},{id:4,src:"/landing/route-optimized.jpg",title:"Rutas optimizadas"},{id:5,src:"/landing/eta-prediction.jpg",title:"ETA y SLA"},{id:6,src:"/landing/scan-proof.jpg",title:"Prueba de entrega"},{id:7,src:"/landing/analytics.jpg",title:"Estadísticas"},{id:8,src:"/landing/orders-board.jpg",title:"Órdenes en cola"},{id:9,src:"/landing/customer-sms.jpg",title:"Notificaciones"},{id:10,src:"/landing/fleet-overview.jpg",title:"Flota y zonas"},{id:11,src:"/landing/mobile-courier.jpg",title:"App del mensajero"},{id:12,src:"/landing/heatmap.jpg",title:"Heatmap de entregas"}];function IL({onLogin:n=()=>{},onRegister:e=()=>{},onDemo:t=()=>{}}){return a.jsxs("div",{className:"min-h-screen bg-black text-white",children:[a.jsx("header",{className:"sticky top-0 z-40 bg-black/70 backdrop-blur border-b border-white/10",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-9 w-9 rounded-2xl bg-white/10 grid place-items-center font-bold",children:"EV"}),a.jsx("span",{className:"text-sm md:text-base font-semibold tracking-wide",children:"Envíos · Logística en tiempo real"})]}),a.jsxs("nav",{className:"hidden md:flex items-center gap-6 text-sm text-white/80",children:[a.jsx("a",{href:"#features",className:"hover:text-white",children:"Características"}),a.jsx("a",{href:"#preview",className:"hover:text-white",children:"Vista previa"}),a.jsx("a",{href:"#planes",className:"hover:text-white",children:"Planes"}),a.jsx("a",{href:"#faq",className:"hover:text-white",children:"Preguntas"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:t,className:"px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20",children:"Probar demo"}),a.jsx("button",{onClick:n,className:"px-3 py-2 rounded-xl bg-white text-black",children:"Iniciar sesión"})]})]})}),a.jsxs("section",{className:"relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(90%_60%_at_20%_0%,rgba(16,185,129,.15),rgba(0,0,0,0))] pointer-events-none"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-14 md:py-20 grid lg:grid-cols-[1.05fr_.95fr] gap-10 items-center",children:[a.jsxs("div",{children:[a.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs border border-emerald-400/30 bg-emerald-400/10 text-emerald-200",children:"• En vivo — seguimiento, rutas y KPIs"}),a.jsxs("h1",{className:"mt-4 text-4xl md:text-6xl font-bold leading-tight",children:["Gestiona tus ",a.jsx("span",{className:"text-emerald-300",children:"entregas"})," con precisión,",a.jsx("br",{className:"hidden md:block"})," en un solo lugar."]}),a.jsx("p",{className:"mt-4 text-white/70 max-w-xl",children:"Crea órdenes, asigna mensajeros, optimiza rutas, predice tiempos y comparte el tracking con tus clientes. Todo sincronizado en tiempo real."}),a.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3",children:[a.jsx("button",{onClick:e,className:"px-5 py-3 rounded-2xl bg-emerald-500 hover:bg-emerald-400 text-black font-medium",children:"Crear cuenta gratis"}),a.jsx("button",{onClick:t,className:"px-5 py-3 rounded-2xl bg-white/10 hover:bg-white/20",children:"Explorar demo (solo lectura)"})]}),a.jsxs("div",{className:"mt-8 grid grid-cols-3 gap-4 text-center",children:[a.jsx(Ey,{label:"Órdenes/mes",value:"50–∞"}),a.jsx(Ey,{label:"Asignación",value:"1 clic"}),a.jsx(Ey,{label:"Actualización",value:"Tiempo real"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsxs("div",{className:"rounded-2xl overflow-hidden border border-white/10 bg-white/5 shadow-[0_20px_60px_-20px_rgba(16,185,129,.25)]",children:[a.jsxs("div",{className:"px-4 py-3 text-sm border-b border-white/10 flex items-center gap-2",children:[a.jsx("span",{className:"inline-block h-2.5 w-2.5 rounded-full bg-emerald-400"}),a.jsx("span",{className:"text-white/70",children:"Panel de envíos (vista previa)"})]}),a.jsxs("div",{className:"p-4 md:p-6 grid md:grid-cols-3 gap-4",children:[a.jsx(wy,{title:"Órdenes de hoy",value:"128",sub:"+12% vs ayer"}),a.jsx(wy,{title:"En ruta",value:"42",sub:"ETA promedio 19min"}),a.jsx(wy,{title:"Entregadas",value:"79",sub:"SLA 94%"}),a.jsx("div",{className:"md:col-span-2 rounded-xl border border-white/10 bg-black/30 p-3",children:a.jsx(PL,{})}),a.jsx("div",{className:"rounded-xl border border-white/10 bg-black/30 p-3",children:a.jsx(ML,{})})]})]}),a.jsx("div",{className:"absolute -inset-6 rounded-[28px] pointer-events-none bg-[radial-gradient(40%_30%_at_50%_0%,rgba(16,185,129,.25),rgba(0,0,0,0))]"})]})]})]}),a.jsx("section",{id:"features",className:"max-w-7xl mx-auto px-4 py-12",children:a.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[a.jsx(Gf,{icon:"📍",title:"Tracking en vivo",desc:"Ubicación de mensajeros y destinatarios con actualización en tiempo real."}),a.jsx(Gf,{icon:"🧭",title:"Rutas optimizadas",desc:"Secuencias inteligentes por cercanía, tráfico y ventanas horarias."}),a.jsx(Gf,{icon:"⏱️",title:"ETA & SLA",desc:"Compromisos de tiempo y alertas cuando algo se desvía del plan."}),a.jsx(Gf,{icon:"📊",title:"Analytics",desc:"KPIs por franja, mensajero, zona y desempeño de la flota."})]})}),a.jsxs("section",{id:"preview",className:"max-w-7xl mx-auto px-4 py-6",children:[a.jsxs("div",{className:"flex items-baseline justify-between mb-3",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Vista previa"}),a.jsx("button",{onClick:t,className:"text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/20",children:"Abrir demo"})]}),a.jsx("div",{className:"columns-1 sm:columns-2 lg:columns-4 gap-4 [&>*]:mb-4",children:RL.map(r=>a.jsxs("figure",{className:"break-inside-avoid rounded-2xl overflow-hidden border border-white/10 bg-white/5 group relative",children:[a.jsx("img",{src:r.src,alt:r.title,className:"w-full h-auto block object-cover group-hover:opacity-90 transition",onError:l=>{l.currentTarget.outerHTML=`
                    <div class="aspect-[4/5] grid place-items-center text-white/40 text-xs bg-neutral-900/40">
                      ${r.title}
                    </div>`}}),a.jsx("figcaption",{className:"absolute bottom-0 left-0 right-0 p-3 text-xs bg-gradient-to-t from-black/70 to-transparent",children:a.jsx("span",{className:"text-white/90",children:r.title})})]},r.id))})]}),a.jsx("section",{id:"planes",className:"max-w-7xl mx-auto px-4 py-12",children:a.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[a.jsx(Sy,{name:"Free",price:"$0",bullets:["1 admin • 1 operador • 1 mensajero","Hasta 50 órdenes/mes","Vista previa de mapas y stats"],cta:"Comenzar",onClick:e}),a.jsx(Sy,{focus:!0,name:"Básico",price:"$8",bullets:["1 admin • 2 operadores • 1 mensajero","Hasta 300 órdenes/mes","Estadísticas y auditoría"],cta:"Elegir Básico",onClick:e}),a.jsx(Sy,{name:"Ilimitado",price:"$999",bullets:["Usuarios y órdenes ilimitados","SLAs avanzados y API","Soporte priorizado"],cta:"Contactar",onClick:e})]})}),a.jsx("section",{className:"max-w-7xl mx-auto px-4 pb-16",children:a.jsxs("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 flex flex-col md:flex-row items-center gap-6",children:[a.jsx("div",{className:"h-12 w-12 rounded-2xl bg-emerald-400/10 grid place-items-center text-2xl",children:"🔒"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Seguridad y control"}),a.jsx("p",{className:"text-sm text-white/70",children:"Reglas de Firestore, auditoría de cambios y límites por plan. Tus datos viajan cifrados y se sincronizan en tiempo real."})]}),a.jsx("button",{onClick:e,className:"px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20",children:"Crear cuenta"})]})}),a.jsx("footer",{id:"faq",className:"border-t border-white/10 py-6 text-center text-white/50 text-sm",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:["© ",new Date().getFullYear()," Envíos. Hecho para operar rápido."]})})]})}function wy({title:n,value:e,sub:t}){return a.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/30 p-4",children:[a.jsx("div",{className:"text-sm text-white/60",children:n}),a.jsx("div",{className:"text-2xl font-semibold mt-1",children:e}),a.jsx("div",{className:"text-xs text-white/50 mt-1",children:t})]})}function PL(){return a.jsxs("div",{className:"h-40 w-full relative overflow-hidden rounded-lg bg-[linear-gradient(180deg,rgba(255,255,255,.04),transparent)]",children:[a.jsx("div",{className:"absolute inset-0 opacity-70",children:a.jsx("svg",{viewBox:"0 0 400 160",className:"w-full h-full",children:a.jsx("polyline",{fill:"none",stroke:"rgba(52,211,153,.8)",strokeWidth:"3",points:"0,120 40,100 80,110 120,80 160,95 200,70 240,75 280,60 320,72 360,50 400,62"})})}),a.jsx("div",{className:"absolute inset-x-0 bottom-0 text-[10px] text-white/40 px-2 py-1",children:"Hoy"})]})}function ML(){const n=[{id:"A-1023",name:"Pedido Zonas Norte",eta:"12:35"},{id:"A-1024",name:"Farmacia Central",eta:"12:41"},{id:"A-1025",name:"Pedido Express",eta:"12:55"},{id:"A-1026",name:"Repuesto Carrera 5",eta:"13:08"}];return a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-white/70 mb-2",children:"Órdenes recientes"}),a.jsx("ul",{className:"space-y-2",children:n.map(e=>a.jsxs("li",{className:"flex items-center justify-between text-sm bg-white/5 border border-white/10 rounded-lg px-3 py-2",children:[a.jsx("span",{className:"text-white/80",children:e.name}),a.jsxs("span",{className:"text-white/50",children:["ETA ",e.eta]})]},e.id))})]})}function Ey({value:n,label:e}){return a.jsxs("div",{className:"rounded-2xl border border-white/10 p-4",children:[a.jsx("div",{className:"text-2xl font-bold",children:n}),a.jsx("div",{className:"text-xs text-white/60",children:e})]})}function Gf({icon:n,title:e,desc:t}){return a.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-3xl p-5 flex gap-4",children:[a.jsx("div",{className:"h-10 w-10 rounded-2xl bg-white/10 grid place-items-center text-lg",children:n}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold",children:e}),a.jsx("div",{className:"text-sm text-white/70",children:t})]})]})}function Sy({name:n,price:e,bullets:t=[],cta:r="Elegir",onClick:l,focus:u=!1}){return a.jsxs("div",{className:`rounded-3xl border ${u?"border-emerald-400/60 shadow-[0_0_0_2px_rgba(52,211,153,.2)]":"border-white/10"} bg-white/5`,children:[a.jsxs("div",{className:"p-5 flex items-baseline justify-between",children:[a.jsx("span",{className:"font-semibold",children:n}),a.jsxs("span",{className:`text-2xl font-bold ${u?"text-emerald-300":"text-white"}`,children:[e,a.jsx("span",{className:"text-xs font-normal text-white/60",children:"/mes"})]})]}),a.jsxs("div",{className:"px-5 pb-5 space-y-3",children:[a.jsx("ul",{className:"space-y-2 text-sm text-white/80 list-disc list-inside",children:t.map((f,y)=>a.jsx("li",{children:f},y))}),a.jsx("button",{onClick:l,className:`w-full px-4 py-2 rounded-xl ${u?"bg-emerald-500 hover:bg-emerald-400 text-black":"bg-white/10 hover:bg-white/20"}`,children:r})]})]})}const Nw="registro-empresa-css";if(!document.getElementById(Nw)){const n=document.createElement("style");n.id=Nw,n.innerHTML=`
  .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:16px}
  .row{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
  label{font-size:12px;color:#475569;font-weight:600}
  input{width:100%;padding:10px;border-radius:10px;border:1px solid #e5e7eb}
  .btn{background:#111;color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
  .err{color:#b91c1c}
  `,document.head.appendChild(n)}function kL(){const[n]=N_(),e=n.get("plan")||"free",t=n.get("periodo")==="anual"?"anual":"mensual",r=rr(),[l,u]=E.useState(""),[f,y]=E.useState(""),[_,v]=E.useState(""),[w,R]=E.useState(""),[I,G]=E.useState(!1),[H,Z]=E.useState("");async function F(Q){if(Q.preventDefault(),Z(""),!l.trim()||!f.trim()||!_.trim()||!w){Z("Completa todos los campos.");return}try{G(!0);const se=await Au(du,_.trim(),w),ue=se.user.uid;await g1(se.user,{displayName:f.trim()});const we=gt(Bt(ze,"empresas")),Ce=we.id;await mi(gt(ze,"usuarios",ue),{uid:ue,nombre:f.trim(),email:_.trim(),rol:"administrador",empresaId:Ce,createdAt:new Date},{merge:!0}),await mi(we,{nombre:l.trim(),empresaId:Ce,ownerUid:ue,createdAt:new Date},{merge:!0}),await mi(gt(ze,"empresas",Ce,"config","plan"),{planId:e,periodo:t,updatedAt:new Date},{merge:!0}),localStorage.setItem("usuarioActivo",JSON.stringify({uid:ue,nombre:f.trim(),email:_.trim(),rol:"administrador",empresaId:Ce})),r("/dashboard")}catch(se){console.error(se),Z(se?.message||"No pude registrar la empresa.")}finally{G(!1)}}return a.jsxs("div",{style:{padding:16,maxWidth:720,margin:"0 auto"},children:[a.jsx("h2",{style:{marginTop:0},children:"Crear cuenta de empresa"}),a.jsxs("div",{className:"card",style:{marginTop:10},children:[a.jsxs("div",{className:"pill",style:{display:"inline-block",padding:"6px 10px",border:"1px solid #e5e7eb",borderRadius:999},children:["Plan elegido: ",a.jsx("b",{children:e})," · ",a.jsx("b",{children:t})]}),a.jsxs("form",{onSubmit:F,style:{marginTop:12},children:[a.jsxs("div",{className:"row",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Nombre de la empresa"}),a.jsx("input",{value:l,onChange:Q=>u(Q.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tu nombre (administrador)"}),a.jsx("input",{value:f,onChange:Q=>y(Q.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Correo"}),a.jsx("input",{type:"email",value:_,onChange:Q=>v(Q.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Contraseña"}),a.jsx("input",{type:"password",value:w,onChange:Q=>R(Q.target.value)})]})]}),H&&a.jsx("div",{className:"err",style:{marginTop:8},children:H}),a.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[a.jsx("button",{className:"btn",disabled:I,children:I?"Creando…":"Crear empresa"}),a.jsx(Zt,{to:"/planes-publicos",className:"btn",style:{background:"#fff",color:"#111",border:"1px solid #e5e7eb"},children:"Volver a planes"})]})]})]})]})}function OL(){const[n,e]=E.useState(""),[t,r]=E.useState(""),[l,u]=E.useState(""),[f,y]=E.useState(""),[_,v]=E.useState(""),[w,R]=E.useState(!1),I=rr();async function G(H){if(H.preventDefault(),v(""),!n.trim()||!t.trim()||!l.trim()||!f){v("Completa todos los campos.");return}try{R(!0);const Z=await Au(du,l.trim(),f);await g1(Z.user,{displayName:t.trim()});const F=Z.user.uid;await mi(gt(ze,"usuarios",F),{uid:F,nombre:t.trim(),email:l.trim(),rol:"mensajero",empresaId:n.trim(),createdAt:new Date},{merge:!0}),localStorage.setItem("usuarioActivo",JSON.stringify({uid:F,nombre:t.trim(),email:l.trim(),rol:"mensajero",empresaId:n.trim()})),I("/entregas")}catch(Z){console.error(Z),v(Z?.message||"No pude registrar el agente.")}finally{R(!1)}}return a.jsxs("div",{style:{padding:16,maxWidth:720,margin:"0 auto"},children:[a.jsx("h2",{children:"Registro de mensajero"}),a.jsxs("form",{onSubmit:G,className:"card",style:{padding:16},children:[a.jsx("label",{children:"Empresa ID"}),a.jsx("input",{value:n,onChange:H=>e(H.target.value)}),a.jsx("label",{children:"Nombre"}),a.jsx("input",{value:t,onChange:H=>r(H.target.value)}),a.jsx("label",{children:"Correo"}),a.jsx("input",{type:"email",value:l,onChange:H=>u(H.target.value)}),a.jsx("label",{children:"Contraseña"}),a.jsx("input",{type:"password",value:f,onChange:H=>y(H.target.value)}),_&&a.jsx("div",{style:{color:"#b00",marginTop:8},children:_}),a.jsx("button",{disabled:w,style:{marginTop:10},children:w?"Creando…":"Crear cuenta"})]})]})}let Cw=!1;function DL(){if(Cw)return;Cw=!0;const n=document.createElement("style");n.innerHTML=`
    .plan-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:14px}
    .price{font-size:28px;font-weight:700}
    .subprice{font-size:12px;color:#64748b;margin-top:-6px}
    .btn{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn:hover{background:#f8fafc}
    .btn.primary{background:#6366f1;border-color:#6366f1;color:#fff}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600}
    .ok{color:#065f46}
    .err{color:#b91c1c}
    .meter{height:8px;border-radius:999px;background:#eef2ff;overflow:hidden}
    .meter > span{display:block;height:100%;background:#6366f1}
    .toggle{display:inline-flex;border:1px solid #e5e7eb;border-radius:999px;overflow:hidden}
    .toggle > button{padding:6px 12px;border:none;background:#fff;cursor:pointer}
    .toggle > button.active{background:#6366f1;color:#fff}
  `,document.head.appendChild(n)}DL();function LL(n){const e=n?.precioUSD??n?.precioUsd??0,t=Number(e);return Number.isFinite(t)?t:0}function Rw(n){const e=n?.limites?.ordersPerMonth??n?.limites?.ordenesMes??null,t=Number(e);return Number.isFinite(t)?t:null}function VL(n,e){if(!n)return{main:"Gratis",sub:""};if(e==="annual"){const t=Math.round(n*10),r=Math.round(t/12);return{main:`$${t}/año`,sub:`≈ $${r}/mes (2 meses gratis)`}}return{main:`$${n}/mes`,sub:""}}function UL(){rr();const n=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),e=n?.empresaId!=null?String(n.empresaId):null,t=String(n?.rol||"").toLowerCase(),r=["admin","administrador","administrator"].includes(t),[l,u]=E.useState([]),[f,y]=E.useState(null),[_,v]=E.useState(!0),[w,R]=E.useState(!1),[I,G]=E.useState(""),[H,Z]=E.useState(""),[F,Q]=E.useState("monthly"),se=cl(hu,"ensurePlansCatalog"),ue=cl(hu,"getMyPlan"),we=cl(hu,"choosePlan");E.useEffect(()=>{(async()=>{if(v(!0),Z(""),!await Qn()){Z("No autenticado."),v(!1);return}try{const q=Bt(ze,"planesCatalogo");let j=[];try{j=(await uu(en(q,Fr("orden","asc")))).docs.map(Y=>({id:Y.id,...Y.data()}))}catch{j=(await uu(q)).docs.map(Y=>({id:Y.id,...Y.data()}))}u(j);const de=await ue({});de?.data?.ok?y(de.data):Z("No se pudo obtener el plan actual.")}catch(q){console.error(q);const j=String(q?.message||"");/cors|failed|preflight|access-control-allow-origin/i.test(j)?Z("No pude consultar Cloud Functions (CORS). Revisa que las funciones estén desplegadas y que la región coincida."):/internal/i.test(j)?Z("Error interno al consultar funciones. Verifica que 'getMyPlan' esté desplegada en la región correcta."):Z(j||"Error cargando planes.")}finally{v(!1)}})()},[]);async function Ce(){try{await se({}),alert("Catálogo asegurado ✅");const k=Bt(ze,"planesCatalogo"),q=await uu(en(k,Fr("orden","asc")));u(q.docs.map(j=>({id:j.id,...j.data()})))}catch(k){console.error(k),Z(k?.message||"No pude sembrar el catálogo")}}async function Ue(k,q){if(!r)return alert("Solo el administrador puede elegir plan.");if(confirm(`¿Confirmas activar este plan (${q==="annual"?"ANUAL - 2 meses gratis":"MENSUAL"}) para tu empresa?`))try{if(R(!0),(await we({planId:k,cycle:q}))?.data?.ok){G("Plan activado correctamente ✅");const de=await ue({});de?.data?.ok&&y(de.data)}else Z("No se pudo activar el plan.")}catch(j){console.error(j);const de=String(j?.message||"");/cors|failed|preflight|access-control-allow-origin/i.test(de)?Z("No pude llamar a Cloud Functions (CORS)."):Z(de||"Error al activar plan.")}finally{R(!1)}}const P=f?.plan?.planId||null,M=f?.consumo||null,D=f?.catalog||null,U=D?Rw(D):null;return a.jsxs("div",{style:{padding:16,maxWidth:1100,margin:"0 auto"},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("h2",{style:{margin:0},children:"🧩 Plan y consumo"}),a.jsxs("div",{className:"toggle",style:{marginLeft:8},children:[a.jsx("button",{className:F==="monthly"?"active":"",onClick:()=>Q("monthly"),children:"Mensual"}),a.jsx("button",{className:F==="annual"?"active":"",onClick:()=>Q("annual"),title:"Paga 10 meses, obtén 12 (2 gratis)",children:"Anual −2 meses"})]}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx(Zt,{className:"btn",to:r?"/dashboard":"/ordenes",children:"← Volver"}),r&&a.jsx("button",{className:"btn",onClick:Ce,children:"Asegurar catálogo"})]})]}),e&&a.jsxs("div",{style:{marginTop:6},className:"pill",children:["Empresa: ",a.jsx("b",{children:e})]}),P&&a.jsxs("div",{style:{marginTop:6},className:"pill",children:["Plan actual: ",a.jsx("b",{children:D?.nombre||P})]}),M&&a.jsxs("div",{className:"card",style:{marginTop:10},children:[a.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Consumo del mes ",M.yyyymm]}),a.jsx("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))"},children:a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:13,marginBottom:4},children:["Órdenes creadas ",U!=null?`(límite ${U})`:""]}),a.jsx("div",{className:"meter",children:a.jsx("span",{style:{width:`${Math.min(100,U?100*(Number(M.ordenesCreadas||0)/Math.max(1,U)):0)}%`}})}),a.jsxs("div",{style:{fontSize:12,marginTop:4},children:[a.jsx("b",{children:Number(M.ordenesCreadas||0)})," / ",U??"—"]})]})})]}),_&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),H&&a.jsx("div",{className:"err",style:{marginTop:8},children:H}),I&&a.jsx("div",{className:"ok",style:{marginTop:8},children:I}),!_&&a.jsxs(a.Fragment,{children:[a.jsx("h3",{style:{marginTop:16},children:"Selecciona un plan"}),a.jsxs("div",{className:"plan-grid",children:[l.map(k=>{const q=LL(k),{main:j,sub:de}=VL(q,F),ae=Rw(k);return a.jsxs("div",{className:"card",children:[a.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[a.jsx("h4",{style:{margin:0},children:k.nombre}),a.jsx("div",{className:"price",children:j})]}),F==="annual"&&de&&a.jsx("div",{className:"subprice",children:de}),a.jsx("ul",{style:{marginTop:8,paddingLeft:18},children:(k.features||[]).map((Y,ye)=>a.jsx("li",{children:Y},ye))}),ae!=null&&a.jsxs("div",{className:"pill",style:{marginTop:8},children:["Límite: ",a.jsx("b",{children:ae})," órdenes/mes"]}),F==="annual"&&a.jsx("div",{className:"pill",style:{marginTop:6},children:"2 meses gratis (paga 10)"}),a.jsx("div",{style:{marginTop:12,display:"flex",gap:8},children:P===k.id?a.jsx("button",{className:"btn",disabled:!0,children:"Plan activo"}):a.jsx("button",{className:"btn primary",onClick:()=>Ue(k.id,F),disabled:w||!r,title:r?"Activar este plan":"Solo el admin puede cambiar el plan",children:w?"Activando…":`Elegir ${F==="annual"?"anual":"mensual"}`})})]},k.id)}),!l.length&&a.jsxs("div",{className:"card",children:["No hay planes en catálogo. ",r&&a.jsxs(a.Fragment,{children:["Haz clic en ",a.jsx("b",{children:"Asegurar catálogo"})," arriba."]})]})]})]})]})}function FL(){const{token:n}=Su(),[e,t]=E.useState(null),[r,l]=E.useState(!0),[u,f]=E.useState(""),[y,_]=E.useState(""),[v,w]=E.useState(""),[R,I]=E.useState("");E.useEffect(()=>{let H=!0;return(async()=>{l(!0),f("");try{const Z=gt(ze,"invitaciones",n),F=await Jr(Z);if(F.exists()){const Ce={id:F.id,...F.data()};if(!H)return;t(Ce),Ce?.email&&_(Ce.email),l(!1);return}const Q=Bt(ze,"invitaciones"),se=en(Q,Nt("token","==",n)),ue=await uu(se),we=ue.docs[0]?{id:ue.docs[0].id,...ue.docs[0].data()}:null;if(!H)return;t(we),we?.email&&_(we.email)}catch(Z){if(!H)return;f("No pude cargar la invitación."),console.error(Z)}finally{H&&l(!1)}})(),()=>{H=!1}},[n]);async function G(H){if(H.preventDefault(),!e)return alert("Invitación no válida o expirada.");if(!y||!v||!R)return alert("Completa nombre, email y contraseña.");try{const Z=np();let F;try{F=(await Au(Z,y,v)).user.uid}catch{F=(await V_(Z,y,v)).user.uid}await mi(gt(ze,"usuarios",F),{empresaId:e.empresaId,rol:(e.rol||"").toLowerCase(),nombre:R,email:y,createdAt:ut()},{merge:!0}),await mi(gt(ze,"invitaciones",e.id),{status:"accepted",acceptedBy:F,acceptedAt:ut()},{merge:!0}),localStorage.setItem("usuarioActivo",JSON.stringify({id:F,uid:F,nombre:R,email:y,rol:(e.rol||"").toLowerCase(),empresaId:e.empresaId})),alert("Cuenta vinculada a la empresa ✅");const Q=(e.rol||"").toLowerCase();window.location.href=Q==="mensajero"?"/entregas":"/ordenes"}catch(Z){console.error(Z),alert("No se pudo completar el registro. Revisa los datos.")}}return r?a.jsx("div",{style:{padding:20},children:"Cargando invitación…"}):e?u?a.jsx("div",{style:{padding:20,color:"#b00"},children:u}):a.jsxs("div",{style:{maxWidth:480,margin:"30px auto"},children:[a.jsx("h2",{children:"Unirte a la empresa"}),a.jsxs("p",{children:["Empresa ID: ",a.jsx("code",{children:e.empresaId})]}),a.jsxs("p",{children:["Rol: ",a.jsx("b",{children:(e.rol||"").toLowerCase()})]}),a.jsxs("form",{onSubmit:G,style:{display:"grid",gap:10},children:[a.jsx("input",{placeholder:"Tu nombre",value:R,onChange:H=>I(H.target.value)}),a.jsx("input",{placeholder:"Email",value:y,onChange:H=>_(H.target.value)}),a.jsx("input",{placeholder:"Contraseña",type:"password",value:v,onChange:H=>w(H.target.value)}),a.jsx("button",{children:"Crear/Iniciar sesión y unirme"})]})]}):a.jsx("div",{style:{padding:20,color:"#b00"},children:"Invitación no encontrada o expirada."})}function zL(){const[n,e]=E.useState(""),[t,r]=E.useState(null),[l,u]=E.useState(""),[f,y]=E.useState(""),[_,v]=E.useState(""),w=async()=>{if(!n.trim())return alert("Ingresa el token");const I=gt(ze,"invitaciones",n.trim()),G=await Jr(I);if(!G.exists()){alert("Token inválido o no encontrado");return}r(G.data()),G.data().email&&u(G.data().email)},R=async I=>{if(I.preventDefault(),!t)return alert("Busca un token válido primero");const G=np();let H;try{H=(await Au(G,l,f)).user.uid}catch{H=(await V_(G,l,f)).user.uid}await mi(gt(ze,"usuarios",H),{empresaId:t.empresaId,rol:t.rol,nombre:_,email:l,createdAt:ut()},{merge:!0}),localStorage.setItem("usuarioActivo",JSON.stringify({id:H,uid:H,nombre:_,email:l,rol:t.rol,empresaId:t.empresaId})),alert("Cuenta vinculada correctamente ✅"),window.location.href=t.rol==="mensajero"?"/entregas":"/ordenes"};return a.jsxs("div",{style:{maxWidth:480,margin:"30px auto"},children:[a.jsx("h2",{children:"Reclamar Token de Empresa"}),!t&&a.jsxs("div",{style:{display:"grid",gap:10},children:[a.jsx("input",{placeholder:"Token",value:n,onChange:I=>e(I.target.value)}),a.jsx("button",{onClick:w,children:"Buscar invitación"})]}),t&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Empresa ID: ",a.jsx("code",{children:t.empresaId})]}),a.jsxs("p",{children:["Rol asignado: ",a.jsx("b",{children:t.rol})]}),a.jsxs("form",{onSubmit:R,style:{display:"grid",gap:10},children:[a.jsx("input",{placeholder:"Tu nombre",value:_,onChange:I=>v(I.target.value)}),a.jsx("input",{placeholder:"Email",value:l,onChange:I=>u(I.target.value)}),a.jsx("input",{placeholder:"Contraseña",type:"password",value:f,onChange:I=>y(I.target.value)}),a.jsx("button",{children:"Crear/Iniciar sesión y unirme"})]})]})]})}const Iw="planes-publicos-css";if(!document.getElementById(Iw)){const n=document.createElement("style");n.id=Iw,n.innerHTML=`
  .plan-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:14px}
  .price{font-size:28px;font-weight:700}
  .btn{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn:hover{background:#f8fafc}
  .btn.primary{background:#6366f1;border-color:#6366f1;color:#fff}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600}
  .seg-toggle{display:inline-flex;border:1px solid #e5e7eb;border-radius:999px;overflow:hidden}
  .seg-toggle button{border:0;padding:8px 12px;background:#fff;cursor:pointer}
  .seg-toggle button.active{background:#111;color:#fff}
  `,document.head.appendChild(n)}function BL(n){const e=n?.precioUSD??n?.precioUsd??0,t=Number(e);return Number.isFinite(t)?t:0}function HL(){const[n,e]=E.useState([]),[t,r]=E.useState(!0),[l,u]=E.useState("mensual"),f=rr();E.useEffect(()=>{(async()=>{r(!0);try{const v=Bt(ze,"planesCatalogo");let w;try{w=await uu(en(v,Fr("orden","asc")))}catch{w=await uu(v)}const R=w.docs.map(I=>({id:I.id,...I.data()}));e(R)}finally{r(!1)}})()},[]);const y=v=>{const w=BL(v);return l==="anual"?w*10:w},_=v=>l==="anual"?"/año (ahorras 2 meses)":"/mes";return a.jsxs("div",{style:{padding:16,maxWidth:1100,margin:"0 auto"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h2",{style:{margin:0},children:"💳 Planes"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[a.jsxs("div",{className:"seg-toggle",role:"tablist","aria-label":"Periodo de facturación",children:[a.jsx("button",{className:l==="mensual"?"active":"",onClick:()=>u("mensual"),children:"Mensual"}),a.jsx("button",{className:l==="anual"?"active":"",onClick:()=>u("anual"),children:"Anual"})]}),a.jsx(Zt,{className:"btn",to:"/login",children:"Iniciar sesión"})]})]}),t&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),!t&&a.jsxs("div",{className:"plan-grid",style:{marginTop:12},children:[n.map(v=>{const w=y(v);return a.jsxs("div",{className:"card",children:[a.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[a.jsx("h3",{style:{margin:0},children:v.nombre}),a.jsxs("div",{className:"price",children:[w===0?"Gratis":`$${w}`," ",a.jsx("span",{style:{fontSize:12},children:_()})]})]}),Array.isArray(v.features)&&v.features.length>0&&a.jsx("ul",{style:{marginTop:8,paddingLeft:18},children:v.features.map((R,I)=>a.jsx("li",{children:R},I))}),v?.limites?.ordersPerMonth!=null&&a.jsxs("div",{className:"pill",style:{marginTop:8},children:["Límite: ",a.jsx("b",{children:v.limites.ordersPerMonth})," órdenes/mes"]}),a.jsx("div",{style:{marginTop:12},children:a.jsx("button",{className:"btn primary",onClick:()=>f(`/registro-empresa?plan=${encodeURIComponent(v.id)}&periodo=${l}`),children:"Comenzar con este plan"})})]},v.id)}),!n.length&&a.jsx("div",{className:"card",children:"No hay planes configurados."})]})]})}function qL(){const n=rr(),e=np(),[t,r]=E.useState(""),[l,u]=E.useState("basico"),[f,y]=E.useState(""),[_,v]=E.useState(""),[w,R]=E.useState(""),[I,G]=E.useState(!1),[H,Z]=E.useState("");async function F(Q){Q.preventDefault(),Z("");const se=t.trim(),ue=f.trim(),we=_.trim().toLowerCase(),Ce=w,Ue=(l||"basico").toLowerCase();if(!se||!ue||!we||!Ce){Z("Completa todos los campos.");return}G(!0);try{const M=(await Au(e,we,Ce)).user.uid,U=(await so(Bt(ze,"empresas"),{nombre:se,plan:Ue,ownerUid:M,createdAt:ut()})).id;await mi(gt(ze,"usuarios",M),{nombre:ue,email:we,rol:"administrador",empresaId:U,createdAt:ut()},{merge:!0}),localStorage.setItem("usuarioActivo",JSON.stringify({id:M,uid:M,nombre:ue,email:we,rol:"administrador",empresaId:U})),alert("¡Empresa y usuario creados! 🎉"),n("/dashboard")}catch(P){console.error("Registro empresa:",P);const M=P?.code==="auth/email-already-in-use"?"Ese correo ya está en uso.":P?.code==="auth/invalid-email"?"Correo inválido.":P?.code==="auth/weak-password"?"La contraseña es muy débil.":P?.message||"No pude registrar.";Z(M)}finally{G(!1)}}return a.jsxs("div",{style:{maxWidth:520,margin:"20px auto",padding:16},children:[a.jsx("h2",{children:"Crear empresa y usuario administrador"}),a.jsxs("form",{onSubmit:F,style:{display:"grid",gap:10},children:[a.jsxs("label",{children:["Nombre de la empresa",a.jsx("input",{type:"text",value:t,onChange:Q=>r(Q.target.value),placeholder:"Mi Empresa SRL"})]}),a.jsxs("label",{children:["Plan",a.jsxs("select",{value:l,onChange:Q=>u(Q.target.value),children:[a.jsx("option",{value:"basico",children:"Básico"}),a.jsx("option",{value:"pro",children:"Pro"}),a.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),a.jsxs("label",{children:["Tu nombre (administrador)",a.jsx("input",{type:"text",value:f,onChange:Q=>y(Q.target.value),placeholder:"Juan Pérez"})]}),a.jsxs("label",{children:["Correo (login)",a.jsx("input",{type:"email",value:_,onChange:Q=>v(Q.target.value),placeholder:"admin@empresa.com"})]}),a.jsxs("label",{children:["Contraseña",a.jsx("input",{type:"password",value:w,onChange:Q=>R(Q.target.value),placeholder:"********"})]}),H&&a.jsx("div",{style:{color:"#b00"},children:H}),a.jsx("button",{type:"submit",disabled:I,children:I?"Creando...":"Crear empresa y admin"})]})]})}const Gd={OWNER:"OWNER",ADMIN:"ADMIN",OPERADOR:"OPERADOR",AUDITOR:"AUDITOR"};function Zf(n){return[Gd.OWNER,Gd.ADMIN,Gd.OPERADOR,Gd.AUDITOR].includes(n)}function $L(){const n=Gd.ADMIN;return E.useMemo(()=>({role:n}),[n])}const hi={bg:"#f9fafb",surface:"#fdfafaff",text:"#212936",muted:"#6b7280",border:"#000000ff",brand:"#6271b6ff",brandHover:"#93a2fa",accent:"#a7f3d0",danger:"#fecaca",dangerHover:"#fca5a5",chipLavender:"#eef2ff",chipLavenderBorder:"#dde3ff",chipLavenderText:"#3742a6",chipGreen:"#e8fff4",chipGreenBorder:"#c8f4df",chipGreenText:"#0f5132",chipOrange:"#fff3e6",chipOrangeBorder:"#ffd9b8",chipOrangeText:"#8a3b12",chipRed:"#ffe9e9",chipRedBorder:"#ffcfcf",chipRedText:"#7f1d1d",menuActive:"#929dbfff"};(function(){if(typeof document>"u"||document.getElementById("pastelDashboardCSS"))return;const e=`
    :root {
      --bg: ${hi.bg};
      --surface: ${hi.surface};
      --text: ${hi.text};
      --muted: ${hi.muted};
      --border: ${hi.border};

      --brand: ${hi.brand};
      --brand-hover: ${hi.brandHover};

      --accent: ${hi.accent};

      --danger: ${hi.danger};
      --danger-hover: ${hi.dangerHover};

      --chip-lavender: ${hi.chipLavender};
      --chip-lavender-border: ${hi.chipLavenderBorder};
      --chip-lavender-text: ${hi.chipLavenderText};

      --chip-green: ${hi.chipGreen};
      --chip-green-border: ${hi.chipGreenBorder};
      --chip-green-text: ${hi.chipGreenText};

      --chip-orange: ${hi.chipOrange};
      --chip-orange-border: ${hi.chipOrangeBorder};
      --chip-orange-text: ${hi.chipOrangeText};

      --chip-red: ${hi.chipRed};
      --chip-red-border: ${hi.chipRedBorder};
      --chip-red-text: ${hi.chipRedText};

      --menu-active: ${hi.menuActive};
      --radius: 12px;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0)
    }

    body { background: var(--bg); color: var(--text); }

    /* Tarjetas y secciones */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .section { padding: 24px; }
    .section-title { margin: 0 0 12px; font-size: 20px; }

    /* Botones — SIEMPRE sólidos (sin opacity en hover) */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: #ced7f9ff;            /* base suave para que nunca quede “invisible” */
      color: var(--text);
      font-weight: 700;
      cursor: pointer;
      transition: background .2s ease, color .2s ease, border-color .2s ease, transform .04s ease;
      text-decoration: none;
    }
    .btn:active { transform: translateY(1px); }

    /* Primario pastel (marca) */
    .btn-primary {
      background: var(--brand);
      color: #171f49ff;                 /* texto con contraste sobre pastel */
      border-color: var(--brand-hover);
    }
    .btn-primary:hover {
      background: var(--brand-hover); /* hover sólido, NO transparencia */
      border-color: #7f91f7;
      color: #272f4dff;
    }

    /* Secundario con borde visible y fondo pastel (no blanco puro) */
    .btn-outline {
      background: #f5f7ff;            /* pastel sólido */
      border-color: var(--border);
      color: #496076ff;
    }
    .btn-outline:hover {
      background: #e9edff;            /* un tono más marcado, PERO sólido */
      border-color: var(--brand-hover);
      color: #2a3350;
    }

    /* Peligro pastel (eliminar, etc.) */
    .btn-danger {
      background: var(--danger);
      border-color: var(--danger-hover);
      color: #5b1212;
    }
    .btn-danger:hover {
      background: var(--danger-hover);
      border-color: var(--danger-hover);
      color: #4b0f0f;
    }

    /* Pills / etiquetas de estado */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .2px;
      border: 1px solid var(--border);
      background: #f3f4f6;
      color: var(--muted);
      white-space: nowrap;
    }
    .pill.blue   { background: var(--chip-lavender); border-color: var(--chip-lavender-border); color: var(--chip-lavender-text); }
    .pill.green  { background: var(--chip-green);    border-color: var(--chip-green-border);    color: var(--chip-green-text); }
    .pill.orange { background: var(--chip-orange);   border-color: var(--chip-orange-border);   color: var(--chip-orange-text); }
    .pill.red    { background: var(--chip-red);      border-color: var(--chip-red-border);      color: var(--chip-red-text); }

    .chips { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Tabla */
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { padding: 10px 8px; border-bottom: 1px solid var(--border); }
    .table thead th { color: var(--muted); font-weight: 700; background: #fbfcff; }

    /* Bloque KPIs */
    .kpis { display: flex; gap: 12px; flex-wrap: wrap; }
    .kpi {
      border: 1px dashed #e6eaf5;
      border-radius: var(--radius);
      padding: 12px 14px;
      min-width: 150px;
      background: var(--surface);
    }
    .kpi .lbl { font-size: 12px; color: var(--muted); }
    .kpi .val { font-size: 22px; font-weight: 800; color: #374151; }

    /* Títulos y bloques */
    .title { display: flex; align-items: center; gap: 10px; }
    .muted { color: var(--muted); }

    /* Links activos o resaltados */
    .is-active { background: var(--menu-active); border-radius: var(--radius); }
  `,t=document.createElement("style");t.id="pastelDashboardCSS",t.innerHTML=e,document.head.appendChild(t)})();const GL=(n=new Date)=>{const e=new Date(n);return e.setHours(0,0,0,0),e.toISOString().slice(0,10)};function Kf(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const e=new Date(n).getTime();if(Number.isFinite(e))return e}}catch{}return NaN}function Nd(n){const e=(n?.fecha||"").trim(),t=(n?.hora||"").trim();if(!e)return NaN;const r=/^\d{2}:\d{2}$/.test(t)?t:"00:00",l=new Date(`${e}T${r}:00`).getTime();return Number.isFinite(l)?l:NaN}const Pw=(n,e)=>e?`${(n/e*100).toFixed(0)}%`:"—";function jy(){const{role:n}=$L();rr();let e=null;try{e=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const t=e?.empresaId!=null&&e?.empresaId!==""?String(e.empresaId):null;if(!t)return a.jsxs("div",{className:"section",style:{color:"var(--danger)"},children:["Falta ",a.jsx("code",{children:"empresaId"})," en sesión."]});const[r,l]=E.useState([]),[u,f]=E.useState([]),[y,_]=E.useState([]),[v,w]=E.useState(""),[R,I]=E.useState(15);E.useEffect(()=>{const k=gt(ze,"ajustesEmpresa",t),q=Kt(k,j=>{const ae=j.data()?.alertas?.toleranciaMin;Number.isFinite(ae)&&I(ae)});return()=>q()},[t]);const[G,H]=E.useState(Date.now());E.useEffect(()=>{const k=setInterval(()=>H(Date.now()),15e3);return()=>clearInterval(k)},[]),E.useEffect(()=>{let k=null;return(async()=>{if(!await Qn()){w("Sesión inválida.");return}try{const j=Bt(ze,"ordenes");k=Kt(en(j,Nt("empresaId","==",t),Fr("createdAt","desc")),de=>l(de.docs.map(ae=>({id:ae.id,...ae.data()}))),de=>w(de?.message||"No pude leer órdenes."))}catch(j){w(j?.message||"No pude iniciar suscripción de órdenes.")}})(),()=>k&&k()},[t]),E.useEffect(()=>{let k=null;return(async()=>{if(await Qn())try{const j=Bt(ze,"ubicacionesMensajeros");k=Kt(en(j,Nt("empresaId","==",t)),de=>_(de.docs.map(ae=>{const Y=ae.data()||{};return{id:ae.id,nombre:Y.nombre||ae.id,estado:(Y.estado||"disponible").toLowerCase(),lastPingAt:Y.lastPingAt?.toDate?Y.lastPingAt.toDate():null}})),()=>{})}catch{}})(),()=>k&&k()},[t]),E.useEffect(()=>{let k=null;return(async()=>{if(await Qn())try{const j=Bt(ze,"cambiosOrden");k=Kt(en(j,Nt("empresaId","==",t),Fr("createdAt","desc"),LO(12)),de=>f(de.docs.map(ae=>{const Y=ae.data()||{};return{id:ae.id,createdAt:Y.createdAt,orderId:Y.orderId||"—",actor:Y.actorNombre||"desconocido",rol:Y.actorRol||"—",cambios:Array.isArray(Y.cambios)?Y.cambios:[],motivo:Y.motivo||""}})),()=>{})}catch{}})(),()=>k&&k()},[t]);const Z=GL(),F=E.useMemo(()=>{const k=new Date;return k.setHours(0,0,0,0),k.getTime()},[]),Q=E.useMemo(()=>{const k=new Date;return k.setHours(23,59,59,999),k.getTime()},[]),se=E.useMemo(()=>{const k=[];for(const q of r)if(q?.fecha===Z)k.push(q);else{const j=Kf(q.createdAt);if(Number.isFinite(j)&&j>=F&&j<=Q)k.push(q);else{const de=Nd(q);Number.isFinite(de)&&de>=F&&de<=Q&&k.push(q)}}return k},[r,Z,F,Q]),{pendHoy:ue,entrHoy:we,onTimeEntrHoy:Ce,porVencerHoy:Ue,kpi:P}=E.useMemo(()=>{const k=(Number.isFinite(R)?R:15)*6e4,q=[],j=[];let de=0;const ae=[],Y=30*6e4;for(const ie of se)if(ie.entregado){j.push(ie);const be=Kf(ie.fechaEntregada),A=Nd(ie);Number.isFinite(be)&&Number.isFinite(A)&&be<=A+k&&de++}else{q.push(ie);const be=Nd(ie),A=Number.isFinite(be)?be+k-G:null;A!=null&&A<=Y&&A>0&&ae.push(ie)}const ye={totalHoy:se.length,pendientes:q.length,entregadas:j.length,onTime:de,onTimePct:Pw(de,j.length||0),porVencer:ae.length};return{pendHoy:q,entrHoy:j,onTimeEntrHoy:de,porVencerHoy:ae,kpi:ye}},[se,R,G]),M=E.useMemo(()=>{const q=y.filter(j=>{const de=j.lastPingAt instanceof Date?j.lastPingAt.getTime():NaN;return Number.isFinite(de)&&G-de<=6e5});return{activos:q.length,total:y.length,detalle:q.slice(0,12)}},[y,G]),D=E.useMemo(()=>{const k=[{key:"cliente",label:"Cliente",min:160},{key:"numeroFactura",label:"Factura/Doc"},{key:"hora",label:"Hora"},{key:"asignadoNombre",label:"Asignado"},{key:"zona",label:"Zona"},{key:"estado",label:"Estado"},{key:"acciones",label:"Acciones"}];return Zf(n)&&k.splice(5,0,{key:"usuario",label:"Registrado por"}),k},[n]),U=E.useMemo(()=>{const k=[{key:"cliente",label:"Cliente",min:160},{key:"numeroFactura",label:"Factura/Doc"},{key:"hora",label:"Hora prog."},{key:"entregada",label:"Entregada"},{key:"onTime",label:"On-time"},{key:"asignadoNombre",label:"Asignado"},{key:"acciones",label:"Acciones"}];return Zf(n)&&k.splice(5,0,{key:"usuario",label:"Registrado por"}),k},[n]);return a.jsxs("div",{className:"container",style:{paddingTop:16,paddingBottom:24},children:[a.jsxs("div",{className:"card section",style:{display:"flex",gap:12},children:[a.jsxs("div",{className:"title",style:{justifyContent:"space-between",width:"100%"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[a.jsx("h2",{className:"section-title",style:{margin:0},children:"📊 Panel"}),a.jsxs("span",{className:"pill blue",children:["Rol: ",a.jsx("b",{children:n})]})]}),a.jsxs("div",{className:"chips",children:[a.jsx(Zt,{className:"btn btn-outline",to:"/ordenes",children:"📋 Órdenes"}),a.jsx(Zt,{className:"btn btn-outline",to:"/alertas-sla",children:"⏱️ Alertas SLA"}),a.jsx(Zt,{className:"btn btn-outline",to:"/mapa",children:"🗺️ Mapa"}),a.jsx(Zt,{className:"btn btn-outline",to:"/historial-cambios",children:"🗂️ Historial"}),a.jsx(Zt,{className:"btn btn-primary",to:"/nueva-orden",children:"➕ Nueva orden"})]})]}),v&&a.jsx("div",{style:{color:"var(--danger)"},children:v})]}),a.jsx("div",{className:"card section",style:{marginTop:12},children:a.jsxs("div",{className:"kpis",children:[a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Órdenes de hoy"}),a.jsx("div",{className:"val",children:P.totalHoy})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Pendientes"}),a.jsx("div",{className:"val",children:P.pendientes})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Entregadas"}),a.jsx("div",{className:"val",children:P.entregadas})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"On-time (hoy)"}),a.jsx("div",{className:"val",children:`${P.onTime} (${P.onTimePct})`})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Por vencer (≤30m)"}),a.jsx("div",{className:"val",children:P.porVencer})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Mensajeros activos"}),a.jsxs("div",{className:"val",children:[M.activos," ",a.jsxs("span",{className:"muted",children:["/ ",M.total]})]})]}),a.jsx("div",{className:"muted",style:{marginLeft:"auto",alignSelf:"center"},children:new Date(G).toLocaleTimeString()})]})}),a.jsxs("section",{className:"card section",style:{marginTop:12},children:[a.jsxs("div",{className:"title",style:{justifyContent:"space-between"},children:[a.jsx("h3",{className:"section-title",children:"🚴 Mensajeros activos"}),a.jsx(Zt,{className:"btn btn-outline",to:"/mapa",children:"Abrir mapa"})]}),M.detalle.length?a.jsx("div",{className:"chips",style:{marginTop:6},children:M.detalle.map(k=>a.jsxs("span",{className:`pill ${k.estado==="en_ruta"?"green":"blue"}`,children:[k.nombre," · ",k.estado]},k.id))}):a.jsx("div",{className:"muted",children:"Sin pings recientes (< 10 min)."})]}),a.jsxs("section",{className:"card section",style:{marginTop:12},children:[a.jsxs("div",{className:"title",style:{justifyContent:"space-between"},children:[a.jsx("h3",{className:"section-title",children:"⏳ Pendientes de hoy"}),a.jsxs("div",{className:"chips",children:[a.jsxs("span",{className:"pill orange",children:["Por vencer: ",a.jsx("b",{children:Ue.length})]}),a.jsx(Zt,{className:"btn btn-outline",to:"/alertas-sla",children:"Ver en Alertas SLA"})]})]}),a.jsx("div",{style:{overflowX:"auto",marginTop:8},children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsx("tr",{children:D.map(k=>a.jsx("th",{style:{minWidth:k.min||void 0},children:k.label},k.key))})}),a.jsx("tbody",{children:ue.length?ue.slice(0,50).map(k=>{const q=Nd(k),j=(Number.isFinite(R)?R:15)*6e4,de=Number.isFinite(q)?q+j-G:null,ae=de==null?"—":de<=0?"Vencida":de<=30*6e4?"Por vencer":"En tiempo",Y=de==null?"":de<=0?"red":de<=30*6e4?"orange":"green";return a.jsxs("tr",{children:[a.jsx("td",{style:{minWidth:160},children:k.cliente||"—"}),a.jsx("td",{children:k.numeroFactura||"—"}),a.jsx("td",{children:k.hora||"—"}),a.jsx("td",{children:k.asignadoNombre||"—"}),a.jsx("td",{children:k.zona||"—"}),Zf(n)&&a.jsx("td",{children:k.usuario||"—"}),a.jsx("td",{children:a.jsx("span",{className:`pill ${Y}`,children:ae})}),a.jsx("td",{children:a.jsxs("div",{className:"chips",children:[a.jsx(Zt,{className:"btn btn-outline",to:`/orden/${k.id}`,children:"Ver orden"}),a.jsx(Zt,{className:"btn btn-outline",to:`/mapa/${k.id}`,children:"Ver en mapa"})]})})]},k.id)}):a.jsx("tr",{children:a.jsx("td",{colSpan:D.length,className:"muted",children:"No hay pendientes hoy."})})})]})})]}),a.jsxs("section",{className:"card section",style:{marginTop:12},children:[a.jsxs("div",{className:"title",style:{justifyContent:"space-between"},children:[a.jsx("h3",{className:"section-title",children:"✅ Entregadas hoy"}),a.jsxs("div",{className:"chips",children:[a.jsxs("span",{className:"pill green",children:["On-time: ",a.jsxs("b",{children:[Ce," (",Pw(Ce,Math.max(1,P.entregadas)),")"]})]}),a.jsx(Zt,{className:"btn btn-outline",to:"/alertas-sla",children:"Analizar SLA"})]})]}),a.jsx("div",{style:{overflowX:"auto",marginTop:8},children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsx("tr",{children:U.map(k=>a.jsx("th",{style:{minWidth:k.min||void 0},children:k.label},k.key))})}),a.jsx("tbody",{children:we.length?we.slice(0,50).map(k=>{const q=Kf(k.fechaEntregada),j=Number.isFinite(q)?new Date(q).toLocaleTimeString():"—",de=Nd(k),ae=(Number.isFinite(R)?R:15)*6e4,Y=Number.isFinite(de)&&Number.isFinite(q)&&q<=de+ae;return a.jsxs("tr",{children:[a.jsx("td",{style:{minWidth:160},children:k.cliente||"—"}),a.jsx("td",{children:k.numeroFactura||"—"}),a.jsx("td",{children:k.hora||"—"}),Zf(n)&&a.jsx("td",{children:k.usuario||"—"}),a.jsx("td",{children:j}),a.jsx("td",{children:a.jsx("span",{className:`pill ${Y?"green":"red"}`,children:Y?"On-time":"Fuera SLA"})}),a.jsx("td",{children:k.asignadoNombre||"—"}),a.jsx("td",{children:a.jsx("div",{className:"chips",children:a.jsx(Zt,{className:"btn btn-outline",to:`/orden/${k.id}`,children:"Ver orden"})})})]},k.id)}):a.jsx("tr",{children:a.jsx("td",{colSpan:U.length,className:"muted",children:"No hay entregas hoy."})})})]})})]}),a.jsxs("section",{className:"card section",style:{marginTop:12},children:[a.jsxs("div",{className:"title",style:{justifyContent:"space-between"},children:[a.jsx("h3",{className:"section-title",children:"🗂️ Actividad reciente"}),a.jsx(Zt,{className:"btn btn-outline",to:"/historial-cambios",children:"Abrir historial"})]}),a.jsx("div",{style:{overflowX:"auto",marginTop:8},children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Orden"}),a.jsx("th",{children:"Actor"}),a.jsx("th",{children:"Rol"}),a.jsx("th",{children:"Cambios"}),a.jsx("th",{children:"Motivo"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:u.length?u.map(k=>{const q=Kf(k.createdAt),j=Number.isFinite(q)?new Date(q).toLocaleString():"—";return a.jsxs("tr",{children:[a.jsx("td",{children:j}),a.jsx("td",{style:{whiteSpace:"nowrap",fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace"},children:k.orderId}),a.jsx("td",{children:k.actor}),a.jsx("td",{children:a.jsx("span",{className:"pill",children:k.rol})}),a.jsx("td",{children:k.cambios&&k.cambios.length?a.jsxs("div",{className:"chips",children:[k.cambios.slice(0,4).map((de,ae)=>a.jsx("span",{className:"pill",children:de?.campo||"—"},`${k.id}-${ae}`)),k.cambios.length>4&&a.jsxs("span",{className:"pill muted",children:["+",k.cambios.length-4]})]}):"—"}),a.jsx("td",{children:k.motivo||"—"}),a.jsx("td",{children:a.jsx("div",{className:"chips",children:a.jsx(Zt,{className:"btn btn-outline",to:`/orden/${k.orderId}`,children:"Ver orden"})})})]},k.id)}):a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"muted",children:"Sin actividad reciente."})})})]})})]})]})}const Ay="ordenes",Wc=["00–06","06–09","09–12","12–15","15–18","18–21","21–24"];function Wf(n){return n>=0&&n<6?"00–06":n>=6&&n<9?"06–09":n>=9&&n<12?"09–12":n>=12&&n<15?"12–15":n>=15&&n<18?"15–18":n>=18&&n<21?"18–21":"21–24"}function ya(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const t=new Date(n).getTime();if(Number.isFinite(t))return t}}catch{}return NaN}function Ps(n){return Number.isFinite(n)?`${n.toFixed(1)} min`:"—"}function Ga(n,e){const t=ya(n),r=ya(e);return Number.isFinite(t)&&Number.isFinite(r)?(t-r)/6e4:null}function Yc(n,e){return e?`${(n/e*100).toFixed(1)}%`:"—"}function Mw(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0");return`${e}-${t}`}function ZL(n,e){const t=n?.formatted||e||"";if(!t)return"Desconocida";const r=String(t).split(",").map(l=>l.trim()).filter(Boolean);return r[1]||r[0]||"Desconocida"}function kw(n,e){if(!e?.length)return;const t=Object.keys(e[0]),r=[t.join(","),e.map(y=>t.map(_=>`"${String(y[_]??"").replace(/"/g,'""')}"`).join(",")).join(`
`)].join(`
`),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(l),f=document.createElement("a");f.href=u,f.download=n,f.click(),URL.revokeObjectURL(u)}function Yf(n,e){if(!n?.length)return null;const t=n.filter(Number.isFinite).sort((f,y)=>f-y);if(!t.length)return null;const r=e/100*(t.length-1),l=Math.floor(r),u=Math.ceil(r);return l===u?t[l]:t[l]+(t[u]-t[l])*(r-l)}function v_(n){if(typeof n!="string")return NaN;const e=n.trim(),t=new Date(e).getTime();if(Number.isFinite(t))return t;let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{4})\/(\d{2})\/(\d{2})$/),r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})-(\d{2})-(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[1]}-${r[2]}T12:00:00`).getTime();if(Number.isFinite(l))return l}return NaN}function Nj(n){const e=(n?.fecha||"").trim(),t=(n?.hora||"").trim();if(!e)return NaN;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){const r=/^\d{2}:\d{2}$/.test(t)?t:"00:00",l=new Date(`${e}T${r}:00`).getTime();return Number.isFinite(l)?l:NaN}return v_(e)}function Cj(n,e){return e==="creacion"?ya(n?.createdAt):e==="programada"?Nj(n):e==="entrega"?ya(n?.fechaEntregada):NaN}function Cd(n,e){const t=ya(n?.createdAt);if(Number.isFinite(t))return t;const r=Cj(n,e);return Number.isFinite(r)?r:0}function $l(n){const e=new Date(n);return Number.isFinite(n)?e.toISOString().slice(0,10):""}function Ny({title:n,data:e,total:t}){return a.jsxs("div",{className:"card",style:{marginTop:12},children:[a.jsx("h3",{className:"card-title",children:n}),a.jsx("div",{className:"hbar-list",children:e.map(({label:r,value:l})=>{const u=t?l/t*100:0;return a.jsxs("div",{className:"hbar-row",children:[a.jsx("div",{className:"hbar-label",children:r}),a.jsx("div",{className:"hbar-track",children:a.jsx("div",{className:"hbar-fill",style:{width:`${u}%`}})}),a.jsx("div",{className:"hbar-value",children:l})]},r)})})]})}function Qf({title:n,data:e,height:t=160}){const r=Math.max(1,...e.map(l=>l.value||0));return a.jsxs("div",{className:"card",style:{marginTop:12},children:[a.jsx("h3",{className:"card-title",children:n}),a.jsx("div",{className:"vbar-wrap",style:{height:t},children:e.map(l=>a.jsxs("div",{className:"vbar-col",children:[a.jsx("div",{className:"vbar-track",title:`${l.label}: ${l.value}`,children:a.jsx("div",{className:"vbar-fill",style:{height:`${l.value/r*100}%`}})}),a.jsx("div",{className:"vbar-label",children:l.label})]},l.label))})]})}function Ow(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}if((n?.rol||"").toLowerCase()!=="administrador")return a.jsx("div",{style:{padding:20},children:"403 – Solo el administrador puede ver estadísticas."});const t=n?.empresaId!=null&&n?.empresaId!==""?String(n.empresaId):null,r=new Date,l=new Date(r.getFullYear(),r.getMonth(),1),[u,f]=E.useState(l.toISOString().slice(0,10)),[y,_]=E.useState(r.toISOString().slice(0,10)),[v,w]=E.useState(!1),[R,I]=E.useState("creacion"),[G,H]=E.useState(!1),[Z,F]=E.useState(""),[Q,se]=E.useState(""),[ue,we]=E.useState(15),[Ce,Ue]=E.useState(45),[P,M]=E.useState([]),[D,U]=E.useState(!1),[k,q]=E.useState(""),[j,de]=E.useState(null),[ae,Y]=E.useState({fromCache:!1,pendingLocal:0,total:0}),[ye,ie]=E.useState([]),[be,A]=E.useState(!1),[W,$]=E.useState({usuarioEmpresaId:t,usuarioEmpresaIdType:typeof n?.empresaId,userDocEmpresaId:null,userDocEmpresaIdType:null,muestraEmpresaIdOrdenes:[],lastSnapshotError:null,lastWriteError:null}),[te,me]=E.useState(!1);E.useEffect(()=>{(async()=>{try{if(n?.uid){const X=gt(ze,"usuarios",n.uid),Fe=await Jr(X);if(Fe.exists()){const st=Fe.data()?.empresaId;$(zt=>({...zt,userDocEmpresaId:st!=null?String(st):null,userDocEmpresaIdType:typeof st}))}else $(st=>({...st,userDocEmpresaId:"(no existe doc usuarios/{uid})"}))}else $(X=>({...X,userDocEmpresaId:"(sin uid en usuarioActivo)"}))}catch(X){$(Fe=>({...Fe,userDocEmpresaId:`(error leyendo usuarios/${n?.uid}): ${X?.message}`}))}})()},[n?.uid]),E.useEffect(()=>{let X=null,Fe=null,st=null,zt=!1;return(async()=>{try{if(U(!0),q(""),!await Qn()){q("Sesión inválida: ensureUsuarioActivo() retornó false."),U(!1);return}const Xn=t;if(!Xn){q("Falta empresaId en usuarioActivo."),U(!1);return}st=setTimeout(()=>{zt||(U(!1),q(hn=>hn||"No llegó ningún snapshot (verifica conexión/reglas/índices)."))},6e3);const Nn=Bt(ze,Ay),Yt=en(Nn,Nt("empresaId","==",Xn)),En=Number.isNaN(Number(Xn))?null:Number(Xn),dn=new Map,bn=hn=>{zt=!0,st&&(clearTimeout(st),st=null),hn.docs.forEach(Mt=>{const ke=Mt.data();dn.set(Mt.id,{id:Mt.id,...ke,__pending:Mt.metadata.hasPendingWrites===!0})});const gn=Array.from(dn.values()).sort((Mt,ke)=>Cd(ke,R)-Cd(Mt,R)),Pi=gn.reduce((Mt,ke)=>Mt+(ke.__pending?1:0),0);Y({fromCache:hn.metadata.fromCache,pendingLocal:Pi,total:gn.length});const Ht=gn.map(({__pending:Mt,...ke})=>ke);M(Ht),de(new Date),ie(gn.filter(Mt=>!Mt.createdAt&&!Mt.__pending).map(Mt=>Mt.id)),$(Mt=>({...Mt,muestraEmpresaIdOrdenes:gn.slice(0,3).map(ke=>({id:ke.id,empresaId:ke.empresaId,tipo:typeof ke.empresaId}))})),U(!1)},St=hn=>{zt=!0,st&&(clearTimeout(st),st=null),console.error("onSnapshot error:",hn),$(gn=>({...gn,lastSnapshotError:hn?.message||String(hn)})),q(hn?.message||"Error al suscribirse a órdenes."),U(!1)};if(X=Kt(Yt,{includeMetadataChanges:!0},bn,St),En!=null){const hn=en(Nn,Nt("empresaId","==",En));Fe=Kt(hn,{includeMetadataChanges:!0},bn,St)}}catch($n){zt=!0,st&&(clearTimeout(st),st=null),console.error("Suscripción falló:",$n),q($n?.message||"No pude iniciar la suscripción."),U(!1)}})(),()=>{st&&clearTimeout(st),X&&X(),Fe&&Fe()}},[n?.empresaId,R]);const J=E.useMemo(()=>{const X=new Set;for(const Fe of P)Fe.asignadoNombre&&X.add(String(Fe.asignadoNombre));return Array.from(X).sort((Fe,st)=>Fe.localeCompare(st))},[P]),oe=E.useMemo(()=>{const X=new Set;for(const Fe of P){const st=Fe.creadoPorNombre||Fe.usuario||Fe.creadoPor||"";st&&X.add(String(st))}return Array.from(X).sort((Fe,st)=>Fe.localeCompare(st))},[P]),{filtered:re,counts:he}=E.useMemo(()=>{if(!Array.isArray(P))return{filtered:[],counts:{conCreatedAt:0,conFechaStr:0,sinFecha:0,inRange:0,outRange:0}};const X=new Date(u);X.setHours(0,0,0,0);const Fe=new Date(y);Fe.setHours(23,59,59,999);const st=X.getTime(),zt=Fe.getTime();let $n=0,Xn=0,Nn=0,Yt=0,En=0,bn=P.filter(St=>{const hn=ya(St?.createdAt);Number.isFinite(hn)&&$n++;let gn=Cj(St,R);if(!Number.isFinite(gn)&&R==="programada"){const Pi=v_(St?.fecha);Number.isFinite(Pi)&&(Xn++,gn=Pi)}return Number.isFinite(gn)?gn>=st&&gn<=zt?(Yt++,!0):(En++,!1):(Nn++,!0)});return v&&(bn=bn.filter(St=>St.entregado)),G&&(bn=bn.filter(St=>!!(St?.proofUrl||Array.isArray(St?.fotosPodUrls)&&St.fotosPodUrls.length>0))),Z&&(bn=bn.filter(St=>(St.asignadoNombre||"")===Z)),Q&&(bn=bn.filter(St=>(St.creadoPorNombre||St.usuario||St.creadoPor||"")===Q)),bn.sort((St,hn)=>Cd(hn,R)-Cd(St,R)),{filtered:bn,counts:{conCreatedAt:$n,conFechaStr:Xn,sinFecha:Nn,inRange:Yt,outRange:En}}},[P,u,y,v,G,Z,Q,R]),Ae=E.useMemo(()=>{if(!Array.isArray(P)||P.length===0)return{minMs:NaN,maxMs:NaN};let X=1/0,Fe=-1/0;for(const st of P){const zt=Cd(st,R);Number.isFinite(zt)&&(zt<X&&(X=zt),zt>Fe&&(Fe=zt))}return{minMs:X,maxMs:Fe}},[P,R]);E.useEffect(()=>{if(ae.total>0&&he.inRange===0&&he.outRange>0){const{minMs:X,maxMs:Fe}=Ae;Number.isFinite(X)&&Number.isFinite(Fe)&&(f($l(X)),_($l(Fe)))}},[ae.total,he.inRange,he.outRange,Ae.minMs,Ae.maxMs]);const K=E.useMemo(()=>{const X={total:0,entregadas:0,pendientes:0,avgCreacionARecibida:null,avgRecibidaAEntregada:null,avgTotal:null,p50Total:null,p90Total:null,dentroSLA:0,slaPct:"—",porMensajero:[],porZona:{},porDiaSemana:{},porMes:{},porHoraCreacion:{},franjasCreacion:{},porHoraEntrega:{},franjasEntrega:{},porOperador:[],faltantesCoords:0,faltantesAddress:0,duplicadasFactura:[],exportRows:[],conPOD:0,podPct:"—",onTimeCount:0,onTimePct:"—",tendencias:[]};if(!re.length)return X;let Fe=0,st=0,zt=0,$n=0,Xn=0,Nn=0;const Yt={},En={},dn={},bn=[],St={},hn=[],gn={},Pi={};for(const ke of re){X.total+=1,ke.entregado?X.entregadas+=1:X.pendientes+=1,!!(ke.address?.formatted||ke.direccionTexto)||(X.faltantesAddress+=1);const Gn=ke?.address?.lat??ke?.destino?.lat??ke?.destinoLat??null,nt=ke?.address?.lng??ke?.destino?.lng??ke?.destinoLng??null;if((!Number.isFinite(Number(Gn))||!Number.isFinite(Number(nt)))&&(X.faltantesCoords+=1),ke.numeroFactura){const Un=String(ke.numeroFactura).trim();gn[Un]=(gn[Un]||0)+1}let ni=null;const Ir=ya(ke.createdAt);if(Number.isFinite(Ir)){const Un=new Date(Ir);ni=Un.getHours();const ii=String(ni).padStart(2,"0");X.porHoraCreacion[ii]=(X.porHoraCreacion[ii]||0)+1;const li=Un.getDay();X.porDiaSemana[li]=(X.porDiaSemana[li]||0)+1;const ei=Mw(Un);dn[ei]=(dn[ei]||0)+1;const xn=Wf(ni);X.franjasCreacion[xn]=(X.franjasCreacion[xn]||0)+1}else{const Un=v_(ke?.fecha);if(Number.isFinite(Un)){const ii=new Date(Un);ni=ii.getHours();const li=String(ni).padStart(2,"0");X.porHoraCreacion[li]=(X.porHoraCreacion[li]||0)+1;const ei=ii.getDay();X.porDiaSemana[ei]=(X.porDiaSemana[ei]||0)+1;const xn=Mw(ii);dn[xn]=(dn[xn]||0)+1;const gi=Wf(ni);X.franjasCreacion[gi]=(X.franjasCreacion[gi]||0)+1}}const Ti=ZL(ke.address,ke.direccionTexto);En[Ti]=En[Ti]||{total:0,entregadas:0,sumTOT:0,nTOT:0},En[Ti].total+=1,ke.entregado&&(En[Ti].entregadas+=1);const sr=Ga(ke.fechaRecibida,ke.createdAt),wi=Ga(ke.fechaEntregada,ke.fechaRecibida),Cn=Ga(ke.fechaEntregada,ke.createdAt);Number.isFinite(sr)&&(Fe+=sr,st+=1),Number.isFinite(wi)&&(zt+=wi,$n+=1),Number.isFinite(Cn)&&(Xn+=Cn,Nn+=1,En[Ti].sumTOT+=Cn,En[Ti].nTOT+=1,hn.push(Cn));const _t=!!(ke?.proofUrl||Array.isArray(ke?.fotosPodUrls)&&ke.fotosPodUrls.length>0);_t&&(X.conPOD+=1);const Rn=Nj(ke),fn=ya(ke?.fechaEntregada),Ls=(Number.isFinite(ue)?ue:15)*6e4,yr=ke.entregado&&Number.isFinite(Rn)&&Number.isFinite(fn)&&fn<=Rn+Ls;if(yr&&(X.onTimeCount+=1),Number.isFinite(fn)){const ii=new Date(fn).getHours(),li=String(ii).padStart(2,"0");X.porHoraEntrega[li]=(X.porHoraEntrega[li]||0)+1;const ei=Wf(ii);X.franjasEntrega[ei]=(X.franjasEntrega[ei]||0)+1;const xn=$l(fn),gi=Pi[xn]||{entregadas:0,sumTOT:0,nTOT:0};gi.entregadas+=1,Number.isFinite(Cn)&&(gi.sumTOT+=Cn,gi.nTOT+=1),Pi[xn]=gi}const Vn=ke.asignadoUid||ke.asignadoNombre||"—",Bi=ke.asignadoNombre||Vn;Yt[Vn]=Yt[Vn]||{nombre:Bi,total:0,entregadas:0,sumRE:0,nRE:0,sumTOT:0,nTOT:0,pod:0,onTime:0},Yt[Vn].total+=1,ke.entregado&&(Yt[Vn].entregadas+=1),Number.isFinite(wi)&&(Yt[Vn].sumRE+=wi,Yt[Vn].nRE+=1),Number.isFinite(Cn)&&(Yt[Vn].sumTOT+=Cn,Yt[Vn].nTOT+=1),_t&&(Yt[Vn].pod+=1),yr&&(Yt[Vn].onTime+=1);const bs=ke.creadoPorNombre||ke.usuario||ke.creadoPor||"—",Jn=bs;if(St[Jn]=St[Jn]||{nombre:bs,creadas:0,entregadas:0,sumTOT:0,nTOT:0,tiempos:[],horas:{},franjas:{}},St[Jn].creadas+=1,ke.entregado&&(St[Jn].entregadas+=1,Number.isFinite(Cn)&&(St[Jn].sumTOT+=Cn,St[Jn].nTOT+=1,St[Jn].tiempos.push(Cn))),ni!=null){const Un=String(ni).padStart(2,"0");St[Jn].horas[Un]=(St[Jn].horas[Un]||0)+1;const ii=Wf(ni);St[Jn].franjas[ii]=(St[Jn].franjas[ii]||0)+1}bn.push({id:ke.id,cliente:ke.cliente||"",mensajero:Bi,creado:Number.isFinite(Ir)?new Date(Ir).toLocaleString():"",recibida:ke.fechaRecibida?new Date(ya(ke.fechaRecibida)).toLocaleString():"",entregada:ke.fechaEntregada?new Date(ya(ke.fechaEntregada)).toLocaleString():"",zona:Ti,estado:ke.entregado?"ENTREGADA":ke.recibida?"RECIBIDA":"PENDIENTE",tiene_pod:_t?"sí":"no",on_time:yr?"sí":"no",operador:bs,min_creacion_a_recibida:Number.isFinite(Ga(ke.fechaRecibida,ke.createdAt))?Ga(ke.fechaRecibida,ke.createdAt).toFixed(1):"",min_recibida_a_entregada:Number.isFinite(Ga(ke.fechaEntregada,ke.fechaRecibida))?Ga(ke.fechaEntregada,ke.fechaRecibida).toFixed(1):"",min_total:Number.isFinite(Ga(ke.fechaEntregada,ke.createdAt))?Ga(ke.fechaEntregada,ke.createdAt).toFixed(1):""})}const Ht=(ke,at)=>at>0?ke/at:null;X.avgCreacionARecibida=Ht(Fe,st),X.avgRecibidaAEntregada=Ht(zt,$n),X.avgTotal=Ht(Xn,Nn),X.p50Total=Yf(hn,50),X.p90Total=Yf(hn,90);const Mt=Number.isFinite(Ce)?Ce:45;return X.dentroSLA=hn.filter(ke=>Number.isFinite(ke)&&ke<=Mt).length,X.slaPct=Yc(X.dentroSLA,hn.length||0),X.podPct=Yc(X.conPOD,X.entregadas||0),X.onTimePct=Yc(X.onTimeCount,X.entregadas||0),X.porZona=En,X.porMes=dn,X.porMensajero=Object.entries(Yt).map(([ke,at])=>({uid:ke,nombre:at.nombre,total:at.total,entregadas:at.entregadas,tasaExito:at.total?at.entregadas/at.total:0,avgEntregaMin:Ht(at.sumRE,at.nRE),avgTotalMin:Ht(at.sumTOT,at.nTOT),podPctNum:at.entregadas?at.pod/at.entregadas:0,onTimePctNum:at.entregadas?at.onTime/at.entregadas:0})).sort((ke,at)=>at.entregadas-ke.entregadas||at.total-ke.total),X.porOperador=Object.entries(St).map(([ke,at])=>({nombre:at.nombre||ke,creadas:at.creadas,entregadas:at.entregadas,promedioTotal:Ht(at.sumTOT,at.nTOT),p50:Yf(at.tiempos,50),p90:Yf(at.tiempos,90),horas:at.horas,franjas:at.franjas})).sort((ke,at)=>at.creadas-ke.creadas||(at.promedioTotal??0)-(ke.promedioTotal??0)),X.duplicadasFactura=Object.entries(gn).filter(([,ke])=>ke>1).map(([ke,at])=>({numeroFactura:ke,repeticiones:at})),X.exportRows=bn,X.tendencias=Object.entries(Pi).map(([ke,at])=>({fecha:ke,entregadas:at.entregadas,promTotal:at.nTOT?at.sumTOT/at.nTOT:null})).sort((ke,at)=>ke.fecha.localeCompare(at.fecha)),X},[re,Ce,ue]),le=Ay;async function Re(){try{let X=null;try{X=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const Fe=X?.empresaId!=null&&X?.empresaId!==""?String(X.empresaId):null;if(!Fe)throw new Error("empresaId vacío en usuarioActivo. No crearé la orden.");const st=new Date,zt=st.toISOString().slice(0,10),$n=st.toTimeString().slice(0,5),Xn=X?.nombre||X?.usuario||"tester",Nn=(X?.rol||"administrador").toLowerCase(),Yt={empresaId:Fe,cliente:"PRUEBA KPI",telefono:"000-000-0000",numeroFactura:`TEST-${Date.now()}`,monto:"0",fecha:zt,hora:$n,address:{formatted:"Punto de prueba, Santo Domingo",lat:18.4861,lng:-69.9312},destinoLat:18.4861,destinoLng:-69.9312,direccionTexto:"Punto de prueba, Santo Domingo",entregado:!1,recibida:!1,fechaRecibida:null,fechaEntregada:null,tiempoTotalEntrega:null,asignadoUid:null,asignadoNombre:null,usuario:Xn,rolUsuario:Nn,createdAt:ut()},En=await so(Bt(ze,le),Yt);alert(`✅ Orden de prueba creada (${En.id}).`)}catch(X){console.error("crearOrdenPrueba:",X),$(Fe=>({...Fe,lastWriteError:X?.message||String(X)})),alert("No pude crear la orden de prueba: "+(X?.message||""))}}async function Ge(){try{let X=null;try{X=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const Fe=X?.empresaId!=null&&X?.empresaId!==""?String(X.empresaId):null;if(!Fe)throw new Error("empresaId vacío en usuarioActivo. No crearé la orden.");const st=new Date,zt=st.toISOString().slice(0,10),$n=st.toTimeString().slice(0,5),Xn=X?.nombre||X?.usuario||"tester",Nn=(X?.rol||"administrador").toLowerCase(),Yt={empresaId:Fe,cliente:"PRUEBA FLUJO",telefono:"000-000-0000",numeroFactura:`FLOW-${Date.now()}`,monto:"0",fecha:zt,hora:$n,address:{formatted:"Punto flujo, Santo Domingo",lat:18.49,lng:-69.93},destinoLat:18.49,destinoLng:-69.93,direccionTexto:"Punto flujo, Santo Domingo",entregado:!1,recibida:!1,fechaRecibida:null,fechaEntregada:null,tiempoTotalEntrega:null,asignadoUid:"rider-1",asignadoNombre:"Carlos",usuario:Xn,rolUsuario:Nn,createdAt:ut()},En=await so(Bt(ze,le),Yt);setTimeout(()=>mr(gt(ze,le,En.id),{recibida:!0,fechaRecibida:ut()}).catch(dn=>{console.error("mark recibida:",dn),$(bn=>({...bn,lastWriteError:dn?.message||String(dn)}))}),2e3),setTimeout(()=>mr(gt(ze,le,En.id),{entregado:!0,fechaEntregada:ut(),tiempoTotalEntrega:"2.0"}).catch(dn=>{console.error("mark entregada:",dn),$(bn=>({...bn,lastWriteError:dn?.message||String(dn)}))}),4e3),alert(`✅ Orden de flujo creada: ${En.id}.`)}catch(X){console.error("crearYCompletarPrueba:",X),$(Fe=>({...Fe,lastWriteError:X?.message||String(X)})),alert("No pude crear la orden de flujo: "+(X?.message||""))}}async function Je(){if(!t)return alert("Falta empresaId.");if(!ye.length)return alert("No hay órdenes por corregir.");try{A(!0);let X=0,Fe=0;for(const st of ye)try{await mr(gt(ze,Ay,st),{createdAt:ut()}),X++}catch(zt){console.warn("Fix createdAt fallo:",st,zt?.message),Fe++}alert(`Fix createdAt listo. OK: ${X} · Fallas: ${Fe}`),A(!1)}catch(X){console.error("arreglarCreatedAtFaltantes:",X),A(!1)}}const Ze=[{label:"Órdenes (rango)",value:K.total},{label:"Entregadas",value:K.entregadas},{label:"Pendientes",value:K.pendientes},{label:"Prom. creación→recibida",value:Ps(K.avgCreacionARecibida)},{label:"Prom. recibida→entregada",value:Ps(K.avgRecibidaAEntregada)},{label:"Prom. total",value:Ps(K.avgTotal)},{label:"P50 total",value:Ps(K.p50Total)},{label:"P90 total",value:Ps(K.p90Total)},{label:`SLA ≤ ${Ce} min`,value:K.slaPct},{label:"% con POD (sobre entregadas)",value:K.podPct},{label:`% On-time (≤ ${ue} min)`,value:K.onTimePct}],Ct=K.duplicadasFactura||[],Ot=Object.entries(K.porZona||{}),Ke=Object.entries(K.porMes||{}),ft=["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],Wt=Wc.reduce((X,Fe)=>X+(K.franjasCreacion[Fe]||0),0),Hn=Wc.reduce((X,Fe)=>X+(K.franjasEntrega[Fe]||0),0),pn=Array.from({length:24},(X,Fe)=>String(Fe).padStart(2,"0")),qn=Wc.map(X=>({label:X,value:K.franjasCreacion[X]||0})),gr=Wc.map(X=>({label:X,value:K.franjasEntrega[X]||0})),kt=pn.map(X=>({label:X,value:K.porHoraCreacion[X]||0})),yt=pn.map(X=>({label:X,value:K.porHoraEntrega[X]||0})),ct=ft.map((X,Fe)=>({label:X,value:K.porDiaSemana[Fe]||0})),$t=K.porOperador.find(X=>X.nombre===Q),Ln=$t?Wc.reduce((X,Fe)=>X+($t.franjas?.[Fe]||0),0):0,ts=$t?Wc.map(X=>({label:X,value:$t.franjas?.[X]||0})):[],ia=$t?pn.map(X=>({label:X,value:$t.horas?.[X]||0})):[];function Rr(){const Fe=new Date().toISOString().slice(0,10);f(Fe),_(Fe)}function zr(){const X=new Date,st=(X.getDay()+6)%7,zt=new Date(X);zt.setDate(X.getDate()-st);const $n=new Date(zt);$n.setDate(zt.getDate()+6),f(zt.toISOString().slice(0,10)),_($n.toISOString().slice(0,10))}function Ki(){const X=new Date,Fe=new Date(X.getFullYear(),X.getMonth(),1),st=new Date(X.getFullYear(),X.getMonth()+1,0);f(Fe.toISOString().slice(0,10)),_(st.toISOString().slice(0,10))}return a.jsxs("div",{className:"stats-page",children:[a.jsx("style",{children:`
        .stats-page{
          --bg:#f8fafc;
          --surface:#ffffff;
          --text:#0f172a;
          --muted:#64748b;
          --border:#e5e7eb;
          --primary:#7c3aed;        /* violeta suave */
          --primary-weak:#ede9fe;   /* fondo pastel */
          --accent:#06b6d4;         /* cian suave */
          --green:#10b981;
          --green-weak:#ecfdf5;
          --orange:#f59e0b;
          --red:#ef4444;
          --shadow:0 1px 3px rgba(2,6,23,.06),0 1px 2px rgba(2,6,23,.04);
          background:var(--bg);
          min-height:100%;
          padding:16px;
          color:var(--text);
        }
        .header{
          display:flex; align-items:center; gap:10px; margin-bottom:10px;
        }
        .title{
          margin:0;
          font-weight:800;
          letter-spacing:.2px;
        }
        .pill{
          background:var(--primary-weak);
          color:var(--primary);
          padding:4px 10px; border-radius:999px;
          font-size:12px; font-weight:600;
        }
        .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end; }
        .toolbar .group{ display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap; }
        .toolbar label{ font-size:12px; color:var(--muted); display:block; margin-bottom:4px; }
        .toolbar input, .toolbar select{
          padding:8px 10px; border:1px solid var(--border); border-radius:10px; background:#fff; min-width:150px;
        }
        .btn{ padding:8px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; cursor:pointer; transition:transform .02s, background .2s, border .2s; }
        .btn:hover{ background:#f9fafb; }
        .btn:active{ transform:scale(.98); }
        .btn-primary{ background:var(--primary); color:#fff; border-color:var(--primary); }
        .btn-primary:hover{ filter:brightness(.98); }
        .btn-soft{ background:var(--primary-weak); color:var(--primary); border-color:transparent; }
        .btn-ghost{ background:transparent; border-color:transparent; color:var(--muted); }
        .meta{ font-size:12px; color:var(--muted); display:flex; gap:12px; align-items:center; }
        .card{
          background:var(--surface);
          border:1px solid var(--border);
          border-radius:14px;
          padding:14px;
          box-shadow:var(--shadow);
        }
        .card-title{ margin:0 0 8px 0; font-size:14px; color:#111827; font-weight:700; }
        .kpi-grid{
          display:grid;
          grid-template-columns:repeat(auto-fit, minmax(200px,1fr));
          gap:12px; margin-top:12px;
        }
        .kpi{
          border:1px solid var(--border);
          border-radius:14px;
          padding:14px;
          background:var(--surface);
          box-shadow:var(--shadow);
        }
        .kpi .label{ font-size:12px; color:var(--muted); }
        .kpi .value{ font-size:22px; font-weight:800; letter-spacing:.2px; margin-top:2px; }
        .hbar-list .hbar-row{
          display:grid; grid-template-columns:90px 1fr 60px; align-items:center; gap:10px; margin:10px 0;
        }
        .hbar-label{ font-size:12px; color:var(--muted); }
        .hbar-track{ background:#eef2ff; border-radius:999px; height:12px; overflow:hidden; }
        .hbar-fill{ height:100%; background:linear-gradient(90deg,var(--primary) 0%, #8b5cf6 100%); }
        .hbar-value{ text-align:right; font-variant-numeric:tabular-nums; }
        .vbar-wrap{ display:flex; align-items:flex-end; gap:10px; }
        .vbar-col{ flex:1; display:flex; flex-direction:column; align-items:center; gap:6px; }
        .vbar-track{ width:100%; background:#f1f5f9; border-radius:8px; height:100%; display:flex; align-items:flex-end; overflow:hidden; }
        .vbar-fill{ width:100%; background:linear-gradient(180deg,#22d3ee 0%, #06b6d4 100%); border-top-left-radius:8px; border-top-right-radius:8px; }
        .vbar-label{ font-size:10px; color:var(--muted); }
        .section-title{ margin:18px 0 8px 0; font-size:16px; font-weight:800; }
        .table-wrap{ overflow-x:auto; }
        table.pretty{ width:100%; border-collapse:separate; border-spacing:0; }
        table.pretty th{
          text-align:left; padding:10px; font-size:12px; color:#111827; background:#fafafa; border-bottom:1px solid var(--border);
          position:sticky; top:0; z-index:1;
        }
        table.pretty td{
          padding:10px; border-bottom:1px solid #f1f5f9; vertical-align:top;
        }
        table.pretty tbody tr:nth-child(odd){ background:#fcfcff; }
        table.pretty tbody tr:hover{ background:#f8fafc; }
        .hint{ font-size:12px; color:var(--muted); margin-top:10px; }
        .badge{
          display:inline-block; padding:3px 8px; border-radius:999px; border:1px solid var(--border); background:#fff; color:var(--muted); font-size:12px;
        }
      `}),a.jsxs("div",{className:"header",children:[a.jsx("h2",{className:"title",children:"📊 Estadísticas (Administrador)"}),a.jsx("span",{className:"pill",children:"Vista en vivo"}),a.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:a.jsx("button",{className:"btn btn-soft",onClick:()=>me(X=>!X),children:te?"Ocultar debug":"Mostrar debug"})})]}),te&&a.jsxs("div",{className:"card",style:{marginBottom:10,background:"#fffbeb",borderColor:"#fde68a"},children:[a.jsx("div",{className:"card-title",children:"Debug"}),a.jsxs("div",{className:"meta",style:{flexWrap:"wrap"},children:[a.jsxs("span",{children:["usuarioActivo.empresaId: ",a.jsx("code",{children:String(W.usuarioEmpresaId)})," (typeof ",W.usuarioEmpresaIdType,")"]}),a.jsxs("span",{children:["usuarios/",n?.uid,".empresaId: ",a.jsx("code",{children:String(W.userDocEmpresaId)})," (typeof ",W.userDocEmpresaIdType,")"]}),a.jsxs("span",{children:["docs: ",a.jsx("b",{children:ae.total})]}),a.jsxs("span",{children:["pending: ",a.jsx("b",{children:ae.pendingLocal})]})]}),a.jsxs("div",{className:"meta",style:{marginTop:6},children:[a.jsxs("span",{children:["Filtro — conCreatedAt: ",a.jsx("b",{children:he.conCreatedAt})]}),a.jsxs("span",{children:["conFechaStr: ",a.jsx("b",{children:he.conFechaStr})]}),a.jsxs("span",{children:["sinFecha: ",a.jsx("b",{children:he.sinFecha})]}),a.jsxs("span",{children:["inRange: ",a.jsx("b",{children:he.inRange})]}),a.jsxs("span",{children:["outRange: ",a.jsx("b",{children:he.outRange})]})]})]}),a.jsxs("div",{className:"meta",style:{marginBottom:8},children:[a.jsxs("span",{className:"badge",children:["cache: ",String(ae.fromCache)]}),a.jsxs("span",{className:"badge",children:["pendientes: ",ae.pendingLocal]}),a.jsxs("span",{className:"badge",children:["docs: ",ae.total]}),a.jsxs("span",{style:{marginLeft:"auto"},children:[a.jsx("b",{children:"Rango disponible:"})," ",Number.isFinite(Ae.minMs)?$l(Ae.minMs):"—"," →"," ",Number.isFinite(Ae.maxMs)?$l(Ae.maxMs):"—",a.jsx("button",{className:"btn btn-ghost",style:{marginLeft:8},onClick:()=>{const{minMs:X,maxMs:Fe}=Ae;Number.isFinite(X)&&Number.isFinite(Fe)?(f($l(X)),_($l(Fe))):(f("2020-01-01"),_(new Date().toISOString().slice(0,10)))},children:"📅 Ver todo"})]})]}),a.jsxs("div",{className:"card",style:{marginBottom:12},children:[a.jsxs("div",{className:"toolbar",children:[a.jsxs("div",{className:"group",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Desde"}),a.jsx("input",{type:"date",value:u,onChange:X=>f(X.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Hasta"}),a.jsx("input",{type:"date",value:y,onChange:X=>_(X.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tipo de fecha"}),a.jsxs("select",{value:R,onChange:X=>I(X.target.value),children:[a.jsx("option",{value:"creacion",children:"Creación"}),a.jsx("option",{value:"programada",children:"Programada (fecha/hora)"}),a.jsx("option",{value:"entrega",children:"Entrega"})]})]})]}),a.jsxs("div",{className:"group",style:{minWidth:220},children:[a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:v,onChange:X=>w(X.target.checked)})," Solo entregadas"]}),a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:G,onChange:X=>H(X.target.checked)})," Solo con POD"]})]}),a.jsxs("div",{className:"group",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Mensajero"}),a.jsxs("select",{value:Z,onChange:X=>F(X.target.value),children:[a.jsx("option",{value:"",children:"(Todos)"}),J.map(X=>a.jsx("option",{value:X,children:X},X))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Operador (quien crea)"}),a.jsxs("select",{value:Q,onChange:X=>se(X.target.value),children:[a.jsx("option",{value:"",children:"(Todos)"}),oe.map(X=>a.jsx("option",{value:X,children:X},X))]})]})]}),a.jsxs("div",{className:"group",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Objetivo SLA (min)"}),a.jsx("input",{type:"number",min:1,style:{width:100},value:Ce,onChange:X=>Ue(Number(X.target.value)||0)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tolerancia On-time (min)"}),a.jsx("input",{type:"number",min:0,style:{width:100},value:ue,onChange:X=>we(Number(X.target.value)??0)})]})]}),a.jsxs("div",{className:"group",style:{marginLeft:"auto"},children:[a.jsx("button",{className:"btn",onClick:Rr,children:"📆 Hoy"}),a.jsx("button",{className:"btn",onClick:zr,children:"🗓️ Esta semana"}),a.jsx("button",{className:"btn",onClick:Ki,children:"🗓️ Este mes"}),a.jsx("button",{className:"btn",onClick:()=>{F(""),se("")},title:"Quitar filtros",children:"🧹 Limpiar"})]}),a.jsxs("div",{className:"group",children:[a.jsx("button",{className:"btn",onClick:Re,children:"➕ Orden de prueba"}),a.jsx("button",{className:"btn",onClick:Ge,children:"🎯 Prueba completa (4s)"}),a.jsx("button",{className:"btn btn-primary",onClick:()=>kw(`ordenes_${u}_a_${y}${v?"_entregadas":""}.csv`,K.exportRows),disabled:!K.exportRows.length,children:"⬇️ Exportar CSV"})]})]}),ye.length>0&&a.jsxs("div",{className:"meta",style:{marginTop:10},children:[a.jsxs("span",{style:{color:"#b45309"},children:["Hay ",ye.length," órdenes sin ",a.jsx("code",{children:"createdAt"}),"."]}),a.jsx("button",{className:"btn btn-soft",onClick:Je,disabled:be,children:be?"Arreglando…":"Arreglar createdAt"})]}),D&&a.jsx("div",{className:"meta",style:{marginTop:8},children:"Cargando…"}),k&&a.jsx("div",{className:"meta",style:{marginTop:8,color:"#b91c1c"},children:k}),j&&a.jsxs("div",{className:"meta",style:{marginTop:4},children:["Última actualización: ",j.toLocaleTimeString()]})]}),a.jsx("div",{className:"kpi-grid",children:Ze.map(X=>a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"label",children:X.label}),a.jsx("div",{className:"value",children:X.value})]},X.label))}),a.jsx(Ny,{title:"⏰ Franjas de creación (órdenes registradas)",data:qn,total:Wt}),a.jsx(Ny,{title:"⏱️ Franjas de entrega",data:gr,total:Hn}),a.jsx(Qf,{title:"🕘 Por hora de creación (0–23)",data:kt}),a.jsx(Qf,{title:"🕒 Por hora de entrega (0–23)",data:yt}),a.jsx(Qf,{title:"📅 Por día de la semana (creación)",data:ct}),a.jsx("h3",{className:"section-title",children:"🩺 Calidad de datos (diagnóstico local)"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Indicador"}),a.jsx("th",{children:"Valor"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{children:"Órdenes sin dirección (address/direccionTexto)"}),a.jsx("td",{children:K.faltantesAddress})]}),a.jsxs("tr",{children:[a.jsx("td",{children:"Órdenes sin coordenadas válidas"}),a.jsx("td",{children:K.faltantesCoords})]})]})]})}),a.jsx("h3",{className:"section-title",children:"🧾 Posibles duplicados por Nº de factura"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Número de factura"}),a.jsx("th",{children:"Repeticiones"})]})}),a.jsx("tbody",{children:Ct.length?Ct.sort((X,Fe)=>Fe.repeticiones-X.repeticiones).map(X=>a.jsxs("tr",{children:[a.jsx("td",{children:X.numeroFactura}),a.jsx("td",{children:X.repeticiones})]},X.numeroFactura)):a.jsx("tr",{children:a.jsx("td",{colSpan:2,children:"Sin duplicados detectados en el rango."})})})]})}),a.jsx("h3",{className:"section-title",children:"🏆 Mensajeros"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Mensajero"}),a.jsx("th",{children:"Entregadas"}),a.jsx("th",{children:"Órdenes (total)"}),a.jsx("th",{children:"Tasa de éxito"}),a.jsx("th",{children:"Prom. entrega (recibida→entregada)"}),a.jsx("th",{children:"Prom. total"}),a.jsx("th",{children:"% POD"}),a.jsx("th",{children:"% On-time"})]})}),a.jsx("tbody",{children:K.porMensajero.length?K.porMensajero.map(X=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("button",{className:"btn btn-ghost",onClick:()=>F(X.nombre),title:"Filtrar por este mensajero",children:X.nombre})}),a.jsx("td",{style:{textAlign:"center"},children:X.entregadas}),a.jsx("td",{style:{textAlign:"center"},children:X.total}),a.jsx("td",{style:{textAlign:"center"},children:Yc(X.entregadas,X.total)}),a.jsx("td",{children:Ps(X.avgEntregaMin)}),a.jsx("td",{children:Ps(X.avgTotalMin)}),a.jsx("td",{style:{textAlign:"center"},children:Yc(X.podPctNum*X.entregadas,X.entregadas)}),a.jsx("td",{style:{textAlign:"center"},children:Yc(X.onTimePctNum*X.entregadas,X.entregadas)})]},X.uid)):a.jsx("tr",{children:a.jsx("td",{colSpan:8,children:"Sin datos en el rango."})})})]})}),a.jsx("h3",{className:"section-title",children:"🧑‍💻 Operadores (órdenes creadas y tiempos de entrega)"}),a.jsx("div",{className:"card",style:{marginBottom:8,display:"flex",gap:8,alignItems:"center"},children:a.jsx("button",{className:"btn",onClick:()=>kw(`kpi_operadores_${u}_a_${y}.csv`,K.porOperador.map(X=>({operador:X.nombre,creadas:X.creadas,entregadas:X.entregadas,promedio_total_min:X.promedioTotal!=null?X.promedioTotal.toFixed(2):"",p50_min:X.p50!=null?X.p50.toFixed(2):"",p90_min:X.p90!=null?X.p90.toFixed(2):""}))),disabled:!K.porOperador.length,children:"⬇️ Exportar KPI operadores"})}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Operador"}),a.jsx("th",{children:"Creadas"}),a.jsx("th",{children:"Entregadas"}),a.jsx("th",{children:"Prom. total"}),a.jsx("th",{children:"p50"}),a.jsx("th",{children:"p90"})]})}),a.jsx("tbody",{children:K.porOperador.length?K.porOperador.map(X=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("button",{className:"btn btn-ghost",onClick:()=>se(X.nombre),title:"Filtrar por este operador",children:X.nombre})}),a.jsx("td",{style:{textAlign:"center"},children:X.creadas}),a.jsx("td",{style:{textAlign:"center"},children:X.entregadas}),a.jsx("td",{style:{textAlign:"center"},children:Ps(X.promedioTotal)}),a.jsx("td",{style:{textAlign:"center"},children:Ps(X.p50)}),a.jsx("td",{style:{textAlign:"center"},children:Ps(X.p90)})]},X.nombre)):a.jsx("tr",{children:a.jsx("td",{colSpan:6,children:"Sin datos en el rango."})})})]})}),Q&&$t&&a.jsxs(a.Fragment,{children:[a.jsx(Ny,{title:`⏰ Franjas de creación de ${Q}`,data:ts,total:Ln}),a.jsx(Qf,{title:`🕘 Por hora de creación (0–23) de ${Q}`,data:ia})]}),a.jsx("h3",{className:"section-title",children:"🗺️ Zonas (tiempo promedio creación→entrega)"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Zona"}),a.jsx("th",{children:"Órdenes"}),a.jsx("th",{children:"Entregadas"}),a.jsx("th",{children:"Prom. total"})]})}),a.jsx("tbody",{children:Ot.length?Ot.sort((X,Fe)=>Fe[1].total-X[1].total).map(([X,Fe])=>{const st=Fe.nTOT?Fe.sumTOT/Fe.nTOT:null;return a.jsxs("tr",{children:[a.jsx("td",{children:X}),a.jsx("td",{style:{textAlign:"center"},children:Fe.total}),a.jsx("td",{style:{textAlign:"center"},children:Fe.entregadas}),a.jsx("td",{children:Ps(st)})]},X)}):a.jsx("tr",{children:a.jsx("td",{colSpan:4,children:"Sin datos en el rango."})})})]})}),a.jsx("h3",{className:"section-title",children:"📅 Distribución por día de la semana (creación)"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsx("tr",{children:ft.map(X=>a.jsx("th",{children:X},X))})}),a.jsx("tbody",{children:a.jsx("tr",{children:ft.map((X,Fe)=>a.jsx("td",{style:{textAlign:"center"},children:K.porDiaSemana[Fe]||0},Fe))})})]})}),a.jsx("h3",{className:"section-title",children:"📈 Historial mensual (órdenes creadas)"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Mes"}),a.jsx("th",{children:"Órdenes"})]})}),a.jsx("tbody",{children:Ke.length?Ke.sort((X,Fe)=>X[0].localeCompare(Fe[0])).map(([X,Fe])=>a.jsxs("tr",{children:[a.jsx("td",{children:X}),a.jsx("td",{style:{textAlign:"center"},children:Fe})]},X)):a.jsx("tr",{children:a.jsx("td",{colSpan:2,children:"Sin datos en el rango."})})})]})}),a.jsx("h3",{className:"section-title",children:"📊 Tendencias (por día de entrega)"}),a.jsx("div",{className:"table-wrap card",children:a.jsxs("table",{className:"pretty",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Entregadas"}),a.jsx("th",{children:"Prom. total (min)"})]})}),a.jsx("tbody",{children:K.tendencias.length?K.tendencias.map(X=>a.jsxs("tr",{children:[a.jsx("td",{children:X.fecha}),a.jsx("td",{style:{textAlign:"center"},children:X.entregadas}),a.jsx("td",{children:Ps(X.promTotal)})]},X.fecha)):a.jsx("tr",{children:a.jsx("td",{colSpan:3,children:"Sin datos de entrega en el rango."})})})]})}),a.jsxs("div",{className:"hint",children:["* Asegúrate de que ",a.jsx("code",{children:"usuarios/{uid}.empresaId"})," exista y coincida con ",a.jsx("code",{children:"ordenes[].empresaId"}),"."]})]})}function Za(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const t=new Date(n).getTime();if(Number.isFinite(t))return t}}catch{}return NaN}function Dw(n){if(typeof n!="string")return NaN;const e=n.trim(),t=new Date(e).getTime();if(Number.isFinite(t))return t;let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{4})\/(\d{2})\/(\d{2})$/),r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})-(\d{2})-(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[1]}-${r[2]}T12:00:00`).getTime();if(Number.isFinite(l))return l}return NaN}function Lw(n,e){const t=Za(n),r=Za(e);return!Number.isFinite(t)||!Number.isFinite(r)?null:(r-t)/6e4}function Vw(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0");return`${e}-${t}`}function Rd(n,e=1){return n==null?"—":Number(n).toFixed(e)}function KL(n,e){if(!e?.length)return;const t=Object.keys(e[0]),r=[t.join(","),...e.map(y=>t.map(_=>`"${String(y[_]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(l),f=document.createElement("a");f.href=u,f.download=n,f.click(),URL.revokeObjectURL(u)}const Gl={padding:12,border:"1px solid #eee",borderRadius:8,background:"#fff"},Ri={textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 10px",background:"#fafafa"},ps={borderBottom:"1px solid #f2f2f2",padding:"8px 10px"},ms={...ps,textAlign:"center"};function Uw(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const e=(n?.rol||"").toLowerCase(),t=n?.empresaId!=null&&n?.empresaId!==""?String(n.empresaId):null,r=new Date,l=new Date(r.getFullYear(),r.getMonth(),1),[u,f]=E.useState(l.toISOString().slice(0,10)),[y,_]=E.useState(r.toISOString().slice(0,10)),[v,w]=E.useState("ambos"),[R,I]=E.useState(""),[G,H]=E.useState(45),[Z,F]=E.useState([]),[Q,se]=E.useState(!1),[ue,we]=E.useState("");E.useEffect(()=>{let $=null,te=null;return(async()=>{if(se(!0),we(""),!await Qn()||!t){we("Sesión inválida o falta empresaId."),se(!1);return}try{const J=Bt(ze,"ordenes"),oe=en(J,Nt("empresaId","==",t),Fr("createdAt","desc"));$=Kt(oe,re=>{const he=re.docs.map(Ae=>({id:Ae.id,...Ae.data()}));F(he),se(!1)},re=>{if(console.error("onSnapshot(operadores):",re?.code,re?.message),re?.code==="failed-precondition"){const he=en(J,Nt("empresaId","==",t));te=Kt(he,Ae=>{const K=Ae.docs.map(le=>({id:le.id,...le.data()}));K.sort((le,Re)=>(Re?.createdAt?.toMillis?.()??0)-(le?.createdAt?.toMillis?.()??0)),F(K),se(!1)},Ae=>{we(Ae?.message||"No se pudieron leer órdenes (fallback). Crea el índice empresaId+createdAt."),se(!1)})}else re?.code==="permission-denied"?(we("Permiso denegado al leer órdenes. Revisa reglas / empresaId en usuarios/{uid}."),se(!1)):(we(re?.message||"No se pudieron leer órdenes."),se(!1))})}catch(J){console.error("query(ordenes) operadores error:",J),we(J?.message||"No se pudo iniciar la suscripción."),se(!1)}})(),()=>{$&&$(),te&&te()}},[t]);const Ce=E.useMemo(()=>{const $=new Set;for(const me of Z){const J=(me.rolUsuario||"").toLowerCase(),oe=(me.usuario||"").trim();oe&&(v==="operador"&&J!=="operador"||v==="administrador"&&J!=="administrador"||$.add(oe))}const te=Array.from($).sort((me,J)=>me.localeCompare(J));return e==="operador"&&n?.nombre&&te.includes(n.nombre)?[n.nombre]:te},[Z,v,e,n?.nombre]),Ue=E.useMemo(()=>{const $=new Date(u);$.setHours(0,0,0,0);const te=new Date(y);return te.setHours(23,59,59,999),{dMs:$.getTime(),hMs:te.getTime()}},[u,y]),P=E.useMemo(()=>{const $=[],me=e==="operador"&&n?.nombre||""||R;for(const J of Z){const oe=(J.rolUsuario||"").toLowerCase();if(v==="operador"&&oe!=="operador"||v==="administrador"&&oe!=="administrador")continue;const re=(J.usuario||"").trim();if(me&&re!==me)continue;let he=Za(J.createdAt);if(!Number.isFinite(he)){const Ae=Dw(J?.fecha);Number.isFinite(Ae)&&(he=Ae)}Number.isFinite(he)&&(he<Ue.dMs||he>Ue.hMs||$.push(J))}return $.sort((J,oe)=>Za(oe.createdAt)-Za(J.createdAt)),$},[Z,v,R,Ue.dMs,Ue.hMs,e,n?.nombre]),{kpiGlobal:M,porOperador:D,franjaGlobal:U,franjaOperador:k,porMes:q,porDia:j}=E.useMemo(()=>{const $=()=>{const Ke={};for(let ft=0;ft<24;ft++)Ke[String(ft).padStart(2,"0")]=0;return Ke},te=$(),me={},J={},oe=new Map,re=Ke=>{const ft=Ke||"—";return oe.has(ft)||oe.set(ft,{nombre:ft,creadas:0,entregadas:0,pendientes:0,asignadosPorMensajero:{},franja:$(),tiemposTotales:[],podSobreEntregadas:0}),oe.get(ft)};for(const Ke of P){const ft=(Ke.usuario||"—").trim(),Wt=re(ft);Wt.creadas+=1,Ke.entregado?Wt.entregadas+=1:Wt.pendientes+=1;const Hn=Za(Ke.createdAt);if(Number.isFinite(Hn)){const kt=new Date(Hn),yt=String(kt.getHours()).padStart(2,"0");Wt.franja[yt]=(Wt.franja[yt]||0)+1,te[yt]=(te[yt]||0)+1;const ct=kt.toISOString().slice(0,10),$t=Vw(kt);me[ct]=(me[ct]||0)+1,J[$t]=(J[$t]||0)+1}else{const kt=Dw(Ke?.fecha);if(Number.isFinite(kt)){const yt=new Date(kt),ct=yt.toISOString().slice(0,10),$t=Vw(yt);me[ct]=(me[ct]||0)+1,J[$t]=(J[$t]||0)+1}}const pn=(Ke.asignadoNombre||"").trim();pn&&(Wt.asignadosPorMensajero[pn]=(Wt.asignadosPorMensajero[pn]||0)+1);const qn=Lw(Ke.createdAt,Ke.fechaEntregada);Number.isFinite(qn)&&Wt.tiemposTotales.push(qn);const gr=!!(Ke?.proofUrl||Array.isArray(Ke?.fotosPodUrls)&&Ke.fotosPodUrls.length>0);Ke.entregado&&gr&&(Wt.podSobreEntregadas+=1)}const he=P.length,Ae=P.filter(Ke=>Ke.entregado).length,K=he-Ae,le=P.map(Ke=>Lw(Ke.createdAt,Ke.fechaEntregada)).filter(Ke=>Number.isFinite(Ke)),Re=le.length?le.reduce((Ke,ft)=>Ke+ft,0)/le.length:null,Ge=le.filter(Ke=>Ke<=Number(G)).length,Je={totalCreadas:he,totalEntregadas:Ae,totalPendientes:K,promTotalMin:Re,slaPct:Ae?`${(Ge/le.length*100).toFixed(1)}%`:"—"},Ze=Array.from(oe.values()).map(Ke=>{const ft=Ke.tiemposTotales.length?Ke.tiemposTotales.reduce((pn,qn)=>pn+qn,0)/Ke.tiemposTotales.length:null,Wt=Ke.tiemposTotales.filter(pn=>pn<=Number(G)).length,Hn=Ke.entregadas?Ke.podSobreEntregadas/Ke.entregadas*100:0;return{nombre:Ke.nombre,creadas:Ke.creadas,entregadas:Ke.entregadas,pendientes:Ke.pendientes,promTotalMin:ft,slaPctNum:Ke.tiemposTotales.length?Wt/Ke.tiemposTotales.length*100:0,podPctNum:Hn,asignadosPorMensajero:Ke.asignadosPorMensajero,franja:Ke.franja}}).sort((Ke,ft)=>ft.creadas-Ke.creadas||Ke.nombre.localeCompare(ft.nombre));let Ct=null;const Ot=e==="operador"?n?.nombre||"":R;if(Ot){const Ke=Ze.find(ft=>ft.nombre===Ot);Ke&&(Ct=Ke.franja)}return{kpiGlobal:Je,porOperador:Ze,franjaGlobal:te,franjaOperador:Ct,porMes:J,porDia:me}},[P,R,e,n?.nombre,G]),de=E.useMemo(()=>Array.from({length:24},($,te)=>String(te).padStart(2,"0")),[]),ae=E.useMemo(()=>e==="operador"?n?.nombre||"":R,[e,n?.nombre,R]),Y=E.useMemo(()=>{if(!ae)return[];const $=[];for(const te of P){if((te.usuario||"").trim()!==ae)continue;const J=Za(te.createdAt),oe=Za(te.fechaRecibida),re=Za(te.fechaEntregada),he=Number.isFinite(J)&&Number.isFinite(re)?(re-J)/6e4:null;$.push({id:te.id,cliente:te.cliente||"",factura:te.numeroFactura||"",creadoMs:J,recibidaMs:oe,entregadaMs:re,minTotal:he,mensajero:te.asignadoNombre||"—",estado:te.entregado?"ENTREGADA":te.recibida?"RECIBIDA":"PENDIENTE"})}return $.sort((te,me)=>(me.creadoMs||0)-(te.creadoMs||0)),$},[P,ae]),ye=E.useMemo(()=>{const $=Y.length,te=Y.filter(oe=>oe.estado==="ENTREGADA").length,me=Y.map(oe=>oe.minTotal).filter(Number.isFinite),J=me.length?me.reduce((oe,re)=>oe+re,0)/me.length:null;return{creadas:$,entregadas:te,promedioMin:J}},[Y]);function ie(){const te=new Date().toISOString().slice(0,10);f(te),_(te)}function be(){const $=new Date,me=($.getDay()+6)%7,J=new Date($);J.setDate($.getDate()-me);const oe=new Date(J);oe.setDate(J.getDate()+6),f(J.toISOString().slice(0,10)),_(oe.toISOString().slice(0,10))}function A(){const $=new Date,te=new Date($.getFullYear(),$.getMonth(),1),me=new Date($.getFullYear(),$.getMonth()+1,0);f(te.toISOString().slice(0,10)),_(me.toISOString().slice(0,10))}const W=$=>Number.isFinite($)?new Date($).toLocaleString():"—";return a.jsxs("div",{style:{padding:16},children:[a.jsx("h2",{style:{margin:0},children:"👩‍💼 Productividad de Operadores"}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsx("h3",{style:{marginTop:0},children:"Filtros"}),a.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"end"},children:[a.jsxs("div",{children:[a.jsx("label",{children:"Desde"}),a.jsx("br",{}),a.jsx("input",{type:"date",value:u,onChange:$=>f($.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Hasta"}),a.jsx("br",{}),a.jsx("input",{type:"date",value:y,onChange:$=>_($.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tipo de creador"}),a.jsx("br",{}),a.jsxs("select",{value:v,onChange:$=>{w($.target.value),I("")},disabled:e==="operador",children:[a.jsx("option",{value:"ambos",children:"Operadores y Administradores"}),a.jsx("option",{value:"operador",children:"Solo Operadores"}),a.jsx("option",{value:"administrador",children:"Solo Administradores"})]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Operador"}),a.jsx("br",{}),a.jsxs("select",{value:e==="operador"?n?.nombre||"":R,onChange:$=>I($.target.value),disabled:e==="operador",style:{minWidth:220},children:[a.jsx("option",{value:"",children:"(Todos)"}),Ce.map($=>a.jsx("option",{value:$,children:$},$))]})]}),a.jsxs("div",{style:{display:"inline-flex",gap:8,alignItems:"center"},children:[a.jsx("label",{children:"Objetivo SLA (min)"}),a.jsx("input",{type:"number",min:1,style:{width:80},value:G,onChange:$=>H(Number($.target.value)||0)})]}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx("button",{onClick:ie,children:"📆 Hoy"}),a.jsx("button",{onClick:be,children:"🗓️ Esta semana"}),a.jsx("button",{onClick:A,children:"🗓️ Este mes"}),a.jsx("button",{onClick:()=>I(""),title:"Quitar filtro operador",children:"🧹 Limpiar operador"})]}),Q&&a.jsx("div",{style:{width:"100%"},children:"Cargando…"}),!!ue&&a.jsx("div",{style:{width:"100%",color:"#b00"},children:ue})]})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsx("h3",{style:{marginTop:0},children:"Resumen global (órdenes creadas en el rango)"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, minmax(160px,1fr))",gap:10},children:[a.jsx(Id,{label:"Creadas",value:M.totalCreadas}),a.jsx(Id,{label:"Entregadas",value:M.totalEntregadas}),a.jsx(Id,{label:"Pendientes",value:M.totalPendientes}),a.jsx(Id,{label:"Prom. creación→entrega",value:`${Rd(M.promTotalMin,1)} min`}),a.jsx(Id,{label:`SLA ≤ ${G} min`,value:M.slaPct})]})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsx("h3",{style:{marginTop:0},children:"Franja horaria de creación (global)"}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsx("tr",{children:de.map($=>a.jsxs("th",{style:Ri,children:[$,":00"]},$))})}),a.jsx("tbody",{children:a.jsx("tr",{children:de.map($=>a.jsx("td",{style:ms,children:U?.[$]||0},$))})})]})}),a.jsx("div",{style:{marginTop:8,fontSize:12,color:"#666"},children:"* Usa esta tabla para detectar la **hora pico** de registro de órdenes."})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsxs("h3",{style:{marginTop:0},children:["Franja horaria de creación ",e==="operador"?"(mi actividad)":ae?`— ${ae}`:"(selecciona un operador)"]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",opacity:k?1:.5},children:[a.jsx("thead",{children:a.jsx("tr",{children:de.map($=>a.jsxs("th",{style:Ri,children:[$,":00"]},$))})}),a.jsx("tbody",{children:a.jsx("tr",{children:de.map($=>a.jsx("td",{style:ms,children:k&&k[$]||0},$))})})]})})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsx("h3",{style:{marginTop:0},children:"Operadores (rango seleccionado)"}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Ri,children:"Operador"}),a.jsx("th",{style:Ri,children:"Creadas"}),a.jsx("th",{style:Ri,children:"Entregadas"}),a.jsx("th",{style:Ri,children:"Pendientes"}),a.jsx("th",{style:Ri,children:"Prom. creación→entrega"}),a.jsx("th",{style:Ri,children:"% SLA"}),a.jsx("th",{style:Ri,children:"% POD (sobre entregadas)"}),a.jsx("th",{style:Ri,children:"Mensajeros más usados"})]})}),a.jsx("tbody",{children:D.length?D.map($=>{const te=Object.entries($.asignadosPorMensajero||{}).sort((me,J)=>J[1]-me[1]).slice(0,3).map(([me,J])=>`${me} (${J})`).join(", ");return a.jsxs("tr",{children:[a.jsx("td",{style:ps,children:a.jsx("button",{onClick:()=>I($.nombre),title:"Filtrar por este operador",children:$.nombre})}),a.jsx("td",{style:ms,children:$.creadas}),a.jsx("td",{style:ms,children:$.entregadas}),a.jsx("td",{style:ms,children:$.pendientes}),a.jsx("td",{style:ms,children:$.promTotalMin!=null?`${Rd($.promTotalMin,1)} min`:"—"}),a.jsx("td",{style:ms,children:`${Rd($.slaPctNum,1)}%`}),a.jsx("td",{style:ms,children:`${Rd($.podPctNum,1)}%`}),a.jsx("td",{style:ps,children:te||"—"})]},$.nombre)}):a.jsx("tr",{children:a.jsx("td",{colSpan:8,style:ps,children:"Sin datos en el rango."})})})]})})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsx("h3",{style:{marginTop:0},children:"Histórico (órdenes creadas)"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:12},children:[a.jsxs("div",{children:[a.jsx("h4",{style:{margin:"0 0 6px 0"},children:"Por día"}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Ri,children:"Fecha"}),a.jsx("th",{style:Ri,children:"Creadas"})]})}),a.jsxs("tbody",{children:[Object.entries(j).sort(($,te)=>$[0].localeCompare(te[0])).map(([$,te])=>a.jsxs("tr",{children:[a.jsx("td",{style:ps,children:$}),a.jsx("td",{style:ms,children:te})]},$)),!Object.keys(j).length&&a.jsx("tr",{children:a.jsx("td",{colSpan:2,style:ps,children:"Sin datos."})})]})]})})]}),a.jsxs("div",{children:[a.jsx("h4",{style:{margin:"0 0 6px 0"},children:"Por mes"}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Ri,children:"Mes"}),a.jsx("th",{style:Ri,children:"Creadas"})]})}),a.jsxs("tbody",{children:[Object.entries(q).sort(($,te)=>$[0].localeCompare(te[0])).map(([$,te])=>a.jsxs("tr",{children:[a.jsx("td",{style:ps,children:$}),a.jsx("td",{style:ms,children:te})]},$)),!Object.keys(q).length&&a.jsx("tr",{children:a.jsx("td",{colSpan:2,style:ps,children:"Sin datos."})})]})]})})]})]}),a.jsx("div",{style:{marginTop:8,fontSize:12,color:"#666"},children:"* Todos los conteos usan la **fecha de creación** de la orden."})]}),a.jsxs("div",{style:{...Gl,marginTop:12},children:[a.jsxs("h3",{style:{marginTop:0},children:["Detalle de órdenes del operador ",ae?`— ${ae}`:"(selecciona un operador)"]}),ae?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginBottom:8},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Creadas:"})," ",ye.creadas]}),a.jsxs("div",{children:[a.jsx("b",{children:"Entregadas:"})," ",ye.entregadas]}),a.jsxs("div",{children:[a.jsx("b",{children:"Prom. creación→entrega:"})," ",Rd(ye.promedioMin,1)," min"]}),a.jsx("div",{style:{marginLeft:"auto"},children:a.jsx("button",{onClick:()=>{KL(`detalle_${ae}_${u}_a_${y}.csv`,Y.map($=>({orderId:$.id,cliente:$.cliente,factura:$.factura,creado:W($.creadoMs),recibida:W($.recibidaMs),entregada:W($.entregadaMs),minutos_total:$.minTotal!=null?$.minTotal.toFixed(1):"",mensajero:$.mensajero,estado:$.estado})))},disabled:!Y.length,children:"⬇️ Exportar detalle"})})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Ri,children:"Creada"}),a.jsx("th",{style:Ri,children:"Entregada"}),a.jsx("th",{style:Ri,children:"Min (creación→entrega)"}),a.jsx("th",{style:Ri,children:"Mensajero"}),a.jsx("th",{style:Ri,children:"Cliente"}),a.jsx("th",{style:Ri,children:"Factura"}),a.jsx("th",{style:Ri,children:"Estado"})]})}),a.jsx("tbody",{children:Y.length?Y.map($=>a.jsxs("tr",{children:[a.jsx("td",{style:ps,children:W($.creadoMs)}),a.jsx("td",{style:ps,children:W($.entregadaMs)}),a.jsx("td",{style:ms,children:$.minTotal!=null?$.minTotal.toFixed(1):"—"}),a.jsx("td",{style:ps,children:$.mensajero}),a.jsx("td",{style:ps,children:$.cliente}),a.jsx("td",{style:ms,children:$.factura||"—"}),a.jsx("td",{style:ms,children:$.estado})]},$.id)):a.jsx("tr",{children:a.jsx("td",{colSpan:7,style:ps,children:"Sin órdenes creadas por este operador en el rango."})})})]})})]}):a.jsx("div",{style:{color:"#666"},children:"Selecciona un operador en los filtros (o entra con rol Operador) para ver el detalle."})]})]})}function Id({label:n,value:e}){return a.jsxs("div",{style:{padding:10,border:"1px dashed #ddd",borderRadius:10,background:"#fcfcfc"},children:[a.jsx("div",{style:{fontSize:12,color:"#666"},children:n}),a.jsx("div",{style:{fontSize:20,fontWeight:700},children:e})]})}function WL(n){if(!n||typeof n!="string")return{calle:"",numero:"",colonia:"",ciudad:"",estado:"",codigoPostal:"",pais:"México"};const e=n.trim(),t=e.split(",").map(r=>r.trim());return{calle:t[0]||"",numero:YL(t[0])||"",colonia:t[1]||"",ciudad:t[2]||"",estado:t[3]||"",codigoPostal:QL(e)||"",pais:"México"}}function YL(n){if(!n)return"";const e=n.match(/\d+/);return e?e[0]:""}function QL(n){if(!n)return"";const e=n.match(/\b\d{5}\b/);return e?e[0]:""}const Rj="https://nominatim.openstreetmap.org";async function Fw(n,e="mx"){if(!n||!n.trim())throw new Error("Dirección vacía");try{const t=new URLSearchParams({q:n,format:"json",limit:"1",countrycodes:e,addressdetails:"1"}),r=await fetch(`${Rj}/search?${t}`);if(!r.ok)throw new Error(`Error en geocodificación: ${r.status}`);const l=await r.json();if(!l||l.length===0)throw new Error("No se encontraron resultados para esta dirección");const u=l[0];return{lat:parseFloat(u.lat),lng:parseFloat(u.lon),display_name:u.display_name,address:u.address||{}}}catch(t){throw console.error("Error en geocodeText:",t),t}}async function zw(n,e){if(!n||!e)throw new Error("Coordenadas inválidas");try{const t=new URLSearchParams({lat:n.toString(),lon:e.toString(),format:"json",addressdetails:"1"}),r=await fetch(`${Rj}/reverse?${t}`);if(!r.ok)throw new Error(`Error en geocodificación inversa: ${r.status}`);const l=await r.json();if(!l||l.error)throw new Error("No se pudo obtener la dirección para estas coordenadas");return{display_name:l.display_name,address:l.address||{}}}catch(t){throw console.error("Error en reverseGeocode:",t),t}}function Ij(n,e){const t=E.useRef(e);E.useEffect(function(){e!==t.current&&n.attributionControl!=null&&(t.current!=null&&n.attributionControl.removeAttribution(t.current),e!=null&&n.attributionControl.addAttribution(e)),t.current=e},[n,e])}function XL(n,e,t){e.center!==t.center&&n.setLatLng(e.center),e.radius!=null&&e.radius!==t.radius&&n.setRadius(e.radius)}const JL=1;function e6(n){return Object.freeze({__version:JL,map:n})}function Lv(n,e){return Object.freeze({...n,...e})}const Vv=E.createContext(null);function Tp(){const n=E.use(Vv);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function Pj(n){function e(t,r){const{instance:l,context:u}=n(t).current;E.useImperativeHandle(r,()=>l);const{children:f}=t;return f==null?null:wm.createElement(Vv,{value:u},f)}return E.forwardRef(e)}function t6(n){function e(t,r){const[l,u]=E.useState(!1),{instance:f}=n(t,u).current;E.useImperativeHandle(r,()=>f),E.useEffect(function(){l&&f.update()},[f,l,t.children]);const y=f._contentNode;return y?kC.createPortal(t.children,y):null}return E.forwardRef(e)}function n6(n){function e(t,r){const{instance:l}=n(t).current;return E.useImperativeHandle(r,()=>l),null}return E.forwardRef(e)}function Uv(n,e){const t=E.useRef(void 0);E.useEffect(function(){return e!=null&&n.instance.on(e),t.current=e,function(){t.current!=null&&n.instance.off(t.current),t.current=null}},[n,e])}function wp(n,e){const t=n.pane??e.pane;return t?{...n,pane:t}:n}function i6(n,e){return function(r,l){const u=Tp(),f=n(wp(r,u),u);return Ij(u.map,r.attribution),Uv(f.current,r.eventHandlers),e(f.current,u,r,l),f}}var Zd={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var r6=Zd.exports,Bw;function s6(){return Bw||(Bw=1,function(n,e){(function(t,r){r(e)})(r6,function(t){var r="1.9.4";function l(o){var d,p,x,S;for(p=1,x=arguments.length;p<x;p++){S=arguments[p];for(d in S)o[d]=S[d]}return o}var u=Object.create||function(){function o(){}return function(d){return o.prototype=d,new o}}();function f(o,d){var p=Array.prototype.slice;if(o.bind)return o.bind.apply(o,p.call(arguments,1));var x=p.call(arguments,2);return function(){return o.apply(d,x.length?x.concat(p.call(arguments)):arguments)}}var y=0;function _(o){return"_leaflet_id"in o||(o._leaflet_id=++y),o._leaflet_id}function v(o,d,p){var x,S,O,ee;return ee=function(){x=!1,S&&(O.apply(p,S),S=!1)},O=function(){x?S=arguments:(o.apply(p,arguments),setTimeout(ee,d),x=!0)},O}function w(o,d,p){var x=d[1],S=d[0],O=x-S;return o===x&&p?o:((o-S)%O+O)%O+S}function R(){return!1}function I(o,d){if(d===!1)return o;var p=Math.pow(10,d===void 0?6:d);return Math.round(o*p)/p}function G(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function H(o){return G(o).split(/\s+/)}function Z(o,d){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?u(o.options):{});for(var p in d)o.options[p]=d[p];return o.options}function F(o,d,p){var x=[];for(var S in o)x.push(encodeURIComponent(p?S.toUpperCase():S)+"="+encodeURIComponent(o[S]));return(!d||d.indexOf("?")===-1?"?":"&")+x.join("&")}var Q=/\{ *([\w_ -]+) *\}/g;function se(o,d){return o.replace(Q,function(p,x){var S=d[x];if(S===void 0)throw new Error("No value provided for variable "+p);return typeof S=="function"&&(S=S(d)),S})}var ue=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function we(o,d){for(var p=0;p<o.length;p++)if(o[p]===d)return p;return-1}var Ce="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Ue(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var P=0;function M(o){var d=+new Date,p=Math.max(0,16-(d-P));return P=d+p,window.setTimeout(o,p)}var D=window.requestAnimationFrame||Ue("RequestAnimationFrame")||M,U=window.cancelAnimationFrame||Ue("CancelAnimationFrame")||Ue("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function k(o,d,p){if(p&&D===M)o.call(d);else return D.call(window,f(o,d))}function q(o){o&&U.call(window,o)}var j={__proto__:null,extend:l,create:u,bind:f,get lastId(){return y},stamp:_,throttle:v,wrapNum:w,falseFn:R,formatNum:I,trim:G,splitWords:H,setOptions:Z,getParamString:F,template:se,isArray:ue,indexOf:we,emptyImageUrl:Ce,requestFn:D,cancelFn:U,requestAnimFrame:k,cancelAnimFrame:q};function de(){}de.extend=function(o){var d=function(){Z(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},p=d.__super__=this.prototype,x=u(p);x.constructor=d,d.prototype=x;for(var S in this)Object.prototype.hasOwnProperty.call(this,S)&&S!=="prototype"&&S!=="__super__"&&(d[S]=this[S]);return o.statics&&l(d,o.statics),o.includes&&(ae(o.includes),l.apply(null,[x].concat(o.includes))),l(x,o),delete x.statics,delete x.includes,x.options&&(x.options=p.options?u(p.options):{},l(x.options,o.options)),x._initHooks=[],x.callInitHooks=function(){if(!this._initHooksCalled){p.callInitHooks&&p.callInitHooks.call(this),this._initHooksCalled=!0;for(var O=0,ee=x._initHooks.length;O<ee;O++)x._initHooks[O].call(this)}},d},de.include=function(o){var d=this.prototype.options;return l(this.prototype,o),o.options&&(this.prototype.options=d,this.mergeOptions(o.options)),this},de.mergeOptions=function(o){return l(this.prototype.options,o),this},de.addInitHook=function(o){var d=Array.prototype.slice.call(arguments,1),p=typeof o=="function"?o:function(){this[o].apply(this,d)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(p),this};function ae(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=ue(o)?o:[o];for(var d=0;d<o.length;d++)o[d]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Y={on:function(o,d,p){if(typeof o=="object")for(var x in o)this._on(x,o[x],d);else{o=H(o);for(var S=0,O=o.length;S<O;S++)this._on(o[S],d,p)}return this},off:function(o,d,p){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var x in o)this._off(x,o[x],d);else{o=H(o);for(var S=arguments.length===1,O=0,ee=o.length;O<ee;O++)S?this._off(o[O]):this._off(o[O],d,p)}return this},_on:function(o,d,p,x){if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}if(this._listens(o,d,p)===!1){p===this&&(p=void 0);var S={fn:d,ctx:p};x&&(S.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push(S)}},_off:function(o,d,p){var x,S,O;if(this._events&&(x=this._events[o],!!x)){if(arguments.length===1){if(this._firingCount)for(S=0,O=x.length;S<O;S++)x[S].fn=R;delete this._events[o];return}if(typeof d!="function"){console.warn("wrong listener type: "+typeof d);return}var ee=this._listens(o,d,p);if(ee!==!1){var ge=x[ee];this._firingCount&&(ge.fn=R,this._events[o]=x=x.slice()),x.splice(ee,1)}}},fire:function(o,d,p){if(!this.listens(o,p))return this;var x=l({},d,{type:o,target:this,sourceTarget:d&&d.sourceTarget||this});if(this._events){var S=this._events[o];if(S){this._firingCount=this._firingCount+1||1;for(var O=0,ee=S.length;O<ee;O++){var ge=S[O],Se=ge.fn;ge.once&&this.off(o,Se,ge.ctx),Se.call(ge.ctx||this,x)}this._firingCount--}}return p&&this._propagateEvent(x),this},listens:function(o,d,p,x){typeof o!="string"&&console.warn('"string" type argument expected');var S=d;typeof d!="function"&&(x=!!d,S=void 0,p=void 0);var O=this._events&&this._events[o];if(O&&O.length&&this._listens(o,S,p)!==!1)return!0;if(x){for(var ee in this._eventParents)if(this._eventParents[ee].listens(o,d,p,x))return!0}return!1},_listens:function(o,d,p){if(!this._events)return!1;var x=this._events[o]||[];if(!d)return!!x.length;p===this&&(p=void 0);for(var S=0,O=x.length;S<O;S++)if(x[S].fn===d&&x[S].ctx===p)return S;return!1},once:function(o,d,p){if(typeof o=="object")for(var x in o)this._on(x,o[x],d,!0);else{o=H(o);for(var S=0,O=o.length;S<O;S++)this._on(o[S],d,p,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[_(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[_(o)],this},_propagateEvent:function(o){for(var d in this._eventParents)this._eventParents[d].fire(o.type,l({layer:o.target,propagatedFrom:o.target},o),!0)}};Y.addEventListener=Y.on,Y.removeEventListener=Y.clearAllEventListeners=Y.off,Y.addOneTimeEventListener=Y.once,Y.fireEvent=Y.fire,Y.hasEventListeners=Y.listens;var ye=de.extend(Y);function ie(o,d,p){this.x=p?Math.round(o):o,this.y=p?Math.round(d):d}var be=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(o){return this.clone()._add(A(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(A(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new ie(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new ie(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=be(this.x),this.y=be(this.y),this},distanceTo:function(o){o=A(o);var d=o.x-this.x,p=o.y-this.y;return Math.sqrt(d*d+p*p)},equals:function(o){return o=A(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=A(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+I(this.x)+", "+I(this.y)+")"}};function A(o,d,p){return o instanceof ie?o:ue(o)?new ie(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new ie(o.x,o.y):new ie(o,d,p)}function W(o,d){if(o)for(var p=d?[o,d]:o,x=0,S=p.length;x<S;x++)this.extend(p[x])}W.prototype={extend:function(o){var d,p;if(!o)return this;if(o instanceof ie||typeof o[0]=="number"||"x"in o)d=p=A(o);else if(o=$(o),d=o.min,p=o.max,!d||!p)return this;return!this.min&&!this.max?(this.min=d.clone(),this.max=p.clone()):(this.min.x=Math.min(d.x,this.min.x),this.max.x=Math.max(p.x,this.max.x),this.min.y=Math.min(d.y,this.min.y),this.max.y=Math.max(p.y,this.max.y)),this},getCenter:function(o){return A((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return A(this.min.x,this.max.y)},getTopRight:function(){return A(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var d,p;return typeof o[0]=="number"||o instanceof ie?o=A(o):o=$(o),o instanceof W?(d=o.min,p=o.max):d=p=o,d.x>=this.min.x&&p.x<=this.max.x&&d.y>=this.min.y&&p.y<=this.max.y},intersects:function(o){o=$(o);var d=this.min,p=this.max,x=o.min,S=o.max,O=S.x>=d.x&&x.x<=p.x,ee=S.y>=d.y&&x.y<=p.y;return O&&ee},overlaps:function(o){o=$(o);var d=this.min,p=this.max,x=o.min,S=o.max,O=S.x>d.x&&x.x<p.x,ee=S.y>d.y&&x.y<p.y;return O&&ee},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var d=this.min,p=this.max,x=Math.abs(d.x-p.x)*o,S=Math.abs(d.y-p.y)*o;return $(A(d.x-x,d.y-S),A(p.x+x,p.y+S))},equals:function(o){return o?(o=$(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function $(o,d){return!o||o instanceof W?o:new W(o,d)}function te(o,d){if(o)for(var p=d?[o,d]:o,x=0,S=p.length;x<S;x++)this.extend(p[x])}te.prototype={extend:function(o){var d=this._southWest,p=this._northEast,x,S;if(o instanceof J)x=o,S=o;else if(o instanceof te){if(x=o._southWest,S=o._northEast,!x||!S)return this}else return o?this.extend(oe(o)||me(o)):this;return!d&&!p?(this._southWest=new J(x.lat,x.lng),this._northEast=new J(S.lat,S.lng)):(d.lat=Math.min(x.lat,d.lat),d.lng=Math.min(x.lng,d.lng),p.lat=Math.max(S.lat,p.lat),p.lng=Math.max(S.lng,p.lng)),this},pad:function(o){var d=this._southWest,p=this._northEast,x=Math.abs(d.lat-p.lat)*o,S=Math.abs(d.lng-p.lng)*o;return new te(new J(d.lat-x,d.lng-S),new J(p.lat+x,p.lng+S))},getCenter:function(){return new J((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new J(this.getNorth(),this.getWest())},getSouthEast:function(){return new J(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof J||"lat"in o?o=oe(o):o=me(o);var d=this._southWest,p=this._northEast,x,S;return o instanceof te?(x=o.getSouthWest(),S=o.getNorthEast()):x=S=o,x.lat>=d.lat&&S.lat<=p.lat&&x.lng>=d.lng&&S.lng<=p.lng},intersects:function(o){o=me(o);var d=this._southWest,p=this._northEast,x=o.getSouthWest(),S=o.getNorthEast(),O=S.lat>=d.lat&&x.lat<=p.lat,ee=S.lng>=d.lng&&x.lng<=p.lng;return O&&ee},overlaps:function(o){o=me(o);var d=this._southWest,p=this._northEast,x=o.getSouthWest(),S=o.getNorthEast(),O=S.lat>d.lat&&x.lat<p.lat,ee=S.lng>d.lng&&x.lng<p.lng;return O&&ee},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,d){return o?(o=me(o),this._southWest.equals(o.getSouthWest(),d)&&this._northEast.equals(o.getNorthEast(),d)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function me(o,d){return o instanceof te?o:new te(o,d)}function J(o,d,p){if(isNaN(o)||isNaN(d))throw new Error("Invalid LatLng object: ("+o+", "+d+")");this.lat=+o,this.lng=+d,p!==void 0&&(this.alt=+p)}J.prototype={equals:function(o,d){if(!o)return!1;o=oe(o);var p=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return p<=(d===void 0?1e-9:d)},toString:function(o){return"LatLng("+I(this.lat,o)+", "+I(this.lng,o)+")"},distanceTo:function(o){return he.distance(this,oe(o))},wrap:function(){return he.wrapLatLng(this)},toBounds:function(o){var d=180*o/40075017,p=d/Math.cos(Math.PI/180*this.lat);return me([this.lat-d,this.lng-p],[this.lat+d,this.lng+p])},clone:function(){return new J(this.lat,this.lng,this.alt)}};function oe(o,d,p){return o instanceof J?o:ue(o)&&typeof o[0]!="object"?o.length===3?new J(o[0],o[1],o[2]):o.length===2?new J(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new J(o.lat,"lng"in o?o.lng:o.lon,o.alt):d===void 0?null:new J(o,d,p)}var re={latLngToPoint:function(o,d){var p=this.projection.project(o),x=this.scale(d);return this.transformation._transform(p,x)},pointToLatLng:function(o,d){var p=this.scale(d),x=this.transformation.untransform(o,p);return this.projection.unproject(x)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var d=this.projection.bounds,p=this.scale(o),x=this.transformation.transform(d.min,p),S=this.transformation.transform(d.max,p);return new W(x,S)},infinite:!1,wrapLatLng:function(o){var d=this.wrapLng?w(o.lng,this.wrapLng,!0):o.lng,p=this.wrapLat?w(o.lat,this.wrapLat,!0):o.lat,x=o.alt;return new J(p,d,x)},wrapLatLngBounds:function(o){var d=o.getCenter(),p=this.wrapLatLng(d),x=d.lat-p.lat,S=d.lng-p.lng;if(x===0&&S===0)return o;var O=o.getSouthWest(),ee=o.getNorthEast(),ge=new J(O.lat-x,O.lng-S),Se=new J(ee.lat-x,ee.lng-S);return new te(ge,Se)}},he=l({},re,{wrapLng:[-180,180],R:6371e3,distance:function(o,d){var p=Math.PI/180,x=o.lat*p,S=d.lat*p,O=Math.sin((d.lat-o.lat)*p/2),ee=Math.sin((d.lng-o.lng)*p/2),ge=O*O+Math.cos(x)*Math.cos(S)*ee*ee,Se=2*Math.atan2(Math.sqrt(ge),Math.sqrt(1-ge));return this.R*Se}}),Ae=6378137,K={R:Ae,MAX_LATITUDE:85.0511287798,project:function(o){var d=Math.PI/180,p=this.MAX_LATITUDE,x=Math.max(Math.min(p,o.lat),-p),S=Math.sin(x*d);return new ie(this.R*o.lng*d,this.R*Math.log((1+S)/(1-S))/2)},unproject:function(o){var d=180/Math.PI;return new J((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*d,o.x*d/this.R)},bounds:function(){var o=Ae*Math.PI;return new W([-o,-o],[o,o])}()};function le(o,d,p,x){if(ue(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=d,this._c=p,this._d=x}le.prototype={transform:function(o,d){return this._transform(o.clone(),d)},_transform:function(o,d){return d=d||1,o.x=d*(this._a*o.x+this._b),o.y=d*(this._c*o.y+this._d),o},untransform:function(o,d){return d=d||1,new ie((o.x/d-this._b)/this._a,(o.y/d-this._d)/this._c)}};function Re(o,d,p,x){return new le(o,d,p,x)}var Ge=l({},he,{code:"EPSG:3857",projection:K,transformation:function(){var o=.5/(Math.PI*K.R);return Re(o,.5,-o,.5)}()}),Je=l({},Ge,{code:"EPSG:900913"});function Ze(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Ct(o,d){var p="",x,S,O,ee,ge,Se;for(x=0,O=o.length;x<O;x++){for(ge=o[x],S=0,ee=ge.length;S<ee;S++)Se=ge[S],p+=(S?"L":"M")+Se.x+" "+Se.y;p+=d?nt.svg?"z":"x":""}return p||"M0 0"}var Ot=document.documentElement.style,Ke="ActiveXObject"in window,ft=Ke&&!document.addEventListener,Wt="msLaunchUri"in navigator&&!("documentMode"in document),Hn=Gn("webkit"),pn=Gn("android"),qn=Gn("android 2")||Gn("android 3"),gr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),kt=pn&&Gn("Google")&&gr<537&&!("AudioNode"in window),yt=!!window.opera,ct=!Wt&&Gn("chrome"),$t=Gn("gecko")&&!Hn&&!yt&&!Ke,Ln=!ct&&Gn("safari"),ts=Gn("phantom"),ia="OTransition"in Ot,Rr=navigator.platform.indexOf("Win")===0,zr=Ke&&"transition"in Ot,Ki="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!qn,X="MozPerspective"in Ot,Fe=!window.L_DISABLE_3D&&(zr||Ki||X)&&!ia&&!ts,st=typeof orientation<"u"||Gn("mobile"),zt=st&&Hn,$n=st&&Ki,Xn=!window.PointerEvent&&window.MSPointerEvent,Nn=!!(window.PointerEvent||Xn),Yt="ontouchstart"in window||!!window.TouchEvent,En=!window.L_NO_TOUCH&&(Yt||Nn),dn=st&&yt,bn=st&&$t,St=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,hn=function(){var o=!1;try{var d=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",R,d),window.removeEventListener("testPassiveEventSupport",R,d)}catch{}return o}(),gn=function(){return!!document.createElement("canvas").getContext}(),Pi=!!(document.createElementNS&&Ze("svg").createSVGRect),Ht=!!Pi&&function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Mt=!Pi&&function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var d=o.firstChild;return d.style.behavior="url(#default#VML)",d&&typeof d.adj=="object"}catch{return!1}}(),ke=navigator.platform.indexOf("Mac")===0,at=navigator.platform.indexOf("Linux")===0;function Gn(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var nt={ie:Ke,ielt9:ft,edge:Wt,webkit:Hn,android:pn,android23:qn,androidStock:kt,opera:yt,chrome:ct,gecko:$t,safari:Ln,phantom:ts,opera12:ia,win:Rr,ie3d:zr,webkit3d:Ki,gecko3d:X,any3d:Fe,mobile:st,mobileWebkit:zt,mobileWebkit3d:$n,msPointer:Xn,pointer:Nn,touch:En,touchNative:Yt,mobileOpera:dn,mobileGecko:bn,retina:St,passiveEvents:hn,canvas:gn,svg:Pi,vml:Mt,inlineSvg:Ht,mac:ke,linux:at},ni=nt.msPointer?"MSPointerDown":"pointerdown",Ir=nt.msPointer?"MSPointerMove":"pointermove",Ti=nt.msPointer?"MSPointerUp":"pointerup",sr=nt.msPointer?"MSPointerCancel":"pointercancel",wi={touchstart:ni,touchmove:Ir,touchend:Ti,touchcancel:sr},Cn={touchstart:Un,touchmove:Jn,touchend:Jn,touchcancel:Jn},_t={},Rn=!1;function fn(o,d,p){return d==="touchstart"&&bs(),Cn[d]?(p=Cn[d].bind(this,p),o.addEventListener(wi[d],p,!1),p):(console.warn("wrong event specified:",d),R)}function Ls(o,d,p){if(!wi[d]){console.warn("wrong event specified:",d);return}o.removeEventListener(wi[d],p,!1)}function yr(o){_t[o.pointerId]=o}function Vn(o){_t[o.pointerId]&&(_t[o.pointerId]=o)}function Bi(o){delete _t[o.pointerId]}function bs(){Rn||(document.addEventListener(ni,yr,!0),document.addEventListener(Ir,Vn,!0),document.addEventListener(Ti,Bi,!0),document.addEventListener(sr,Bi,!0),Rn=!0)}function Jn(o,d){if(d.pointerType!==(d.MSPOINTER_TYPE_MOUSE||"mouse")){d.touches=[];for(var p in _t)d.touches.push(_t[p]);d.changedTouches=[d],o(d)}}function Un(o,d){d.MSPOINTER_TYPE_TOUCH&&d.pointerType===d.MSPOINTER_TYPE_TOUCH&&wn(d),Jn(o,d)}function ii(o){var d={},p,x;for(x in o)p=o[x],d[x]=p&&p.bind?p.bind(o):p;return o=d,d.type="dblclick",d.detail=2,d.isTrusted=!1,d._simulated=!0,d}var li=200;function ei(o,d){o.addEventListener("dblclick",d);var p=0,x;function S(O){if(O.detail!==1){x=O.detail;return}if(!(O.pointerType==="mouse"||O.sourceCapabilities&&!O.sourceCapabilities.firesTouchEvents)){var ee=co(O);if(!(ee.some(function(Se){return Se instanceof HTMLLabelElement&&Se.attributes.for})&&!ee.some(function(Se){return Se instanceof HTMLInputElement||Se instanceof HTMLSelectElement}))){var ge=Date.now();ge-p<=li?(x++,x===2&&d(ii(O))):x=1,p=ge}}}return o.addEventListener("click",S),{dblclick:d,simDblclick:S}}function xn(o,d){o.removeEventListener("dblclick",d.dblclick),o.removeEventListener("click",d.simDblclick)}var gi=xe(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ns=xe(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Br=ns==="webkitTransition"||ns==="OTransition"?ns+"End":"transitionend";function Vs(o){return typeof o=="string"?document.getElementById(o):o}function Hr(o,d){var p=o.style[d]||o.currentStyle&&o.currentStyle[d];if((!p||p==="auto")&&document.defaultView){var x=document.defaultView.getComputedStyle(o,null);p=x?x[d]:null}return p==="auto"?null:p}function Dt(o,d,p){var x=document.createElement(o);return x.className=d||"",p&&p.appendChild(x),x}function bt(o){var d=o.parentNode;d&&d.removeChild(o)}function yi(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function Pt(o){var d=o.parentNode;d&&d.lastChild!==o&&d.appendChild(o)}function xs(o){var d=o.parentNode;d&&d.firstChild!==o&&d.insertBefore(o,d.firstChild)}function is(o,d){if(o.classList!==void 0)return o.classList.contains(d);var p=Fn(o);return p.length>0&&new RegExp("(^|\\s)"+d+"(\\s|$)").test(p)}function jt(o,d){if(o.classList!==void 0)for(var p=H(d),x=0,S=p.length;x<S;x++)o.classList.add(p[x]);else if(!is(o,d)){var O=Fn(o);Aa(o,(O?O+" ":"")+d)}}function Tn(o,d){o.classList!==void 0?o.classList.remove(d):Aa(o,G((" "+Fn(o)+" ").replace(" "+d+" "," ")))}function Aa(o,d){o.className.baseVal===void 0?o.className=d:o.className.baseVal=d}function Fn(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function mn(o,d){"opacity"in o.style?o.style.opacity=d:"filter"in o.style&&z(o,d)}function z(o,d){var p=!1,x="DXImageTransform.Microsoft.Alpha";try{p=o.filters.item(x)}catch{if(d===1)return}d=Math.round(d*100),p?(p.Enabled=d!==100,p.Opacity=d):o.style.filter+=" progid:"+x+"(opacity="+d+")"}function xe(o){for(var d=document.documentElement.style,p=0;p<o.length;p++)if(o[p]in d)return o[p];return!1}function He(o,d,p){var x=d||new ie(0,0);o.style[gi]=(nt.ie3d?"translate("+x.x+"px,"+x.y+"px)":"translate3d("+x.x+"px,"+x.y+"px,0)")+(p?" scale("+p+")":"")}function Ne(o,d){o._leaflet_pos=d,nt.any3d?He(o,d):(o.style.left=d.x+"px",o.style.top=d.y+"px")}function ot(o){return o._leaflet_pos||new ie(0,0)}var et,Be,Ye;if("onselectstart"in document)et=function(){dt(window,"selectstart",wn)},Be=function(){tn(window,"selectstart",wn)};else{var We=xe(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);et=function(){if(We){var o=document.documentElement.style;Ye=o[We],o[We]="none"}},Be=function(){We&&(document.documentElement.style[We]=Ye,Ye=void 0)}}function mt(){dt(window,"dragstart",wn)}function Qt(){tn(window,"dragstart",wn)}var Zn,ci;function Mi(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(Ei(),Zn=o,ci=o.style.outlineStyle,o.style.outlineStyle="none",dt(window,"keydown",Ei))}function Ei(){Zn&&(Zn.style.outlineStyle=ci,Zn=void 0,ci=void 0,tn(window,"keydown",Ei))}function _r(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function ar(o){var d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}var ra={__proto__:null,TRANSFORM:gi,TRANSITION:ns,TRANSITION_END:Br,get:Vs,getStyle:Hr,create:Dt,remove:bt,empty:yi,toFront:Pt,toBack:xs,hasClass:is,addClass:jt,removeClass:Tn,setClass:Aa,getClass:Fn,setOpacity:mn,testProp:xe,setTransform:He,setPosition:Ne,getPosition:ot,get disableTextSelection(){return et},get enableTextSelection(){return Be},disableImageDrag:mt,enableImageDrag:Qt,preventOutline:Mi,restoreOutline:Ei,getSizedParentNode:_r,getScale:ar};function dt(o,d,p,x){if(d&&typeof d=="object")for(var S in d)Si(o,S,d[S],p);else{d=H(d);for(var O=0,ee=d.length;O<ee;O++)Si(o,d[O],p,x)}return this}var or="_leaflet_events";function tn(o,d,p,x){if(arguments.length===1)vr(o),delete o[or];else if(d&&typeof d=="object")for(var S in d)yn(o,S,d[S],p);else if(d=H(d),arguments.length===2)vr(o,function(ge){return we(d,ge)!==-1});else for(var O=0,ee=d.length;O<ee;O++)yn(o,d[O],p,x);return this}function vr(o,d){for(var p in o[or]){var x=p.split(/\d/)[0];(!d||d(x))&&yn(o,x,null,null,p)}}var Wi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Si(o,d,p,x){var S=d+_(p)+(x?"_"+_(x):"");if(o[or]&&o[or][S])return this;var O=function(ge){return p.call(x||o,ge||window.event)},ee=O;!nt.touchNative&&nt.pointer&&d.indexOf("touch")===0?O=fn(o,d,O):nt.touch&&d==="dblclick"?O=ei(o,O):"addEventListener"in o?d==="touchstart"||d==="touchmove"||d==="wheel"||d==="mousewheel"?o.addEventListener(Wi[d]||d,O,nt.passiveEvents?{passive:!1}:!1):d==="mouseenter"||d==="mouseleave"?(O=function(ge){ge=ge||window.event,Us(o,ge)&&ee(ge)},o.addEventListener(Wi[d],O,!1)):o.addEventListener(d,ee,!1):o.attachEvent("on"+d,O),o[or]=o[or]||{},o[or][S]=O}function yn(o,d,p,x,S){S=S||d+_(p)+(x?"_"+_(x):"");var O=o[or]&&o[or][S];if(!O)return this;!nt.touchNative&&nt.pointer&&d.indexOf("touch")===0?Ls(o,d,O):nt.touch&&d==="dblclick"?xn(o,O):"removeEventListener"in o?o.removeEventListener(Wi[d]||d,O,!1):o.detachEvent("on"+d,O),o[or][S]=null}function ri(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function Yi(o){return Si(o,"wheel",ri),this}function Pr(o){return dt(o,"mousedown touchstart dblclick contextmenu",ri),o._leaflet_disable_click=!0,this}function wn(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function ji(o){return wn(o),ri(o),this}function co(o){if(o.composedPath)return o.composedPath();for(var d=[],p=o.target;p;)d.push(p),p=p.parentNode;return d}function Ai(o,d){if(!d)return new ie(o.clientX,o.clientY);var p=ar(d),x=p.boundingClientRect;return new ie((o.clientX-x.left)/p.x-d.clientLeft,(o.clientY-x.top)/p.y-d.clientTop)}var _n=nt.linux&&nt.chrome?window.devicePixelRatio:nt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Na(o){return nt.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/_n:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function Us(o,d){var p=d.relatedTarget;if(!p)return!0;try{for(;p&&p!==o;)p=p.parentNode}catch{return!1}return p!==o}var mc={__proto__:null,on:dt,off:tn,stopPropagation:ri,disableScrollPropagation:Yi,disableClickPropagation:Pr,preventDefault:wn,stop:ji,getPropagationPath:co,getMousePosition:Ai,getWheelDelta:Na,isExternalTarget:Us,addListener:dt,removeListener:tn},Ca=ye.extend({run:function(o,d,p,x){this.stop(),this._el=o,this._inProgress=!0,this._duration=p||.25,this._easeOutPower=1/Math.max(x||.5,.2),this._startPos=ot(o),this._offset=d.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=k(this._animate,this),this._step()},_step:function(o){var d=+new Date-this._startTime,p=this._duration*1e3;d<p?this._runFrame(this._easeOut(d/p),o):(this._runFrame(1),this._complete())},_runFrame:function(o,d){var p=this._startPos.add(this._offset.multiplyBy(o));d&&p._round(),Ne(this._el,p),this.fire("step")},_complete:function(){q(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),Lt=ye.extend({options:{crs:Ge,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,d){d=Z(this,d),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=f(this._onResize,this),this._initEvents(),d.maxBounds&&this.setMaxBounds(d.maxBounds),d.zoom!==void 0&&(this._zoom=this._limitZoom(d.zoom)),d.center&&d.zoom!==void 0&&this.setView(oe(d.center),d.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ns&&nt.any3d&&!nt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),dt(this._proxy,Br,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,d,p){if(d=d===void 0?this._zoom:this._limitZoom(d),o=this._limitCenter(oe(o),d,this.options.maxBounds),p=p||{},this._stop(),this._loaded&&!p.reset&&p!==!0){p.animate!==void 0&&(p.zoom=l({animate:p.animate},p.zoom),p.pan=l({animate:p.animate,duration:p.duration},p.pan));var x=this._zoom!==d?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,d,p.zoom):this._tryAnimatedPan(o,p.pan);if(x)return clearTimeout(this._sizeTimer),this}return this._resetView(o,d,p.pan&&p.pan.noMoveStart),this},setZoom:function(o,d){return this._loaded?this.setView(this.getCenter(),o,{zoom:d}):(this._zoom=o,this)},zoomIn:function(o,d){return o=o||(nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,d)},zoomOut:function(o,d){return o=o||(nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,d)},setZoomAround:function(o,d,p){var x=this.getZoomScale(d),S=this.getSize().divideBy(2),O=o instanceof ie?o:this.latLngToContainerPoint(o),ee=O.subtract(S).multiplyBy(1-1/x),ge=this.containerPointToLatLng(S.add(ee));return this.setView(ge,d,{zoom:p})},_getBoundsCenterZoom:function(o,d){d=d||{},o=o.getBounds?o.getBounds():me(o);var p=A(d.paddingTopLeft||d.padding||[0,0]),x=A(d.paddingBottomRight||d.padding||[0,0]),S=this.getBoundsZoom(o,!1,p.add(x));if(S=typeof d.maxZoom=="number"?Math.min(d.maxZoom,S):S,S===1/0)return{center:o.getCenter(),zoom:S};var O=x.subtract(p).divideBy(2),ee=this.project(o.getSouthWest(),S),ge=this.project(o.getNorthEast(),S),Se=this.unproject(ee.add(ge).divideBy(2).add(O),S);return{center:Se,zoom:S}},fitBounds:function(o,d){if(o=me(o),!o.isValid())throw new Error("Bounds are not valid.");var p=this._getBoundsCenterZoom(o,d);return this.setView(p.center,p.zoom,d)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,d){return this.setView(o,this._zoom,{pan:d})},panBy:function(o,d){if(o=A(o).round(),d=d||{},!o.x&&!o.y)return this.fire("moveend");if(d.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ca,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),d.noMoveStart||this.fire("movestart"),d.animate!==!1){jt(this._mapPane,"leaflet-pan-anim");var p=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,p,d.duration||.25,d.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,d,p){if(p=p||{},p.animate===!1||!nt.any3d)return this.setView(o,d,p);this._stop();var x=this.project(this.getCenter()),S=this.project(o),O=this.getSize(),ee=this._zoom;o=oe(o),d=d===void 0?ee:d;var ge=Math.max(O.x,O.y),Se=ge*this.getZoomScale(ee,d),Ve=S.distanceTo(x)||1,Qe=1.42,it=Qe*Qe;function lt(si){var Ns=si?-1:1,$s=si?Se:ge,ua=Se*Se-ge*ge+Ns*it*it*Ve*Ve,Gs=2*$s*it*Ve,Dl=ua/Gs,Ac=Math.sqrt(Dl*Dl+1)-Dl,Ll=Ac<1e-9?-18:Math.log(Ac);return Ll}function Rt(si){return(Math.exp(si)-Math.exp(-si))/2}function Wn(si){return(Math.exp(si)+Math.exp(-si))/2}function ui(si){return Rt(si)/Wn(si)}var Xi=lt(0);function qr(si){return ge*(Wn(Xi)/Wn(Xi+Qe*si))}function Fh(si){return ge*(Wn(Xi)*ui(Xi+Qe*si)-Rt(Xi))/it}function zh(si){return 1-Math.pow(1-si,1.5)}var Ol=Date.now(),Ao=(lt(1)-Xi)/Qe,Bh=p.duration?1e3*p.duration:1e3*Ao*.8;function No(){var si=(Date.now()-Ol)/Bh,Ns=zh(si)*Ao;si<=1?(this._flyToFrame=k(No,this),this._move(this.unproject(x.add(S.subtract(x).multiplyBy(Fh(Ns)/Ve)),ee),this.getScaleZoom(ge/qr(Ns),ee),{flyTo:!0})):this._move(o,d)._moveEnd(!0)}return this._moveStart(!0,p.noMoveStart),No.call(this),this},flyToBounds:function(o,d){var p=this._getBoundsCenterZoom(o,d);return this.flyTo(p.center,p.zoom,d)},setMaxBounds:function(o){return o=me(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var d=this.options.minZoom;return this.options.minZoom=o,this._loaded&&d!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var d=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&d!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,d){this._enforcingBounds=!0;var p=this.getCenter(),x=this._limitCenter(p,this._zoom,me(o));return p.equals(x)||this.panTo(x,d),this._enforcingBounds=!1,this},panInside:function(o,d){d=d||{};var p=A(d.paddingTopLeft||d.padding||[0,0]),x=A(d.paddingBottomRight||d.padding||[0,0]),S=this.project(this.getCenter()),O=this.project(o),ee=this.getPixelBounds(),ge=$([ee.min.add(p),ee.max.subtract(x)]),Se=ge.getSize();if(!ge.contains(O)){this._enforcingBounds=!0;var Ve=O.subtract(ge.getCenter()),Qe=ge.extend(O).getSize().subtract(Se);S.x+=Ve.x<0?-Qe.x:Qe.x,S.y+=Ve.y<0?-Qe.y:Qe.y,this.panTo(this.unproject(S),d),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=l({animate:!1,pan:!0},o===!0?{animate:!0}:o);var d=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var p=this.getSize(),x=d.divideBy(2).round(),S=p.divideBy(2).round(),O=x.subtract(S);return!O.x&&!O.y?this:(o.animate&&o.pan?this.panBy(O):(o.pan&&this._rawPanBy(O),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(f(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:d,newSize:p}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=l({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var d=f(this._handleGeolocationResponse,this),p=f(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(d,p,o):navigator.geolocation.getCurrentPosition(d,p,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var d=o.code,p=o.message||(d===1?"permission denied":d===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:d,message:"Geolocation error: "+p+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var d=o.coords.latitude,p=o.coords.longitude,x=new J(d,p),S=x.toBounds(o.coords.accuracy*2),O=this._locateOptions;if(O.setView){var ee=this.getBoundsZoom(S);this.setView(x,O.maxZoom?Math.min(ee,O.maxZoom):ee)}var ge={latlng:x,bounds:S,timestamp:o.timestamp};for(var Se in o.coords)typeof o.coords[Se]=="number"&&(ge[Se]=o.coords[Se]);this.fire("locationfound",ge)}},addHandler:function(o,d){if(!d)return this;var p=this[o]=new d(this);return this._handlers.push(p),this.options[o]&&p.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),bt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(q(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)bt(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,d){var p="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),x=Dt("div",p,d||this._mapPane);return o&&(this._panes[o]=x),x},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),d=this.unproject(o.getBottomLeft()),p=this.unproject(o.getTopRight());return new te(d,p)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,d,p){o=me(o),p=A(p||[0,0]);var x=this.getZoom()||0,S=this.getMinZoom(),O=this.getMaxZoom(),ee=o.getNorthWest(),ge=o.getSouthEast(),Se=this.getSize().subtract(p),Ve=$(this.project(ge,x),this.project(ee,x)).getSize(),Qe=nt.any3d?this.options.zoomSnap:1,it=Se.x/Ve.x,lt=Se.y/Ve.y,Rt=d?Math.max(it,lt):Math.min(it,lt);return x=this.getScaleZoom(Rt,x),Qe&&(x=Math.round(x/(Qe/100))*(Qe/100),x=d?Math.ceil(x/Qe)*Qe:Math.floor(x/Qe)*Qe),Math.max(S,Math.min(O,x))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ie(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,d){var p=this._getTopLeftPoint(o,d);return new W(p,p.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,d){var p=this.options.crs;return d=d===void 0?this._zoom:d,p.scale(o)/p.scale(d)},getScaleZoom:function(o,d){var p=this.options.crs;d=d===void 0?this._zoom:d;var x=p.zoom(o*p.scale(d));return isNaN(x)?1/0:x},project:function(o,d){return d=d===void 0?this._zoom:d,this.options.crs.latLngToPoint(oe(o),d)},unproject:function(o,d){return d=d===void 0?this._zoom:d,this.options.crs.pointToLatLng(A(o),d)},layerPointToLatLng:function(o){var d=A(o).add(this.getPixelOrigin());return this.unproject(d)},latLngToLayerPoint:function(o){var d=this.project(oe(o))._round();return d._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(oe(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(me(o))},distance:function(o,d){return this.options.crs.distance(oe(o),oe(d))},containerPointToLayerPoint:function(o){return A(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return A(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var d=this.containerPointToLayerPoint(A(o));return this.layerPointToLatLng(d)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(oe(o)))},mouseEventToContainerPoint:function(o){return Ai(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var d=this._container=Vs(o);if(d){if(d._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");dt(d,"scroll",this._onScroll,this),this._containerId=_(d)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&nt.any3d,jt(o,"leaflet-container"+(nt.touch?" leaflet-touch":"")+(nt.retina?" leaflet-retina":"")+(nt.ielt9?" leaflet-oldie":"")+(nt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var d=Hr(o,"position");d!=="absolute"&&d!=="relative"&&d!=="fixed"&&d!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ne(this._mapPane,new ie(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(jt(o.markerPane,"leaflet-zoom-hide"),jt(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,d,p){Ne(this._mapPane,new ie(0,0));var x=!this._loaded;this._loaded=!0,d=this._limitZoom(d),this.fire("viewprereset");var S=this._zoom!==d;this._moveStart(S,p)._move(o,d)._moveEnd(S),this.fire("viewreset"),x&&this.fire("load")},_moveStart:function(o,d){return o&&this.fire("zoomstart"),d||this.fire("movestart"),this},_move:function(o,d,p,x){d===void 0&&(d=this._zoom);var S=this._zoom!==d;return this._zoom=d,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),x?p&&p.pinch&&this.fire("zoom",p):((S||p&&p.pinch)&&this.fire("zoom",p),this.fire("move",p)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return q(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){Ne(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[_(this._container)]=this;var d=o?tn:dt;d(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&d(window,"resize",this._onResize,this),nt.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){q(this._resizeRequest),this._resizeRequest=k(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,d){for(var p=[],x,S=d==="mouseout"||d==="mouseover",O=o.target||o.srcElement,ee=!1;O;){if(x=this._targets[_(O)],x&&(d==="click"||d==="preclick")&&this._draggableMoved(x)){ee=!0;break}if(x&&x.listens(d,!0)&&(S&&!Us(O,o)||(p.push(x),S))||O===this._container)break;O=O.parentNode}return!p.length&&!ee&&!S&&this.listens(d,!0)&&(p=[this]),p},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var d=o.target||o.srcElement;if(!(!this._loaded||d._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(d))){var p=o.type;p==="mousedown"&&Mi(d),this._fireDOMEvent(o,p)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,d,p){if(o.type==="click"){var x=l({},o);x.type="preclick",this._fireDOMEvent(x,x.type,p)}var S=this._findEventTargets(o,d);if(p){for(var O=[],ee=0;ee<p.length;ee++)p[ee].listens(d,!0)&&O.push(p[ee]);S=O.concat(S)}if(S.length){d==="contextmenu"&&wn(o);var ge=S[0],Se={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var Ve=ge.getLatLng&&(!ge._radius||ge._radius<=10);Se.containerPoint=Ve?this.latLngToContainerPoint(ge.getLatLng()):this.mouseEventToContainerPoint(o),Se.layerPoint=this.containerPointToLayerPoint(Se.containerPoint),Se.latlng=Ve?ge.getLatLng():this.layerPointToLatLng(Se.layerPoint)}for(ee=0;ee<S.length;ee++)if(S[ee].fire(d,Se,!0),Se.originalEvent._stopped||S[ee].options.bubblingMouseEvents===!1&&we(this._mouseEvents,d)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,d=this._handlers.length;o<d;o++)this._handlers[o].disable()},whenReady:function(o,d){return this._loaded?o.call(d||this,{target:this}):this.on("load",o,d),this},_getMapPanePos:function(){return ot(this._mapPane)||new ie(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,d){var p=o&&d!==void 0?this._getNewPixelOrigin(o,d):this.getPixelOrigin();return p.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,d){var p=this.getSize()._divideBy(2);return this.project(o,d)._subtract(p)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,d,p){var x=this._getNewPixelOrigin(p,d);return this.project(o,d)._subtract(x)},_latLngBoundsToNewLayerBounds:function(o,d,p){var x=this._getNewPixelOrigin(p,d);return $([this.project(o.getSouthWest(),d)._subtract(x),this.project(o.getNorthWest(),d)._subtract(x),this.project(o.getSouthEast(),d)._subtract(x),this.project(o.getNorthEast(),d)._subtract(x)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,d,p){if(!p)return o;var x=this.project(o,d),S=this.getSize().divideBy(2),O=new W(x.subtract(S),x.add(S)),ee=this._getBoundsOffset(O,p,d);return Math.abs(ee.x)<=1&&Math.abs(ee.y)<=1?o:this.unproject(x.add(ee),d)},_limitOffset:function(o,d){if(!d)return o;var p=this.getPixelBounds(),x=new W(p.min.add(o),p.max.add(o));return o.add(this._getBoundsOffset(x,d))},_getBoundsOffset:function(o,d,p){var x=$(this.project(d.getNorthEast(),p),this.project(d.getSouthWest(),p)),S=x.min.subtract(o.min),O=x.max.subtract(o.max),ee=this._rebound(S.x,-O.x),ge=this._rebound(S.y,-O.y);return new ie(ee,ge)},_rebound:function(o,d){return o+d>0?Math.round(o-d)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(d))},_limitZoom:function(o){var d=this.getMinZoom(),p=this.getMaxZoom(),x=nt.any3d?this.options.zoomSnap:1;return x&&(o=Math.round(o/x)*x),Math.max(d,Math.min(p,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Tn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,d){var p=this._getCenterOffset(o)._trunc();return(d&&d.animate)!==!0&&!this.getSize().contains(p)?!1:(this.panBy(p,d),!0)},_createAnimProxy:function(){var o=this._proxy=Dt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(d){var p=gi,x=this._proxy.style[p];He(this._proxy,this.project(d.center,d.zoom),this.getZoomScale(d.zoom,1)),x===this._proxy.style[p]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){bt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),d=this.getZoom();He(this._proxy,this.project(o,d),this.getZoomScale(d,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,d,p){if(this._animatingZoom)return!0;if(p=p||{},!this._zoomAnimated||p.animate===!1||this._nothingToAnimate()||Math.abs(d-this._zoom)>this.options.zoomAnimationThreshold)return!1;var x=this.getZoomScale(d),S=this._getCenterOffset(o)._divideBy(1-1/x);return p.animate!==!0&&!this.getSize().contains(S)?!1:(k(function(){this._moveStart(!0,p.noMoveStart||!1)._animateZoom(o,d,!0)},this),!0)},_animateZoom:function(o,d,p,x){this._mapPane&&(p&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=d,jt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:d,noUpdate:x}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(f(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Tn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ts(o,d){return new Lt(o,d)}var Hi=de.extend({options:{position:"topright"},initialize:function(o){Z(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var d=this._map;return d&&d.removeControl(this),this.options.position=o,d&&d.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var d=this._container=this.onAdd(o),p=this.getPosition(),x=o._controlCorners[p];return jt(d,"leaflet-control"),p.indexOf("bottom")!==-1?x.insertBefore(d,x.firstChild):x.appendChild(d),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(bt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),Qi=function(o){return new Hi(o)};Lt.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},d="leaflet-",p=this._controlContainer=Dt("div",d+"control-container",this._container);function x(S,O){var ee=d+S+" "+d+O;o[S+O]=Dt("div",ee,p)}x("top","left"),x("top","right"),x("bottom","left"),x("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)bt(this._controlCorners[o]);bt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Tl=Hi.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,d,p,x){return p<x?-1:x<p?1:0}},initialize:function(o,d,p){Z(this,p),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var x in o)this._addLayer(o[x],x);for(x in d)this._addLayer(d[x],x,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return Hi.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,d){return this._addLayer(o,d),this._map?this._update():this},addOverlay:function(o,d){return this._addLayer(o,d,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var d=this._getLayer(_(o));return d&&this._layers.splice(this._layers.indexOf(d),1),this._map?this._update():this},expand:function(){jt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(jt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):Tn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Tn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",d=this._container=Dt("div",o),p=this.options.collapsed;d.setAttribute("aria-haspopup",!0),Pr(d),Yi(d);var x=this._section=Dt("section",o+"-list");p&&(this._map.on("click",this.collapse,this),dt(d,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var S=this._layersLink=Dt("a",o+"-toggle",d);S.href="#",S.title="Layers",S.setAttribute("role","button"),dt(S,{keydown:function(O){O.keyCode===13&&this._expandSafely()},click:function(O){wn(O),this._expandSafely()}},this),p||this.expand(),this._baseLayersList=Dt("div",o+"-base",x),this._separator=Dt("div",o+"-separator",x),this._overlaysList=Dt("div",o+"-overlays",x),d.appendChild(x)},_getLayer:function(o){for(var d=0;d<this._layers.length;d++)if(this._layers[d]&&_(this._layers[d].layer)===o)return this._layers[d]},_addLayer:function(o,d,p){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:d,overlay:p}),this.options.sortLayers&&this._layers.sort(f(function(x,S){return this.options.sortFunction(x.layer,S.layer,x.name,S.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;yi(this._baseLayersList),yi(this._overlaysList),this._layerControlInputs=[];var o,d,p,x,S=0;for(p=0;p<this._layers.length;p++)x=this._layers[p],this._addItem(x),d=d||x.overlay,o=o||!x.overlay,S+=x.overlay?0:1;return this.options.hideSingleBase&&(o=o&&S>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=d&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var d=this._getLayer(_(o.target)),p=d.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;p&&this._map.fire(p,d)},_createRadioElement:function(o,d){var p='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(d?' checked="checked"':"")+"/>",x=document.createElement("div");return x.innerHTML=p,x.firstChild},_addItem:function(o){var d=document.createElement("label"),p=this._map.hasLayer(o.layer),x;o.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="leaflet-control-layers-selector",x.defaultChecked=p):x=this._createRadioElement("leaflet-base-layers_"+_(this),p),this._layerControlInputs.push(x),x.layerId=_(o.layer),dt(x,"click",this._onInputClick,this);var S=document.createElement("span");S.innerHTML=" "+o.name;var O=document.createElement("span");d.appendChild(O),O.appendChild(x),O.appendChild(S);var ee=o.overlay?this._overlaysList:this._baseLayersList;return ee.appendChild(d),this._checkDisabledLayers(),d},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,d,p,x=[],S=[];this._handlingClick=!0;for(var O=o.length-1;O>=0;O--)d=o[O],p=this._getLayer(d.layerId).layer,d.checked?x.push(p):d.checked||S.push(p);for(O=0;O<S.length;O++)this._map.hasLayer(S[O])&&this._map.removeLayer(S[O]);for(O=0;O<x.length;O++)this._map.hasLayer(x[O])||this._map.addLayer(x[O]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,d,p,x=this._map.getZoom(),S=o.length-1;S>=0;S--)d=o[S],p=this._getLayer(d.layerId).layer,d.disabled=p.options.minZoom!==void 0&&x<p.options.minZoom||p.options.maxZoom!==void 0&&x>p.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,dt(o,"click",wn),this.expand();var d=this;setTimeout(function(){tn(o,"click",wn),d._preventClick=!1})}}),Du=function(o,d,p){return new Tl(o,d,p)},Fs=Hi.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var d="leaflet-control-zoom",p=Dt("div",d+" leaflet-bar"),x=this.options;return this._zoomInButton=this._createButton(x.zoomInText,x.zoomInTitle,d+"-in",p,this._zoomIn),this._zoomOutButton=this._createButton(x.zoomOutText,x.zoomOutTitle,d+"-out",p,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),p},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,d,p,x,S){var O=Dt("a",p,x);return O.innerHTML=o,O.href="#",O.title=d,O.setAttribute("role","button"),O.setAttribute("aria-label",d),Pr(O),dt(O,"click",ji),dt(O,"click",S,this),dt(O,"click",this._refocusOnMap,this),O},_updateDisabled:function(){var o=this._map,d="leaflet-disabled";Tn(this._zoomInButton,d),Tn(this._zoomOutButton,d),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(jt(this._zoomOutButton,d),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(jt(this._zoomInButton,d),this._zoomInButton.setAttribute("aria-disabled","true"))}});Lt.mergeOptions({zoomControl:!0}),Lt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Fs,this.addControl(this.zoomControl))});var uo=function(o){return new Fs(o)},ho=Hi.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var d="leaflet-control-scale",p=Dt("div",d),x=this.options;return this._addScales(x,d+"-line",p),o.on(x.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),p},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,d,p){o.metric&&(this._mScale=Dt("div",d,p)),o.imperial&&(this._iScale=Dt("div",d,p))},_update:function(){var o=this._map,d=o.getSize().y/2,p=o.distance(o.containerPointToLatLng([0,d]),o.containerPointToLatLng([this.options.maxWidth,d]));this._updateScales(p)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var d=this._getRoundNum(o),p=d<1e3?d+" m":d/1e3+" km";this._updateScale(this._mScale,p,d/o)},_updateImperial:function(o){var d=o*3.2808399,p,x,S;d>5280?(p=d/5280,x=this._getRoundNum(p),this._updateScale(this._iScale,x+" mi",x/p)):(S=this._getRoundNum(d),this._updateScale(this._iScale,S+" ft",S/d))},_updateScale:function(o,d,p){o.style.width=Math.round(this.options.maxWidth*p)+"px",o.innerHTML=d},_getRoundNum:function(o){var d=Math.pow(10,(Math.floor(o)+"").length-1),p=o/d;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,d*p}}),fo=function(o){return new ho(o)},pc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',sa=Hi.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(nt.inlineSvg?pc+" ":"")+"Leaflet</a>"},initialize:function(o){Z(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=Dt("div","leaflet-control-attribution"),Pr(this._container);for(var d in o._layers)o._layers[d].getAttribution&&this.addAttribution(o._layers[d].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var d in this._attributions)this._attributions[d]&&o.push(d);var p=[];this.options.prefix&&p.push(this.options.prefix),o.length&&p.push(o.join(", ")),this._container.innerHTML=p.join(' <span aria-hidden="true">|</span> ')}}});Lt.mergeOptions({attributionControl:!0}),Lt.addInitHook(function(){this.options.attributionControl&&new sa().addTo(this)});var Lu=function(o){return new sa(o)};Hi.Layers=Tl,Hi.Zoom=Fs,Hi.Scale=ho,Hi.Attribution=sa,Qi.layers=Du,Qi.zoom=uo,Qi.scale=fo,Qi.attribution=Lu;var br=de.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});br.addTo=function(o,d){return o.addHandler(d,this),this};var Ra={Events:Y},wl=nt.touch?"touchstart mousedown":"mousedown",rs=ye.extend({options:{clickTolerance:3},initialize:function(o,d,p,x){Z(this,x),this._element=o,this._dragStartTarget=d||o,this._preventOutline=p},enable:function(){this._enabled||(dt(this._dragStartTarget,wl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(rs._dragging===this&&this.finishDrag(!0),tn(this._dragStartTarget,wl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!is(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){rs._dragging===this&&this.finishDrag();return}if(!(rs._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(rs._dragging=this,this._preventOutline&&Mi(this._element),mt(),et(),!this._moving)){this.fire("down");var d=o.touches?o.touches[0]:o,p=_r(this._element);this._startPoint=new ie(d.clientX,d.clientY),this._startPos=ot(this._element),this._parentScale=ar(p);var x=o.type==="mousedown";dt(document,x?"mousemove":"touchmove",this._onMove,this),dt(document,x?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var d=o.touches&&o.touches.length===1?o.touches[0]:o,p=new ie(d.clientX,d.clientY)._subtract(this._startPoint);!p.x&&!p.y||Math.abs(p.x)+Math.abs(p.y)<this.options.clickTolerance||(p.x/=this._parentScale.x,p.y/=this._parentScale.y,wn(o),this._moved||(this.fire("dragstart"),this._moved=!0,jt(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),jt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(p),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),Ne(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){Tn(document.body,"leaflet-dragging"),this._lastTarget&&(Tn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),tn(document,"mousemove touchmove",this._onMove,this),tn(document,"mouseup touchend touchcancel",this._onUp,this),Qt(),Be();var d=this._moved&&this._moving;this._moving=!1,rs._dragging=!1,d&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function mo(o,d,p){var x,S=[1,4,2,8],O,ee,ge,Se,Ve,Qe,it,lt;for(O=0,Qe=o.length;O<Qe;O++)o[O]._code=ws(o[O],d);for(ge=0;ge<4;ge++){for(it=S[ge],x=[],O=0,Qe=o.length,ee=Qe-1;O<Qe;ee=O++)Se=o[O],Ve=o[ee],Se._code&it?Ve._code&it||(lt=ki(Ve,Se,it,d,p),lt._code=ws(lt,d),x.push(lt)):(Ve._code&it&&(lt=ki(Ve,Se,it,d,p),lt._code=ws(lt,d),x.push(lt)),x.push(Se));o=x}return o}function aa(o,d){var p,x,S,O,ee,ge,Se,Ve,Qe;if(!o||o.length===0)throw new Error("latlngs not passed");m(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var it=oe([0,0]),lt=me(o),Rt=lt.getNorthWest().distanceTo(lt.getSouthWest())*lt.getNorthEast().distanceTo(lt.getNorthWest());Rt<1700&&(it=po(o));var Wn=o.length,ui=[];for(p=0;p<Wn;p++){var Xi=oe(o[p]);ui.push(d.project(oe([Xi.lat-it.lat,Xi.lng-it.lng])))}for(ge=Se=Ve=0,p=0,x=Wn-1;p<Wn;x=p++)S=ui[p],O=ui[x],ee=S.y*O.x-O.y*S.x,Se+=(S.x+O.x)*ee,Ve+=(S.y+O.y)*ee,ge+=ee*3;ge===0?Qe=ui[0]:Qe=[Se/ge,Ve/ge];var qr=d.unproject(A(Qe));return oe([qr.lat+it.lat,qr.lng+it.lng])}function po(o){for(var d=0,p=0,x=0,S=0;S<o.length;S++){var O=oe(o[S]);d+=O.lat,p+=O.lng,x++}return oe([d/x,p/x])}var go={__proto__:null,clipPolygon:mo,polygonCenter:aa,centroid:po};function El(o,d){if(!d||!o.length)return o.slice();var p=d*d;return o=yc(o,p),o=gc(o,p),o}function yo(o,d,p){return Math.sqrt(xr(o,d,p,!0))}function zs(o,d,p){return xr(o,d,p)}function gc(o,d){var p=o.length,x=typeof Uint8Array<"u"?Uint8Array:Array,S=new x(p);S[0]=S[p-1]=1,_o(o,S,d,0,p-1);var O,ee=[];for(O=0;O<p;O++)S[O]&&ee.push(o[O]);return ee}function _o(o,d,p,x,S){var O=0,ee,ge,Se;for(ge=x+1;ge<=S-1;ge++)Se=xr(o[ge],o[x],o[S],!0),Se>O&&(ee=ge,O=Se);O>p&&(d[ee]=1,_o(o,d,p,x,ee),_o(o,d,p,ee,S))}function yc(o,d){for(var p=[o[0]],x=1,S=0,O=o.length;x<O;x++)_c(o[x],o[S])>d&&(p.push(o[x]),S=x);return S<O-1&&p.push(o[O-1]),p}var Sl;function Ia(o,d,p,x,S){var O=x?Sl:ws(o,p),ee=ws(d,p),ge,Se,Ve;for(Sl=ee;;){if(!(O|ee))return[o,d];if(O&ee)return!1;ge=O||ee,Se=ki(o,d,ge,p,S),Ve=ws(Se,p),ge===O?(o=Se,O=Ve):(d=Se,ee=Ve)}}function ki(o,d,p,x,S){var O=d.x-o.x,ee=d.y-o.y,ge=x.min,Se=x.max,Ve,Qe;return p&8?(Ve=o.x+O*(Se.y-o.y)/ee,Qe=Se.y):p&4?(Ve=o.x+O*(ge.y-o.y)/ee,Qe=ge.y):p&2?(Ve=Se.x,Qe=o.y+ee*(Se.x-o.x)/O):p&1&&(Ve=ge.x,Qe=o.y+ee*(ge.x-o.x)/O),new ie(Ve,Qe,S)}function ws(o,d){var p=0;return o.x<d.min.x?p|=1:o.x>d.max.x&&(p|=2),o.y<d.min.y?p|=4:o.y>d.max.y&&(p|=8),p}function _c(o,d){var p=d.x-o.x,x=d.y-o.y;return p*p+x*x}function xr(o,d,p,x){var S=d.x,O=d.y,ee=p.x-S,ge=p.y-O,Se=ee*ee+ge*ge,Ve;return Se>0&&(Ve=((o.x-S)*ee+(o.y-O)*ge)/Se,Ve>1?(S=p.x,O=p.y):Ve>0&&(S+=ee*Ve,O+=ge*Ve)),ee=o.x-S,ge=o.y-O,x?ee*ee+ge*ge:new ie(S,O)}function m(o){return!ue(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function T(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),m(o)}function N(o,d){var p,x,S,O,ee,ge,Se,Ve;if(!o||o.length===0)throw new Error("latlngs not passed");m(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var Qe=oe([0,0]),it=me(o),lt=it.getNorthWest().distanceTo(it.getSouthWest())*it.getNorthEast().distanceTo(it.getNorthWest());lt<1700&&(Qe=po(o));var Rt=o.length,Wn=[];for(p=0;p<Rt;p++){var ui=oe(o[p]);Wn.push(d.project(oe([ui.lat-Qe.lat,ui.lng-Qe.lng])))}for(p=0,x=0;p<Rt-1;p++)x+=Wn[p].distanceTo(Wn[p+1])/2;if(x===0)Ve=Wn[0];else for(p=0,O=0;p<Rt-1;p++)if(ee=Wn[p],ge=Wn[p+1],S=ee.distanceTo(ge),O+=S,O>x){Se=(O-x)/S,Ve=[ge.x-Se*(ge.x-ee.x),ge.y-Se*(ge.y-ee.y)];break}var Xi=d.unproject(A(Ve));return oe([Xi.lat+Qe.lat,Xi.lng+Qe.lng])}var B={__proto__:null,simplify:El,pointToSegmentDistance:yo,closestPointOnSegment:zs,clipSegment:Ia,_getEdgeIntersection:ki,_getBitCode:ws,_sqClosestPointOnSegment:xr,isFlat:m,_flat:T,polylineCenter:N},pe={project:function(o){return new ie(o.lng,o.lat)},unproject:function(o){return new J(o.y,o.x)},bounds:new W([-180,-90],[180,90])},je={R:6378137,R_MINOR:6356752314245179e-9,bounds:new W([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var d=Math.PI/180,p=this.R,x=o.lat*d,S=this.R_MINOR/p,O=Math.sqrt(1-S*S),ee=O*Math.sin(x),ge=Math.tan(Math.PI/4-x/2)/Math.pow((1-ee)/(1+ee),O/2);return x=-p*Math.log(Math.max(ge,1e-10)),new ie(o.lng*d*p,x)},unproject:function(o){for(var d=180/Math.PI,p=this.R,x=this.R_MINOR/p,S=Math.sqrt(1-x*x),O=Math.exp(-o.y/p),ee=Math.PI/2-2*Math.atan(O),ge=0,Se=.1,Ve;ge<15&&Math.abs(Se)>1e-7;ge++)Ve=S*Math.sin(ee),Ve=Math.pow((1-Ve)/(1+Ve),S/2),Se=Math.PI/2-2*Math.atan(O*Ve)-ee,ee+=Se;return new J(ee*d,o.x*d/p)}},qe={__proto__:null,LonLat:pe,Mercator:je,SphericalMercator:K},nn=l({},he,{code:"EPSG:3395",projection:je,transformation:function(){var o=.5/(Math.PI*je.R);return Re(o,.5,-o,.5)}()}),_i=l({},he,{code:"EPSG:4326",projection:pe,transformation:Re(1/180,1,-1/180,.5)}),rn=l({},re,{projection:pe,transformation:Re(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,d){var p=d.lng-o.lng,x=d.lat-o.lat;return Math.sqrt(p*p+x*x)},infinite:!0});re.Earth=he,re.EPSG3395=nn,re.EPSG3857=Ge,re.EPSG900913=Je,re.EPSG4326=_i,re.Simple=rn;var Sn=ye.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[_(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[_(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var d=o.target;if(d.hasLayer(this)){if(this._map=d,this._zoomAnimated=d._zoomAnimated,this.getEvents){var p=this.getEvents();d.on(p,this),this.once("remove",function(){d.off(p,this)},this)}this.onAdd(d),this.fire("add"),d.fire("layeradd",{layer:this})}}});Lt.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var d=_(o);return this._layers[d]?this:(this._layers[d]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var d=_(o);return this._layers[d]?(this._loaded&&o.onRemove(this),delete this._layers[d],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return _(o)in this._layers},eachLayer:function(o,d){for(var p in this._layers)o.call(d,this._layers[p]);return this},_addLayers:function(o){o=o?ue(o)?o:[o]:[];for(var d=0,p=o.length;d<p;d++)this.addLayer(o[d])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[_(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var d=_(o);this._zoomBoundLayers[d]&&(delete this._zoomBoundLayers[d],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,d=-1/0,p=this._getZoomSpan();for(var x in this._zoomBoundLayers){var S=this._zoomBoundLayers[x].options;o=S.minZoom===void 0?o:Math.min(o,S.minZoom),d=S.maxZoom===void 0?d:Math.max(d,S.maxZoom)}this._layersMaxZoom=d===-1/0?void 0:d,this._layersMinZoom=o===1/0?void 0:o,p!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Kn=Sn.extend({initialize:function(o,d){Z(this,d),this._layers={};var p,x;if(o)for(p=0,x=o.length;p<x;p++)this.addLayer(o[p])},addLayer:function(o){var d=this.getLayerId(o);return this._layers[d]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var d=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[d]&&this._map.removeLayer(this._layers[d]),delete this._layers[d],this},hasLayer:function(o){var d=typeof o=="number"?o:this.getLayerId(o);return d in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var d=Array.prototype.slice.call(arguments,1),p,x;for(p in this._layers)x=this._layers[p],x[o]&&x[o].apply(x,d);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,d){for(var p in this._layers)o.call(d,this._layers[p]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return _(o)}}),Bs=function(o,d){return new Kn(o,d)},zn=Kn.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),Kn.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),Kn.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new te;for(var d in this._layers){var p=this._layers[d];o.extend(p.getBounds?p.getBounds():p.getLatLng())}return o}}),Es=function(o,d){return new zn(o,d)},Ss=de.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){Z(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,d){var p=this._getIconUrl(o);if(!p){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var x=this._createImg(p,d&&d.tagName==="IMG"?d:null);return this._setIconStyles(x,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),x},_setIconStyles:function(o,d){var p=this.options,x=p[d+"Size"];typeof x=="number"&&(x=[x,x]);var S=A(x),O=A(d==="shadow"&&p.shadowAnchor||p.iconAnchor||S&&S.divideBy(2,!0));o.className="leaflet-marker-"+d+" "+(p.className||""),O&&(o.style.marginLeft=-O.x+"px",o.style.marginTop=-O.y+"px"),S&&(o.style.width=S.x+"px",o.style.height=S.y+"px")},_createImg:function(o,d){return d=d||document.createElement("img"),d.src=o,d},_getIconUrl:function(o){return nt.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function vc(o){return new Ss(o)}var vo=Ss.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof vo.imagePath!="string"&&(vo.imagePath=this._detectIconPath()),(this.options.imagePath||vo.imagePath)+Ss.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var d=function(p,x,S){var O=x.exec(p);return O&&O[S]};return o=d(o,/^url\((['"])?(.+)\1\)$/,2),o&&d(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=Dt("div","leaflet-default-icon-path",document.body),d=Hr(o,"background-image")||Hr(o,"backgroundImage");if(document.body.removeChild(o),d=this._stripUrl(d),d)return d;var p=document.querySelector('link[href$="leaflet.css"]');return p?p.href.substring(0,p.href.length-11-1):""}}),Vu=br.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new rs(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),jt(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Tn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var d=this._marker,p=d._map,x=this._marker.options.autoPanSpeed,S=this._marker.options.autoPanPadding,O=ot(d._icon),ee=p.getPixelBounds(),ge=p.getPixelOrigin(),Se=$(ee.min._subtract(ge).add(S),ee.max._subtract(ge).subtract(S));if(!Se.contains(O)){var Ve=A((Math.max(Se.max.x,O.x)-Se.max.x)/(ee.max.x-Se.max.x)-(Math.min(Se.min.x,O.x)-Se.min.x)/(ee.min.x-Se.min.x),(Math.max(Se.max.y,O.y)-Se.max.y)/(ee.max.y-Se.max.y)-(Math.min(Se.min.y,O.y)-Se.min.y)/(ee.min.y-Se.min.y)).multiplyBy(x);p.panBy(Ve,{animate:!1}),this._draggable._newPos._add(Ve),this._draggable._startPos._add(Ve),Ne(d._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=k(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(q(this._panRequest),this._panRequest=k(this._adjustPan.bind(this,o)))},_onDrag:function(o){var d=this._marker,p=d._shadow,x=ot(d._icon),S=d._map.layerPointToLatLng(x);p&&Ne(p,x),d._latlng=S,o.latlng=S,o.oldLatLng=this._oldLatLng,d.fire("move",o).fire("drag",o)},_onDragEnd:function(o){q(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),bo=Sn.extend({options:{icon:new vo,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,d){Z(this,d),this._latlng=oe(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var d=this._latlng;return this._latlng=oe(o),this.update(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,d="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),p=o.icon.createIcon(this._icon),x=!1;p!==this._icon&&(this._icon&&this._removeIcon(),x=!0,o.title&&(p.title=o.title),p.tagName==="IMG"&&(p.alt=o.alt||"")),jt(p,d),o.keyboard&&(p.tabIndex="0",p.setAttribute("role","button")),this._icon=p,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&dt(p,"focus",this._panOnFocus,this);var S=o.icon.createShadow(this._shadow),O=!1;S!==this._shadow&&(this._removeShadow(),O=!0),S&&(jt(S,d),S.alt=""),this._shadow=S,o.opacity<1&&this._updateOpacity(),x&&this.getPane().appendChild(this._icon),this._initInteraction(),S&&O&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&tn(this._icon,"focus",this._panOnFocus,this),bt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&bt(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&Ne(this._icon,o),this._shadow&&Ne(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(d)},_initInteraction:function(){if(this.options.interactive&&(jt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Vu)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Vu(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&mn(this._icon,o),this._shadow&&mn(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var d=this.options.icon.options,p=d.iconSize?A(d.iconSize):A(0,0),x=d.iconAnchor?A(d.iconAnchor):A(0,0);o.panInside(this._latlng,{paddingTopLeft:x,paddingBottomRight:p.subtract(x)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Uu(o,d){return new bo(o,d)}var Hs=Sn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return Z(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),jl=Hs.extend({options:{fill:!0,radius:10},initialize:function(o,d){Z(this,d),this._latlng=oe(o),this._radius=this.options.radius},setLatLng:function(o){var d=this._latlng;return this._latlng=oe(o),this.redraw(),this.fire("move",{oldLatLng:d,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var d=o&&o.radius||this._radius;return Hs.prototype.setStyle.call(this,o),this.setRadius(d),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,d=this._radiusY||o,p=this._clickTolerance(),x=[o+p,d+p];this._pxBounds=new W(this._point.subtract(x),this._point.add(x))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function kh(o,d){return new jl(o,d)}var Fu=jl.extend({initialize:function(o,d,p){if(typeof d=="number"&&(d=l({},p,{radius:d})),Z(this,d),this._latlng=oe(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new te(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:Hs.prototype.setStyle,_project:function(){var o=this._latlng.lng,d=this._latlng.lat,p=this._map,x=p.options.crs;if(x.distance===he.distance){var S=Math.PI/180,O=this._mRadius/he.R/S,ee=p.project([d+O,o]),ge=p.project([d-O,o]),Se=ee.add(ge).divideBy(2),Ve=p.unproject(Se).lat,Qe=Math.acos((Math.cos(O*S)-Math.sin(d*S)*Math.sin(Ve*S))/(Math.cos(d*S)*Math.cos(Ve*S)))/S;(isNaN(Qe)||Qe===0)&&(Qe=O/Math.cos(Math.PI/180*d)),this._point=Se.subtract(p.getPixelOrigin()),this._radius=isNaN(Qe)?0:Se.x-p.project([Ve,o-Qe]).x,this._radiusY=Se.y-ee.y}else{var it=x.unproject(x.project(this._latlng).subtract([this._mRadius,0]));this._point=p.latLngToLayerPoint(this._latlng),this._radius=this._point.x-p.latLngToLayerPoint(it).x}this._updateBounds()}});function jp(o,d,p){return new Fu(o,d,p)}var qs=Hs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,d){Z(this,d),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var d=1/0,p=null,x=xr,S,O,ee=0,ge=this._parts.length;ee<ge;ee++)for(var Se=this._parts[ee],Ve=1,Qe=Se.length;Ve<Qe;Ve++){S=Se[Ve-1],O=Se[Ve];var it=x(o,S,O,!0);it<d&&(d=it,p=x(o,S,O))}return p&&(p.distance=Math.sqrt(d)),p},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return N(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,d){return d=d||this._defaultShape(),o=oe(o),d.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new te,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return m(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var d=[],p=m(o),x=0,S=o.length;x<S;x++)p?(d[x]=oe(o[x]),this._bounds.extend(d[x])):d[x]=this._convertLatLngs(o[x]);return d},_project:function(){var o=new W;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),d=new ie(o,o);this._rawPxBounds&&(this._pxBounds=new W([this._rawPxBounds.min.subtract(d),this._rawPxBounds.max.add(d)]))},_projectLatlngs:function(o,d,p){var x=o[0]instanceof J,S=o.length,O,ee;if(x){for(ee=[],O=0;O<S;O++)ee[O]=this._map.latLngToLayerPoint(o[O]),p.extend(ee[O]);d.push(ee)}else for(O=0;O<S;O++)this._projectLatlngs(o[O],d,p)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var d=this._parts,p,x,S,O,ee,ge,Se;for(p=0,S=0,O=this._rings.length;p<O;p++)for(Se=this._rings[p],x=0,ee=Se.length;x<ee-1;x++)ge=Ia(Se[x],Se[x+1],o,x,!0),ge&&(d[S]=d[S]||[],d[S].push(ge[0]),(ge[1]!==Se[x+1]||x===ee-2)&&(d[S].push(ge[1]),S++))}},_simplifyPoints:function(){for(var o=this._parts,d=this.options.smoothFactor,p=0,x=o.length;p<x;p++)o[p]=El(o[p],d)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,d){var p,x,S,O,ee,ge,Se=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(p=0,O=this._parts.length;p<O;p++)for(ge=this._parts[p],x=0,ee=ge.length,S=ee-1;x<ee;S=x++)if(!(!d&&x===0)&&yo(o,ge[S],ge[x])<=Se)return!0;return!1}});function Ap(o,d){return new qs(o,d)}qs._flat=T;var xo=qs.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return aa(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var d=qs.prototype._convertLatLngs.call(this,o),p=d.length;return p>=2&&d[0]instanceof J&&d[0].equals(d[p-1])&&d.pop(),d},_setLatLngs:function(o){qs.prototype._setLatLngs.call(this,o),m(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return m(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,d=this.options.weight,p=new ie(d,d);if(o=new W(o.min.subtract(p),o.max.add(p)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var x=0,S=this._rings.length,O;x<S;x++)O=mo(this._rings[x],o,!0),O.length&&this._parts.push(O)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var d=!1,p,x,S,O,ee,ge,Se,Ve;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(O=0,Se=this._parts.length;O<Se;O++)for(p=this._parts[O],ee=0,Ve=p.length,ge=Ve-1;ee<Ve;ge=ee++)x=p[ee],S=p[ge],x.y>o.y!=S.y>o.y&&o.x<(S.x-x.x)*(o.y-x.y)/(S.y-x.y)+x.x&&(d=!d);return d||qs.prototype._containsPoint.call(this,o,!0)}});function Mr(o,d){return new xo(o,d)}var kr=zn.extend({initialize:function(o,d){Z(this,d),this._layers={},o&&this.addData(o)},addData:function(o){var d=ue(o)?o:o.features,p,x,S;if(d){for(p=0,x=d.length;p<x;p++)S=d[p],(S.geometries||S.geometry||S.features||S.coordinates)&&this.addData(S);return this}var O=this.options;if(O.filter&&!O.filter(o))return this;var ee=Al(o,O);return ee?(ee.feature=To(o),ee.defaultOptions=ee.options,this.resetStyle(ee),O.onEachFeature&&O.onEachFeature(o,ee),this.addLayer(ee)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=l({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(d){this._setLayerStyle(d,o)},this)},_setLayerStyle:function(o,d){o.setStyle&&(typeof d=="function"&&(d=d(o.feature)),o.setStyle(d))}});function Al(o,d){var p=o.type==="Feature"?o.geometry:o,x=p?p.coordinates:null,S=[],O=d&&d.pointToLayer,ee=d&&d.coordsToLatLng||bc,ge,Se,Ve,Qe;if(!x&&!p)return null;switch(p.type){case"Point":return ge=ee(x),zu(O,o,ge,d);case"MultiPoint":for(Ve=0,Qe=x.length;Ve<Qe;Ve++)ge=ee(x[Ve]),S.push(zu(O,o,ge,d));return new zn(S);case"LineString":case"MultiLineString":return Se=Nl(x,p.type==="LineString"?0:1,ee),new qs(Se,d);case"Polygon":case"MultiPolygon":return Se=Nl(x,p.type==="Polygon"?1:2,ee),new xo(Se,d);case"GeometryCollection":for(Ve=0,Qe=p.geometries.length;Ve<Qe;Ve++){var it=Al({geometry:p.geometries[Ve],type:"Feature",properties:o.properties},d);it&&S.push(it)}return new zn(S);case"FeatureCollection":for(Ve=0,Qe=p.features.length;Ve<Qe;Ve++){var lt=Al(p.features[Ve],d);lt&&S.push(lt)}return new zn(S);default:throw new Error("Invalid GeoJSON object.")}}function zu(o,d,p,x){return o?o(d,p):new bo(p,x&&x.markersInheritOptions&&x)}function bc(o){return new J(o[1],o[0],o[2])}function Nl(o,d,p){for(var x=[],S=0,O=o.length,ee;S<O;S++)ee=d?Nl(o[S],d-1,p):(p||bc)(o[S]),x.push(ee);return x}function Cl(o,d){return o=oe(o),o.alt!==void 0?[I(o.lng,d),I(o.lat,d),I(o.alt,d)]:[I(o.lng,d),I(o.lat,d)]}function xc(o,d,p,x){for(var S=[],O=0,ee=o.length;O<ee;O++)S.push(d?xc(o[O],m(o[O])?0:d-1,p,x):Cl(o[O],x));return!d&&p&&S.length>0&&S.push(S[0].slice()),S}function ss(o,d){return o.feature?l({},o.feature,{geometry:d}):To(d)}function To(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var Pa={toGeoJSON:function(o){return ss(this,{type:"Point",coordinates:Cl(this.getLatLng(),o)})}};bo.include(Pa),Fu.include(Pa),jl.include(Pa),qs.include({toGeoJSON:function(o){var d=!m(this._latlngs),p=xc(this._latlngs,d?1:0,!1,o);return ss(this,{type:(d?"Multi":"")+"LineString",coordinates:p})}}),xo.include({toGeoJSON:function(o){var d=!m(this._latlngs),p=d&&!m(this._latlngs[0]),x=xc(this._latlngs,p?2:d?1:0,!0,o);return d||(x=[x]),ss(this,{type:(p?"Multi":"")+"Polygon",coordinates:x})}}),Kn.include({toMultiPoint:function(o){var d=[];return this.eachLayer(function(p){d.push(p.toGeoJSON(o).geometry.coordinates)}),ss(this,{type:"MultiPoint",coordinates:d})},toGeoJSON:function(o){var d=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(d==="MultiPoint")return this.toMultiPoint(o);var p=d==="GeometryCollection",x=[];return this.eachLayer(function(S){if(S.toGeoJSON){var O=S.toGeoJSON(o);if(p)x.push(O.geometry);else{var ee=To(O);ee.type==="FeatureCollection"?x.push.apply(x,ee.features):x.push(ee)}}}),p?ss(this,{geometries:x,type:"GeometryCollection"}):{type:"FeatureCollection",features:x}}});function Tc(o,d){return new kr(o,d)}var Oh=Tc,js=Sn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,d,p){this._url=o,this._bounds=me(d),Z(this,p)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(jt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){bt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&Pt(this._image),this},bringToBack:function(){return this._map&&xs(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=me(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",d=this._image=o?this._url:Dt("img");if(jt(d,"leaflet-image-layer"),this._zoomAnimated&&jt(d,"leaflet-zoom-animated"),this.options.className&&jt(d,this.options.className),d.onselectstart=R,d.onmousemove=R,d.onload=f(this.fire,this,"load"),d.onerror=f(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=d.src;return}d.src=this._url,d.alt=this.options.alt},_animateZoom:function(o){var d=this._map.getZoomScale(o.zoom),p=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;He(this._image,p,d)},_reset:function(){var o=this._image,d=new W(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),p=d.getSize();Ne(o,d.min),o.style.width=p.x+"px",o.style.height=p.y+"px"},_updateOpacity:function(){mn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),wo=function(o,d,p){return new js(o,d,p)},wc=js.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",d=this._image=o?this._url:Dt("video");if(jt(d,"leaflet-image-layer"),this._zoomAnimated&&jt(d,"leaflet-zoom-animated"),this.options.className&&jt(d,this.options.className),d.onselectstart=R,d.onmousemove=R,d.onloadeddata=f(this.fire,this,"load"),o){for(var p=d.getElementsByTagName("source"),x=[],S=0;S<p.length;S++)x.push(p[S].src);this._url=p.length>0?x:[d.src];return}ue(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(d.style,"objectFit")&&(d.style.objectFit="fill"),d.autoplay=!!this.options.autoplay,d.loop=!!this.options.loop,d.muted=!!this.options.muted,d.playsInline=!!this.options.playsInline;for(var O=0;O<this._url.length;O++){var ee=Dt("source");ee.src=this._url[O],d.appendChild(ee)}}});function Dh(o,d,p){return new wc(o,d,p)}var oa=js.extend({_initImage:function(){var o=this._image=this._url;jt(o,"leaflet-image-layer"),this._zoomAnimated&&jt(o,"leaflet-zoom-animated"),this.options.className&&jt(o,this.options.className),o.onselectstart=R,o.onmousemove=R}});function Lh(o,d,p){return new oa(o,d,p)}var as=Sn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,d){o&&(o instanceof J||ue(o))?(this._latlng=oe(o),Z(this,d)):(Z(this,o),this._source=d),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&mn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&mn(this._container,1),this.bringToFront(),this.options.interactive&&(jt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?(mn(this._container,0),this._removeTimeout=setTimeout(f(bt,void 0,this._container),200)):bt(this._container),this.options.interactive&&(Tn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=oe(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Pt(this._container),this},bringToBack:function(){return this._map&&xs(this._container),this},_prepareOpen:function(o){var d=this._source;if(!d._map)return!1;if(d instanceof zn){d=null;var p=this._source._layers;for(var x in p)if(p[x]._map){d=p[x];break}if(!d)return!1;this._source=d}if(!o)if(d.getCenter)o=d.getCenter();else if(d.getLatLng)o=d.getLatLng();else if(d.getBounds)o=d.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,d=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof d=="string")o.innerHTML=d;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(d)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),d=A(this.options.offset),p=this._getAnchor();this._zoomAnimated?Ne(this._container,o.add(p)):d=d.add(o).add(p);var x=this._containerBottom=-d.y,S=this._containerLeft=-Math.round(this._containerWidth/2)+d.x;this._container.style.bottom=x+"px",this._container.style.left=S+"px"}},_getAnchor:function(){return[0,0]}});Lt.include({_initOverlay:function(o,d,p,x){var S=d;return S instanceof o||(S=new o(x).setContent(d)),p&&S.setLatLng(p),S}}),Sn.include({_initOverlay:function(o,d,p,x){var S=p;return S instanceof o?(Z(S,x),S._source=this):(S=d&&!x?d:new o(x,this),S.setContent(p)),S}});var Rl=as.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,as.prototype.openOn.call(this,o)},onAdd:function(o){as.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Hs||this._source.on("preclick",ri))},onRemove:function(o){as.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Hs||this._source.off("preclick",ri))},getEvents:function(){var o=as.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",d=this._container=Dt("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),p=this._wrapper=Dt("div",o+"-content-wrapper",d);if(this._contentNode=Dt("div",o+"-content",p),Pr(d),Yi(this._contentNode),dt(d,"contextmenu",ri),this._tipContainer=Dt("div",o+"-tip-container",d),this._tip=Dt("div",o+"-tip",this._tipContainer),this.options.closeButton){var x=this._closeButton=Dt("a",o+"-close-button",d);x.setAttribute("role","button"),x.setAttribute("aria-label","Close popup"),x.href="#close",x.innerHTML='<span aria-hidden="true">&#215;</span>',dt(x,"click",function(S){wn(S),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,d=o.style;d.width="",d.whiteSpace="nowrap";var p=o.offsetWidth;p=Math.min(p,this.options.maxWidth),p=Math.max(p,this.options.minWidth),d.width=p+1+"px",d.whiteSpace="",d.height="";var x=o.offsetHeight,S=this.options.maxHeight,O="leaflet-popup-scrolled";S&&x>S?(d.height=S+"px",jt(o,O)):Tn(o,O),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),p=this._getAnchor();Ne(this._container,d.add(p))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,d=parseInt(Hr(this._container,"marginBottom"),10)||0,p=this._container.offsetHeight+d,x=this._containerWidth,S=new ie(this._containerLeft,-p-this._containerBottom);S._add(ot(this._container));var O=o.layerPointToContainerPoint(S),ee=A(this.options.autoPanPadding),ge=A(this.options.autoPanPaddingTopLeft||ee),Se=A(this.options.autoPanPaddingBottomRight||ee),Ve=o.getSize(),Qe=0,it=0;O.x+x+Se.x>Ve.x&&(Qe=O.x+x-Ve.x+Se.x),O.x-Qe-ge.x<0&&(Qe=O.x-ge.x),O.y+p+Se.y>Ve.y&&(it=O.y+p-Ve.y+Se.y),O.y-it-ge.y<0&&(it=O.y-ge.y),(Qe||it)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([Qe,it]))}},_getAnchor:function(){return A(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Np=function(o,d){return new Rl(o,d)};Lt.mergeOptions({closePopupOnClick:!0}),Lt.include({openPopup:function(o,d,p){return this._initOverlay(Rl,o,d,p).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),Sn.include({bindPopup:function(o,d){return this._popup=this._initOverlay(Rl,this._popup,o,d),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof zn||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){ji(o);var d=o.layer||o.target;if(this._popup._source===d&&!(d instanceof Hs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=d,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var Ec=as.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){as.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){as.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=as.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",d=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Dt("div",d),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+_(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var d,p,x=this._map,S=this._container,O=x.latLngToContainerPoint(x.getCenter()),ee=x.layerPointToContainerPoint(o),ge=this.options.direction,Se=S.offsetWidth,Ve=S.offsetHeight,Qe=A(this.options.offset),it=this._getAnchor();ge==="top"?(d=Se/2,p=Ve):ge==="bottom"?(d=Se/2,p=0):ge==="center"?(d=Se/2,p=Ve/2):ge==="right"?(d=0,p=Ve/2):ge==="left"?(d=Se,p=Ve/2):ee.x<O.x?(ge="right",d=0,p=Ve/2):(ge="left",d=Se+(Qe.x+it.x)*2,p=Ve/2),o=o.subtract(A(d,p,!0)).add(Qe).add(it),Tn(S,"leaflet-tooltip-right"),Tn(S,"leaflet-tooltip-left"),Tn(S,"leaflet-tooltip-top"),Tn(S,"leaflet-tooltip-bottom"),jt(S,"leaflet-tooltip-"+ge),Ne(S,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&mn(this._container,o)},_animateZoom:function(o){var d=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(d)},_getAnchor:function(){return A(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Cp=function(o,d){return new Ec(o,d)};Lt.include({openTooltip:function(o,d,p){return this._initOverlay(Ec,o,d,p).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),Sn.include({bindTooltip:function(o,d){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ec,this._tooltip,o,d),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var d=o?"off":"on",p={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?p.add=this._openTooltip:(p.mouseover=this._openTooltip,p.mouseout=this.closeTooltip,p.click=this._openTooltip,this._map?this._addFocusListeners():p.add=this._addFocusListeners),this._tooltip.options.sticky&&(p.mousemove=this._moveTooltip),this[d](p),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof zn||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var d=typeof o.getElement=="function"&&o.getElement();d&&(dt(d,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),dt(d,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var d=typeof o.getElement=="function"&&o.getElement();d&&d.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var d=this;this._map.once("moveend",function(){d._openOnceFlag=!1,d._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var d=o.latlng,p,x;this._tooltip.options.sticky&&o.originalEvent&&(p=this._map.mouseEventToContainerPoint(o.originalEvent),x=this._map.containerPointToLayerPoint(p),d=this._map.layerPointToLatLng(x)),this._tooltip.setLatLng(d)}});var Bu=Ss.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var d=o&&o.tagName==="DIV"?o:document.createElement("div"),p=this.options;if(p.html instanceof Element?(yi(d),d.appendChild(p.html)):d.innerHTML=p.html!==!1?p.html:"",p.bgPos){var x=A(p.bgPos);d.style.backgroundPosition=-x.x+"px "+-x.y+"px"}return this._setIconStyles(d,"icon"),d},createShadow:function(){return null}});function Vh(o){return new Bu(o)}Ss.Default=vo;var Ma=Sn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:nt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){Z(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),bt(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Pt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(xs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=v(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof ie?o:new ie(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var d=this.getPane().children,p=-o(-1/0,1/0),x=0,S=d.length,O;x<S;x++)O=d[x].style.zIndex,d[x]!==this._container&&O&&(p=o(p,+O));isFinite(p)&&(this.options.zIndex=p+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!nt.ielt9){mn(this._container,this.options.opacity);var o=+new Date,d=!1,p=!1;for(var x in this._tiles){var S=this._tiles[x];if(!(!S.current||!S.loaded)){var O=Math.min(1,(o-S.loaded)/200);mn(S.el,O),O<1?d=!0:(S.active?p=!0:this._onOpaqueTile(S),S.active=!0)}}p&&!this._noPrune&&this._pruneTiles(),d&&(q(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this))}},_onOpaqueTile:R,_initContainer:function(){this._container||(this._container=Dt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,d=this.options.maxZoom;if(o!==void 0){for(var p in this._levels)p=Number(p),this._levels[p].el.children.length||p===o?(this._levels[p].el.style.zIndex=d-Math.abs(o-p),this._onUpdateLevel(p)):(bt(this._levels[p].el),this._removeTilesAtZoom(p),this._onRemoveLevel(p),delete this._levels[p]);var x=this._levels[o],S=this._map;return x||(x=this._levels[o]={},x.el=Dt("div","leaflet-tile-container leaflet-zoom-animated",this._container),x.el.style.zIndex=d,x.origin=S.project(S.unproject(S.getPixelOrigin()),o).round(),x.zoom=o,this._setZoomTransform(x,S.getCenter(),S.getZoom()),R(x.el.offsetWidth),this._onCreateLevel(x)),this._level=x,x}},_onUpdateLevel:R,_onRemoveLevel:R,_onCreateLevel:R,_pruneTiles:function(){if(this._map){var o,d,p=this._map.getZoom();if(p>this.options.maxZoom||p<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)d=this._tiles[o],d.retain=d.current;for(o in this._tiles)if(d=this._tiles[o],d.current&&!d.active){var x=d.coords;this._retainParent(x.x,x.y,x.z,x.z-5)||this._retainChildren(x.x,x.y,x.z,x.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var d in this._tiles)this._tiles[d].coords.z===o&&this._removeTile(d)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)bt(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,d,p,x){var S=Math.floor(o/2),O=Math.floor(d/2),ee=p-1,ge=new ie(+S,+O);ge.z=+ee;var Se=this._tileCoordsToKey(ge),Ve=this._tiles[Se];return Ve&&Ve.active?(Ve.retain=!0,!0):(Ve&&Ve.loaded&&(Ve.retain=!0),ee>x?this._retainParent(S,O,ee,x):!1)},_retainChildren:function(o,d,p,x){for(var S=2*o;S<2*o+2;S++)for(var O=2*d;O<2*d+2;O++){var ee=new ie(S,O);ee.z=p+1;var ge=this._tileCoordsToKey(ee),Se=this._tiles[ge];if(Se&&Se.active){Se.retain=!0;continue}else Se&&Se.loaded&&(Se.retain=!0);p+1<x&&this._retainChildren(S,O,p+1,x)}},_resetView:function(o){var d=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),d,d)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var d=this.options;return d.minNativeZoom!==void 0&&o<d.minNativeZoom?d.minNativeZoom:d.maxNativeZoom!==void 0&&d.maxNativeZoom<o?d.maxNativeZoom:o},_setView:function(o,d,p,x){var S=Math.round(d);this.options.maxZoom!==void 0&&S>this.options.maxZoom||this.options.minZoom!==void 0&&S<this.options.minZoom?S=void 0:S=this._clampZoom(S);var O=this.options.updateWhenZooming&&S!==this._tileZoom;(!x||O)&&(this._tileZoom=S,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),S!==void 0&&this._update(o),p||this._pruneTiles(),this._noPrune=!!p),this._setZoomTransforms(o,d)},_setZoomTransforms:function(o,d){for(var p in this._levels)this._setZoomTransform(this._levels[p],o,d)},_setZoomTransform:function(o,d,p){var x=this._map.getZoomScale(p,o.zoom),S=o.origin.multiplyBy(x).subtract(this._map._getNewPixelOrigin(d,p)).round();nt.any3d?He(o.el,S,x):Ne(o.el,S)},_resetGrid:function(){var o=this._map,d=o.options.crs,p=this._tileSize=this.getTileSize(),x=this._tileZoom,S=this._map.getPixelWorldBounds(this._tileZoom);S&&(this._globalTileRange=this._pxBoundsToTileRange(S)),this._wrapX=d.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,d.wrapLng[0]],x).x/p.x),Math.ceil(o.project([0,d.wrapLng[1]],x).x/p.y)],this._wrapY=d.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([d.wrapLat[0],0],x).y/p.x),Math.ceil(o.project([d.wrapLat[1],0],x).y/p.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var d=this._map,p=d._animatingZoom?Math.max(d._animateToZoom,d.getZoom()):d.getZoom(),x=d.getZoomScale(p,this._tileZoom),S=d.project(o,this._tileZoom).floor(),O=d.getSize().divideBy(x*2);return new W(S.subtract(O),S.add(O))},_update:function(o){var d=this._map;if(d){var p=this._clampZoom(d.getZoom());if(o===void 0&&(o=d.getCenter()),this._tileZoom!==void 0){var x=this._getTiledPixelBounds(o),S=this._pxBoundsToTileRange(x),O=S.getCenter(),ee=[],ge=this.options.keepBuffer,Se=new W(S.getBottomLeft().subtract([ge,-ge]),S.getTopRight().add([ge,-ge]));if(!(isFinite(S.min.x)&&isFinite(S.min.y)&&isFinite(S.max.x)&&isFinite(S.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ve in this._tiles){var Qe=this._tiles[Ve].coords;(Qe.z!==this._tileZoom||!Se.contains(new ie(Qe.x,Qe.y)))&&(this._tiles[Ve].current=!1)}if(Math.abs(p-this._tileZoom)>1){this._setView(o,p);return}for(var it=S.min.y;it<=S.max.y;it++)for(var lt=S.min.x;lt<=S.max.x;lt++){var Rt=new ie(lt,it);if(Rt.z=this._tileZoom,!!this._isValidTile(Rt)){var Wn=this._tiles[this._tileCoordsToKey(Rt)];Wn?Wn.current=!0:ee.push(Rt)}}if(ee.sort(function(Xi,qr){return Xi.distanceTo(O)-qr.distanceTo(O)}),ee.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ui=document.createDocumentFragment();for(lt=0;lt<ee.length;lt++)this._addTile(ee[lt],ui);this._level.el.appendChild(ui)}}}},_isValidTile:function(o){var d=this._map.options.crs;if(!d.infinite){var p=this._globalTileRange;if(!d.wrapLng&&(o.x<p.min.x||o.x>p.max.x)||!d.wrapLat&&(o.y<p.min.y||o.y>p.max.y))return!1}if(!this.options.bounds)return!0;var x=this._tileCoordsToBounds(o);return me(this.options.bounds).overlaps(x)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var d=this._map,p=this.getTileSize(),x=o.scaleBy(p),S=x.add(p),O=d.unproject(x,o.z),ee=d.unproject(S,o.z);return[O,ee]},_tileCoordsToBounds:function(o){var d=this._tileCoordsToNwSe(o),p=new te(d[0],d[1]);return this.options.noWrap||(p=this._map.wrapLatLngBounds(p)),p},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var d=o.split(":"),p=new ie(+d[0],+d[1]);return p.z=+d[2],p},_removeTile:function(o){var d=this._tiles[o];d&&(bt(d.el),delete this._tiles[o],this.fire("tileunload",{tile:d.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){jt(o,"leaflet-tile");var d=this.getTileSize();o.style.width=d.x+"px",o.style.height=d.y+"px",o.onselectstart=R,o.onmousemove=R,nt.ielt9&&this.options.opacity<1&&mn(o,this.options.opacity)},_addTile:function(o,d){var p=this._getTilePos(o),x=this._tileCoordsToKey(o),S=this.createTile(this._wrapCoords(o),f(this._tileReady,this,o));this._initTile(S),this.createTile.length<2&&k(f(this._tileReady,this,o,null,S)),Ne(S,p),this._tiles[x]={el:S,coords:o,current:!0},d.appendChild(S),this.fire("tileloadstart",{tile:S,coords:o})},_tileReady:function(o,d,p){d&&this.fire("tileerror",{error:d,tile:p,coords:o});var x=this._tileCoordsToKey(o);p=this._tiles[x],p&&(p.loaded=+new Date,this._map._fadeAnimated?(mn(p.el,0),q(this._fadeFrame),this._fadeFrame=k(this._updateOpacity,this)):(p.active=!0,this._pruneTiles()),d||(jt(p.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:p.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),nt.ielt9||!this._map._fadeAnimated?k(this._pruneTiles,this):setTimeout(f(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var d=new ie(this._wrapX?w(o.x,this._wrapX):o.x,this._wrapY?w(o.y,this._wrapY):o.y);return d.z=o.z,d},_pxBoundsToTileRange:function(o){var d=this.getTileSize();return new W(o.min.unscaleBy(d).floor(),o.max.unscaleBy(d).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function os(o){return new Ma(o)}var ka=Ma.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,d){this._url=o,d=Z(this,d),d.detectRetina&&nt.retina&&d.maxZoom>0?(d.tileSize=Math.floor(d.tileSize/2),d.zoomReverse?(d.zoomOffset--,d.minZoom=Math.min(d.maxZoom,d.minZoom+1)):(d.zoomOffset++,d.maxZoom=Math.max(d.minZoom,d.maxZoom-1)),d.minZoom=Math.max(0,d.minZoom)):d.zoomReverse?d.minZoom=Math.min(d.maxZoom,d.minZoom):d.maxZoom=Math.max(d.minZoom,d.maxZoom),typeof d.subdomains=="string"&&(d.subdomains=d.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,d){return this._url===o&&d===void 0&&(d=!0),this._url=o,d||this.redraw(),this},createTile:function(o,d){var p=document.createElement("img");return dt(p,"load",f(this._tileOnLoad,this,d,p)),dt(p,"error",f(this._tileOnError,this,d,p)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(p.referrerPolicy=this.options.referrerPolicy),p.alt="",p.src=this.getTileUrl(o),p},getTileUrl:function(o){var d={r:nt.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var p=this._globalTileRange.max.y-o.y;this.options.tms&&(d.y=p),d["-y"]=p}return se(this._url,l(d,this.options))},_tileOnLoad:function(o,d){nt.ielt9?setTimeout(f(o,this,null,d),0):o(null,d)},_tileOnError:function(o,d,p){var x=this.options.errorTileUrl;x&&d.getAttribute("src")!==x&&(d.src=x),o(p,d)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,d=this.options.maxZoom,p=this.options.zoomReverse,x=this.options.zoomOffset;return p&&(o=d-o),o+x},_getSubdomain:function(o){var d=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[d]},_abortLoading:function(){var o,d;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(d=this._tiles[o].el,d.onload=R,d.onerror=R,!d.complete)){d.src=Ce;var p=this._tiles[o].coords;bt(d),delete this._tiles[o],this.fire("tileabort",{tile:d,coords:p})}},_removeTile:function(o){var d=this._tiles[o];if(d)return d.el.setAttribute("src",Ce),Ma.prototype._removeTile.call(this,o)},_tileReady:function(o,d,p){if(!(!this._map||p&&p.getAttribute("src")===Ce))return Ma.prototype._tileReady.call(this,o,d,p)}});function Or(o,d){return new ka(o,d)}var Dr=ka.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,d){this._url=o;var p=l({},this.defaultWmsParams);for(var x in d)x in this.options||(p[x]=d[x]);d=Z(this,d);var S=d.detectRetina&&nt.retina?2:1,O=this.getTileSize();p.width=O.x*S,p.height=O.y*S,this.wmsParams=p},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var d=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[d]=this._crs.code,ka.prototype.onAdd.call(this,o)},getTileUrl:function(o){var d=this._tileCoordsToNwSe(o),p=this._crs,x=$(p.project(d[0]),p.project(d[1])),S=x.min,O=x.max,ee=(this._wmsVersion>=1.3&&this._crs===_i?[S.y,S.x,O.y,O.x]:[S.x,S.y,O.x,O.y]).join(","),ge=ka.prototype.getTileUrl.call(this,o);return ge+F(this.wmsParams,ge,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ee},setParams:function(o,d){return l(this.wmsParams,o),d||this.redraw(),this}});function Eo(o,d){return new Dr(o,d)}ka.WMS=Dr,Or.wms=Eo;var ls=Sn.extend({options:{padding:.1},initialize:function(o){Z(this,o),_(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),jt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,d){var p=this._map.getZoomScale(d,this._zoom),x=this._map.getSize().multiplyBy(.5+this.options.padding),S=this._map.project(this._center,d),O=x.multiplyBy(-p).add(S).subtract(this._map._getNewPixelOrigin(o,d));nt.any3d?He(this._container,O,p):Ne(this._container,O)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,d=this._map.getSize(),p=this._map.containerPointToLayerPoint(d.multiplyBy(-o)).round();this._bounds=new W(p,p.add(d.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Il=ls.extend({options:{tolerance:0},getEvents:function(){var o=ls.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ls.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");dt(o,"mousemove",this._onMouseMove,this),dt(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),dt(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){q(this._redrawRequest),delete this._ctx,bt(this._container),tn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var d in this._layers)o=this._layers[d],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ls.prototype._update.call(this);var o=this._bounds,d=this._container,p=o.getSize(),x=nt.retina?2:1;Ne(d,o.min),d.width=x*p.x,d.height=x*p.y,d.style.width=p.x+"px",d.style.height=p.y+"px",nt.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){ls.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[_(o)]=o;var d=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=d),this._drawLast=d,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var d=o._order,p=d.next,x=d.prev;p?p.prev=x:this._drawLast=x,x?x.next=p:this._drawFirst=p,delete o._order,delete this._layers[_(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var d=o.options.dashArray.split(/[, ]+/),p=[],x,S;for(S=0;S<d.length;S++){if(x=Number(d[S]),isNaN(x))return;p.push(x)}o.options._dashArray=p}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||k(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var d=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new W,this._redrawBounds.extend(o._pxBounds.min.subtract([d,d])),this._redrawBounds.extend(o._pxBounds.max.add([d,d]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var d=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,d.x,d.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,d=this._redrawBounds;if(this._ctx.save(),d){var p=d.getSize();this._ctx.beginPath(),this._ctx.rect(d.min.x,d.min.y,p.x,p.y),this._ctx.clip()}this._drawing=!0;for(var x=this._drawFirst;x;x=x.next)o=x.layer,(!d||o._pxBounds&&o._pxBounds.intersects(d))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,d){if(this._drawing){var p,x,S,O,ee=o._parts,ge=ee.length,Se=this._ctx;if(ge){for(Se.beginPath(),p=0;p<ge;p++){for(x=0,S=ee[p].length;x<S;x++)O=ee[p][x],Se[x?"lineTo":"moveTo"](O.x,O.y);d&&Se.closePath()}this._fillStroke(Se,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var d=o._point,p=this._ctx,x=Math.max(Math.round(o._radius),1),S=(Math.max(Math.round(o._radiusY),1)||x)/x;S!==1&&(p.save(),p.scale(1,S)),p.beginPath(),p.arc(d.x,d.y/S,x,0,Math.PI*2,!1),S!==1&&p.restore(),this._fillStroke(p,o)}},_fillStroke:function(o,d){var p=d.options;p.fill&&(o.globalAlpha=p.fillOpacity,o.fillStyle=p.fillColor||p.color,o.fill(p.fillRule||"evenodd")),p.stroke&&p.weight!==0&&(o.setLineDash&&o.setLineDash(d.options&&d.options._dashArray||[]),o.globalAlpha=p.opacity,o.lineWidth=p.weight,o.strokeStyle=p.color,o.lineCap=p.lineCap,o.lineJoin=p.lineJoin,o.stroke())},_onClick:function(o){for(var d=this._map.mouseEventToLayerPoint(o),p,x,S=this._drawFirst;S;S=S.next)p=S.layer,p.options.interactive&&p._containsPoint(d)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(p))&&(x=p);this._fireEvent(x?[x]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var d=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,d)}},_handleMouseOut:function(o){var d=this._hoveredLayer;d&&(Tn(this._container,"leaflet-interactive"),this._fireEvent([d],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,d){if(!this._mouseHoverThrottled){for(var p,x,S=this._drawFirst;S;S=S.next)p=S.layer,p.options.interactive&&p._containsPoint(d)&&(x=p);x!==this._hoveredLayer&&(this._handleMouseOut(o),x&&(jt(this._container,"leaflet-interactive"),this._fireEvent([x],o,"mouseover"),this._hoveredLayer=x)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(f(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,d,p){this._map._fireDOMEvent(d,p||d.type,o)},_bringToFront:function(o){var d=o._order;if(d){var p=d.next,x=d.prev;if(p)p.prev=x;else return;x?x.next=p:p&&(this._drawFirst=p),d.prev=this._drawLast,this._drawLast.next=d,d.next=null,this._drawLast=d,this._requestRedraw(o)}},_bringToBack:function(o){var d=o._order;if(d){var p=d.next,x=d.prev;if(x)x.next=p;else return;p?p.prev=x:x&&(this._drawLast=x),d.prev=null,d.next=this._drawFirst,this._drawFirst.prev=d,this._drawFirst=d,this._requestRedraw(o)}}});function Pl(o){return nt.canvas?new Il(o):null}var Oa=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),So={_initContainer:function(){this._container=Dt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ls.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var d=o._container=Oa("shape");jt(d,"leaflet-vml-shape "+(this.options.className||"")),d.coordsize="1 1",o._path=Oa("path"),d.appendChild(o._path),this._updateStyle(o),this._layers[_(o)]=o},_addPath:function(o){var d=o._container;this._container.appendChild(d),o.options.interactive&&o.addInteractiveTarget(d)},_removePath:function(o){var d=o._container;bt(d),o.removeInteractiveTarget(d),delete this._layers[_(o)]},_updateStyle:function(o){var d=o._stroke,p=o._fill,x=o.options,S=o._container;S.stroked=!!x.stroke,S.filled=!!x.fill,x.stroke?(d||(d=o._stroke=Oa("stroke")),S.appendChild(d),d.weight=x.weight+"px",d.color=x.color,d.opacity=x.opacity,x.dashArray?d.dashStyle=ue(x.dashArray)?x.dashArray.join(" "):x.dashArray.replace(/( *, *)/g," "):d.dashStyle="",d.endcap=x.lineCap.replace("butt","flat"),d.joinstyle=x.lineJoin):d&&(S.removeChild(d),o._stroke=null),x.fill?(p||(p=o._fill=Oa("fill")),S.appendChild(p),p.color=x.fillColor||x.color,p.opacity=x.fillOpacity):p&&(S.removeChild(p),o._fill=null)},_updateCircle:function(o){var d=o._point.round(),p=Math.round(o._radius),x=Math.round(o._radiusY||p);this._setPath(o,o._empty()?"M0 0":"AL "+d.x+","+d.y+" "+p+","+x+" 0,"+65535*360)},_setPath:function(o,d){o._path.v=d},_bringToFront:function(o){Pt(o._container)},_bringToBack:function(o){xs(o._container)}},Ml=nt.vml?Oa:Ze,la=ls.extend({_initContainer:function(){this._container=Ml("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ml("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){bt(this._container),tn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ls.prototype._update.call(this);var o=this._bounds,d=o.getSize(),p=this._container;(!this._svgSize||!this._svgSize.equals(d))&&(this._svgSize=d,p.setAttribute("width",d.x),p.setAttribute("height",d.y)),Ne(p,o.min),p.setAttribute("viewBox",[o.min.x,o.min.y,d.x,d.y].join(" ")),this.fire("update")}},_initPath:function(o){var d=o._path=Ml("path");o.options.className&&jt(d,o.options.className),o.options.interactive&&jt(d,"leaflet-interactive"),this._updateStyle(o),this._layers[_(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){bt(o._path),o.removeInteractiveTarget(o._path),delete this._layers[_(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var d=o._path,p=o.options;d&&(p.stroke?(d.setAttribute("stroke",p.color),d.setAttribute("stroke-opacity",p.opacity),d.setAttribute("stroke-width",p.weight),d.setAttribute("stroke-linecap",p.lineCap),d.setAttribute("stroke-linejoin",p.lineJoin),p.dashArray?d.setAttribute("stroke-dasharray",p.dashArray):d.removeAttribute("stroke-dasharray"),p.dashOffset?d.setAttribute("stroke-dashoffset",p.dashOffset):d.removeAttribute("stroke-dashoffset")):d.setAttribute("stroke","none"),p.fill?(d.setAttribute("fill",p.fillColor||p.color),d.setAttribute("fill-opacity",p.fillOpacity),d.setAttribute("fill-rule",p.fillRule||"evenodd")):d.setAttribute("fill","none"))},_updatePoly:function(o,d){this._setPath(o,Ct(o._parts,d))},_updateCircle:function(o){var d=o._point,p=Math.max(Math.round(o._radius),1),x=Math.max(Math.round(o._radiusY),1)||p,S="a"+p+","+x+" 0 1,0 ",O=o._empty()?"M0 0":"M"+(d.x-p)+","+d.y+S+p*2+",0 "+S+-p*2+",0 ";this._setPath(o,O)},_setPath:function(o,d){o._path.setAttribute("d",d)},_bringToFront:function(o){Pt(o._path)},_bringToBack:function(o){xs(o._path)}});nt.vml&&la.include(So);function Da(o){return nt.svg||nt.vml?new la(o):null}Lt.include({getRenderer:function(o){var d=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return d||(d=this._renderer=this._createRenderer()),this.hasLayer(d)||this.addLayer(d),d},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var d=this._paneRenderers[o];return d===void 0&&(d=this._createRenderer({pane:o}),this._paneRenderers[o]=d),d},_createRenderer:function(o){return this.options.preferCanvas&&Pl(o)||Da(o)}});var Uh=xo.extend({initialize:function(o,d){xo.prototype.initialize.call(this,this._boundsToLatLngs(o),d)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=me(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function Lr(o,d){return new Uh(o,d)}la.create=Ml,la.pointsToPath=Ct,kr.geometryToLayer=Al,kr.coordsToLatLng=bc,kr.coordsToLatLngs=Nl,kr.latLngToCoords=Cl,kr.latLngsToCoords=xc,kr.getFeature=ss,kr.asFeature=To,Lt.mergeOptions({boxZoom:!0});var Sc=br.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){dt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){tn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){bt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),et(),mt(),this._startPoint=this._map.mouseEventToContainerPoint(o),dt(document,{contextmenu:ji,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=Dt("div","leaflet-zoom-box",this._container),jt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var d=new W(this._point,this._startPoint),p=d.getSize();Ne(this._box,d.min),this._box.style.width=p.x+"px",this._box.style.height=p.y+"px"},_finish:function(){this._moved&&(bt(this._box),Tn(this._container,"leaflet-crosshair")),Be(),Qt(),tn(document,{contextmenu:ji,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(f(this._resetState,this),0);var d=new te(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(d).fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Lt.addInitHook("addHandler","boxZoom",Sc),Lt.mergeOptions({doubleClickZoom:!0});var As=br.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var d=this._map,p=d.getZoom(),x=d.options.zoomDelta,S=o.originalEvent.shiftKey?p-x:p+x;d.options.doubleClickZoom==="center"?d.setZoom(S):d.setZoomAround(o.containerPoint,S)}});Lt.addInitHook("addHandler","doubleClickZoom",As),Lt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Hu=br.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new rs(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}jt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Tn(this._map._container,"leaflet-grab"),Tn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var d=me(this._map.options.maxBounds);this._offsetLimit=$(this._map.latLngToContainerPoint(d.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(d.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var d=this._lastTime=+new Date,p=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(p),this._times.push(d),this._prunePositions(d)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),d=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=d.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,d){return o-(o-d)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),d=this._offsetLimit;o.x<d.min.x&&(o.x=this._viscousLimit(o.x,d.min.x)),o.y<d.min.y&&(o.y=this._viscousLimit(o.y,d.min.y)),o.x>d.max.x&&(o.x=this._viscousLimit(o.x,d.max.x)),o.y>d.max.y&&(o.y=this._viscousLimit(o.y,d.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,d=Math.round(o/2),p=this._initialWorldOffset,x=this._draggable._newPos.x,S=(x-d+p)%o+d-p,O=(x+d+p)%o-d-p,ee=Math.abs(S+p)<Math.abs(O+p)?S:O;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ee},_onDragEnd:function(o){var d=this._map,p=d.options,x=!p.inertia||o.noInertia||this._times.length<2;if(d.fire("dragend",o),x)d.fire("moveend");else{this._prunePositions(+new Date);var S=this._lastPos.subtract(this._positions[0]),O=(this._lastTime-this._times[0])/1e3,ee=p.easeLinearity,ge=S.multiplyBy(ee/O),Se=ge.distanceTo([0,0]),Ve=Math.min(p.inertiaMaxSpeed,Se),Qe=ge.multiplyBy(Ve/Se),it=Ve/(p.inertiaDeceleration*ee),lt=Qe.multiplyBy(-it/2).round();!lt.x&&!lt.y?d.fire("moveend"):(lt=d._limitOffset(lt,d.options.maxBounds),k(function(){d.panBy(lt,{duration:it,easeLinearity:ee,noMoveStart:!0,animate:!0})}))}}});Lt.addInitHook("addHandler","dragging",Hu),Lt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var kl=br.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),dt(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),tn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,d=document.documentElement,p=o.scrollTop||d.scrollTop,x=o.scrollLeft||d.scrollLeft;this._map._container.focus(),window.scrollTo(x,p)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var d=this._panKeys={},p=this.keyCodes,x,S;for(x=0,S=p.left.length;x<S;x++)d[p.left[x]]=[-1*o,0];for(x=0,S=p.right.length;x<S;x++)d[p.right[x]]=[o,0];for(x=0,S=p.down.length;x<S;x++)d[p.down[x]]=[0,o];for(x=0,S=p.up.length;x<S;x++)d[p.up[x]]=[0,-1*o]},_setZoomDelta:function(o){var d=this._zoomKeys={},p=this.keyCodes,x,S;for(x=0,S=p.zoomIn.length;x<S;x++)d[p.zoomIn[x]]=o;for(x=0,S=p.zoomOut.length;x<S;x++)d[p.zoomOut[x]]=-o},_addHooks:function(){dt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){tn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var d=o.keyCode,p=this._map,x;if(d in this._panKeys){if(!p._panAnim||!p._panAnim._inProgress)if(x=this._panKeys[d],o.shiftKey&&(x=A(x).multiplyBy(3)),p.options.maxBounds&&(x=p._limitOffset(A(x),p.options.maxBounds)),p.options.worldCopyJump){var S=p.wrapLatLng(p.unproject(p.project(p.getCenter()).add(x)));p.panTo(S)}else p.panBy(x)}else if(d in this._zoomKeys)p.setZoom(p.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[d]);else if(d===27&&p._popup&&p._popup.options.closeOnEscapeKey)p.closePopup();else return;ji(o)}}});Lt.addInitHook("addHandler","keyboard",kl),Lt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ca=br.extend({addHooks:function(){dt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){tn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var d=Na(o),p=this._map.options.wheelDebounceTime;this._delta+=d,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var x=Math.max(p-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(f(this._performZoom,this),x),ji(o)},_performZoom:function(){var o=this._map,d=o.getZoom(),p=this._map.options.zoomSnap||0;o._stop();var x=this._delta/(this._map.options.wheelPxPerZoomLevel*4),S=4*Math.log(2/(1+Math.exp(-Math.abs(x))))/Math.LN2,O=p?Math.ceil(S/p)*p:S,ee=o._limitZoom(d+(this._delta>0?O:-O))-d;this._delta=0,this._startTime=null,ee&&(o.options.scrollWheelZoom==="center"?o.setZoom(d+ee):o.setZoomAround(this._lastMousePos,d+ee))}});Lt.addInitHook("addHandler","scrollWheelZoom",ca);var qu=600;Lt.mergeOptions({tapHold:nt.touchNative&&nt.safari&&nt.mobile,tapTolerance:15});var jc=br.extend({addHooks:function(){dt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){tn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var d=o.touches[0];this._startPos=this._newPos=new ie(d.clientX,d.clientY),this._holdTimeout=setTimeout(f(function(){this._cancel(),this._isTapValid()&&(dt(document,"touchend",wn),dt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",d))},this),qu),dt(document,"touchend touchcancel contextmenu",this._cancel,this),dt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){tn(document,"touchend",wn),tn(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),tn(document,"touchend touchcancel contextmenu",this._cancel,this),tn(document,"touchmove",this._onMove,this)},_onMove:function(o){var d=o.touches[0];this._newPos=new ie(d.clientX,d.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,d){var p=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:d.screenX,screenY:d.screenY,clientX:d.clientX,clientY:d.clientY});p._simulated=!0,d.target.dispatchEvent(p)}});Lt.addInitHook("addHandler","tapHold",jc),Lt.mergeOptions({touchZoom:nt.touch,bounceAtZoomLimits:!0});var La=br.extend({addHooks:function(){jt(this._map._container,"leaflet-touch-zoom"),dt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Tn(this._map._container,"leaflet-touch-zoom"),tn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var d=this._map;if(!(!o.touches||o.touches.length!==2||d._animatingZoom||this._zooming)){var p=d.mouseEventToContainerPoint(o.touches[0]),x=d.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=d.getSize()._divideBy(2),this._startLatLng=d.containerPointToLatLng(this._centerPoint),d.options.touchZoom!=="center"&&(this._pinchStartLatLng=d.containerPointToLatLng(p.add(x)._divideBy(2))),this._startDist=p.distanceTo(x),this._startZoom=d.getZoom(),this._moved=!1,this._zooming=!0,d._stop(),dt(document,"touchmove",this._onTouchMove,this),dt(document,"touchend touchcancel",this._onTouchEnd,this),wn(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var d=this._map,p=d.mouseEventToContainerPoint(o.touches[0]),x=d.mouseEventToContainerPoint(o.touches[1]),S=p.distanceTo(x)/this._startDist;if(this._zoom=d.getScaleZoom(S,this._startZoom),!d.options.bounceAtZoomLimits&&(this._zoom<d.getMinZoom()&&S<1||this._zoom>d.getMaxZoom()&&S>1)&&(this._zoom=d._limitZoom(this._zoom)),d.options.touchZoom==="center"){if(this._center=this._startLatLng,S===1)return}else{var O=p._add(x)._divideBy(2)._subtract(this._centerPoint);if(S===1&&O.x===0&&O.y===0)return;this._center=d.unproject(d.project(this._pinchStartLatLng,this._zoom).subtract(O),this._zoom)}this._moved||(d._moveStart(!0,!1),this._moved=!0),q(this._animRequest);var ee=f(d._move,d,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=k(ee,this,!0),wn(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,q(this._animRequest),tn(document,"touchmove",this._onTouchMove,this),tn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Lt.addInitHook("addHandler","touchZoom",La),Lt.BoxZoom=Sc,Lt.DoubleClickZoom=As,Lt.Drag=Hu,Lt.Keyboard=kl,Lt.ScrollWheelZoom=ca,Lt.TapHold=jc,Lt.TouchZoom=La,t.Bounds=W,t.Browser=nt,t.CRS=re,t.Canvas=Il,t.Circle=Fu,t.CircleMarker=jl,t.Class=de,t.Control=Hi,t.DivIcon=Bu,t.DivOverlay=as,t.DomEvent=mc,t.DomUtil=ra,t.Draggable=rs,t.Evented=ye,t.FeatureGroup=zn,t.GeoJSON=kr,t.GridLayer=Ma,t.Handler=br,t.Icon=Ss,t.ImageOverlay=js,t.LatLng=J,t.LatLngBounds=te,t.Layer=Sn,t.LayerGroup=Kn,t.LineUtil=B,t.Map=Lt,t.Marker=bo,t.Mixin=Ra,t.Path=Hs,t.Point=ie,t.PolyUtil=go,t.Polygon=xo,t.Polyline=qs,t.Popup=Rl,t.PosAnimation=Ca,t.Projection=qe,t.Rectangle=Uh,t.Renderer=ls,t.SVG=la,t.SVGOverlay=oa,t.TileLayer=ka,t.Tooltip=Ec,t.Transformation=le,t.Util=j,t.VideoOverlay=wc,t.bind=f,t.bounds=$,t.canvas=Pl,t.circle=jp,t.circleMarker=kh,t.control=Qi,t.divIcon=Vh,t.extend=l,t.featureGroup=Es,t.geoJSON=Tc,t.geoJson=Oh,t.gridLayer=os,t.icon=vc,t.imageOverlay=wo,t.latLng=oe,t.latLngBounds=me,t.layerGroup=Bs,t.map=Ts,t.marker=Uu,t.point=A,t.polygon=Mr,t.polyline=Ap,t.popup=Np,t.rectangle=Lr,t.setOptions=Z,t.stamp=_,t.svg=Da,t.svgOverlay=Lh,t.tileLayer=Or,t.tooltip=Cp,t.transformation=Re,t.version=r,t.videoOverlay=Dh;var jo=window.L;t.noConflict=function(){return window.L=jo,this},window.L=t})}(Zd,Zd.exports)),Zd.exports}var xl=s6();const na=_E(xl);function Mu(n,e,t){return Object.freeze({instance:n,context:e,container:t})}function Ep(n,e){return e==null?function(r,l){const u=E.useRef(void 0);return u.current||(u.current=n(r,l)),u}:function(r,l){const u=E.useRef(void 0);u.current||(u.current=n(r,l));const f=E.useRef(r),{instance:y}=u.current;return E.useEffect(function(){f.current!==r&&(e(y,r,f.current),f.current=r)},[y,r,e]),u}}function Mj(n,e){E.useEffect(function(){return(e.layerContainer??e.map).addLayer(n.instance),function(){e.layerContainer?.removeLayer(n.instance),e.map.removeLayer(n.instance)}},[e,n])}function kj(n){return function(t){const r=Tp(),l=n(wp(t,r),r);return Ij(r.map,t.attribution),Uv(l.current,t.eventHandlers),Mj(l.current,r),l}}function a6(n,e){const t=E.useRef(void 0);E.useEffect(function(){if(e.pathOptions!==t.current){const l=e.pathOptions??{};n.instance.setStyle(l),t.current=l}},[n,e])}function o6(n){return function(t){const r=Tp(),l=n(wp(t,r),r);return Uv(l.current,t.eventHandlers),Mj(l.current,r),a6(l.current,t),l}}function l6(n,e){const t=Ep(n,e),r=kj(t);return Pj(r)}function Oj(n,e){const t=Ep(n),r=i6(t,e);return t6(r)}function Dj(n,e){const t=Ep(n,e),r=o6(t);return Pj(r)}function c6(n,e){const t=Ep(n,e),r=kj(t);return n6(r)}function u6(n,e,t){const{opacity:r,zIndex:l}=e;r!=null&&r!==t.opacity&&n.setOpacity(r),l!=null&&l!==t.zIndex&&n.setZIndex(l)}function fc(){return Tp().map}function d6(n){const e=fc();return E.useEffect(function(){return e.on(n),function(){e.off(n)}},[e,n]),e}const h6=Dj(function({center:e,children:t,...r},l){const u=new xl.CircleMarker(e,r);return Mu(u,Lv(l,{overlayContainer:u}))},XL);function f6({bounds:n,boundsOptions:e,center:t,children:r,className:l,id:u,placeholder:f,style:y,whenReady:_,zoom:v,...w},R){const[I]=E.useState({className:l,id:u,style:y}),[G,H]=E.useState(null),Z=E.useRef(void 0);E.useImperativeHandle(R,()=>G?.map??null,[G]);const F=E.useCallback(se=>{if(se!==null&&!Z.current){const ue=new xl.Map(se,w);Z.current=ue,t!=null&&v!=null?ue.setView(t,v):n!=null&&ue.fitBounds(n,e),_!=null&&ue.whenReady(_),H(e6(ue))}},[]);E.useEffect(()=>()=>{G?.map.remove()},[G]);const Q=G?wm.createElement(Vv,{value:G},r):f??null;return wm.createElement("div",{...I,ref:F},Q)}const ku=E.forwardRef(f6),ks=l6(function({position:e,...t},r){const l=new xl.Marker(e,t);return Mu(l,Lv(r,{overlayContainer:l}))},function(e,t,r){t.position!==r.position&&e.setLatLng(t.position),t.icon!=null&&t.icon!==r.icon&&e.setIcon(t.icon),t.zIndexOffset!=null&&t.zIndexOffset!==r.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),t.opacity!=null&&t.opacity!==r.opacity&&e.setOpacity(t.opacity),e.dragging!=null&&t.draggable!==r.draggable&&(t.draggable===!0?e.dragging.enable():e.dragging.disable())}),Sp=Dj(function({positions:e,...t},r){const l=new xl.Polyline(e,t);return Mu(l,Lv(r,{overlayContainer:l}))},function(e,t,r){t.positions!==r.positions&&e.setLatLngs(t.positions)}),Sa=Oj(function(e,t){const r=new xl.Popup(e,t.overlayContainer);return Mu(r,t)},function(e,t,{position:r},l){E.useEffect(function(){const{instance:f}=e;function y(v){v.popup===f&&(f.update(),l(!0))}function _(v){v.popup===f&&l(!1)}return t.map.on({popupopen:y,popupclose:_}),t.overlayContainer==null?(r!=null&&f.setLatLng(r),f.openOn(t.map)):t.overlayContainer.bindPopup(f),function(){t.map.off({popupopen:y,popupclose:_}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(f)}},[e,t,l,r])}),Ou=c6(function({url:e,...t},r){const l=new xl.TileLayer(e,wp(t,r));return Mu(l,r)},function(e,t,r){u6(e,t,r);const{url:l}=t;l!=null&&l!==r.url&&e.setUrl(l)}),Hw=Oj(function(e,t){const r=new xl.Tooltip(e,t.overlayContainer);return Mu(r,t)},function(e,t,{position:r},l){E.useEffect(function(){const f=t.overlayContainer;if(f==null)return;const{instance:y}=e,_=w=>{w.tooltip===y&&(r!=null&&y.setLatLng(r),y.update(),l(!0))},v=w=>{w.tooltip===y&&l(!1)};return f.on({tooltipopen:_,tooltipclose:v}),f.bindTooltip(y),function(){f.off({tooltipopen:_,tooltipclose:v}),f._map!=null&&f.unbindTooltip()}},[e,t,l,r])}),m6=new na.Icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41]});function p6({onPick:n}){return d6({click(e){n(e.latlng.lat,e.latlng.lng)}}),null}function lc({value:n,onChange:e}){const[t,r]=E.useState("TEXT"),[l,u]=E.useState(""),[f,y]=E.useState(null),[_,v]=E.useState("");async function w(){if(!l.trim())return;const G=await Fw(l.trim());G&&e(G)}async function R(G,H){y({lat:G,lng:H});const Z=await zw(G,H);Z&&e(Z)}async function I(){const G=WL(_);if(G){if(G.type==="coords"){const H=await zw(G.lat,G.lng);H&&e({...H,source:"LINK_IMPORT",source_text:_})}else if(G.type==="query"){const H=await Fw(G.query);H&&e({...H,source:"LINK_IMPORT",source_text:_})}}}return a.jsxs("div",{className:"address-input",style:{display:"grid",gap:8},children:[a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{onClick:()=>r("TEXT"),disabled:t==="TEXT",children:"Escribir"}),a.jsx("button",{onClick:()=>r("MAP"),disabled:t==="MAP",children:"Mapa"}),a.jsx("button",{onClick:()=>r("IMPORT"),disabled:t==="IMPORT",children:"Importar"})]}),t==="TEXT"&&a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("input",{placeholder:"C/ Dirección, ciudad, país",value:l,onChange:G=>u(G.target.value),style:{flex:1}}),a.jsx("button",{onClick:w,children:"Geocodificar"})]}),t==="MAP"&&a.jsxs("div",{children:[a.jsxs(ku,{center:[18.4861,-69.9312],zoom:12,style:{height:300},children:[a.jsx(Ou,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a.jsx(p6,{onPick:R}),f&&a.jsx(ks,{position:[f.lat,f.lng],icon:m6})]}),a.jsx("small",{children:"Haz clic en el mapa para fijar la ubicación."})]}),t==="IMPORT"&&a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("input",{placeholder:"Pega aquí un enlace o texto (WhatsApp / Google / Waze / coords)",value:_,onChange:G=>v(G.target.value),style:{flex:1}}),a.jsx("button",{onClick:I,children:"Procesar"})]}),n&&a.jsxs("div",{style:{marginTop:8,padding:8,border:"1px solid #ddd",borderRadius:6},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Dirección:"})," ",n.formatted]}),a.jsxs("div",{children:[a.jsx("b",{children:"Coords:"})," ",n.lat?.toFixed(6),", ",n.lng?.toFixed(6)]}),a.jsxs("div",{children:[a.jsx("b",{children:"Proveedor:"})," ",n.provider," / ",a.jsx("b",{children:"Origen:"})," ",n.source]})]})]})}function g6(n={},e={}){const t=["cliente","numeroFactura","monto","fecha","hora","mensajero","vehiculo","estado","entregado","recibida","tiempoEstimado","tiempoReal","tiempoTotalEntrega","direccionTexto","destinoLat","destinoLng","address.formatted","address.lat","address.lng"],r=[];for(const l of t){const u=qw(n,l),f=qw(e,l);$w(u)!==$w(f)&&r.push({campo:l,antes:u??null,despues:f??null})}return r}function qw(n,e){return e.split(".").reduce((t,r)=>t?t[r]:void 0,n)}function $w(n){return n===void 0?null:typeof n=="string"?n.trim():n}async function xu({orderId:n,empresaId:e,antes:t,despues:r,actor:l,motivo:u}){if(!e)throw new Error("logCambioOrden: falta empresaId");const f=g6(t,r)||[];if(!f.length)return;const y={empresaId:e,orderId:n,cambios:f,actorId:l?.id||l?.uid||null,actorNombre:l?.nombre||l?.usuario||"desconocido",actorRol:l?.rol||"desconocido",motivo:u??null,ts:ut(),meta:{cliente:r?.cliente??t?.cliente??null}};await so(Bt(ze,"historialCambios"),y)}if(!document.getElementById("ordenes-entrega-soft-styles")){const n=document.createElement("style");n.id="ordenes-entrega-soft-styles",n.innerHTML=`
:root{
  --bg:#f7fafc;
  --card:#ffffff;
  --border:#eaecef;
  --text:#111827;
  --text-muted:#6b7280;
  --chip:#f5f7fa;

  --ok-bg:#ecfdf5; --ok-bd:#a7f3d0; --ok-tx:#047857;
  --warn-bg:#fff7ed; --warn-bd:#fed7aa; --warn-tx:#9a3412;
  --danger-bg:#fef2f2; --danger-bd:#fecaca; --danger-tx:#991b1b;
}
body{ background: var(--bg); color: var(--text); }

.card{
  border:1px solid var(--border);
  border-radius:12px;
  background:var(--card);
  padding:12px;
}

.muted{ color: var(--text-muted); font-size:12px; }

.btn-primary{
  background:#2563eb; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;
}
.btn-primary:disabled{ opacity:.6; cursor:not-allowed; }
.btn-ghost{
  background:#ffffff; color:#111827; border:1px solid var(--border); padding:8px 12px; border-radius:8px; cursor:pointer;
}

.tab{
  background:transparent; border:none; padding:8px 12px; border-bottom:3px solid transparent; cursor:pointer;
}
.tab-active{ border-bottom-color:#2563eb; font-weight:700; }

table.nice-table{ width:100%; border-collapse:collapse; font-size:14px; }
.nice-table thead th{
  text-align:left; background:#fafafa; position:sticky; top:0; z-index:1;
  border-bottom:1px solid var(--border); padding:8px 10px;
}
.nice-table tbody td{
  border-bottom:1px solid #000000ff; padding:8px 10px;
}
input, select{
  padding:8px 10px; border:1px solid var(--border); border-radius:8px; width:100%; background:#fff;
}
`,document.head.appendChild(n)}function y6(){try{if(document.getElementById("ordenFormCss"))return;const n=document.createElement("style");n.id="ordenFormCss",n.innerHTML=`
      .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:12px}
      .row{display:grid;gap:12px}
      .row.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
      .row.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
      .row.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
      label{font-size:12px;color:#475569;font-weight:600}
      input[type="text"],input[type="tel"],input[type="number"],input[type="date"],input[type="time"],input[type="datetime-local"],textarea,select{
        width:100%;padding:8px 10px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;color:#111827
      }
      .help{font-size:12px;color:#64748b}
      .btn{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:10px 14px;cursor:pointer}
      .btn:hover{background:#f8fafc}
      .btn.primary{background:#6366f1;border-color:#6366f1;color:#fff}
      .btn.danger{background:#ef4444;border-color:#ef4444;color:#fff}
      .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600}
      .pill.info{background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
      .err{color:#b91c1c;font-size:13px}
      .ok{color:#065f46;font-size:13px}
      .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    `,document.head.appendChild(n)}catch{}}y6();const _6=new Set(["mensajero","mensajeros","rider","riders","courier","delivery","deliveryman","repartidor","repartidores","conductor","driver"]),Xf=n=>String(n||"").trim().toLowerCase();function v6(){try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}}function b6({orden:n,ordenId:e,onUpdated:t}){const r=v6(),l=r?.empresaId!=null?String(r.empresaId):null,[u,f]=E.useState(n||null),[y,_]=E.useState([]),[v,w]=E.useState([]),[R,I]=E.useState(""),[G,H]=E.useState(!1),[Z,F]=E.useState(""),Q=n?.id||e;E.useEffect(()=>{if(n||!Q)return;let D=!0;return(async()=>{if(!await Qn()){F("Sin sesión");return}try{const k=await Jr(gt(ze,"ordenes",Q));D&&f(k.exists()?{id:Q,...k.data()}:null)}catch(k){D&&F(k?.message||"No pude cargar la orden")}})(),()=>{D=!1}},[Q,n]),E.useEffect(()=>{let D=null,U=null;return(async()=>!l||!await Qn()||(D=Kt(en(Bt(ze,"usuarios"),Nt("empresaId","==",l)),q=>{const j=q.docs.map(de=>({id:de.id,...de.data()}));_(j.filter(de=>_6.has(Xf(de.rol))))}),U=Kt(en(Bt(ze,"ubicacionesMensajeros"),Nt("empresaId","==",l)),q=>w(q.docs.map(j=>({id:j.id,...j.data()}))))))(),()=>{D&&D(),U&&U()}},[l]);const se=E.useMemo(()=>{const D=new Map;for(const U of v)D.set(String(U.id),U);return D},[v]),ue=E.useMemo(()=>{const D=Xf(R);return y.map(U=>{const k=se.get(String(U.uid||U.id)),q=Xf(k?.estado||"disponible");return{uid:String(U.uid||U.id),nombre:U.nombre||U.displayName||U.email||U.id,estado:q}}).filter(U=>!D||Xf(U.nombre).includes(D)||U.uid.includes(D)).sort((U,k)=>U.nombre.localeCompare(k.nombre))},[y,se,R]),we=u?.asignadoUid||null,Ce=u?.asignadoNombre||null;async function Ue(D,U,k="asignación"){try{await so(Bt(ze,"cambiosOrden"),{empresaId:l,orderId:D,createdAt:ut(),actorUid:r?.uid||null,actorNombre:r?.nombre||r?.email||"desconocido",actorRol:r?.rol||"",motivo:k,cambios:U.map(q=>({campo:q.campo,antes:q.antes??null,despues:q.despues??null}))})}catch(q){console.warn("logCambioOrden fallo:",q?.message)}}async function P(D){if(Q){H(!0),F("");try{await Qn();const U=[{campo:"asignadoUid",antes:we||null,despues:D.uid},{campo:"asignadoNombre",antes:Ce||null,despues:D.nombre}];await mr(gt(ze,"ordenes",Q),{asignadoUid:D.uid,asignadoNombre:D.nombre,asignadoAt:ut()}),await Ue(Q,U,"Asignación de mensajero"),f(k=>({...k||{},asignadoUid:D.uid,asignadoNombre:D.nombre})),t&&t()}catch(U){F(U?.message||"No pude asignar")}finally{H(!1)}}}async function M(){if(Q){H(!0),F("");try{await Qn();const D=[{campo:"asignadoUid",antes:we||null,despues:null},{campo:"asignadoNombre",antes:Ce||null,despues:null}];await mr(gt(ze,"ordenes",Q),{asignadoUid:null,asignadoNombre:null,asignadoAt:ut()}),await Ue(Q,D,"Desasignación"),f(U=>({...U||{},asignadoUid:null,asignadoNombre:null})),t&&t()}catch(D){F(D?.message||"No pude desasignar")}finally{H(!1)}}}return a.jsxs("section",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#fff",marginTop:12},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[a.jsx("h3",{style:{margin:0},children:"Asignación de mensajero"}),u?.numeroFactura&&a.jsxs("span",{style:{fontSize:12,color:"#666"},children:["Factura: ",a.jsx("b",{children:u.numeroFactura})]}),a.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:we?a.jsxs(a.Fragment,{children:[a.jsxs("span",{style:{fontSize:13},children:["Asignado a: ",a.jsx("b",{children:Ce})," ",a.jsxs("span",{style:{color:"#64748b"},children:["(",String(we).slice(0,6),"…)"]})]}),a.jsx("button",{onClick:M,disabled:G,title:"Quitar asignación",children:"Desasignar"})]}):a.jsx("span",{style:{fontSize:13,color:"#64748b"},children:"Sin mensajero asignado"})})]}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"end",marginTop:10,flexWrap:"wrap"},children:[a.jsxs("div",{children:[a.jsx("label",{style:{fontSize:12,color:"#334155"},children:"Buscar"}),a.jsx("br",{}),a.jsx("input",{type:"text",placeholder:"nombre o UID…",value:R,onChange:D=>I(D.target.value),style:{minWidth:220}})]}),a.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:["* Se permite asignar incluso si el mensajero está ",a.jsx("b",{children:"en ruta"}),"."]})]}),a.jsx("div",{style:{marginTop:10,maxHeight:260,overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:10},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Jf,children:"Mensajero"}),a.jsx("th",{style:Jf,children:"UID"}),a.jsx("th",{style:Jf,children:"Estado"}),a.jsx("th",{style:Jf,children:"Acción"})]})}),a.jsx("tbody",{children:ue.length?ue.map(D=>{const U=we&&String(we)===String(D.uid),k=D.estado==="en_ruta"?"#22c55e":D.estado==="listo_para_ruta"?"#6d28d9":D.estado==="disponible"?"#3b82f6":"#94a3b8";return a.jsxs("tr",{children:[a.jsx("td",{style:Pd,children:D.nombre}),a.jsxs("td",{style:{...Pd,fontFamily:"ui-monospace,Menlo,monospace"},children:[D.uid.slice(0,12),"…"]}),a.jsx("td",{style:Pd,children:a.jsx("span",{style:{display:"inline-block",padding:"2px 8px",borderRadius:12,background:k,color:"#fff",fontSize:12},children:D.estado.replaceAll("_"," ")})}),a.jsx("td",{style:Pd,children:U?a.jsx("button",{disabled:!0,className:"btn",children:"Asignado"}):a.jsx("button",{onClick:()=>P(D),disabled:G,children:"Asignar"})})]},D.uid)}):a.jsx("tr",{children:a.jsx("td",{style:Pd,colSpan:4,children:"No hay mensajeros."})})})]})}),!!Z&&a.jsx("div",{style:{color:"#b00",marginTop:8},children:Z})]})}const Jf={textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 10px",background:"#fafafa"},Pd={borderBottom:"1px solid #f2f2f2",padding:"8px 10px"},Cy="ordenes";function Gw(n){const e=String(n||"").trim().toLowerCase();return{admin:"administrador",administrador:"administrador",administrator:"administrador",operador:"operador",operator:"operador",mensajero:"mensajero",rider:"mensajero",courier:"mensajero",delivery:"mensajero",deliveryman:"mensajero",repartidor:"mensajero",gerente:"gerente",manager:"gerente"}[e]||e}function Zw(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime()}catch{}return NaN}function x6(n,e){const t=Zw(n),r=Zw(e);if(!Number.isFinite(t)||!Number.isFinite(r))return null;const l=(r-t)/6e4;return Number.isFinite(l)&&l>=0?Number(l.toFixed(2)):null}function Kw(n){if(!n)return"—";const e=String(n);return/^\d{4}$/.test(e)?e.slice(0,2)+":"+e.slice(2):e}function em(){const{id:n}=Su();rr();const e=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),t=Gw(e?.rol||"desconocido"),r=e?.empresaId!=null?String(e.empresaId):null,[l,u]=E.useState(null),[f,y]=E.useState(!0),[_,v]=E.useState(""),[w,R]=E.useState(null),[I,G]=E.useState(null),[H,Z]=E.useState(""),[F,Q]=E.useState(!1);E.useEffect(()=>{let q=null;return(async()=>{if(!await Qn()||!r){v("Sesión inválida o falta empresaId."),y(!1);return}try{const de=gt(ze,Cy,n);q=Kt(de,ae=>{if(!ae.exists()){v("No existe la orden."),y(!1);return}u({id:ae.id,...ae.data()}),v(""),y(!1)},ae=>{console.error("onSnapshot(orden):",ae),v(ae?.message||"No se pudo leer la orden."),y(!1)})}catch(de){console.error("suscripción orden error:",de),v(de?.message||"No se pudo suscribir."),y(!1)}})(),()=>{q&&q()}},[n,r]);function se(){const q=e||{};return{id:q?.id||q?.uid||null,nombre:q?.nombre||q?.usuario||"desconocido",rol:Gw(q?.rol||"desconocido"),empresaId:q?.empresaId!=null?String(q.empresaId):null}}async function ue(){if(!l)return;if(!(t==="administrador"||t==="mensajero")){alert("No tienes permisos para cambiar este estado.");return}const q=se(),j={...l},de={...l,recibida:!0,fechaRecibida:ut()};try{await mr(gt(ze,Cy,l.id),{recibida:!0,fechaRecibida:ut()}),l.asignadoUid&&await mi(gt(ze,"ubicacionesMensajeros",l.asignadoUid),{empresaId:r,estado:"en_ruta",estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0}),await xu({orderId:l.id,empresaId:r,antes:j,despues:de,actor:q,motivo:"Orden recibida"}),alert("Orden marcada como recibida.")}catch(ae){console.error("marcarRecibida:",ae),alert("No se pudo marcar como recibida.")}}function we(q){const j=q.target.files?.[0]||null;R(j||null),G(j?URL.createObjectURL(j):null)}async function Ce(){if(!l)return;if(!(t==="administrador"||t==="mensajero")){alert("No tienes permisos para registrar prueba/entregar.");return}if(!w)return alert("Selecciona una foto de prueba.");if(!r)return alert("Falta empresaId en sesión.");const q=se(),j={...l};try{Q(!0);const de=(w.name||"proof.jpg").replace(/\s+/g,"_"),ae=`proofs/${q.id||"uid"}/${l.id}/${Date.now()}_${de}`,Y=Sj(Aj,ae);await wj(Y,w,{contentType:w.type||"image/jpeg",customMetadata:{orderId:l.id,empresaId:r,actorUid:q.id||"",actorNombre:q.nombre||""}});const ye=await Ej(Y),ie=l.fechaRecibida||l.createdAt,be=x6(ie,new Date),A={proofUrl:ye,proofStoragePath:ae,proofType:"photo",proofAt:ut(),recibeNombre:H||null,entregado:!0,fechaEntregada:ut(),tiempoTotalEntrega:be,proofByUid:q.id||null,proofByNombre:q.nombre||null};await mr(gt(ze,Cy,l.id),A),l.asignadoUid&&await mi(gt(ze,"ubicacionesMensajeros",l.asignadoUid),{empresaId:r,estado:"disponible",estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0});const W={...j,...A};await xu({orderId:l.id,empresaId:r,antes:j,despues:W,actor:q,motivo:"Prueba de entrega (foto) y cierre"}),alert("Prueba registrada y orden entregada ✅"),R(null),G(null),Z("")}catch(de){console.error("registrarPODyEntregar:",de),alert(de?.message||"No se pudo registrar la prueba.")}finally{Q(!1)}}if(f)return a.jsx("div",{style:{padding:16},children:"Cargando…"});if(_)return a.jsxs("div",{style:{padding:16,color:"#b00"},children:[_," ",a.jsx("div",{style:{marginTop:8},children:a.jsx(Zt,{to:"/ordenes",children:"← Volver"})})]});if(!l)return a.jsx("div",{style:{padding:16},children:"No existe la orden."});const Ue=l.entregado?"ENTREGADA":l.recibida?"RECIBIDA":"PENDIENTE",P=l.ventanaInicio??l.ventanaInicioStop??null,M=l.ventanaFin??l.ventanaFinStop??null,D=l.prioridad??l.prioridadEntrega??null,U=t==="administrador"||t==="operador",k=U;return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h2",{style:{margin:0},children:"🔎 Detalle de Orden"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx(Zt,{className:"btn",to:"/ordenes",children:"← Volver"}),a.jsx(Zt,{className:"btn",to:`/mapa/${l.id}`,children:"🗺️ Ver en mapa"}),U&&a.jsx(Zt,{className:"btn",to:`/orden/${l.id}/editar`,children:"✏️ Editar"}),U&&a.jsx(Zt,{className:"btn",to:`/seleccionar-destino/${l.id}`,children:"📍 Seleccionar destino"})]})]}),a.jsxs("div",{style:{marginTop:10,padding:12,border:"1px solid #eee",borderRadius:8},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Orden:"})," ",l.id]}),a.jsxs("div",{children:[a.jsx("b",{children:"Cliente:"})," ",l.cliente," — ",a.jsx("b",{children:"Tel:"})," ",l.telefono||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Factura:"})," ",l.numeroFactura," — ",a.jsx("b",{children:"Monto:"})," $",l.monto]}),a.jsxs("div",{children:[a.jsx("b",{children:"Fecha/Hora:"})," ",l.fecha," ",l.hora]}),a.jsxs("div",{children:[a.jsx("b",{children:"Dirección:"})," ",l.direccionTexto||l.address?.formatted||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Asignado a:"})," ",l.asignadoNombre||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Estado:"})," ",Ue]}),a.jsxs("div",{style:{marginTop:6,display:"flex",gap:16,flexWrap:"wrap",fontSize:14,color:"#444"},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Prioridad:"})," ",D??"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Ventana:"})," ",P||M?`${Kw(P)} — ${Kw(M)}`:"—"]})]})]}),!l.recibida&&!l.entregado&&(t==="administrador"||t==="mensajero")&&a.jsx("div",{style:{marginTop:10},children:a.jsx("button",{onClick:ue,children:"✅ Marcar como Recibida"})}),k?a.jsx(b6,{orden:l,onUpdated:()=>{}}):null,a.jsxs("div",{style:{marginTop:16,padding:12,border:"1px solid #eee",borderRadius:8},children:[a.jsx("h3",{style:{marginTop:0},children:"📷 Prueba de Entrega (foto)"}),l.proofUrl?a.jsxs("div",{children:[a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("b",{children:"Registrada:"})," ",l.proofAt?.toDate?l.proofAt.toDate().toLocaleString():"—"]}),a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("b",{children:"Recibido por:"})," ",l.recibeNombre||"—"]}),a.jsx("a",{href:l.proofUrl,target:"_blank",rel:"noopener noreferrer",children:a.jsx("img",{src:l.proofUrl,alt:"Prueba de entrega",style:{maxWidth:360,maxHeight:360,borderRadius:8,border:"1px solid #ddd"}})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(2, minmax(220px,1fr))"},children:[a.jsxs("div",{children:[a.jsx("label",{children:a.jsx("b",{children:"Foto (cámara o galería)"})}),a.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:we,disabled:F||!(t==="administrador"||t==="mensajero")}),I&&a.jsx("div",{style:{marginTop:8},children:a.jsx("img",{src:I,alt:"preview",style:{maxWidth:240,maxHeight:240,borderRadius:8,border:"1px solid #ddd"}})})]}),a.jsxs("div",{children:[a.jsx("label",{children:a.jsx("b",{children:"Recibe (nombre opcional)"})}),a.jsx("input",{type:"text",placeholder:"Nombre de quien recibe",value:H,onChange:q=>Z(q.target.value),disabled:F||!(t==="administrador"||t==="mensajero"),style:{width:"100%"}})]})]}),a.jsx("div",{style:{marginTop:10},children:(t==="administrador"||t==="mensajero")&&!l.entregado&&a.jsx("button",{onClick:Ce,disabled:F||!w,children:F?"Subiendo…":"Registrar prueba y ENTREGAR"})})]})]})]})}function Ry(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const e=new Date(n).getTime();if(Number.isFinite(e))return e}}catch{}return NaN}function Iy(n){return Number.isFinite(n)?new Date(n).toLocaleString():"—"}function Ww(n){if(n==null)return"—";if(typeof n=="object")try{return JSON.stringify(n)}catch{return String(n)}return String(n)}function T6(n,e){try{if(n===e)return!0;const t=typeof n=="object"?JSON.stringify(n):String(n??""),r=typeof e=="object"?JSON.stringify(e):String(e??"");return t===r}catch{return!1}}function Yw(n,e){if(!e?.length)return;const t=Object.keys(e[0]),r=[t.join(","),...e.map(y=>t.map(_=>`"${String(y[_]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(l),f=document.createElement("a");f.href=u,f.download=n,f.click(),URL.revokeObjectURL(u)}const Gi={textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 10px",background:"#fafafa"},dr={borderBottom:"1px solid #f2f2f2",padding:"8px 10px"},tm={...dr,fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace"},w6={...dr,textAlign:"center"},E6=new Set(["mensajero","mensajeros","rider","riders","courier","delivery","deliveryman","repartidor","repartidores","conductor","driver"]),S6=n=>String(n||"").trim().toLowerCase(),Py=n=>E6.has(S6(n))?"mensajero":"operador";try{if(!document.getElementById("historialCambiosCss")){const n=document.createElement("style");n.id="historialCambiosCss",n.innerHTML=`
      .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:12px}
      .tbl{border:1px solid #e5e7eb;border-radius:10px;overflow:hidden;background:#fff}
      .tbl tbody tr:nth-child(odd) td{background:#fbfdff}
      .tbl tbody tr:hover td{background:#eef2ff}
      .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600;line-height:1}
      .pill.blue{background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
      .pill.green{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}
      .pill.gray{background:#f1f5f9;border-color:#e2e8f0;color:#334155}
      .pill.orange{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
      .pill.purple{background:#f5f3ff;border-color:#ddd6fe;color:#6d28d9}
      .tag{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;font-size:11px;color:#475569;margin:2px 4px 0 0}
      .btn{background:#fff;color:#374151;border:1px solid #e5e7eb;border-radius:10px;padding:8px 12px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:6px}
      .btn:hover{background:#f8fafc}
      .btn.primary{background:#6366f1;border-color:#6366f1;color:#fff}
      .btn.primary:hover{filter:brightness(.96)}
      .actions{display:flex;gap:8px;flex-wrap:wrap}
      .row-msg td{box-shadow: inset 4px 0 0 0 #16a34a66}
      .row-op td{box-shadow: inset 4px 0 0 0 #6d28d966}
    `,document.head.appendChild(n)}}catch{}function Qw(){const[n]=N_();let e=null;try{e=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const t=e?.empresaId!=null&&e?.empresaId!==""?String(e.empresaId):null,r=new Date,l=new Date(r.getFullYear(),r.getMonth(),1),[u,f]=E.useState(l.toISOString().slice(0,10)),[y,_]=E.useState(r.toISOString().slice(0,10)),v=(n.get("orderId")||"").trim(),[w,R]=E.useState(v),[I,G]=E.useState(!0),[H,Z]=E.useState("todos"),[F,Q]=E.useState([]),[se,ue]=E.useState(!1),[we,Ce]=E.useState(""),[Ue,P]=E.useState({fromCache:!1,pendingLocal:0,total:0});function M(){R(""),f("2000-01-01"),_(new Date().toISOString().slice(0,10)),Z("todos")}E.useEffect(()=>{let j=null;return(async()=>{if(ue(!0),Ce(""),!await Qn()||!t){Ce("Sesión inválida o falta empresaId."),ue(!1);return}try{const ae=Bt(ze,"cambiosOrden"),Y=en(ae,Nt("empresaId","==",t),Fr("createdAt","desc"));j=Kt(Y,ye=>{const ie=ye.docs.map(A=>({id:A.id,...A.data(),__pending:A.metadata.hasPendingWrites===!0}));Q(ie);const be=ie.reduce((A,W)=>A+(W.__pending?1:0),0);P({fromCache:ye.metadata.fromCache,pendingLocal:be,total:ie.length}),ue(!1)},ye=>{console.error("onSnapshot(cambiosOrden):",ye?.code,ye?.message),Ce(ye?.message||"No se pudo leer el historial (verifica índice empresaId+createdAt y reglas)."),ue(!1)})}catch(ae){console.error("query(cambiosOrden) error:",ae),Ce(ae?.message||"No se pudo iniciar la suscripción."),ue(!1)}})(),()=>{j&&j()}},[t]);const D=E.useMemo(()=>{const j=new Date(u);j.setHours(0,0,0,0);const de=new Date(y);de.setHours(23,59,59,999);const ae=j.getTime(),Y=de.getTime(),ye=(w||"").trim().toLowerCase(),ie=new Map;for(const A of F){const W=Ry(A.createdAt);if(Number.isFinite(W)&&(W<ae||W>Y))continue;const $=String(A.orderId||"—");if(ye&&$.toLowerCase()!==ye)continue;const te=Py(A.actorRol),me=ie.get($)||{m:!1,o:!1};te==="mensajero"?me.m=!0:me.o=!0,ie.set($,me)}const be=new Set;for(const[A,W]of ie.entries())W.m&&W.o&&be.add(A);return be},[F,u,y,w]),U=E.useMemo(()=>{if(!Array.isArray(F))return[];const j=new Date(u);j.setHours(0,0,0,0);const de=new Date(y);de.setHours(23,59,59,999);const ae=j.getTime(),Y=de.getTime(),ye=(w||"").trim().toLowerCase(),ie=[];for(const be of F){const A=Ry(be.createdAt);if(Number.isFinite(A)&&(A<ae||A>Y))continue;const W=String(be.orderId||"—");if(ye&&W.toLowerCase()!==ye)continue;const $=Py(be.actorRol);if(H==="mensajero"&&$!=="mensajero"||H==="operador"&&$!=="operador"||H==="mixto"&&!D.has(W))continue;const te={_logId:be.id,orderId:W,actor:be.actorNombre||"desconocido",rol:be.actorRol||"—",actorTipo:$,createdAtMs:A,createdAtStr:Iy(A),motivo:be.motivo||""},me=Array.isArray(be.cambios)?be.cambios:[];if(!me.length)ie.push({...te,campo:"(sin detalle)",antes:"",despues:""});else for(const J of me)I&&T6(J?.antes,J?.despues)||ie.push({...te,campo:J?.campo||"—",antes:Ww(J?.antes),despues:Ww(J?.despues)})}return ie.sort((be,A)=>(A.createdAtMs||0)-(be.createdAtMs||0)),ie},[F,u,y,w,I,H,D]),k=E.useMemo(()=>{if(!Array.isArray(F))return[];const j=new Date(u);j.setHours(0,0,0,0);const de=new Date(y);de.setHours(23,59,59,999);const ae=j.getTime(),Y=de.getTime(),ye=(w||"").trim().toLowerCase(),ie=new Map;for(const A of F){const W=Ry(A.createdAt);if(Number.isFinite(W)&&(W<ae||W>Y))continue;const $=String(A.orderId||"—");if(ye&&$.toLowerCase()!==ye)continue;ie.has($)||ie.set($,{orderId:$,totalCambios:0,firstMs:Number.POSITIVE_INFINITY,lastMs:0,campos:new Set,actores:new Set,motivos:new Set,editsMensajero:0,editsOperador:0,ultActor:null,ultRol:null});const te=ie.get($);Py(A.actorRol)==="mensajero"?te.editsMensajero+=1:te.editsOperador+=1;const J=Array.isArray(A.cambios)&&A.cambios.length?A.cambios:[{campo:"(sin detalle)"}];for(const oe of J)te.totalCambios+=1,oe?.campo&&te.campos.add(String(oe.campo));A.actorNombre&&te.actores.add(String(A.actorNombre)),A.motivo&&te.motivos.add(String(A.motivo)),Number.isFinite(W)&&(W<te.firstMs&&(te.firstMs=W),W>te.lastMs&&(te.lastMs=W,te.ultActor=A.actorNombre||null,te.ultRol=A.actorRol||null))}let be=Array.from(ie.values()).map(A=>({orderId:A.orderId,totalCambios:A.totalCambios,camposCount:A.campos.size,campos:Array.from(A.campos),actores:Array.from(A.actores),motivos:Array.from(A.motivos),firstMs:A.firstMs,lastMs:A.lastMs,firstStr:Iy(A.firstMs),lastStr:Iy(A.lastMs),editsMensajero:A.editsMensajero,editsOperador:A.editsOperador,mixto:A.editsMensajero>0&&A.editsOperador>0,ultActor:A.ultActor,ultRol:A.ultRol}));return H==="mensajero"?be=be.filter(A=>A.editsMensajero>0&&A.editsOperador===0):H==="operador"?be=be.filter(A=>A.editsOperador>0&&A.editsMensajero===0):H==="mixto"&&(be=be.filter(A=>A.mixto)),be.sort((A,W)=>(W.lastMs||0)-(A.lastMs||0)),be},[F,u,y,w,H]),q=F.length;return U.length,a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[a.jsx("h2",{style:{margin:0},children:"🗂️ Historial de cambios"}),a.jsx("button",{className:"btn",onClick:M,children:"👁️ Ver TODOS los cambios"}),a.jsx("div",{style:{marginLeft:"auto"},children:a.jsx(Zt,{className:"btn",to:"/ordenes",children:"← Volver a Órdenes"})})]}),a.jsx("div",{className:"card",style:{marginTop:10},children:a.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[a.jsxs("span",{className:"pill gray",children:["cache: ",a.jsx("b",{children:String(Ue.fromCache)})]}),a.jsxs("span",{className:"pill blue",children:["pendientes: ",a.jsx("b",{children:Ue.pendingLocal})]}),a.jsxs("span",{className:"pill green",children:["docs: ",a.jsx("b",{children:Ue.total})]})]})}),a.jsx("h3",{style:{marginTop:16},children:"Filtros"}),a.jsxs("div",{className:"card",style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap",marginTop:6},children:[a.jsxs("div",{children:[a.jsx("label",{children:"Desde"}),a.jsx("br",{}),a.jsx("input",{type:"date",value:u,onChange:j=>f(j.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Hasta"}),a.jsx("br",{}),a.jsx("input",{type:"date",value:y,onChange:j=>_(j.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Order ID"}),a.jsx("br",{}),a.jsx("input",{type:"text",placeholder:"abc123…",value:w,onChange:j=>R(j.target.value),style:{minWidth:180}})]}),a.jsxs("label",{style:{marginLeft:8},children:[a.jsx("input",{type:"checkbox",checked:I,onChange:j=>G(j.target.checked)})," ","Sólo diferencias (antes ≠ después)"]}),a.jsxs("div",{style:{marginLeft:8},children:[a.jsx("label",{children:"Quién editó"}),a.jsx("br",{}),a.jsxs("select",{value:H,onChange:j=>Z(j.target.value),children:[a.jsx("option",{value:"todos",children:"Todos"}),a.jsx("option",{value:"mensajero",children:"Solo mensajero"}),a.jsx("option",{value:"operador",children:"Solo operador"}),a.jsx("option",{value:"mixto",children:"Órdenes mixtas (ambos)"})]})]}),a.jsxs("div",{style:{marginLeft:"auto"},className:"actions",children:[a.jsx("button",{className:"btn",onClick:()=>Yw(`cambios_${u}_a_${y}${w?"_order_"+w:""}.csv`,U.map(j=>({fecha:j.createdAtStr,orderId:j.orderId,campo:j.campo,antes:j.antes,despues:j.despues,actor:j.actor,rol:j.rol,actorTipo:j.actorTipo,motivo:j.motivo}))),disabled:!U.length,children:"⬇️ Exportar CSV (detalle)"}),a.jsx("button",{className:"btn",onClick:()=>Yw(`ordenes_cambiadas_${u}_a_${y}${w?"_order_"+w:""}.csv`,k.map(j=>({orderId:j.orderId,totalCambios:j.totalCambios,camposTocados:j.campos.join(" | "),actores:j.actores.join(" | "),motivos:j.motivos.join(" | "),primerCambio:j.firstStr,ultimoCambio:j.lastStr,editsMensajero:j.editsMensajero,editsOperador:j.editsOperador,mixto:j.mixto?"sí":"no",ultimoEditor:j.ultActor,ultimoRol:j.ultRol}))),disabled:!k.length,children:"⬇️ Exportar CSV (resumen)"})]})]}),se&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),!!we&&a.jsx("div",{style:{marginTop:8,color:"#b00"},children:we}),a.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#666"},children:["Logs totales: ",a.jsx("b",{children:q})," · Filas visibles (detalle): ",a.jsx("b",{children:U.length})," · Órdenes cambiadas (resumen): ",a.jsx("b",{children:k.length})]}),a.jsxs("section",{style:{marginTop:16},children:[a.jsx("h3",{style:{margin:"8px 0"},children:"▶ Órdenes cambiadas (resumen)"}),a.jsx("div",{style:{overflowX:"auto"},children:k.length?a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Gi,children:"Orden"}),a.jsx("th",{style:Gi,children:"Total cambios"}),a.jsx("th",{style:Gi,children:"Tipo de ediciones"}),a.jsx("th",{style:Gi,children:"Campos tocados"}),a.jsx("th",{style:Gi,children:"Actores"}),a.jsx("th",{style:Gi,children:"Motivos"}),a.jsx("th",{style:Gi,children:"Primer cambio"}),a.jsx("th",{style:Gi,children:"Último cambio"}),a.jsx("th",{style:Gi,children:"Último editor"}),a.jsx("th",{style:Gi,children:"Acciones"})]})}),a.jsx("tbody",{children:k.map(j=>a.jsxs("tr",{children:[a.jsx("td",{style:{...tm,whiteSpace:"nowrap"},children:j.orderId}),a.jsx("td",{style:{...dr,fontWeight:600},children:j.totalCambios}),a.jsxs("td",{style:dr,children:[j.editsMensajero>0&&a.jsxs("span",{className:"pill green",children:["Mensajero: ",j.editsMensajero]})," ",j.editsOperador>0&&a.jsxs("span",{className:"pill purple",children:["Operador: ",j.editsOperador]})," ",j.mixto&&a.jsx("span",{className:"pill blue",children:"Mixto"})]}),a.jsx("td",{style:dr,children:j.campos.length?j.campos.map(de=>a.jsx("span",{className:"tag",children:de},`${j.orderId}-c-${de}`)):"—"}),a.jsx("td",{style:dr,children:j.actores.length?j.actores.map(de=>a.jsx("span",{className:"tag",children:de},`${j.orderId}-a-${de}`)):"—"}),a.jsx("td",{style:dr,children:j.motivos.length?j.motivos.map(de=>a.jsx("span",{className:"tag",children:de},`${j.orderId}-m-${de}`)):"—"}),a.jsx("td",{style:dr,children:j.firstStr}),a.jsx("td",{style:dr,children:j.lastStr}),a.jsx("td",{style:dr,children:j.ultActor?a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx("b",{children:j.ultActor})}),a.jsx("div",{className:"pill purple",style:{display:"inline-block",marginTop:4},children:j.ultRol||"—"})]}):"—"}),a.jsx("td",{style:dr,children:a.jsxs("div",{className:"actions",children:[a.jsx("button",{className:"btn",title:"Filtrar la vista detallada por esta orden",onClick:()=>R(j.orderId),children:"Ver cambios"}),a.jsx(Zt,{className:"btn",to:`/orden/${j.orderId}`,children:"Ver orden"}),a.jsx(Zt,{className:"btn primary",to:`/mapa/${j.orderId}`,children:"Ver mapa"})]})})]},`grp-${j.orderId}`))})]}):a.jsx("div",{className:"card",children:"No hay órdenes con cambios en el rango/criterio."})})]}),a.jsxs("section",{style:{marginTop:22},children:[a.jsx("h3",{style:{margin:"8px 0"},children:"▶ Cambios detallados"}),a.jsx("div",{style:{overflowX:"auto",marginTop:8},children:a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:Gi,children:"Fecha"}),a.jsx("th",{style:Gi,children:"Orden"}),a.jsx("th",{style:Gi,children:"Campo"}),a.jsx("th",{style:Gi,children:"Antes"}),a.jsx("th",{style:Gi,children:"Después"}),a.jsx("th",{style:Gi,children:"Actor"}),a.jsx("th",{style:Gi,children:"Rol"}),a.jsx("th",{style:Gi,children:"Motivo"}),a.jsx("th",{style:Gi,children:"Acciones"})]})}),a.jsx("tbody",{children:U.length?U.map((j,de)=>a.jsxs("tr",{className:j.actorTipo==="mensajero"?"row-msg":"row-op",children:[a.jsx("td",{style:dr,children:j.createdAtStr}),a.jsx("td",{style:{...tm,whiteSpace:"nowrap"},children:j.orderId}),a.jsx("td",{style:dr,children:j.campo}),a.jsx("td",{style:tm,children:j.antes}),a.jsx("td",{style:tm,children:j.despues}),a.jsx("td",{style:dr,children:j.actor}),a.jsx("td",{style:w6,children:j.actorTipo==="mensajero"?a.jsx("span",{className:"pill green",children:j.rol||"Mensajero"}):a.jsx("span",{className:"pill purple",children:j.rol||"Operador"})}),a.jsx("td",{style:dr,children:j.motivo?a.jsx("span",{className:"pill blue",children:j.motivo}):"—"}),a.jsx("td",{style:dr,children:a.jsxs("div",{className:"actions",children:[a.jsx(Zt,{className:"btn",to:`/orden/${j.orderId}`,children:"Ver orden"}),a.jsx(Zt,{className:"btn primary",to:`/mapa/${j.orderId}`,children:"Ver mapa"})]})})]},`${j._logId}-${de}`)):a.jsx("tr",{children:a.jsx("td",{style:dr,colSpan:9,children:"No hay cambios en el rango/criterio seleccionado."})})})]})})]}),a.jsxs("div",{style:{marginTop:20,fontSize:12,color:"#666"},children:["* Este módulo solo ",a.jsx("b",{children:"lee"})," ",a.jsx("code",{children:"cambiosOrden"})," de tu empresa (",a.jsx("code",{children:"empresaId"})," coincide). Para registrar cambios, usa ",a.jsx("code",{children:"logCambioOrden()"}),"."]})]})}function j6(){if(document.getElementById("unifiedOrdersCss"))return;const n=document.createElement("style");n.id="unifiedOrdersCss",n.innerHTML=`
    .unified-orders-container { padding: 20px; max-width: 1200px; margin: 0 auto; }
    .order-type-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
    .tab { padding: 12px 20px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; cursor: pointer; transition: all 0.2s; }
    .tab.active { background: #6366f1; color: white; border-color: #6366f1; }
    .tab:hover:not(.active) { background: #f8fafc; }
    
    .form-section { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .section-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #111827; }
    
    .form-grid { display: grid; gap: 16px; }
    .form-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
    .form-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
    
    .form-group { display: flex; flex-direction: column; gap: 4px; }
    .form-label { font-size: 12px; font-weight: 600; color: #475569; }
    .form-input { padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
    .form-input:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
    
    .stops-container { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
    .stop-item { padding: 16px; border-bottom: 1px solid #e5e7eb; background: #f8fafc; }
    .stop-item:last-child { border-bottom: none; }
    .stop-header { display: flex; justify-content: between; align-items: center; margin-bottom: 12px; }
    .stop-number { background: #6366f1; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }
    
    .add-stop-btn { background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; }
    .add-stop-btn:hover { background: #059669; }
    .remove-stop-btn { background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .remove-stop-btn:hover { background: #dc2626; }
    
    .btn { padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: #6366f1; color: white; border: 1px solid #6366f1; }
    .btn-primary:hover { background: #5856eb; }
    .btn-secondary { background: #fff; color: #374151; border: 1px solid #e5e7eb; }
    .btn-secondary:hover { background: #f8fafc; }
    
    .orders-list { margin-top: 30px; }
    .order-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px; }
    .order-header { display: flex; justify-content: between; align-items: center; margin-bottom: 8px; }
    .order-id { font-weight: 600; color: #111827; }
    .order-status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-assigned { background: #dbeafe; color: #1e40af; }
    .status-in-progress { background: #fde68a; color: #b45309; }
    .status-completed { background: #d1fae5; color: #065f46; }
    
    .stops-summary { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .stop-badge { background: #f3f4f6; color: #374151; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
    
    .error { color: #ef4444; font-size: 14px; margin-top: 8px; }
    .success { color: #10b981; font-size: 14px; margin-top: 8px; }
  `,document.head.appendChild(n)}function My(){j6(),N_();const n=rr(),e=Qn();if(!e)return n("/login"),null;const[t,r]=E.useState("basic"),[l,u]=E.useState([]),[f,y]=E.useState(!1),[_,v]=E.useState(!1),[w,R]=E.useState(""),[I,G]=E.useState(""),[H,Z]=E.useState({cliente:"",telefono:"",direccionTexto:"",addressLat:"",addressLng:"",monto:"",numeroFactura:"",fecha:"",hora:"",notas:""}),[F,Q]=E.useState({cliente:"",telefono:"",numeroFactura:"",monto:"",fecha:"",hora:"",prioridad:3,notas:"",stops:[{id:1,tipo:"pickup",direccionTexto:"",addressLat:"",addressLng:"",contacto:"",telefonoContacto:"",ventanaInicio:"",ventanaFin:"",instrucciones:"",requiereConfirmacion:!1}]});E.useMemo(()=>cl(hu,"createOrder"),[]),E.useEffect(()=>{y(!0);const P=en(Bt(ze,"ordenes"),Nt("empresaId","==",e.empresaId),Fr("fechaCreacion","desc")),M=Kt(P,D=>{const U=D.docs.map(k=>({id:k.id,...k.data()}));u(U),y(!1)});return()=>M()},[e.empresaId]);const se=()=>{Q(P=>({...P,stops:[...P.stops,{id:Date.now(),tipo:"delivery",direccionTexto:"",addressLat:"",addressLng:"",contacto:"",telefonoContacto:"",ventanaInicio:"",ventanaFin:"",instrucciones:"",requiereConfirmacion:!1}]}))},ue=P=>{Q(M=>({...M,stops:M.stops.filter(D=>D.id!==P)}))},we=(P,M,D)=>{Q(U=>({...U,stops:U.stops.map(k=>k.id===P?{...k,[M]:D}:k)}))},Ce=async()=>{try{if(v(!0),R(""),G(""),!H.cliente.trim())throw new Error("El nombre del cliente es requerido");if(!H.direccionTexto.trim())throw new Error("La dirección es requerida");const P={...H,empresaId:e.empresaId,creadoPor:e.uid,tipo:"basica",estado:"pendiente",fechaCreacion:ut(),stops:[{id:1,tipo:"delivery",direccionTexto:H.direccionTexto,addressLat:H.addressLat,addressLng:H.addressLng,contacto:H.cliente,telefonoContacto:H.telefono,instrucciones:H.notas||"",requiereConfirmacion:!1}]};await so(Bt(ze,"ordenes"),P),G("Orden básica creada exitosamente"),Z({cliente:"",telefono:"",direccionTexto:"",addressLat:"",addressLng:"",monto:"",numeroFactura:"",fecha:"",hora:"",notas:""})}catch(P){R(P.message)}finally{v(!1)}},Ue=async()=>{try{if(v(!0),R(""),G(""),!F.cliente.trim())throw new Error("El nombre del cliente es requerido");if(F.stops.length===0)throw new Error("Debe agregar al menos una parada");if(F.stops.some(D=>!D.direccionTexto.trim()))throw new Error("Todas las paradas deben tener una dirección");const M={...F,empresaId:e.empresaId,creadoPor:e.uid,tipo:"avanzada",estado:"pendiente",fechaCreacion:ut()};await so(Bt(ze,"ordenes"),M),G("Orden avanzada creada exitosamente"),Q({cliente:"",telefono:"",numeroFactura:"",monto:"",fecha:"",hora:"",prioridad:3,notas:"",stops:[{id:1,tipo:"pickup",direccionTexto:"",addressLat:"",addressLng:"",contacto:"",telefonoContacto:"",ventanaInicio:"",ventanaFin:"",instrucciones:"",requiereConfirmacion:!1}]})}catch(P){R(P.message)}finally{v(!1)}};return a.jsxs("div",{className:"unified-orders-container",children:[a.jsx("h1",{style:{fontSize:"24px",fontWeight:"600",marginBottom:"20px"},children:"📦 Gestión de Órdenes y Entregas"}),a.jsxs("div",{className:"order-type-tabs",children:[a.jsx("button",{className:`tab ${t==="basic"?"active":""}`,onClick:()=>r("basic"),children:"🚚 Orden Básica"}),a.jsx("button",{className:`tab ${t==="advanced"?"active":""}`,onClick:()=>r("advanced"),children:"🗺️ Orden Avanzada (Multi-Stop)"}),a.jsx("button",{className:`tab ${t==="list"?"active":""}`,onClick:()=>r("list"),children:"📋 Lista de Órdenes"})]}),w&&a.jsx("div",{className:"error",children:w}),I&&a.jsx("div",{className:"success",children:I}),t==="basic"&&a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"section-title",children:"Crear Orden Básica"}),a.jsx("p",{style:{color:"#64748b",marginBottom:"20px"},children:"Formulario simple para órdenes con un solo destino"}),a.jsxs("div",{className:"form-grid cols-2",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Cliente *"}),a.jsx("input",{type:"text",className:"form-input",value:H.cliente,onChange:P=>Z(M=>({...M,cliente:P.target.value})),placeholder:"Nombre del cliente"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Teléfono"}),a.jsx("input",{type:"tel",className:"form-input",value:H.telefono,onChange:P=>Z(M=>({...M,telefono:P.target.value})),placeholder:"Número de teléfono"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Número de Factura"}),a.jsx("input",{type:"text",className:"form-input",value:H.numeroFactura,onChange:P=>Z(M=>({...M,numeroFactura:P.target.value})),placeholder:"Número de factura"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Monto"}),a.jsx("input",{type:"number",className:"form-input",value:H.monto,onChange:P=>Z(M=>({...M,monto:P.target.value})),placeholder:"0.00",step:"0.01"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Fecha"}),a.jsx("input",{type:"date",className:"form-input",value:H.fecha,onChange:P=>Z(M=>({...M,fecha:P.target.value}))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Hora"}),a.jsx("input",{type:"time",className:"form-input",value:H.hora,onChange:P=>Z(M=>({...M,hora:P.target.value}))})]})]}),a.jsxs("div",{className:"form-group",style:{marginTop:"16px"},children:[a.jsx("label",{className:"form-label",children:"Dirección de Entrega *"}),a.jsx(lc,{value:{texto:H.direccionTexto,lat:H.addressLat,lng:H.addressLng},onChange:P=>{Z(M=>({...M,direccionTexto:P.texto||"",addressLat:P.lat||"",addressLng:P.lng||""}))}})]}),a.jsxs("div",{className:"form-group",style:{marginTop:"16px"},children:[a.jsx("label",{className:"form-label",children:"Notas"}),a.jsx("textarea",{className:"form-input",value:H.notas,onChange:P=>Z(M=>({...M,notas:P.target.value})),placeholder:"Instrucciones especiales...",rows:"3"})]}),a.jsx("div",{style:{marginTop:"20px"},children:a.jsx("button",{className:"btn btn-primary",onClick:Ce,disabled:_,children:_?"Creando...":"Crear Orden Básica"})})]}),t==="advanced"&&a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"section-title",children:"Crear Orden Avanzada (Multi-Stop)"}),a.jsx("p",{style:{color:"#64748b",marginBottom:"20px"},children:"Formulario completo para órdenes con múltiples paradas y opciones avanzadas"}),a.jsxs("div",{className:"form-grid cols-3",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Cliente *"}),a.jsx("input",{type:"text",className:"form-input",value:F.cliente,onChange:P=>Q(M=>({...M,cliente:P.target.value})),placeholder:"Nombre del cliente"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Teléfono"}),a.jsx("input",{type:"tel",className:"form-input",value:F.telefono,onChange:P=>Q(M=>({...M,telefono:P.target.value})),placeholder:"Número de teléfono"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Número de Factura"}),a.jsx("input",{type:"text",className:"form-input",value:F.numeroFactura,onChange:P=>Q(M=>({...M,numeroFactura:P.target.value})),placeholder:"Número de factura"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Monto"}),a.jsx("input",{type:"number",className:"form-input",value:F.monto,onChange:P=>Q(M=>({...M,monto:P.target.value})),placeholder:"0.00",step:"0.01"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Fecha"}),a.jsx("input",{type:"date",className:"form-input",value:F.fecha,onChange:P=>Q(M=>({...M,fecha:P.target.value}))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Hora"}),a.jsx("input",{type:"time",className:"form-input",value:F.hora,onChange:P=>Q(M=>({...M,hora:P.target.value}))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Prioridad"}),a.jsxs("select",{className:"form-input",value:F.prioridad,onChange:P=>Q(M=>({...M,prioridad:parseInt(P.target.value)})),children:[a.jsx("option",{value:1,children:"🔴 Muy Alta"}),a.jsx("option",{value:2,children:"🟡 Alta"}),a.jsx("option",{value:3,children:"🟢 Normal"}),a.jsx("option",{value:4,children:"🔵 Baja"}),a.jsx("option",{value:5,children:"⚪ Muy Baja"})]})]})]}),a.jsxs("div",{style:{marginTop:"24px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"between",alignItems:"center",marginBottom:"16px"},children:[a.jsx("h3",{style:{fontSize:"16px",fontWeight:"600"},children:"Paradas de la Entrega"}),a.jsx("button",{className:"add-stop-btn",onClick:se,children:"+ Agregar Parada"})]}),a.jsx("div",{className:"stops-container",children:F.stops.map((P,M)=>a.jsxs("div",{className:"stop-item",children:[a.jsxs("div",{className:"stop-header",children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("div",{className:"stop-number",children:M+1}),a.jsxs("select",{className:"form-input",style:{width:"auto",minWidth:"120px"},value:P.tipo,onChange:D=>we(P.id,"tipo",D.target.value),children:[a.jsx("option",{value:"pickup",children:"📦 Recogida"}),a.jsx("option",{value:"delivery",children:"🚚 Entrega"})]})]}),F.stops.length>1&&a.jsx("button",{className:"remove-stop-btn",onClick:()=>ue(P.id),children:"Eliminar"})]}),a.jsxs("div",{className:"form-grid cols-2",style:{marginBottom:"12px"},children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Contacto"}),a.jsx("input",{type:"text",className:"form-input",value:P.contacto,onChange:D=>we(P.id,"contacto",D.target.value),placeholder:"Nombre del contacto"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Teléfono"}),a.jsx("input",{type:"tel",className:"form-input",value:P.telefonoContacto,onChange:D=>we(P.id,"telefonoContacto",D.target.value),placeholder:"Teléfono del contacto"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Ventana Inicio"}),a.jsx("input",{type:"datetime-local",className:"form-input",value:P.ventanaInicio,onChange:D=>we(P.id,"ventanaInicio",D.target.value)})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Ventana Fin"}),a.jsx("input",{type:"datetime-local",className:"form-input",value:P.ventanaFin,onChange:D=>we(P.id,"ventanaFin",D.target.value)})]})]}),a.jsxs("div",{className:"form-group",style:{marginBottom:"12px"},children:[a.jsx("label",{className:"form-label",children:"Dirección *"}),a.jsx(lc,{value:{texto:P.direccionTexto,lat:P.addressLat,lng:P.addressLng},onChange:D=>{we(P.id,"direccionTexto",D.texto||""),we(P.id,"addressLat",D.lat||""),we(P.id,"addressLng",D.lng||"")}})]}),a.jsxs("div",{className:"form-group",style:{marginBottom:"12px"},children:[a.jsx("label",{className:"form-label",children:"Instrucciones Especiales"}),a.jsx("textarea",{className:"form-input",value:P.instrucciones,onChange:D=>we(P.id,"instrucciones",D.target.value),placeholder:"Instrucciones para esta parada...",rows:"2"})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("input",{type:"checkbox",checked:P.requiereConfirmacion,onChange:D=>we(P.id,"requiereConfirmacion",D.target.checked)}),a.jsx("label",{style:{fontSize:"14px",color:"#374151"},children:"Requiere confirmación del destinatario"})]})]},P.id))})]}),a.jsxs("div",{className:"form-group",style:{marginTop:"16px"},children:[a.jsx("label",{className:"form-label",children:"Notas Generales"}),a.jsx("textarea",{className:"form-input",value:F.notas,onChange:P=>Q(M=>({...M,notas:P.target.value})),placeholder:"Notas generales para toda la orden...",rows:"3"})]}),a.jsx("div",{style:{marginTop:"20px"},children:a.jsx("button",{className:"btn btn-primary",onClick:Ue,disabled:_,children:_?"Creando...":"Crear Orden Avanzada"})})]}),t==="list"&&a.jsxs("div",{className:"orders-list",children:[a.jsx("h2",{className:"section-title",children:"Lista de Órdenes"}),f?a.jsx("p",{children:"Cargando órdenes..."}):l.length===0?a.jsx("p",{style:{color:"#64748b"},children:"No hay órdenes creadas aún."}):a.jsx("div",{children:l.map(P=>a.jsxs("div",{className:"order-card",children:[a.jsxs("div",{className:"order-header",children:[a.jsxs("div",{className:"order-id",children:["#",P.id]}),a.jsx("div",{className:`order-status status-${P.estado||"pending"}`,children:P.estado||"Pendiente"})]}),a.jsxs("div",{style:{fontSize:"14px",color:"#374151",marginBottom:"8px"},children:[a.jsx("strong",{children:"Cliente:"})," ",P.cliente," •",a.jsx("strong",{children:" Tipo:"})," ",P.tipo||"básica"," •",a.jsx("strong",{children:" Fecha:"})," ",P.fecha]}),P.stops&&P.stops.length>0&&a.jsx("div",{className:"stops-summary",children:P.stops.map((M,D)=>a.jsxs("div",{className:"stop-badge",children:[D+1,". ",M.tipo==="pickup"?"📦":"🚚"," ",M.direccionTexto?.substring(0,30),"..."]},D))})]},P.id))})]})]})}function A6(){const[n,e]=E.useState("inactivo"),[t,r]=E.useState({lat:null,lng:null}),[l,u]=E.useState(""),f=E.useRef(null),y=E.useRef(0);let _=null;try{_=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const v=_?.empresaId!=null?String(_.empresaId):null,w=_?.id||_?.uid||_?.userId||_?.usuarioId||_?.usuario||"mensajero-desconocido",R=_?.nombre||_?.usuario||"Mensajero";async function I(F,Q){if(v)try{await mi(gt(ze,"ubicacionesMensajeros",w),{empresaId:v,nombre:R,lat:Number(F),lng:Number(Q),lastPingAt:ut()},{merge:!0})}catch(se){u(se?.message||"No pude escribir ubicación")}}function G(F){const Q=Number(F.coords.latitude),se=Number(F.coords.longitude);if(!Number.isFinite(Q)||!Number.isFinite(se))return;r({lat:Q,lng:se}),e("activo"),u("");const ue=Date.now();ue-y.current<15e3||(y.current=ue,I(Q,se))}function H(F){e("denegado"),u(F?.message||"Permiso de ubicación denegado")}E.useEffect(()=>{if(!("geolocation"in navigator)){e("no_soportado"),u("Este dispositivo/navegador no soporta geolocalización.");return}return e("pidiendo_permiso"),f.current=navigator.geolocation.watchPosition(G,H,{enableHighAccuracy:!0,maximumAge:5e3,timeout:1e4}),()=>{f.current!=null&&(navigator.geolocation.clearWatch(f.current),f.current=null)}},[]);async function Z(){"geolocation"in navigator&&(e("ping_manual"),navigator.geolocation.getCurrentPosition(F=>{G(F),e("activo")},H,{enableHighAccuracy:!0,timeout:8e3}))}return a.jsxs("div",{style:{fontSize:12,color:"#333",display:"inline-flex",alignItems:"center",gap:8},children:[a.jsxs("span",{children:["📍 ",n,Number.isFinite(t.lat)&&Number.isFinite(t.lng)?` (${t.lat.toFixed(5)}, ${t.lng.toFixed(5)})`:""]}),a.jsx("button",{onClick:Z,style:{padding:"2px 8px"},children:"Ping ahora"}),l&&a.jsxs("span",{style:{color:"#b00"},children:["· ",l]})]})}const Xw=10,Lj=n=>String(n||"").trim().toLowerCase(),Zl=n=>["admin","administrador","administrator"].includes(Lj(n));function Jw(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n}catch{}return NaN}function ky(n=new Date){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function N6(){const n=rr(),[e,t]=E.useState([]),[r,l]=E.useState(""),[u,f]=E.useState([]),[y,_]=E.useState(""),[v,w]=E.useState({}),[R,I]=E.useState({}),[G,H]=E.useState({}),Z=E.useMemo(()=>{try{const j=localStorage.getItem("usuarioActivo");return j?JSON.parse(j):null}catch{return null}},[]),F=Lj(Z?.rol),Q=Z?.empresaId||null,se=Z?.id||Z?.uid||Z?.userId||Z?.usuarioId||Z?.usuario||"mensajero-desconocido",ue=Z?.nombre||Z?.usuario||"Mensajero",we=j=>{const de=typeof j=="number"?j:j!=null?Number(j):NaN;return Number.isFinite(de)?de:null},Ce=j=>{const de=we(j?.destinoLat)??we(j?.address?.lat)??we(j?.destino?.lat),ae=we(j?.destinoLng)??we(j?.address?.lng)??we(j?.destino?.lng);return{lat:de,lng:ae}};async function Ue(){try{const j=gt(ze,"ubicacionesMensajeros",se),de=await Jr(j),ae=de.exists()?de.data():{},ye=(ae?.estado||"disponible").toLowerCase()==="disponible"?"en_ruta":"disponible";await mi(j,{empresaId:Q,nombre:ae?.nombre||ue,estado:ye,estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0}),alert(`Estado actualizado: ${ye.toUpperCase()}`)}catch(j){console.error("toggleEstadoMensajero:",j),alert("No pude actualizar tu estado.")}}E.useEffect(()=>{if(_(""),!Q){f([]);return}const j=ky(),de=Bt(ze,"rutas");let ae=()=>{};const Y=()=>{const be=en(de,Nt("empresaId","==",Q),Nt("mensajeroNombre","==",ue),Nt("fecha","==",j),Fr("createdAt","desc")),A=Kt(be,$=>f($.docs.map(te=>({id:te.id,...te.data()}))),$=>_($?.message||"No se pudieron leer rutas.")),W=ae;ae=()=>{try{W()}catch{}try{A()}catch{}}},ye=en(de,Nt("empresaId","==",Q),Nt("mensajeroUid","==",se),Nt("fecha","==",j),Fr("createdAt","desc")),ie=Kt(ye,be=>{be.empty?Y():(f(be.docs.map(A=>({id:A.id,...A.data()}))),_(""))},be=>{_(be?.message||"No se pudieron leer rutas."),Y()});return ae=()=>ie(),()=>ae()},[Q,se,ue]),E.useEffect(()=>{if(l(""),!Q){t([]);return}const j=Bt(ze,"ordenes"),de=Z?.id||Z?.uid||Z?.userId||Z?.usuarioId||null,ae=Z?.nombre||null,Y=be=>(be.sort((A,W)=>(W?.createdAt?.toMillis?.()??0)-(A?.createdAt?.toMillis?.()??0)),be);let ye=()=>{};if(Zl(F)){const be=en(j,Nt("empresaId","==",Q)),A=Kt(be,W=>t(Y(W.docs.map($=>({id:$.id,...$.data()})))),W=>l(W?.message||"No se pudieron leer órdenes."));return ye=()=>A(),()=>ye()}const ie=()=>{if(!ae)return;const be=en(j,Nt("empresaId","==",Q),Nt("asignadoNombre","==",ae),Nt("entregado","==",!1)),A=Kt(be,$=>t(Y($.docs.map(te=>({id:te.id,...te.data()})))),$=>l($?.message||"No se pudieron leer órdenes.")),W=ye;ye=()=>{try{W()}catch{}try{A()}catch{}}};if(de){const be=en(j,Nt("empresaId","==",Q),Nt("asignadoUid","==",de),Nt("entregado","==",!1)),A=Kt(be,W=>t(Y(W.docs.map($=>({id:$.id,...$.data()})))),W=>{console.warn("Query por UID falló o requiere índice. Activando fallback por nombre.",W?.message),ie()});return ye=()=>A(),()=>ye()}if(ae){const be=en(j,Nt("empresaId","==",Q),Nt("asignadoNombre","==",ae),Nt("entregado","==",!1)),A=Kt(be,W=>t(Y(W.docs.map($=>({id:$.id,...$.data()})))),W=>l(W?.message||"No se pudieron leer órdenes."));return ye=()=>A(),()=>ye()}return t([]),()=>{}},[Q,F,Z?.id,Z?.uid,Z?.userId,Z?.usuarioId,Z?.nombre]);const P=E.useRef(null);E.useEffect(()=>{if(Zl(F)||!Q)return;const j=e.some(Y=>!!Y.recibida&&!Y.entregado),de=e.some(Y=>!Y.recibida&&!Y.entregado);let ae="disponible";j?ae="en_ruta":de&&(ae="listo_para_ruta"),P.current!==ae&&(P.current=ae,(async()=>{try{const Y=gt(ze,"ubicacionesMensajeros",se);await mi(Y,{empresaId:Q,nombre:ue,estado:ae,estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0})}catch(Y){console.warn("Auto-estado mensajero falló:",Y?.message)}})())},[e,F,se,ue,Q]);const M=async j=>{try{const de={...j},ae={recibida:!0,fechaRecibida:ut()};await mr(gt(ze,"ordenes",j.id),ae),await xu({orderId:j.id,empresaId:Q,antes:de,despues:{...j,...ae},actor:{id:se,nombre:ue,rol:F,empresaId:Q},motivo:"Orden recibida (mensajero)"});try{const ie=gt(ze,"ubicacionesMensajeros",se);await mi(ie,{empresaId:Q,nombre:ue,estado:"en_ruta",estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0})}catch(ie){console.warn("No pude actualizar estado del mensajero (en_ruta):",ie?.message)}const{lat:Y,lng:ye}=Ce(j);Number.isFinite(Y)&&Number.isFinite(ye)?n(`/mapa/${j.id}`,{state:{ordenId:j.id,lat:Y,lng:ye,direccion:j.direccionTexto||j.address?.formatted||"",cliente:j.cliente||"",numeroFactura:j.numeroFactura||"",asignadoUid:j.asignadoUid||null,address:j.address||null}}):n(`/seleccionar-destino/${j.id}`,{state:{ordenId:j.id}})}catch(de){console.error("Recibida:",de),alert("No pude marcar como recibida.")}},D=(j,de)=>w(ae=>({...ae,[j]:de||null})),U=(j,de)=>I(ae=>({...ae,[j]:de}));async function k(j){if(!Q)return alert("Falta empresaId en sesión.");const de=j.id,ae=v[de];if(!ae)return alert("Selecciona una foto primero.");if(!ae.type?.startsWith("image/"))return alert("El archivo debe ser una imagen.");if(ae.size>Xw*1024*1024)return alert(`La imagen supera ${Xw} MB.`);try{H(oe=>({...oe,[de]:!0}));const Y=(ae.name?.split(".").pop()||"jpg").toLowerCase(),ye=Date.now(),ie=`empresas/${Q}/ordenes/${de}/POD_${ye}.${Y}`,be=Sj(Aj,ie);await wj(be,ae,{contentType:ae.type||"image/jpeg",customMetadata:{empresaId:Q,orderId:de,actorId:String(se)}});const A=await Ej(be),W=Jw(j.fechaRecibida)||Jw(j.createdAt)||Date.now(),$=Number(((Date.now()-W)/6e4).toFixed(2)),te={proofUrl:A,proofStoragePath:ie,proofAt:ut(),proofType:"foto",recibeNombre:(R[de]||"").trim()||null,entregado:!0,fechaEntregada:ut(),tiempoTotalEntrega:$},me={...j},J={...j,...te};await mr(gt(ze,"ordenes",de),te),j.asignadoUid&&await mi(gt(ze,"ubicacionesMensajeros",j.asignadoUid),{empresaId:Q,nombre:ue,estado:"disponible",estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0}),await xu({orderId:de,empresaId:Q,antes:me,despues:J,actor:{id:se,nombre:ue,rol:F,empresaId:Q},motivo:"POD foto + marcado como entregado"}),D(de,null),U(de,""),alert("Foto subida y orden marcada como ENTREGADA ✅")}catch(Y){console.error("subirPODyEntregar:",Y),alert(Y?.message||"No pude subir la foto / marcar entregada.")}finally{H(Y=>({...Y,[de]:!1}))}}const q=Zl(F)?"Órdenes (Administrador)":"Mis Órdenes Asignadas";return a.jsxs("div",{style:{padding:20},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[a.jsx("h2",{style:{margin:0},children:Zl(F)?"Panel de Entregas":"Mis Entregas"}),!Zl(F)&&a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("button",{onClick:Ue,children:"🟢 Alternar estado (Disponible / En ruta)"}),a.jsx("span",{style:{fontSize:12,color:"#666"},children:"* Auto-ajuste según tus órdenes."}),a.jsx(A6,{})]})]}),!Zl(F)&&a.jsxs("section",{className:"card",style:{marginTop:12,padding:12,border:"1px solid #e5e7eb",borderRadius:10,background:"#fff"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8,marginBottom:6},children:[a.jsx("h3",{style:{margin:0,fontSize:16},children:"🚦 Mis rutas de hoy"}),a.jsxs("span",{style:{color:"#6b7280",fontSize:12},children:["(",ky(),")"]})]}),y&&a.jsx("div",{style:{color:"#b91c1c",marginBottom:6},children:y}),u.length?a.jsx("div",{style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))"},children:u.map((j,de)=>{const ae=j?.nombre||`Ruta ${de+1}`,Y=String(j?.estado||"pendiente").toUpperCase(),ye=j?.ordenesCount??j?.totalOrdenes??"—";return a.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:12,background:"#fafafa"},children:[a.jsx("div",{style:{fontWeight:700},children:ae}),a.jsxs("div",{style:{fontSize:12,color:"#555"},children:["Fecha: ",j?.fecha||ky(),"  •  Estado: ",a.jsx("b",{children:Y})]}),a.jsxs("div",{style:{fontSize:12,color:"#555",marginTop:4},children:["Órdenes: ",a.jsx("b",{children:ye})]}),a.jsx("div",{style:{marginTop:8,display:"flex",gap:8},children:a.jsx("button",{onClick:()=>n(`/ruta-mensajero/${j.id}`),children:"🧭 Ver ruta"})})]},j.id)})}):a.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"No tienes rutas asignadas hoy. Si te asignan una, aparecerá aquí."})]}),a.jsx("h3",{style:{marginTop:16},children:q}),!!r&&a.jsx("div",{style:{color:"#b00",marginBottom:8},children:r}),!Zl(F)&&u.length===0&&a.jsx("div",{style:{fontSize:12,color:"#6b7280",marginBottom:8},children:"También puedes trabajar por órdenes sueltas mientras no tengas una ruta."}),e.length===0&&a.jsx("p",{children:"No hay órdenes pendientes asignadas."}),a.jsx("ul",{style:{listStyle:"none",padding:0},children:e.map(j=>{const de=j.entregado?"ENTREGADA":j.recibida?"RECIBIDA":"PENDIENTE",ae=j.direccionTexto||j.address?.formatted||"—",{lat:Y,lng:ye}=Ce(j),ie=Number.isFinite(Y)&&Number.isFinite(ye)?`${Y.toFixed(6)}, ${ye.toFixed(6)}`:"—",be=Number.isFinite(Y)&&Number.isFinite(ye)?`https://www.google.com/maps?q=${Y},${ye}`:null,A=j.id;return a.jsxs("li",{style:{marginBottom:14,padding:12,border:"1px solid #ddd",borderRadius:8},children:[a.jsxs("div",{children:[a.jsx("b",{children:j.cliente||"Cliente"})," — Factura: ",j.numeroFactura||"—"," — Tel: ",j.telefono||"—"]}),a.jsxs("div",{children:["Fecha/Hora: ",j.fecha||"—"," ",j.hora||""," — Monto: ",j.monto!=null?`$${j.monto}`:"—"]}),a.jsxs("div",{children:["Dirección: ",ae," — Coords: ",ie,be&&a.jsxs(a.Fragment,{children:[" — ",a.jsx("a",{href:be,target:"_blank",rel:"noopener noreferrer",children:"Abrir en Google Maps"})]})]}),a.jsxs("div",{children:["Estado: ",a.jsx("b",{children:de})]}),a.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>n(`/mapa/${A}`,{state:{ordenId:A,lat:Y,lng:ye,direccion:j.direccionTexto||j.address?.formatted||"",cliente:j.cliente||"",numeroFactura:j.numeroFactura||"",asignadoUid:j.asignadoUid||null,address:j.address||null}}),children:"🗺️ Ver en mapa"}),a.jsx("button",{onClick:()=>n(`/ruta-mensajero/${A}`,{state:{ordenId:A,lat:Y,lng:ye,direccion:j.direccionTexto||j.address?.formatted||""}}),children:"🧭 Navegar (en app)"}),!j.entregado&&!j.recibida&&a.jsx("button",{onClick:()=>M(j),children:"✅ Marcar como Recibida"})]}),!j.entregado&&j.recibida&&F==="mensajero"&&a.jsxs("div",{style:{marginTop:10,padding:10,border:"1px dashed #ccc",borderRadius:8},children:[a.jsx("b",{children:"📷 Subir prueba de entrega"}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:6},children:[a.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:W=>D(A,W.target.files?.[0]||null)}),a.jsx("input",{type:"text",placeholder:"Nombre de quien recibe (opcional)",value:R[A]||"",onChange:W=>U(A,W.target.value),style:{minWidth:220}}),a.jsx("button",{onClick:()=>k(j),disabled:!v[A]||G[A],children:G[A]?"Subiendo...":"Subir foto y marcar entregada"})]}),!!v[A]&&a.jsxs("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:["Archivo seleccionado: ",a.jsx("code",{children:v[A].name})]})]}),j.entregado&&j.proofUrl&&a.jsxs("div",{style:{marginTop:10},children:[a.jsx("b",{children:"📎 Prueba de Entrega"}),a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",marginTop:6},children:[a.jsx("img",{src:j.proofUrl,alt:"POD",style:{maxWidth:240,borderRadius:8,border:"1px solid #eee"}}),a.jsx("div",{style:{fontSize:12,color:"#444"},children:a.jsxs("div",{children:[a.jsx("b",{children:"Recibido por:"})," ",j.recibeNombre||"—"]})})]})]})]},A)})})]})}const Me=n=>{const e=typeof n=="number"?n:n!=null?Number(n):NaN;return Number.isFinite(e)?e:null},Md=n=>Number.isFinite(Me(n?.lat))&&Number.isFinite(Me(n?.lng)),C6=(n,e)=>{const t=Me(n?.lat),r=Me(n?.lng),l=Me(e?.lat),u=Me(e?.lng);if(!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(l)||!Number.isFinite(u))return 0;const f=6371,y=(l-t)*Math.PI/180,_=(u-r)*Math.PI/180,v=Math.sin(y/2)*Math.sin(y/2)+Math.cos(t*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(_/2)*Math.sin(_/2),w=2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v));return f*w},Oy=(n,e)=>Number.isFinite(n)&&Number.isFinite(e)?`https://waze.com/ul?ll=${n},${e}&navigate=yes`:null,Dy=(n,e)=>Number.isFinite(n)&&Number.isFinite(e)?`https://www.google.com/maps?q=${n},${e}`:null;function nm(n=new Date){const e=new Date(n);return e.setHours(0,0,0,0),e.toISOString().slice(0,10)}function eE(n){return String(n||"").trim().toLowerCase()}function tE(n){return String(n||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}const R6=new Set(["mensajero","mensajeros","rider","riders","courier","delivery","deliveryman","repartidor","repartidores","conductor","driver"]),I6=()=>`chain_${Math.random().toString(36).slice(2,9)}`;function nE(){const n=E.useMemo(()=>{try{const z=localStorage.getItem("usuarioActivo");return z?JSON.parse(z):null}catch{return null}},[]),e=eE(n?.rol||n?.role),t=e==="gerente",r=n?.empresaId?String(n.empresaId):null,l=Number.isFinite(Number(r))?Number(r):null,u=n?.id||n?.uid||n?.userId||n?.usuarioId||null,f=n?.nombre||n?.usuario||"desconocido",y=n?.email||null,[_,v]=E.useState(""),[w,R]=E.useState(nm()),[I,G]=E.useState(""),[H,Z]=E.useState("08:00"),[F,Q]=E.useState("18:00"),[se,ue]=E.useState(120),[we,Ce]=E.useState(""),[Ue,P]=E.useState("programado"),[M,D]=E.useState(""),[U,k]=E.useState(""),[q,j]=E.useState(null),[de,ae]=E.useState(null),[Y,ye]=E.useState(null),[ie,be]=E.useState(""),[A,W]=E.useState(!1),[$,te]=E.useState(!1),[me,J]=E.useState(!1),[oe,re]=E.useState(!1),[he,Ae]=E.useState([]),[K,le]=E.useState(""),[Re,Ge]=E.useState(""),[Je,Ze]=E.useState("desconocido"),[Ct,Ot]=E.useState("disponible"),[Ke,ft]=E.useState(""),[Wt,Hn]=E.useState(60),[pn,qn]=E.useState([]),[gr,kt]=E.useState(""),[yt,ct]=E.useState(!1),[$t,Ln]=E.useState(!0),[ts,ia]=E.useState(!1),[Rr,zr]=E.useState(!1),[Ki,X]=E.useState(""),[Fe,st]=E.useState(""),[zt,$n]=E.useState(""),[Xn,Nn]=E.useState(!1),[Yt,En]=E.useState(""),[dn,bn]=E.useState(""),[St,hn]=E.useState(""),[gn,Pi]=E.useState(nm()),[Ht,Mt]=E.useState("09:00"),[ke,at]=E.useState(""),[Gn,nt]=E.useState(null),[ni,Ir]=E.useState(null),[Ti,sr]=E.useState(null),[wi,Cn]=E.useState(null),[_t,Rn]=E.useState([]),[fn,Ls]=E.useState([]),[yr,Vn]=E.useState("todas"),[Bi,bs]=E.useState(nm()),[Jn,Un]=E.useState(!1),[ii,li]=E.useState("");E.useEffect(()=>{if(!r)return;let z=[],xe=!0;const He=et=>{const Be=new Map;for(const Ye of et)Ye?.uid&&Be.set(Ye.uid,Ye);return Array.from(Be.values())},Ne=(et,Be=[])=>{const Ye=et.docs.map(We=>{const mt=We.data()||{},Qt=mt.rol??mt.role??mt.perfil??mt.tipo??"",Zn=eE(Qt);return R6.has(Zn)?{uid:We.id,nombre:mt.nombre||mt.usuario||mt.email||We.id,rol:Zn}:null}).filter(Boolean);return Be.concat(Ye)};return(async()=>{ft("");try{const et=Bt(ze,"usuarios"),Be=en(et,Nt("empresaId","==",r)),Ye=Kt(Be,We=>{const mt=He(Ne(We));mt.length&&(Ae(mt.sort((Qt,Zn)=>Qt.nombre.localeCompare(Zn.nombre))),!K&&mt.length&&(le(mt[0].uid),Ge(mt[0].nombre)))});z.push(Ye)}catch{}if(Number.isFinite(l))try{const et=Bt(ze,"usuarios"),Be=en(et,Nt("empresaId","==",l)),Ye=Kt(Be,We=>{const mt=Ne(We);mt.length&&(Ae(Qt=>He(Qt.concat(mt)).sort((Zn,ci)=>Zn.nombre.localeCompare(ci.nombre))),!K&&mt.length&&(le(mt[0].uid),Ge(mt[0].nombre)))});z.push(Ye)}catch{}try{const et=Bt(ze,"ubicacionesMensajeros"),Be=en(et,Nt("empresaId","==",r)),Ye=Kt(Be,We=>{const mt=We.docs.map(Qt=>({uid:Qt.id,nombre:(Qt.data()||{}).nombre||Qt.id,rol:"mensajero"}));mt.length&&(Ae(Qt=>He(Qt.concat(mt)).sort((Zn,ci)=>Zn.nombre.localeCompare(ci.nombre))),!K&&mt.length&&(le(mt[0].uid),Ge(mt[0].nombre)))});z.push(Ye)}catch{}if(Number.isFinite(l))try{const et=Bt(ze,"ubicacionesMensajeros"),Be=en(et,Nt("empresaId","==",l)),Ye=Kt(Be,We=>{const mt=We.docs.map(Qt=>({uid:Qt.id,nombre:(Qt.data()||{}).nombre||Qt.id,rol:"mensajero"}));mt.length&&(Ae(Qt=>He(Qt.concat(mt)).sort((Zn,ci)=>Zn.nombre.localeCompare(ci.nombre))),!K&&mt.length&&(le(mt[0].uid),Ge(mt[0].nombre)))});z.push(Ye)}catch{}})(),()=>{z.forEach(et=>et&&et())}},[r]);const ei=E.useMemo(()=>K?he.some(z=>z.uid===K):!1,[K,he]);E.useEffect(()=>{if(!Re||ei)return;const z=tE(Re),xe=he.find(He=>tE(He.nombre)===z);xe?(le(xe.uid),Ge(xe.nombre),ft("")):ft("El mensajero debe seleccionarse de los registrados. Usa el selector o escribe exactamente como aparece.")},[Re,ei,he]),E.useEffect(()=>{if(!r||!K){Ze("desconocido");return}const z=gt(ze,"ubicacionesMensajeros",K),xe=Kt(z,He=>{const Ne=He.data();if(!Ne){Ze("desconocido");return}if(String(Ne.empresaId||"")!==String(r)){Ze("otra_empresa");return}Ze(String(Ne.estado||"desconocido").toLowerCase())});return()=>xe()},[r,K]),E.useEffect(()=>{if(!r)return;let z=null;return(async()=>{if(ct(!0),kt(""),!await Qn()){kt("Sesión inválida."),ct(!1);return}try{const He=Bt(ze,"ordenes"),Ne=en(He,Nt("empresaId","==",r),Fr("createdAt","desc"));z=Kt(Ne,ot=>{const et=ot.docs.map(Be=>({id:Be.id,...Be.data()}));qn(et),ct(!1)},ot=>{kt(ot?.message||"No se pudieron leer órdenes."),ct(!1)})}catch(He){kt(He?.message||"No se pudo iniciar la suscripción."),ct(!1)}})(),()=>z&&z()},[r]),E.useEffect(()=>{if(!r)return;let z=null;return(async()=>{try{const xe=Bt(ze,"programasEntrega"),He=en(xe,Nt("empresaId","==",r),Fr("createdAt","desc"));z=Kt(He,Ne=>{const ot=Ne.docs.map(et=>({id:et.id,...et.data()}));Ls(ot)})}catch{}})(),()=>z&&z()},[r]);const xn=E.useMemo(()=>{let z=[...pn];if($t&&(z=z.filter(Ne=>!Ne.asignadoUid)),ts&&(z=z.filter(Ne=>Md({lat:Ne.destinoLat??Ne?.address?.lat,lng:Ne.destinoLng??Ne?.address?.lng}))),Rr&&(z=z.filter(Ne=>!!Ne.ventanaInicioStop||!!Ne.ventanaFinStop)),Ki.trim()){const Ne=Ki.trim().toLowerCase();z=z.filter(ot=>String(ot.zona||"").toLowerCase().includes(Ne))}const xe=Fe.trim().toLowerCase();xe&&(z=z.filter(Ne=>[Ne.cliente,Ne.telefono,Ne.numeroFactura,Ne.direccionTexto,Ne.address?.formatted].map(et=>String(et||"").toLowerCase()).join(" | ").includes(xe)));const He=zt.trim().toLowerCase();return He&&(z=z.filter(Ne=>String(Ne.referencia||"").toLowerCase().includes(He))),Jn&&(z=z.filter(Ne=>!!Ne.programacionId||Ne?.esProgramada===!0||Ne?.tipoEntrega==="programada")),ii&&(z=z.filter(Ne=>Ne.programacionId===ii)),z},[pn,$t,ts,Rr,Ki,Fe,zt,Jn,ii]);function gi(z){return _t.some(xe=>xe.orderId===z)}function ns(z){if(gi(z.id)){alert("Esa orden ya está en la ruta.");return}const xe=Me(z.destinoLat)??Me(z?.address?.lat)??Me(z?.destino?.lat),He=Me(z.destinoLng)??Me(z?.address?.lng)??Me(z?.destino?.lng),Ne={orderId:z.id,cliente:z.cliente||"",direccionTexto:z.direccionTexto||z.address?.formatted||"",lat:xe,lng:He,tipo:"solo_entrega",pesoKg:Me(z.pesoKg),volumenM3:Me(z.volumenM3),unidades:Me(z.unidades),deltaKg:Me(z.pesoKg)?-Math.abs(Me(z.pesoKg)):null,deltaM3:Me(z.volumenM3)?-Math.abs(Me(z.volumenM3)):null,deltaUnidades:Me(z.unidades)?-Math.abs(Me(z.unidades)):null,prioridad:3,ventanaInicioStop:"",ventanaFinStop:"",tiempoServicioMin:10,contactoRecepcion:"",telefonoRecepcion:"",fragil:!1,apilable:!0,valorDeclarado:null,seguroMonto:null,documentosRef:"",notas:"",ordenIndex:_t.length,otpEntrega:null,firmaDigitalUrl:null,fotosPodUrls:[],causalFalla:null,comentariosCliente:null,chainId:null,chainRole:null,esRecarga:!1};Rn(ot=>[...ot,Ne])}function Br(z){if(!Md(z)){alert("La recarga necesita lat/lng.");return}const xe={orderId:`recarga_${Date.now()}`,cliente:"RECARGA / HUB",direccionTexto:z.formatted||"Centro de recarga",lat:Me(z.lat),lng:Me(z.lng),tipo:"recarga",esRecarga:!0,deltaKg:0,deltaM3:0,deltaUnidades:0,prioridad:2,ventanaInicioStop:"",ventanaFinStop:"",tiempoServicioMin:5,contactoRecepcion:"",telefonoRecepcion:"",fragil:!1,apilable:!0,valorDeclarado:null,seguroMonto:null,documentosRef:"",notas:"Punto de recarga",ordenIndex:_t.length,chainId:null,chainRole:null};Rn(He=>[...He,xe])}function Vs({pickup:z,entrega:xe}){if(!Md(z?.address)||!Md(xe?.address)){alert("Pickup y entrega deben tener lat/lng.");return}const He=I6(),Ne={orderId:`pk_${Date.now()}`,cliente:z.cliente||"Pickup muelle",direccionTexto:z.address.formatted||"",lat:Me(z.address.lat),lng:Me(z.address.lng),tipo:"pickup",esRecarga:!1,pesoKg:Me(z.pesoKg),volumenM3:Me(z.volumenM3),unidades:Me(z.unidades),deltaKg:Me(z.pesoKg)||0,deltaM3:Me(z.volumenM3)||0,deltaUnidades:Me(z.unidades)||0,prioridad:3,ventanaInicioStop:z.ventanaInicioStop||"",ventanaFinStop:z.ventanaFinStop||"",tiempoServicioMin:Me(z.tiempoServicioMin)||10,contactoRecepcion:z.contactoRecepcion||"",telefonoRecepcion:z.telefonoRecepcion||"",fragil:!!z.fragil,apilable:z.apilable??!0,valorDeclarado:Me(z.valorDeclarado),seguroMonto:Me(z.seguroMonto),documentosRef:z.documentosRef||"",notas:z.notas||"",ordenIndex:_t.length,chainId:He,chainRole:"pickup",otpEntrega:null,firmaDigitalUrl:null,fotosPodUrls:[],causalFalla:null,comentariosCliente:null},ot={orderId:`dr_${Date.now()+1}`,cliente:xe.cliente||"Entrega destino",direccionTexto:xe.address.formatted||"",lat:Me(xe.address.lat),lng:Me(xe.address.lng),tipo:"drop",esRecarga:!1,pesoKg:Me(z.pesoKg),volumenM3:Me(z.volumenM3),unidades:Me(z.unidades),deltaKg:Me(z.pesoKg)?-Math.abs(Me(z.pesoKg)):0,deltaM3:Me(z.volumenM3)?-Math.abs(Me(z.volumenM3)):0,deltaUnidades:Me(z.unidades)?-Math.abs(Me(z.unidades)):0,prioridad:3,ventanaInicioStop:xe.ventanaInicioStop||"",ventanaFinStop:xe.ventanaFinStop||"",tiempoServicioMin:Me(xe.tiempoServicioMin)||10,contactoRecepcion:xe.contactoRecepcion||"",telefonoRecepcion:xe.telefonoRecepcion||"",fragil:!!xe.fragil,apilable:xe.apilable??!0,valorDeclarado:Me(xe.valorDeclarado),seguroMonto:Me(xe.seguroMonto),documentosRef:xe.documentosRef||"",notas:xe.notas||"",ordenIndex:_t.length+1,chainId:He,chainRole:"drop",otpEntrega:null,firmaDigitalUrl:null,fotosPodUrls:[],causalFalla:null,comentariosCliente:null};Rn(et=>[...et,Ne,ot])}function Hr(z){const xe=[..._t];xe.splice(z,1);for(let He=0;He<xe.length;He++)xe[He].ordenIndex=He;Rn(xe)}function Dt(z,xe){const He=[..._t],Ne=z+xe;if(Ne<0||Ne>=He.length)return;const[ot]=He.splice(z,1);He.splice(Ne,0,ot);for(let et=0;et<He.length;et++)He[et].ordenIndex=et;Rn(He)}function bt(z,xe){Rn(He=>He.map((Ne,ot)=>ot===z?{...Ne,...xe}:Ne))}async function yi(){if(!r)return alert("Falta empresaId en sesión.");if(!Yt||!St||!gn||!Ht||!Gn)return alert("Completa cliente, factura, fecha, hora y dirección.");if(!Md(Gn))return alert("La dirección debe tener lat/lng.");const z=Me(Gn.lat),xe=Me(Gn.lng),He={empresaId:r,cliente:Yt,telefono:dn||null,numeroFactura:St,fecha:gn,hora:Ht,zona:ke||null,address:{...Gn,lat:z,lng:xe},destinoLat:z,destinoLng:xe,direccionTexto:Gn.formatted||"",pesoKg:Me(ni),volumenM3:Me(Ti),unidades:Me(wi),entregado:!1,recibida:!1,fechaRecibida:null,fechaEntregada:null,tiempoTotalEntrega:null,asignadoUid:null,asignadoNombre:null,createdAt:ut(),usuario:f,rolUsuario:e,creadoPorUid:u||null,creadoPorNombre:f,creadoPorRol:e||null,creadoPorEmail:y||null};try{const Ne=await so(Bt(ze,"ordenes"),He);ns({id:Ne.id,...He}),En(""),bn(""),hn(""),Pi(nm()),Mt("09:00"),at(""),nt(null),Ir(null),sr(null),Cn(null),Nn(!1),alert("Orden creada y agregada a la ruta ✅")}catch(Ne){alert(Ne?.message||"No pude crear la orden.")}}const Pt=E.useMemo(()=>{let z=0,xe=0,He=0,Ne=0,ot=0;const et=[],Be=.5,Ye=[];try{const Si=new Date(`${w}T${H}:00`);let yn=0;for(let ri=0;ri<_t.length;ri++){const Yi=_t[ri];if(ri>0){const wn=C6(_t[ri-1],Yi);Ne+=wn;const ji=wn/Be;ot+=ji,yn+=ji}const Pr=new Date(Si.getTime()+yn*6e4);Ye.push(Pr),yn+=Me(Yi.tiempoServicioMin)||0}}catch{}const We=Number.isFinite(q)?q:null,mt=Number.isFinite(de)?de:null,Qt=Number.isFinite(Y)?Y:null;let Zn=0,ci=0,Mi=0,Ei=0,_r=0,ar=0;for(let Si=0;Si<_t.length;Si++){const yn=_t[Si];if(yn.esRecarga||yn.tipo==="recarga")et.push({idx:Si+1,etiqueta:"RECARGA",currKg:Zn,currM3:ci,currUn:Mi,reset:!0}),Zn=0,ci=0,Mi=0;else{const ri=Me(yn.deltaKg)||0,Yi=Me(yn.deltaM3)||0,Pr=Me(yn.deltaUnidades)||0;Zn+=ri,ci+=Yi,Mi+=Pr,Ei=Math.max(Ei,Zn),_r=Math.max(_r,ci),ar=Math.max(ar,Mi),et.push({idx:Si+1,etiqueta:`${yn.tipo==="pickup"?"Pickup":yn.tipo==="drop"||yn.tipo==="solo_entrega"?"Entrega":"Stop"}`,currKg:Zn,currM3:ci,currUn:Mi,reset:!1})}z+=Math.abs(Me(yn.pesoKg)||0),xe+=Math.abs(Me(yn.volumenM3)||0),He+=Math.abs(Me(yn.unidades)||0)}const ra=_t.reduce((Si,yn)=>Si+(Me(yn.tiempoServicioMin)||0),0),dt=ot+ra,or=dt>0?_t.length/(dt/60):null,tn=We&&We>0?z/We*100:null,vr=mt&&mt>0?xe/mt*100:null,Wi=Qt&&Qt>0?He/Qt*100:null;return{kg:z,m3:xe,unid:He,pctKg:tn,pctM3:vr,pctUn:Wi,kmTotal:Ne,minTransito:ot,minServicio:ra,minTotales:dt,paradasHora:or,etaPorStop:Ye,timeline:et,capKg:We,capM3:mt,capUn:Qt,maxKgSeen:Ei,maxM3Seen:_r,maxUnSeen:ar,currKg:Zn,currM3:ci,currUn:Mi}},[_t,q,de,Y,w,H]);function xs(){const z=[];r||z.push("Falta empresaId en sesión."),_||z.push("Falta nombre de la ruta."),w||z.push("Falta fecha."),(!H||!F)&&z.push("Falta ventana de la ruta (inicio/fin)."),!K||!Re?z.push("Selecciona un mensajero registrado (UID y nombre)."):ei||z.push("El mensajero debe existir en la lista de registrados."),_t.length===0&&z.push("Agrega al menos una parada (stop)."),_t.length>Number(Wt||60)&&z.push(`Excede MaxStops (${Wt}).`);const xe=H,He=F;for(const We of _t){if(!Number.isFinite(Me(We.lat))||!Number.isFinite(Me(We.lng))){z.push("Todos los stops deben tener lat/lng.");break}if(We.ventanaInicioStop&&We.ventanaFinStop&&(We.ventanaInicioStop<xe||We.ventanaFinStop>He)){z.push(`Ventana de un stop fuera de la ventana de ruta (${We.cliente||We.orderId}).`);break}}Ct==="disponible"&&!["disponible","listo_para_ruta"].includes(Je)&&z.push("El mensajero seleccionado no está disponible.");const{timeline:Ne,capKg:ot,capM3:et,capUn:Be}=Pt;for(const We of Ne)We.reset||(ot&&We.currKg>ot&&z.push(`Se excede capacidad en KG en el tramo #${We.idx} (acumulado ${We.currKg} > cap ${ot}).`),et&&We.currM3>et&&z.push(`Se excede capacidad en m³ en el tramo #${We.idx} (acumulado ${We.currM3} > cap ${et}).`),Be&&We.currUn>Be&&z.push(`Se excede capacidad en unidades en el tramo #${We.idx} (acumulado ${We.currUn} > cap ${Be}).`));const Ye=new Map;_t.forEach((We,mt)=>{if(!We.chainId)return;const Qt=Ye.get(We.chainId)||{};We.chainRole==="pickup"&&(Qt.pickupIdx=mt),We.chainRole==="drop"&&(Qt.dropIdx=mt),Ye.set(We.chainId,Qt)});for(const[We,mt]of Ye.entries())mt.pickupIdx==null||mt.dropIdx==null?z.push(`Cadena ${We} incompleta: falta pickup o entrega.`):mt.dropIdx<=mt.pickupIdx&&z.push(`Cadena ${We} inválida: la entrega debe ir después del pickup.`);return z}async function is(z="draft"){if(!r)return alert("Falta empresaId en sesión.");if(z==="published"&&t){alert("Tu rol (gerente) es de solo lectura para publicar programaciones. Pide a un administrador u operador que publique.");return}const xe=(I||"").split(/\n|,|;/).map(ot=>ot.trim()).filter(Boolean),He=[w,...xe.filter(ot=>ot!==w)],Ne=xs();if(Ne.length){alert(`Corrige:
• `+Ne.join(`
• `));return}try{for(const ot of He){const et={empresaId:r,status:z,nombreRuta:_,fecha:ot,ventanaInicio:H,ventanaFin:F,slaObjetivoMin:Me(se),zona:we||null,notasRuta:M||null,tipoServicio:Ue,camionNombre:U||null,capacidadKg:Me(q),capacidadM3:Me(de),capacidadUnidades:Me(Y),restriccionesVehiculo:ie||null,equipamiento:{montacargas:!!A,refrigerado:!!$,lona:!!me,handTruck:!!oe},conductorUid:K||null,conductorNombre:Re||null,estadoConductorRequerido:Ct,maxStops:Number(Wt||60),titulo:_?`Entrega programada · ${_} · ${ot}`:`Entrega programada · ${ot}`,kpiPre:{totalStops:_t.length,totalKg:Pt.kg,totalM3:Pt.m3,totalUnidades:Pt.unid,pctKg:Pt.pctKg,pctM3:Pt.pctM3,pctUn:Pt.pctUn,kmTotal:Pt.kmTotal,minTransito:Pt.minTransito,minServicio:Pt.minServicio,minTotales:Pt.minTotales,paradasHora:Pt.paradasHora??null},stops:_t.map(Ye=>({orderId:Ye.orderId,cliente:Ye.cliente||null,direccionTexto:Ye.direccionTexto||null,lat:Me(Ye.lat),lng:Me(Ye.lng),tipo:Ye.tipo||"solo_entrega",esRecarga:!!Ye.esRecarga,pesoKg:Me(Ye.pesoKg),volumenM3:Me(Ye.volumenM3),unidades:Me(Ye.unidades),deltaKg:Me(Ye.deltaKg),deltaM3:Me(Ye.deltaM3),deltaUnidades:Me(Ye.deltaUnidades),prioridad:Number(Ye.prioridad||3),ventanaInicioStop:Ye.ventanaInicioStop||null,ventanaFinStop:Ye.ventanaFinStop||null,tiempoServicioMin:Me(Ye.tiempoServicioMin),contactoRecepcion:Ye.contactoRecepcion||null,telefonoRecepcion:Ye.telefonoRecepcion||null,fragil:!!Ye.fragil,apilable:!!Ye.apilable,valorDeclarado:Me(Ye.valorDeclarado),seguroMonto:Me(Ye.seguroMonto),documentosRef:Ye.documentosRef||null,notas:Ye.notas||null,ordenIndex:Number(Ye.ordenIndex||0),otpEntrega:Ye.otpEntrega||null,firmaDigitalUrl:Ye.firmaDigitalUrl||null,fotosPodUrls:Array.isArray(Ye.fotosPodUrls)?Ye.fotosPodUrls:[],causalFalla:Ye.causalFalla||null,comentariosCliente:Ye.comentariosCliente||null,chainId:Ye.chainId||null,chainRole:Ye.chainRole||null})),createdAt:ut(),createdByUid:u||null,createdByNombre:f||null,createdByRol:e||null,createdByEmail:y||null,publishedAt:z==="published"?ut():null},Be=await so(Bt(ze,"programasEntrega"),et);if(z==="published"){for(let Ye=0;Ye<_t.length;Ye++){const We=_t[Ye],mt=We.orderId&&(We.orderId.startsWith("pk_")||We.orderId.startsWith("dr_")||We.orderId.startsWith("recarga_"));if(!We.orderId||mt)continue;const Qt={programacionId:Be.id,programaEntregaId:Be.id,ordenIndex:Number(We.ordenIndex||0),esProgramada:!0,tipoEntrega:"programada",programacionTitulo:et.titulo||`${_||Be.id} · ${ot}`,programacionFecha:ot,programacionStatus:"published",programacionOrden:Ye+1,programacionTotal:_t.length,programacionPrioridad:Number(We.prioridad||3),ventanaInicioStop:We.ventanaInicioStop||null,ventanaFinStop:We.ventanaFinStop||null,asignadoUid:K||null,asignadoNombre:Re||null,asignadoAt:ut(),programadaResumen:{etiqueta:"Entrega programada",titulo:_||Be.id,fecha:ot,orden:Ye+1,total:_t.length,prioridad:Number(We.prioridad||3),ventana:{inicio:We.ventanaInicioStop||null,fin:We.ventanaFinStop||null}},asignadoPorUid:u||null,asignadoPorNombre:f||null,asignadoPorRol:e||null,asignadoPorEmail:y||null,chainId:We.chainId||null,chainRole:We.chainRole||null};await mr(gt(ze,"ordenes",We.orderId),Qt),await xu({orderId:We.orderId,empresaId:r,antes:null,despues:Qt,actor:{id:u||null,nombre:f||"desconocido",rol:e,empresaId:r},motivo:"Asignada por Programación (planificado)"})}K&&await mi(gt(ze,"ubicacionesMensajeros",K),{empresaId:r,nombre:Re||K,estado:"listo_para_ruta",estadoUpdatedAt:ut(),lastPingAt:ut()},{merge:!0})}}alert(z==="published"?"Programación(es) publicada(s) y órdenes asignadas ✅":"Borrador guardado ✅")}catch(ot){console.error("guardarProgramacion:",ot),alert(ot?.message||"No pude guardar la programación.")}}function jt(z,xe){if(!xe?.length)return;const He=Object.keys(xe[0]),Ne=[He.join(","),...xe.map(Ye=>He.map(We=>`"${String(Ye[We]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),ot=new Blob([Ne],{type:"text/csv;charset=utf-8;"}),et=URL.createObjectURL(ot),Be=document.createElement("a");Be.href=et,Be.download=z,Be.click(),URL.revokeObjectURL(et)}function Tn(){const z=_t.map((xe,He)=>({ordenIndex:He,orderId:xe.orderId,cliente:xe.cliente||"",direccion:xe.direccionTexto||"",lat:Me(xe.lat),lng:Me(xe.lng),tipo:xe.tipo,prioridad:xe.prioridad,pesoKg:Me(xe.pesoKg)||"",volumenM3:Me(xe.volumenM3)||"",unidades:Me(xe.unidades)||"",deltaKg:Me(xe.deltaKg)||"",deltaM3:Me(xe.deltaM3)||"",deltaUnidades:Me(xe.deltaUnidades)||"",ventanaInicioStop:xe.ventanaInicioStop||"",ventanaFinStop:xe.ventanaFinStop||"",tiempoServicioMin:Me(xe.tiempoServicioMin)||"",contacto:xe.contactoRecepcion||"",telefono:xe.telefonoRecepcion||"",fragil:xe.fragil?"sí":"no",apilable:xe.apilable?"sí":"no",notas:xe.notas||"",waze:Oy(Me(xe.lat),Me(xe.lng))||"",gmaps:Dy(Me(xe.lat),Me(xe.lng))||"",chainId:xe.chainId||"",chainRole:xe.chainRole||"",esRecarga:xe.esRecarga?"sí":"no"}));jt(`hoja_ruta_${(_||"ruta").replace(/\s+/g,"_")}_${w}.csv`,z)}function Aa(){const z=`Ruta: ${_||"-"} | Fecha: ${w}
Conductor: ${Re||"-"} | Camión: ${U||"-"}
Paradas: ${_t.length} | Utilización (totales): KG ${mn(Pt.pctKg)}, m³ ${mn(Pt.pctM3)}, UN ${mn(Pt.pctUn)} | Paradas/h: ${Pt.paradasHora?Pt.paradasHora.toFixed(1):"—"}
-----------------------------`,xe=_t.map((Ne,ot)=>{const et=Me(Ne.lat),Be=Me(Ne.lng),Ye=[Number.isFinite(Me(Ne.deltaKg))?`ΔKg ${Ne.deltaKg}`:null,Number.isFinite(Me(Ne.deltaM3))?`Δm³ ${Ne.deltaM3}`:null,Number.isFinite(Me(Ne.deltaUnidades))?`ΔUn ${Ne.deltaUnidades}`:null].filter(Boolean).join(" · ");return`${ot+1}. ${Ne.cliente||"Cliente"} (${Ne.direccionTexto||"-"})
- Tipo: ${Ne.esRecarga?"RECARGA":Ne.tipo}  Ventana: ${Ne.ventanaInicioStop||"—"}–${Ne.ventanaFinStop||"—"}
- Carga: ${Fn(Ne)}  ${Ye?`| ${Ye}`:""}  Servicio: ${Ne.tiempoServicioMin||0} min
- Waze: ${Oy(et,Be)||"-"}  | Maps: ${Dy(et,Be)||"-"}`}).join(`

`),He=encodeURIComponent(`${z}
${xe}`);window.open(`https://wa.me/?text=${He}`,"_blank","noopener,noreferrer")}function Fn(z){const xe=[];return Number.isFinite(Me(z.pesoKg))&&xe.push(`${z.pesoKg} kg`),Number.isFinite(Me(z.volumenM3))&&xe.push(`${z.volumenM3} m³`),Number.isFinite(Me(z.unidades))&&xe.push(`${z.unidades} un`),xe.join(" | ")||"-"}function mn(z){return z==null?"—":`${z.toFixed(0)}%`}return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("h2",{style:{margin:0},children:"🗺️ Programar Entregas"}),t&&a.jsx("span",{style:{marginLeft:8,fontSize:12,color:"var(--text-deeper)"},children:"(modo lectura para publicar)"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx("button",{onClick:()=>is("draft"),children:"💾 Guardar borrador"}),a.jsx("button",{disabled:t,title:t?"Gerente: solo lectura. No puede publicar.":"Publicar y asignar a mensajero",onClick:()=>is("published"),children:"🚀 Publicar y asignar"}),a.jsx("button",{onClick:Tn,children:"⬇️ Exportar hoja CSV"}),a.jsx("button",{onClick:Aa,children:"📲 Compartir por WhatsApp"})]})]}),!!gr&&a.jsx("div",{style:{marginTop:8,color:"var(--danger)"},children:gr}),a.jsxs("section",{style:kd,children:[a.jsx("h3",{style:{marginTop:0},children:"1) Datos de la programación"}),a.jsxs("div",{className:"grid3",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Nombre de la ruta"}),a.jsx("input",{value:_,onChange:z=>v(z.target.value),placeholder:"RUTA-LUNES-A"})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Fecha principal"}),a.jsx("input",{type:"date",value:w,onChange:z=>R(z.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Zona"}),a.jsx("input",{value:we,onChange:z=>Ce(z.target.value),placeholder:"Centro / Norte / ..."})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana inicio"}),a.jsx("input",{type:"time",value:H,onChange:z=>Z(z.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana fin"}),a.jsx("input",{type:"time",value:F,onChange:z=>Q(z.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tipo de servicio"}),a.jsxs("select",{value:Ue,onChange:z=>P(z.target.value),children:[a.jsx("option",{value:"same_day",children:"same_day"}),a.jsx("option",{value:"next_day",children:"next_day"}),a.jsx("option",{value:"programado",children:"programado"})]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"SLA objetivo (min)"}),a.jsx("input",{type:"number",value:se,onChange:z=>ue(Number(z.target.value||0))})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{children:"Notas / Instrucciones"}),a.jsx("input",{value:M,onChange:z=>D(z.target.value),placeholder:"Indicaciones al conductor..."})]})]}),a.jsxs("div",{style:{marginTop:10},children:[a.jsx("label",{children:"Fechas extra (una por línea, ej: 2025-10-12)"}),a.jsx("textarea",{rows:2,placeholder:`2025-10-12
2025-10-13`,value:I,onChange:z=>G(z.target.value)}),a.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:"Al publicar, se crearán programaciones clonadas para cada fecha listada (ideal para “el domingo” u otros días)."})]})]}),a.jsxs("section",{style:kd,children:[a.jsx("h3",{style:{marginTop:0},children:"2) Vehículo y Conductor"}),a.jsxs("div",{className:"grid3",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Camión / Unidad"}),a.jsx("input",{value:U,onChange:z=>k(z.target.value),placeholder:"Camión 1"})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Capacidad (kg)"}),a.jsx("input",{type:"number",value:q??"",onChange:z=>j(Me(z.target.value))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Capacidad (m³)"}),a.jsx("input",{type:"number",value:de??"",onChange:z=>ae(Me(z.target.value))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Capacidad (unidades)"}),a.jsx("input",{type:"number",value:Y??"",onChange:z=>ye(Me(z.target.value))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Restricciones vehículo"}),a.jsx("input",{value:ie,onChange:z=>be(z.target.value),placeholder:"Altura, ancho, accesos..."})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Estado conductor requerido"}),a.jsxs("select",{value:Ct,onChange:z=>Ot(z.target.value),children:[a.jsx("option",{value:"disponible",children:"disponible"}),a.jsx("option",{value:"indistinto",children:"indistinto"})]})]})]}),a.jsxs("div",{className:"grid3",style:{marginTop:8},children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{children:"Seleccionar Mensajero (registrado)"}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("select",{value:K,onChange:z=>{const xe=z.target.value;le(xe);const He=he.find(Ne=>Ne.uid===xe);Ge(He?.nombre||""),ft("")},style:{flex:1},children:[!he.length&&a.jsx("option",{value:"",children:"(No hay mensajeros)"}),he.map(z=>a.jsxs("option",{value:z.uid,children:[z.nombre," (",z.uid.slice(0,6),"…)"]},z.uid))]}),a.jsx("button",{type:"button",title:"Refrescar lista",onClick:()=>Ae(z=>[...z].sort((xe,He)=>xe.nombre.localeCompare(He.nombre))),children:"🔄"})]}),!!Ke&&a.jsx("div",{style:{color:"var(--danger)",fontSize:12,marginTop:4},children:Ke}),a.jsx("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:"* Debe ser alguien registrado. Evita escribir nombres manualmente que no existan."})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Total mensajeros"}),a.jsx("input",{value:he.length,readOnly:!0})]})]}),a.jsxs("div",{className:"grid3",style:{marginTop:8},children:[a.jsxs("div",{children:[a.jsx("label",{children:"Conductor UID"}),a.jsx("input",{value:K,onChange:z=>{const xe=z.target.value;le(xe);const He=he.find(Ne=>Ne.uid===xe);He?(Ge(He.nombre),ft("")):ft("UID no corresponde a un mensajero registrado.")},placeholder:"uid-123"})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Conductor Nombre"}),a.jsx("input",{value:Re,onChange:z=>Ge(z.target.value),placeholder:"Juan Pérez"})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Max Stops"}),a.jsx("input",{type:"number",value:Wt,onChange:z=>Hn(Number(z.target.value||60))})]})]}),a.jsxs("div",{style:{marginTop:8,fontSize:13},children:[a.jsx("b",{children:"Estado del mensajero:"})," ",a.jsx("span",{style:{color:["disponible","listo_para_ruta"].includes(Je)?"var(--ok)":"var(--danger)"},children:Je})]}),a.jsxs("div",{style:{marginTop:10,display:"flex",gap:16,flexWrap:"wrap"},children:[a.jsx(Yo,{label:"Kg (totales ordenados)",value:`${(Pt.kg||0).toFixed(1)} / ${q??"—"}`,extra:`Util: ${mn(Pt.pctKg)}`}),a.jsx(Yo,{label:"m³ (totales ordenados)",value:`${(Pt.m3||0).toFixed(2)} / ${de??"—"}`,extra:`Util: ${mn(Pt.pctM3)}`}),a.jsx(Yo,{label:"Unidades (totales)",value:`${Pt.unid||0} / ${Y??"—"}`,extra:`Util: ${mn(Pt.pctUn)}`}),a.jsx(Yo,{label:"Distancia aprox.",value:`${Pt.kmTotal.toFixed(1)} km`}),a.jsx(Yo,{label:"Tiempo tránsito",value:`${Pt.minTransito.toFixed(0)} min`}),a.jsx(Yo,{label:"Tiempo servicio",value:`${Pt.minServicio.toFixed(0)} min`}),a.jsx(Yo,{label:"Tiempo total",value:`${Pt.minTotales.toFixed(0)} min`}),a.jsx(Yo,{label:"Paradas / hora",value:Pt.paradasHora?Pt.paradasHora.toFixed(1):"—"})]}),a.jsx("div",{style:{marginTop:10},children:a.jsxs("details",{children:[a.jsx("summary",{style:{cursor:"pointer"},children:"📈 Ver timeline de carga (acumulado por tramo)"}),a.jsx("div",{style:{marginTop:8,overflowX:"auto"},children:Pt.timeline.length?a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Ut,{children:"#"}),a.jsx(Ut,{children:"Evento"}),a.jsx(Ut,{children:"Kg acum."}),a.jsx(Ut,{children:"m³ acum."}),a.jsx(Ut,{children:"Un acum."}),a.jsx(Ut,{children:"Nota"})]})}),a.jsx("tbody",{children:Pt.timeline.map((z,xe)=>a.jsxs("tr",{children:[a.jsx(Ft,{children:z.idx}),a.jsx(Ft,{children:z.etiqueta}),a.jsx(Ft,{children:z.currKg??0}),a.jsx(Ft,{children:z.currM3??0}),a.jsx(Ft,{children:z.currUn??0}),a.jsx(Ft,{children:z.reset?"Recarga: acumulados reseteados":""})]},xe))})]}):a.jsx("div",{children:"—"})})]})})]}),a.jsxs("section",{style:kd,children:[a.jsx("h3",{style:{marginTop:0},children:"2.5) Programaciones guardadas"}),a.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[a.jsx("label",{children:"Fecha"}),a.jsx("input",{type:"date",value:Bi,onChange:z=>bs(z.target.value)}),a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:yr,onChange:z=>Vn(z.target.value),children:[a.jsx("option",{value:"todas",children:"todas"}),a.jsx("option",{value:"draft",children:"draft"}),a.jsx("option",{value:"published",children:"published"})]})]}),a.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:fn.length?a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Ut,{children:"Fecha"}),a.jsx(Ut,{children:"Ruta"}),a.jsx(Ut,{children:"Conductor"}),a.jsx(Ut,{children:"Stops"}),a.jsx(Ut,{children:"Status"}),a.jsx(Ut,{children:"KPIs"}),a.jsx(Ut,{children:"Acciones"})]})}),a.jsx("tbody",{children:fn.filter(z=>!Bi||z.fecha===Bi).filter(z=>yr==="todas"?!0:z.status===yr).map(z=>a.jsxs("tr",{children:[a.jsx(Ft,{children:z.fecha||"—"}),a.jsx(Ft,{children:z.nombreRuta||z.id}),a.jsx(Ft,{children:z.conductorNombre||"—"}),a.jsx(Ft,{children:Array.isArray(z.stops)?z.stops.length:0}),a.jsx(Ft,{children:z.status}),a.jsx(Ft,{children:z.kpiPre?`Kg:${z.kpiPre.totalKg??0} · m³:${z.kpiPre.totalM3??0} · par/h:${z.kpiPre.paradasHora??"—"}`:"—"}),a.jsx(Ft,{children:a.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:a.jsx("button",{onClick:()=>{Un(!0),li(z.id)},children:"Ver órdenes de esta programación"})})})]},z.id))})]}):a.jsx("div",{children:"No hay programaciones."})})]}),a.jsxs("section",{style:kd,children:[a.jsx("h3",{style:{marginTop:0},children:"3) Bandeja de órdenes"}),a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:$t,onChange:z=>Ln(z.target.checked)})," Sin asignar"]}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:ts,onChange:z=>ia(z.target.checked)})," Con geoloc"]}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:Rr,onChange:z=>zr(z.target.checked)})," Con ventana"]}),a.jsx("input",{placeholder:"Zona…",value:Ki,onChange:z=>X(z.target.value),style:{minWidth:140}}),a.jsx("input",{placeholder:"Buscar (cliente/factura/teléfono/dirección)...",value:Fe,onChange:z=>st(z.target.value),style:{flex:1,minWidth:240}}),a.jsx("input",{placeholder:"Ref adicional…",value:zt,onChange:z=>$n(z.target.value),style:{minWidth:150}}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:Jn,onChange:z=>Un(z.target.checked)})," Solo programadas"]}),a.jsxs("select",{value:ii,onChange:z=>li(z.target.value),style:{minWidth:220},children:[a.jsx("option",{value:"",children:"(Todas las programaciones)"}),fn.map(z=>a.jsxs("option",{value:z.id,children:[z.nombreRuta||z.id," · ",z.fecha," · ",z.status]},z.id))]}),a.jsx("button",{onClick:()=>{Un(!1),li("")},children:"Limpiar filtros"}),a.jsx("button",{onClick:()=>Nn(z=>!z),children:"➕ Crear orden rápida"})]}),Xn&&a.jsxs("div",{style:{marginTop:10,padding:10,border:"1px dashed var(--border)",borderRadius:8},children:[a.jsx("b",{children:"Nueva orden rápida"}),a.jsxs("div",{className:"grid3",style:{marginTop:6},children:[a.jsx("input",{placeholder:"Cliente",value:Yt,onChange:z=>En(z.target.value)}),a.jsx("input",{placeholder:"Teléfono",value:dn,onChange:z=>bn(z.target.value)}),a.jsx("input",{placeholder:"N° Factura",value:St,onChange:z=>hn(z.target.value)}),a.jsxs("div",{children:[a.jsx("label",{children:"Fecha"}),a.jsx("input",{type:"date",value:gn,onChange:z=>Pi(z.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Hora"}),a.jsx("input",{type:"time",value:Ht,onChange:z=>Mt(z.target.value)})]}),a.jsx("input",{placeholder:"Zona (opcional)",value:ke,onChange:z=>at(z.target.value)})]}),a.jsxs("div",{style:{marginTop:6},children:[a.jsx("label",{children:a.jsx("b",{children:"Dirección"})}),a.jsx(lc,{value:Gn,onChange:nt})]}),a.jsxs("div",{className:"grid3",style:{marginTop:6},children:[a.jsx("input",{type:"number",placeholder:"Peso (kg)",value:ni??"",onChange:z=>Ir(Me(z.target.value))}),a.jsx("input",{type:"number",placeholder:"Volumen (m³)",value:Ti??"",onChange:z=>sr(Me(z.target.value))}),a.jsx("input",{type:"number",placeholder:"Unidades",value:wi??"",onChange:z=>Cn(Me(z.target.value))})]}),a.jsx("div",{style:{marginTop:8},children:a.jsx("button",{onClick:yi,children:"Crear y agregar ➕"})})]}),a.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:yt?a.jsx("div",{children:"Cargando…"}):xn.length?a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Ut,{children:"Fecha/Hora"}),a.jsx(Ut,{children:"Tipo"}),a.jsx(Ut,{children:"Cliente"}),a.jsx(Ut,{children:"Factura"}),a.jsx(Ut,{children:"Asignado"}),a.jsx(Ut,{children:"Zona"}),a.jsx(Ut,{children:"Dirección"}),a.jsx(Ut,{children:"Ventana (stop)"}),a.jsx(Ut,{children:"Acciones"})]})}),a.jsx("tbody",{children:xn.map(z=>{const xe=z.direccionTexto||z.address?.formatted||"—",He=!!(z.programacionId||z?.esProgramada||z?.tipoEntrega==="programada");return a.jsxs("tr",{children:[a.jsxs(Ft,{children:[z.fecha||"—"," ",z.hora||""]}),a.jsx(Ft,{children:He?a.jsx("span",{className:"badge badge-prog",children:"Programada"}):a.jsx("span",{className:"badge badge-uni",children:"Unitaria"})}),a.jsxs(Ft,{children:[z.cliente||"—",He&&z.programacionOrden?a.jsxs("span",{className:"badge badge-seq",title:"Orden dentro de la ruta",children:["#",z.programacionOrden]}):null]}),a.jsx(Ft,{children:z.numeroFactura||"—"}),a.jsx(Ft,{children:z.asignadoNombre||"—"}),a.jsx(Ft,{children:z.zona||"—"}),a.jsx(Ft,{children:xe}),a.jsxs(Ft,{children:[z.ventanaInicioStop||"—",z.ventanaFinStop?`–${z.ventanaFinStop}`:""]}),a.jsx(Ft,{children:a.jsx("button",{onClick:()=>ns(z),disabled:gi(z.id),children:"Agregar"})})]},z.id)})})]}):a.jsx("div",{children:"No hay coincidencias."})})]}),a.jsxs("section",{style:kd,children:[a.jsx("h3",{style:{marginTop:0},children:"4) Paradas (stops) & 6) Secuenciación"}),a.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:[a.jsxs("details",{children:[a.jsx("summary",{style:{cursor:"pointer"},children:"➕ Par pickup→entrega"}),a.jsx(P6,{onCreate:Vs})]}),a.jsxs("details",{children:[a.jsx("summary",{style:{cursor:"pointer"},children:"➕ Parada de recarga"}),a.jsx(M6,{onCreate:Br})]})]}),_t.length===0?a.jsx("div",{children:"Agrega órdenes desde la bandeja o usa “Par pickup→entrega”."}):a.jsxs("div",{style:{overflowX:"auto"},children:[a.jsxs("table",{className:"tbl",style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Ut,{children:"#"}),a.jsx(Ut,{children:"Cliente / Dirección"}),a.jsx(Ut,{children:"Tipo"}),a.jsx(Ut,{children:"Kg"}),a.jsx(Ut,{children:"m³"}),a.jsx(Ut,{children:"Un"}),a.jsx(Ut,{children:"ΔKg"}),a.jsx(Ut,{children:"Δm³"}),a.jsx(Ut,{children:"ΔUn"}),a.jsx(Ut,{children:"Prior."}),a.jsx(Ut,{children:"Ventana"}),a.jsx(Ut,{children:"Serv (min)"}),a.jsx(Ut,{children:"Contacto/Tel"}),a.jsx(Ut,{children:"Flags"}),a.jsx(Ut,{children:"Valor/Seguro"}),a.jsx(Ut,{children:"Docs"}),a.jsx(Ut,{children:"Lat,Lon"}),a.jsx(Ut,{children:"ETA*"}),a.jsx(Ut,{children:"Acciones"})]})}),a.jsx("tbody",{children:_t.map((z,xe)=>{const He=Me(z.lat),Ne=Me(z.lng),ot=Pt.etaPorStop?.[xe],et=[{v:"solo_entrega",t:"solo_entrega"},{v:"pickup",t:"pickup"},{v:"drop",t:"drop"},{v:"recarga",t:"recarga"}];return a.jsxs("tr",{children:[a.jsx(Ft,{style:{whiteSpace:"nowrap"},children:xe+1}),a.jsxs(Ft,{style:{minWidth:220},children:[a.jsx("div",{style:{fontWeight:600},children:z.cliente||z.orderId}),a.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:z.direccionTexto||"—"}),z.chainId?a.jsxs("div",{style:{fontSize:11,color:"var(--text-deeper)"},children:["Cadena: ",z.chainId," · Rol: ",z.chainRole]}):null,z.esRecarga?a.jsx("div",{className:"badge badge-seq",title:"Resetea acumulados",children:"RECARGA"}):null]}),a.jsx(Ft,{children:a.jsx("select",{value:z.tipo,onChange:Be=>bt(xe,{tipo:Be.target.value,esRecarga:Be.target.value==="recarga"}),children:et.map(Be=>a.jsx("option",{value:Be.v,children:Be.t},Be.v))})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.pesoKg??"",onChange:Be=>bt(xe,{pesoKg:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.volumenM3??"",onChange:Be=>bt(xe,{volumenM3:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.unidades??"",onChange:Be=>bt(xe,{unidades:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.deltaKg??"",onChange:Be=>bt(xe,{deltaKg:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.deltaM3??"",onChange:Be=>bt(xe,{deltaM3:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.deltaUnidades??"",onChange:Be=>bt(xe,{deltaUnidades:Me(Be.target.value)}),style:Ms})}),a.jsx(Ft,{children:a.jsx("input",{type:"number",min:1,max:5,value:z.prioridad??3,onChange:Be=>bt(xe,{prioridad:Number(Be.target.value||3)}),style:Ms})}),a.jsxs(Ft,{style:{whiteSpace:"nowrap"},children:[a.jsx("input",{type:"time",value:z.ventanaInicioStop||"",onChange:Be=>bt(xe,{ventanaInicioStop:Be.target.value}),style:Od}),a.jsx("span",{children:"–"}),a.jsx("input",{type:"time",value:z.ventanaFinStop||"",onChange:Be=>bt(xe,{ventanaFinStop:Be.target.value}),style:Od})]}),a.jsx(Ft,{children:a.jsx("input",{type:"number",value:z.tiempoServicioMin??10,onChange:Be=>bt(xe,{tiempoServicioMin:Me(Be.target.value)}),style:Ms})}),a.jsxs(Ft,{style:{minWidth:180},children:[a.jsx("input",{placeholder:"Contacto",value:z.contactoRecepcion||"",onChange:Be=>bt(xe,{contactoRecepcion:Be.target.value}),style:{...Od,marginBottom:4}}),a.jsx("input",{placeholder:"Teléfono",value:z.telefonoRecepcion||"",onChange:Be=>bt(xe,{telefonoRecepcion:Be.target.value}),style:Od})]}),a.jsxs(Ft,{children:[a.jsxs("label",{style:{display:"block",fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:!!z.fragil,onChange:Be=>bt(xe,{fragil:Be.target.checked})})," Frágil"]}),a.jsxs("label",{style:{display:"block",fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:!!z.apilable,onChange:Be=>bt(xe,{apilable:Be.target.checked})})," Apilable"]})]}),a.jsxs(Ft,{children:[a.jsx("input",{type:"number",placeholder:"Valor",value:z.valorDeclarado??"",onChange:Be=>bt(xe,{valorDeclarado:Me(Be.target.value)}),style:Ms}),a.jsx("input",{type:"number",placeholder:"Seguro",value:z.seguroMonto??"",onChange:Be=>bt(xe,{seguroMonto:Me(Be.target.value)}),style:Ms})]}),a.jsx(Ft,{children:a.jsx("input",{placeholder:"Docs ref",value:z.documentosRef||"",onChange:Be=>bt(xe,{documentosRef:Be.target.value}),style:Od})}),a.jsxs(Ft,{style:{minWidth:220},children:[a.jsxs("div",{style:{marginBottom:4},children:[a.jsx("input",{placeholder:"Lat",value:He??"",onChange:Be=>bt(xe,{lat:Me(Be.target.value)}),style:{...Ms,width:90,marginRight:6}}),a.jsx("input",{placeholder:"Lng",value:Ne??"",onChange:Be=>bt(xe,{lng:Me(Be.target.value)}),style:{...Ms,width:90}})]}),a.jsx("div",{style:{fontSize:12},children:Number.isFinite(He)&&Number.isFinite(Ne)&&a.jsxs(a.Fragment,{children:[a.jsx("a",{href:Oy(He,Ne),target:"_blank",rel:"noreferrer",children:"Waze"})," ·"," ",a.jsx("a",{href:Dy(He,Ne),target:"_blank",rel:"noreferrer",children:"Maps"})]})})]}),a.jsx(Ft,{style:{whiteSpace:"nowrap",fontSize:12},children:ot?ot.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"—"}),a.jsx(Ft,{children:a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>Dt(xe,-1),disabled:xe===0,children:"↑"}),a.jsx("button",{onClick:()=>Dt(xe,1),disabled:xe===_t.length-1,children:"↓"}),a.jsx("button",{onClick:()=>Hr(xe),children:"Quitar"})]})})]},z.orderId)})})]}),a.jsx("div",{style:{marginTop:8,fontSize:12,color:"var(--text-muted)"},children:"* ETA y distancia son estimaciones locales (velocidad media 30 km/h)."})]})]})]})}function P6({onCreate:n}){const[e,t]=E.useState({address:null,cliente:"Pickup muelle",pesoKg:null,volumenM3:null,unidades:null,ventanaInicioStop:"",ventanaFinStop:""}),[r,l]=E.useState({address:null,cliente:"Entrega destino",ventanaInicioStop:"",ventanaFinStop:""});return a.jsxs("div",{style:{marginTop:8,padding:10,border:"1px dashed var(--border)",borderRadius:8},children:[a.jsx("b",{children:"Crear par Pickup → Entrega"}),a.jsxs("div",{className:"grid3",style:{marginTop:6},children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{children:"📦 Pickup (origen)"}),a.jsx(lc,{value:e.address,onChange:u=>t(f=>({...f,address:u}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Cliente Pickup"}),a.jsx("input",{value:e.cliente,onChange:u=>t(f=>({...f,cliente:u.target.value}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Peso (kg)"}),a.jsx("input",{type:"number",value:e.pesoKg??"",onChange:u=>t(f=>({...f,pesoKg:Me(u.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Volumen (m³)"}),a.jsx("input",{type:"number",value:e.volumenM3??"",onChange:u=>t(f=>({...f,volumenM3:Me(u.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Unidades"}),a.jsx("input",{type:"number",value:e.unidades??"",onChange:u=>t(f=>({...f,unidades:Me(u.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana pickup (ini)"}),a.jsx("input",{type:"time",value:e.ventanaInicioStop,onChange:u=>t(f=>({...f,ventanaInicioStop:u.target.value}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana pickup (fin)"}),a.jsx("input",{type:"time",value:e.ventanaFinStop,onChange:u=>t(f=>({...f,ventanaFinStop:u.target.value}))})]})]}),a.jsxs("div",{className:"grid3",style:{marginTop:6},children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{children:"🎯 Entrega (destino)"}),a.jsx(lc,{value:r.address,onChange:u=>l(f=>({...f,address:u}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Cliente Entrega"}),a.jsx("input",{value:r.cliente,onChange:u=>l(f=>({...f,cliente:u.target.value}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana entrega (ini)"}),a.jsx("input",{type:"time",value:r.ventanaInicioStop,onChange:u=>l(f=>({...f,ventanaInicioStop:u.target.value}))})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Ventana entrega (fin)"}),a.jsx("input",{type:"time",value:r.ventanaFinStop,onChange:u=>l(f=>({...f,ventanaFinStop:u.target.value}))})]})]}),a.jsx("div",{style:{marginTop:8},children:a.jsx("button",{onClick:()=>n({pickup:e,entrega:r}),children:"Agregar par ➕"})})]})}function M6({onCreate:n}){const[e,t]=E.useState(null);return a.jsxs("div",{style:{marginTop:8,padding:10,border:"1px dashed var(--border)",borderRadius:8},children:[a.jsx("b",{children:"Agregar parada de recarga (hub/CD)"}),a.jsxs("div",{style:{marginTop:6},children:[a.jsx("label",{children:"Dirección"}),a.jsx(lc,{value:e,onChange:t})]}),a.jsx("div",{style:{marginTop:8},children:a.jsx("button",{onClick:()=>n(e),children:"Agregar recarga ➕"})})]})}const kd={marginTop:12,padding:12,border:"1px solid var(--border)",borderRadius:12,background:"var(--bg)",boxShadow:"0 1px 2px rgba(16, 24, 40, 0.04)"},Ut=({children:n})=>a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid var(--border)",padding:"10px 12px",background:"var(--bg-sticky)",color:"var(--text-deeper)",fontWeight:600,position:"sticky",top:0,zIndex:1},children:n}),Ft=({children:n,style:e})=>a.jsx("td",{style:{borderBottom:"1px solid var(--border-soft)",padding:"9px 12px",...e},children:n}),Ms={width:80,padding:"4px 6px"},Od={width:120,padding:"4px 6px"};function Yo({label:n,value:e,extra:t}){return a.jsxs("div",{style:{padding:10,border:"1px dashed var(--border-soft)",borderRadius:12,background:"var(--bg-soft)",minWidth:160},children:[a.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:n}),a.jsx("div",{style:{fontSize:18,fontWeight:700,color:"var(--text)"},children:e}),t&&a.jsx("div",{style:{fontSize:12,color:"var(--text-muted)"},children:t})]})}const Vj=document.createElement("style");Vj.innerHTML=`
  :root{
    --bg:#ffffff;
    --bg-soft:#f9fafb;
    --bg-sticky:#f8fafc;
    --text:#111827;
    --text-deeper:#334155;
    --text-muted:#667085;
    --border:#e5e7eb;
    --border-soft:#eef2f7;
    --primary:#6366f1;
    --primary-soft:#eef2ff;
    --ok:#0a0;
    --danger:#b00;
    --badge-seq-bg:#f1f5f9;
    --badge-seq-border:#b7c7dd;
    --success:#065f46;
    --success-soft:#ecfdf5;
  }

  .grid3 {
    display: grid; gap: 10px;
    grid-template-columns: repeat(3, minmax(220px, 1fr));
  }
  .col-span-2 { grid-column: span 2; }
  input, select, textarea {
    padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; width: 100%; background: #fff;
  }
  input:focus, select:focus, textarea:focus {
    outline: none; border-color: #c7d2fe; box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
  }
  label { display: block; font-size: 12px; color: #475569; margin-bottom: 6px; }

  .tbl { border: 1px solid var(--border); border-radius: 10px; overflow: hidden; background: #fff; }
  .tbl tbody tr:nth-child(odd) td { background: #fbfdff; }
  .tbl tbody tr:hover td { background: var(--primary-soft); }

  .badge {
    display: inline-block; line-height: 1; padding: 4px 8px; border-radius: 999px;
    font-size: 11px; font-weight: 600; border: 1px solid transparent; margin-right: 6px;
  }
  .badge-prog { color: #372c8b; background: var(--primary-soft); border-color: #616a8d; }
  .badge-uni { color: var(--success); background: var(--success-soft); border-color: #bbf7d0; }
  .badge-seq { color: var(--text-deeper); background: var(--badge-seq-bg); border-color: var(--badge-seq-border); margin-left: 6px; }

  button {
    background: var(--primary); color: #000; border: 1px solid var(--primary);
    border-radius: 10px; padding: 8px 12px; cursor: pointer;
  }
  button:hover { filter: brightness(0.95); }
  button:disabled { background: #99a7dd; border-color: #8b8ead; cursor: not-allowed; }

  table { font-size: 14px; }
`;document.head.appendChild(Vj);const k6=new na.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",iconSize:[32,32],iconAnchor:[16,32]});function iE(){const[n,e]=E.useState([]),t=JSON.parse(localStorage.getItem("usuarioActivo"));return E.useEffect(()=>{const l=(JSON.parse(localStorage.getItem("ordenesEntrega"))||[]).filter(u=>u.mensajero===t?.nombre&&!u.entregado);e(l)},[t?.nombre]),a.jsxs("div",{children:[a.jsx("h2",{children:"Ruta Optimizada"}),n.length===0?a.jsx("p",{children:"No tienes paradas asignadas."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{children:n.map(r=>a.jsxs("li",{children:["📦 ",r.producto," — ",r.cliente," ",a.jsx("br",{}),"📍 ",r.direccion||"Dirección no especificada"]},r.id))}),a.jsxs(ku,{center:[18.4861,-69.9312],zoom:12,style:{height:"400px",width:"100%",marginTop:"20px"},children:[a.jsx(Ou,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),n.map((r,l)=>r.coordenadas?a.jsx(ks,{position:r.coordenadas,icon:k6,children:a.jsxs(Sa,{children:[a.jsx("strong",{children:r.producto}),a.jsx("br",{}),"Cliente: ",r.cliente,a.jsx("br",{}),"Dirección: ",r.direccion]})},l):null),n.length>1&&a.jsx(Sp,{positions:n.filter(r=>r.coordenadas).map(r=>r.coordenadas),color:"blue"})]})]})]})}const rE=na.divIcon({className:"destino-icon",html:'<div style="width:18px;height:18px;border-radius:50%;background:#2e7d32;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,.4)"></div>',iconSize:[18,18],iconAnchor:[9,9]}),O6=na.divIcon({className:"origen-icon",html:'<div style="width:18px;height:18px;border-radius:50%;background:#1565c0;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,.4)"></div>',iconSize:[18,18],iconAnchor:[9,9]}),D6=na.divIcon({className:"sel-icon",html:'<div style="width:22px;height:22px;border-radius:50%;background:#f59e0b;border:3px solid #fff;box-shadow:0 0 3px rgba(0,0,0,.5)"></div>',iconSize:[22,22],iconAnchor:[11,11]});function Li(n){if(typeof n=="number")return n;if(n==null)return null;const e=Number(n);return Number.isFinite(e)?e:null}function L6({points:n}){const e=fc();return E.useEffect(()=>{if(!n||n.length===0)return;const t=n.filter(r=>Number.isFinite(r[0])&&Number.isFinite(r[1]));t.length&&e.fitBounds(t,{padding:[30,30]})},[n,e]),null}function im(){const{id:n}=Su(),e=rr(),{state:t}=es()||{},r=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),l=r?.id||r?.uid||r?.userId||r?.usuarioId||r?.usuario||null,u=r?.empresaId!=null?String(r.empresaId):null,[f,y]=E.useState("order"),[_,v]=E.useState({lat:null,lng:null,etiqueta:"",orderId:null}),[w,R]=E.useState(null),[I,G]=E.useState([]),[H,Z]=E.useState(!0),[F,Q]=E.useState(""),[se,ue]=E.useState({lat:null,lng:null,etiqueta:"Tu ubicación"}),[we,Ce]=E.useState([]),[Ue,P]=E.useState(null),[M,D]=E.useState(null),U=E.useMemo(()=>[18.4861,-69.9312],[]);E.useEffect(()=>{let ie=!0;async function be(){Z(!0),Q("");const A=Li(t?.lat),W=Li(t?.lng);if(Number.isFinite(A)&&Number.isFinite(W)){if(!ie)return;y("order"),R(null),G([]),v({lat:A,lng:W,etiqueta:t?.direccion||t?.address?.formatted||t?.cliente||"Destino",orderId:t?.ordenId||null}),Z(!1);return}try{const $=gt(ze,"rutas",n),te=await Jr($);if(te.exists()){const me={id:te.id,...te.data()};if(!ie)return;if(y("route"),R(me),u){const J=Bt(ze,"ordenes"),oe=en(J,Nt("empresaId","==",u),Nt("rutaId","==",n)),re=Kt(oe,he=>{if(!ie)return;const Ae=he.docs.map(le=>({id:le.id,...le.data()}));G(Ae);const K=Ae.find(le=>{const Re=Li(le?.destinoLat??le?.address?.lat),Ge=Li(le?.destinoLng??le?.address?.lng);return Number.isFinite(Re)&&Number.isFinite(Ge)});if(K&&!_.orderId){const le=Li(K?.destinoLat??K?.address?.lat),Re=Li(K?.destinoLng??K?.address?.lng);v({lat:le,lng:Re,etiqueta:K.direccionTexto||K.address?.formatted||K.cliente||"Destino",orderId:K.id})}},he=>{ie&&(console.error("onSnapshot(ordenes ruta):",he),Q("No pude cargar órdenes de la ruta."))});return()=>{re()}}Z(!1);return}}catch($){console.warn("Intento leer ruta:",$?.message)}try{const $=gt(ze,"ordenes",n),te=await Jr($);if(!ie)return;if(!te.exists()){Q("No encontré la orden ni la ruta indicada."),Z(!1);return}const me=te.data()||{},J=Li(me?.destinoLat??me?.address?.lat??me?.destino?.lat),oe=Li(me?.destinoLng??me?.address?.lng??me?.destino?.lng);if(!Number.isFinite(J)||!Number.isFinite(oe)){Q("La orden no tiene coordenadas de destino."),Z(!1);return}y("order"),R(null),G([]),v({lat:J,lng:oe,etiqueta:me.direccionTexto||me.address?.formatted||me.cliente||"Destino",orderId:te.id}),Z(!1)}catch($){console.error("RutaMensajero load order fallback:",$),Q("Error cargando la orden."),Z(!1)}}return be(),()=>{ie=!1}},[n,t,u]),E.useEffect(()=>{let ie=!1;async function be(){if(l)try{const A=gt(ze,"ubicacionesMensajeros",l),W=await Jr(A);if(!ie&&W.exists()){const $=W.data()||{},te=Li($.lat),me=Li($.lng);if(Number.isFinite(te)&&Number.isFinite(me)){ue({lat:te,lng:me,etiqueta:$.nombre||"Origen"});return}}}catch(A){console.warn("No pude leer ubicacionesMensajeros:",A?.message)}"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(A=>{ie||ue({lat:A.coords.latitude,lng:A.coords.longitude,etiqueta:"Tu ubicación"})},()=>{ie||ue({lat:null,lng:null,etiqueta:""})},{enableHighAccuracy:!0,timeout:7e3})}return be(),()=>{ie=!0}},[l]),E.useEffect(()=>{async function ie(){Ce([]),P(null),D(null);const be=Li(se.lat),A=Li(se.lng),W=Li(_.lat),$=Li(_.lng);if(!(!Number.isFinite(W)||!Number.isFinite($))&&!(!Number.isFinite(be)||!Number.isFinite(A)))try{const te=`https://router.project-osrm.org/route/v1/driving/${A},${be};${$},${W}?overview=full&geometries=geojson`,J=await(await fetch(te)).json();if(J.code!=="Ok"||!J.routes?.length)return;const oe=J.routes[0];P(oe.distance||null),D(oe.duration||null);const re=(oe.geometry?.coordinates||[]).map(([he,Ae])=>[Ae,he]).filter(([he,Ae])=>Number.isFinite(he)&&Number.isFinite(Ae));Ce(re)}catch(te){console.warn("No pude calcular la ruta OSRM:",te?.message)}}ie()},[se,_]);const k=E.useMemo(()=>{const ie=[];if(Number.isFinite(se.lat)&&Number.isFinite(se.lng)&&ie.push([se.lat,se.lng]),f==="route"&&Array.isArray(I))for(const be of I){const A=Li(be?.destinoLat??be?.address?.lat),W=Li(be?.destinoLng??be?.address?.lng);Number.isFinite(A)&&Number.isFinite(W)&&ie.push([A,W])}else Number.isFinite(_.lat)&&Number.isFinite(_.lng)&&ie.push([_.lat,_.lng]);return ie},[se,_,f,I]),q=Ue!=null?(Ue/1e3).toFixed(1):null,j=M!=null?Math.round(M/60):null,de=ie=>{if(!(Number.isFinite(_.lat)&&Number.isFinite(_.lng)))return;const A=`${_.lat},${_.lng}`;if(ie&&Number.isFinite(se.lat)&&Number.isFinite(se.lng)){const W=`${se.lat},${se.lng}`;window.open(`https://www.google.com/maps/dir/?api=1&origin=${W}&destination=${A}&travelmode=driving`,"_blank")}else window.open(`https://www.google.com/maps/dir/?api=1&destination=${A}&travelmode=driving`,"_blank")};function ae(ie){return ie.entregado?"ENTREGADA":ie.recibida?"RECIBIDA":"PENDIENTE"}function Y(ie){const be=ae(ie);return be==="ENTREGADA"?"ok":be==="RECIBIDA"?"warn":"danger"}function ye({children:ie,tone:be="default"}){const A=be==="ok"?"var(--ok-bg)":be==="warn"?"var(--warn-bg)":be==="danger"?"var(--danger-bg)":"var(--chip)",W=be==="ok"?"var(--ok-bd)":be==="warn"?"var(--warn-bd)":be==="danger"?"var(--danger-bd)":"var(--border)",$=be==="ok"?"var(--ok-tx)":be==="warn"?"var(--warn-tx)":be==="danger"?"var(--danger-tx)":"var(--text-muted)";return a.jsx("span",{style:{display:"inline-block",background:A,border:`1px solid ${W}`,color:$,borderRadius:999,padding:"4px 10px",fontSize:12,lineHeight:1},children:ie})}return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[a.jsx("h2",{style:{margin:0},children:f==="route"?`🧭 ${w?.nombre||"Ruta"} (${w?.fecha||"—"})`:"🧭 Ruta hacia el destino"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx("button",{onClick:()=>e(-1),children:"← Volver"}),a.jsx("button",{onClick:()=>de(!0),disabled:!Number.isFinite(_.lat),children:"Abrir en Google Maps (con origen)"}),a.jsx("button",{onClick:()=>de(!1),disabled:!Number.isFinite(_.lat),children:"Abrir en Google Maps (solo destino)"})]})]}),f==="route"&&a.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,flexWrap:"wrap"},children:[w?.mensajeroNombre&&a.jsxs("span",{className:"pill",children:["Mensajero: ",a.jsx("b",{children:w.mensajeroNombre})]}),w?.estado&&a.jsxs("span",{className:"pill",children:["Estado ruta: ",a.jsx("b",{children:String(w.estado).toUpperCase()})]}),a.jsxs("span",{className:"pill",children:["Órdenes: ",a.jsx("b",{children:I.length})]})]}),H&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),!!F&&a.jsx("div",{style:{marginTop:8,color:"#b00"},children:F}),a.jsxs("div",{style:{marginTop:8,fontSize:14,color:"#333"},children:[Number.isFinite(se.lat)&&Number.isFinite(se.lng)?a.jsxs("div",{children:[a.jsx("b",{children:"Origen:"})," ",se.etiqueta," (",se.lat?.toFixed(5),", ",se.lng?.toFixed(5),")"]}):a.jsxs("div",{children:[a.jsx("b",{children:"Origen:"})," — (activa tu GPS o registra tu ubicación)"]}),Number.isFinite(_.lat)&&Number.isFinite(_.lng)?a.jsxs("div",{children:[a.jsx("b",{children:"Destino seleccionado:"})," ",_.etiqueta," (",_.lat?.toFixed(5),", ",_.lng?.toFixed(5),")"]}):a.jsxs("div",{children:[a.jsx("b",{children:"Destino seleccionado:"})," —"]}),(q||j)&&a.jsxs("div",{style:{marginTop:4},children:[q&&a.jsxs("span",{children:[a.jsx("b",{children:"Distancia:"})," ",q," km"]}),j!=null&&a.jsxs("span",{children:["  •  ",a.jsx("b",{children:"ETA:"})," ",j," min"]})]})]}),a.jsx("div",{style:{height:560,marginTop:10},children:a.jsxs(ku,{center:U,zoom:12,style:{height:"100%",width:"100%"},children:[a.jsx(Ou,{attribution:"© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Number.isFinite(se.lat)&&Number.isFinite(se.lng)&&a.jsx(ks,{position:[se.lat,se.lng],icon:O6,children:a.jsxs(Sa,{children:["Origen: ",se.etiqueta||"Tu ubicación"]})}),f==="route"?I.map(ie=>{const be=Li(ie?.destinoLat??ie?.address?.lat),A=Li(ie?.destinoLng??ie?.address?.lng);if(!Number.isFinite(be)||!Number.isFinite(A))return null;const W=_.orderId===ie.id;return a.jsx(ks,{position:[be,A],icon:W?D6:rE,children:a.jsx(Sa,{children:a.jsxs("div",{style:{minWidth:180},children:[a.jsx("div",{style:{fontWeight:700},children:ie.cliente||"Cliente"}),a.jsx("div",{style:{fontSize:12,color:"#555"},children:ie.numeroFactura||"—"}),a.jsx("div",{style:{fontSize:12,marginTop:4},children:ie.direccionTexto||ie.address?.formatted||"Sin dirección"}),a.jsxs("div",{style:{marginTop:6},children:[a.jsx("button",{onClick:()=>{v({lat:be,lng:A,etiqueta:ie.direccionTexto||ie.address?.formatted||ie.cliente||"Destino",orderId:ie.id})},children:"Trazar hasta aquí"})," ",a.jsx("button",{onClick:()=>e(`/orden/${ie.id}`),children:"Ver orden"})]})]})})},ie.id)}):Number.isFinite(_.lat)&&Number.isFinite(_.lng)&&a.jsx(ks,{position:[_.lat,_.lng],icon:rE,children:a.jsxs(Sa,{children:["Destino: ",_.etiqueta||"Destino"]})}),we.length>1&&a.jsx(Sp,{positions:we,weight:5,opacity:.85}),a.jsx(L6,{points:k})]})}),f==="route"&&a.jsxs("section",{className:"card",style:{marginTop:14},children:[a.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:16},children:"Órdenes de la ruta"}),a.jsx("div",{style:{overflowX:"auto"},children:I.length?a.jsxs("table",{className:"nice-table",style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{textAlign:"left",padding:"8px 10px",borderBottom:"1px solid #eee"},children:"Cliente"}),a.jsx("th",{style:{textAlign:"left",padding:"8px 10px",borderBottom:"1px solid #eee"},children:"Factura"}),a.jsx("th",{style:{textAlign:"left",padding:"8px 10px",borderBottom:"1px solid #eee"},children:"Dirección"}),a.jsx("th",{style:{textAlign:"left",padding:"8px 10px",borderBottom:"1px solid #eee"},children:"Estado"}),a.jsx("th",{style:{width:280,padding:"8px 10px",borderBottom:"1px solid #eee"},children:"Acciones"})]})}),a.jsx("tbody",{children:I.map(ie=>{const be=Li(ie?.destinoLat??ie?.address?.lat),A=Li(ie?.destinoLng??ie?.address?.lng),W=ae(ie),$=Y(ie);return a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f2f2ff",fontWeight:600},children:ie.cliente||"—"}),a.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f2f2ff"},children:ie.numeroFactura||"—"}),a.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f2f2ff",minWidth:220},children:ie.direccionTexto||ie.address?.formatted||"—"}),a.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f2f2ff"},children:a.jsx(ye,{tone:$,children:W})}),a.jsx("td",{style:{padding:"8px 10px",borderBottom:"1px solid #f3f2f2ff"},children:a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>e(`/orden/${ie.id}`),children:"👁️ Ver"}),a.jsx("button",{onClick:()=>{Number.isFinite(be)&&Number.isFinite(A)?(v({lat:be,lng:A,etiqueta:ie.direccionTexto||ie.address?.formatted||ie.cliente||"Destino",orderId:ie.id}),window.scrollTo({top:0,behavior:"smooth"})):alert("Esta orden no tiene coordenadas.")},children:"🧭 Trazar"}),Number.isFinite(be)&&Number.isFinite(A)&&a.jsx("button",{onClick:()=>{const te=`${be},${A}`;if(Number.isFinite(se.lat)&&Number.isFinite(se.lng)){const me=`${se.lat},${se.lng}`;window.open(`https://www.google.com/maps/dir/?api=1&origin=${me}&destination=${te}&travelmode=driving`,"_blank")}else window.open(`https://www.google.com/maps/dir/?api=1&destination=${te}&travelmode=driving`,"_blank")},children:"📍 Google Maps"})]})})]},ie.id)})})]}):a.jsx("div",{className:"muted",children:"No hay órdenes asignadas a esta ruta."})})]})]})}if(!document.getElementById("ruta-mensajero-soft-styles")){const n=document.createElement("style");n.id="ruta-mensajero-soft-styles",n.innerHTML=`
  :root{
    --border:#e5e7eb;
    --text-muted:#6b7280;
    --chip:#f5f7fa;
    --ok-bg:#ecfdf5; --ok-bd:#a7f3d0; --ok-tx:#047857;
    --warn-bg:#fff7ed; --warn-bd:#fed7aa; --warn-tx:#9a3412;
    --danger-bg:#fef2f2; --danger-bd:#fecaca; --danger-tx:#991b1b;
  }
  .pill{
    display:inline-block;padding:6px 10px;border-radius:999px;
    border:1px solid var(--border);background:#f8fafc;color:#374151;
    font-size:12px;font-weight:600
  }
  .muted{ color: var(--text-muted); font-size: 13px; }
  `,document.head.appendChild(n)}const V6="ubicacionesMensajeros",sE="ordenes",U6=new na.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",iconSize:[36,36],iconAnchor:[18,36],popupAnchor:[0,-30]}),F6=na.divIcon({className:"yo-dot",html:'<span class="mm-yo"></span>',iconSize:[18,18],iconAnchor:[9,9],popupAnchor:[0,-10]}),Fv=n=>na.divIcon({className:"destino-dot",html:`<span style="
      display:inline-block;width:18px;height:18px;border-radius:50%;
      border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,.4);background:${n};
    "></span>`,iconSize:[18,18],iconAnchor:[9,9],popupAnchor:[0,-10]}),z6=Fv("#e53935"),B6=Fv("#fb8c00"),H6=Fv("#43a047");function aE(n){return n?.entregado?H6:n?.recibida?B6:z6}function oE(){const n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function rm(n,e,t=!0){const r=`${Number(n)},${Number(e)}`,l=u=>{const f=u?`https://www.google.com/maps/dir/?api=1&origin=${u}&destination=${r}&travelmode=driving`:`https://www.google.com/maps/dir/?api=1&destination=${r}&travelmode=driving`;window.open(f,"_blank")};if(!t)return l(null);"geolocation"in navigator?navigator.geolocation.getCurrentPosition(u=>l(`${u.coords.latitude},${u.coords.longitude}`),()=>l(null),{enableHighAccuracy:!0,timeout:6e3}):l(null)}function lE({to:n,children:e="Centrar mensajero",zoom:t=15}){const r=fc();return!n||!Number.isFinite(n[0])||!Number.isFinite(n[1])?null:a.jsx("button",{className:"mm-btn",style:{padding:"4px 8px"},onClick:()=>r.flyTo(n,t),children:e})}function q6({bounds:n}){const e=fc();return a.jsx("button",{onClick:()=>{!n||n.length===0||e.fitBounds(n,{padding:[30,30]})},className:"mm-btn mm-fab",style:{position:"absolute",zIndex:1e3,top:12,right:12},title:"Ajustar mapa a mensajeros y destinos",children:"Ajustar vista"})}function $6({onFound:n}){const e=fc();return a.jsx("button",{className:"mm-btn mm-fab",style:{position:"absolute",zIndex:1e3,top:56,right:12},onClick:()=>{if(!("geolocation"in navigator))return alert("Geolocalización no soportada");navigator.geolocation.getCurrentPosition(t=>{const r=t.coords.latitude,l=t.coords.longitude;n&&n({lat:r,lng:l}),e.setView([r,l],15)},t=>alert(t?.message||"No pude obtener tu ubicación"),{enableHighAccuracy:!0,timeout:7e3})},title:"Centrar en mi ubicación",children:"Mi ubicación"})}function sm({estado:n}){const e=(n||"").toLowerCase(),t=e==="en_ruta"?"#22c55e":e==="disponible"?"#3b82f6":e==="listo_para_ruta"?"#6d28d9":"#999",r=e==="en_ruta"?"En ruta":e==="disponible"?"Disponible":e==="listo_para_ruta"?"Listo para ruta":"Inactivo";return a.jsx("span",{style:{display:"inline-block",padding:"2px 8px",borderRadius:12,background:t,color:"#fff",fontSize:12},children:r})}function G6(){const n=(e,t)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:4},children:[a.jsx("span",{style:{display:"inline-block",width:12,height:12,borderRadius:"50%",background:e,border:"1px solid #fff",boxShadow:"0 0 1px rgba(0,0,0,.5)"}}),a.jsx("span",{children:t})]});return a.jsxs("div",{className:"mm-card",style:{position:"absolute",bottom:12,left:12,zIndex:1e3,fontSize:12,color:"#333"},children:[a.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Estados del destino"}),n("#e53935","Pendiente"),n("#fb8c00","Recibida"),n("#43a047","Entregada")]})}function Dd(n){const e=n?.address?.lat??n?.destino?.lat??n?.destinoLat??null,t=n?.address?.lng??n?.destino?.lng??n?.destinoLng??null,r=typeof e=="number"?e:e!=null?Number(e):NaN,l=typeof t=="number"?t:t!=null?Number(t):NaN,u=Number.isFinite(r)?r:null,f=Number.isFinite(l)?l:null;return{lat:u,lng:f}}function Ld(){const n=rr(),{id:e}=Su(),{state:t}=es()||{},r=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),l=r?.empresaId!=null?String(r.empresaId):null,u=typeof t?.lat=="number"?t.lat:t?.lat!=null?Number(t.lat):null,f=typeof t?.lng=="number"?t.lng:t?.lng!=null?Number(t.lng):null,y=Number.isFinite(u)&&Number.isFinite(f),_=e||t?.ordenId||null,v=!!(y||_),[w,R]=E.useState([]),[I,G]=E.useState([]),[H,Z]=E.useState(""),[F,Q]=E.useState(y?{id:_||"sin-id",cliente:t?.cliente||"",numeroFactura:t?.numeroFactura||"",direccionTexto:t?.direccion||t?.address?.formatted||"",address:t?.address||(y?{lat:u,lng:f}:null)}:null),[se,ue]=E.useState(!1),[we,Ce]=E.useState(""),[Ue,P]=E.useState(!0),[M,D]=E.useState(!0),[U,k]=E.useState("carto"),q=U==="carto"?{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:"&copy; OpenStreetMap &copy; CARTO"}:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; OpenStreetMap contributors"},[j,de]=E.useState(null),ae=E.useMemo(()=>[18.4861,-69.9312],[]);E.useEffect(()=>{(async()=>await Qn()||Z("No hay sesión de Firebase. Inicia sesión nuevamente."))()},[]),E.useEffect(()=>{let J=null;return(async()=>{if(!await Qn()){Z("No autenticado.");return}if(!l){Z("Falta empresaId.");return}const re=Bt(ze,V6),he=en(re,Nt("empresaId","==",l));J=Kt(he,Ae=>{const K=Ae.docs.map(le=>{const Re=le.data()||{};return{id:le.id,nombre:Re.nombre||le.id,estado:(Re.estado||"disponible").toLowerCase(),lat:Re.lat,lng:Re.lng,lastPingAt:Re.lastPingAt?.toDate?Re.lastPingAt.toDate():null}});R(K),Z("")},Ae=>{console.error("onSnapshot ubicacionesMensajeros:",Ae),Ae?.code==="permission-denied"?Z("Permiso denegado al leer ubicaciones. Verifica reglas y que los docs tengan empresaId."):Z(Ae?.message||"No pude leer ubicaciones.")})})(),()=>{J&&J()}},[l]),E.useEffect(()=>{if(v)return;let J=null;return(async()=>{if(!await Qn()){Z("No autenticado.");return}if(!l){Z("Falta empresaId.");return}const re=Bt(ze,sE),he=en(re,Nt("empresaId","==",l),Fr("createdAt","desc"));J=Kt(he,Ae=>{const K=Ae.docs.map(le=>({id:le.id,...le.data()}));G(K),Z("")},Ae=>Z(Ae?.message||"No pude leer órdenes."))})(),()=>{J&&J()}},[v,l]),E.useEffect(()=>{let J=!0;return(async()=>{if(!v||y||!_)return;if(!await Qn()){Ce("No autenticado.");return}ue(!0),Ce("");try{const re=gt(ze,sE,_),he=await Jr(re);if(!J)return;if(!he.exists()){Ce("No encontré la orden en la base de datos."),Q(null);return}const Ae=he.data();Q({id:_,...Ae})}catch(re){console.error("MapaMensajeros loadFocusOrder:",re),Ce("Error al cargar la orden.")}finally{ue(!1)}})(),()=>{J=!1}},[v,y,_]);const Y=E.useMemo(()=>{if(v)return[];const J=oE();return I.filter(oe=>{if(M&&oe.entregado||Ue&&oe.fecha!==J)return!1;const{lat:re,lng:he}=Dd(oe);return!(!Number.isFinite(re)||!Number.isFinite(he))})},[v,I,M,Ue]),ye=E.useMemo(()=>{const J=[];if(v){const oe=F;if(oe){const{lat:re,lng:he}=Dd(oe);Number.isFinite(re)&&Number.isFinite(he)&&J.push([re,he])}else y&&Number.isFinite(u)&&Number.isFinite(f)&&J.push([u,f]);return w.forEach(re=>{const he=Number(re.lat),Ae=Number(re.lng);Number.isFinite(he)&&Number.isFinite(Ae)&&J.push([he,Ae])}),J}return w.forEach(oe=>{const re=Number(oe.lat),he=Number(oe.lng);Number.isFinite(re)&&Number.isFinite(he)&&J.push([re,he])}),Y.forEach(oe=>{const{lat:re,lng:he}=Dd(oe);Number.isFinite(re)&&Number.isFinite(he)&&J.push([re,he])}),j&&Number.isFinite(j.lat)&&Number.isFinite(j.lng)&&J.push([j.lat,j.lng]),J},[v,F,y,u,f,w,Y,j]),ie=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("ubicacionMensajero")||"null")}catch{return null}},[]),be=E.useMemo(()=>y?{lat:u,lng:f}:F?Dd(F):{lat:null,lng:null},[y,u,f,F]),A=t?.direccion||t?.address?.formatted||F?.direccionTexto||F?.address?.formatted||"",W=t?.cliente||F?.cliente||"",$=t?.numeroFactura||F?.numeroFactura||"",te=v&&Number.isFinite(be.lat)&&Number.isFinite(be.lng),me=E.useMemo(()=>{const J={total:w.length,disponible:w.filter(re=>re.estado==="disponible").length,en_ruta:w.filter(re=>re.estado==="en_ruta").length,listo_para_ruta:w.filter(re=>re.estado==="listo_para_ruta").length,otros:w.filter(re=>!["disponible","en_ruta","listo_para_ruta"].includes(re.estado)).length},oe={total:Y.length,pendientes:Y.filter(re=>!re.entregado&&!re.recibida).length,recibidas:Y.filter(re=>re.recibida&&!re.entregado).length,entregadas:Y.filter(re=>re.entregado).length};return{mens:J,dest:oe}},[w,Y]);try{if(!document.getElementById("mapaMensajerosCss")){const J=document.createElement("style");J.id="mapaMensajerosCss",J.innerHTML=`
        .mm-card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 1px 2px rgba(16,24,40,.04);padding:10px}
        .mm-kpis{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
        .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600;line-height:1}
        .pill.blue{background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
        .pill.green{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}
        .pill.gray{background:#f1f5f9;border-color:#e2e8f0;color:#334155}
        .pill.orange{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
        .mm-btn{background:#ffffff;border:1px solid #e5e7eb;border-radius:10px;padding:8px 12px;cursor:pointer;color:#374151}
        .mm-btn:hover{background:#f8fafc}
        .mm-fab{box-shadow:0 1px 4px rgba(0,0,0,.08)}
        .mm-topbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:6px;margin-bottom:10px}
        .mm-yo{display:inline-block;width:18px;height:18px;border-radius:50%;background:#2563eb;border:2px solid #fff;box-shadow:0 0 0 4px rgba(37,99,235,.15)}
      `,document.head.appendChild(J)}}catch{}return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[a.jsx("h2",{style:{margin:0},children:v?"🧭 Mapa de entrega (enfocado)":"🗺️ Mapa: Mensajeros + Destinos"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx("button",{onClick:()=>n(-1),children:"← Volver"}),!v&&a.jsx("button",{onClick:()=>window.dispatchEvent(new Event("ajustar-vista")),title:"Ajustar mapa a mensajeros y destinos",children:"Ajustar vista"})]})]}),!v&&a.jsx("div",{className:"mm-card",children:a.jsxs("div",{className:"mm-kpis",children:[a.jsxs("span",{className:"pill gray",children:["Mensajeros: ",a.jsx("b",{children:me.mens.total})]}),a.jsxs("span",{className:"pill blue",children:["Disponibles: ",a.jsx("b",{children:me.mens.disponible})]}),a.jsxs("span",{className:"pill green",children:["En ruta: ",a.jsx("b",{children:me.mens.en_ruta})]}),a.jsxs("span",{className:"pill gray",children:["Listos: ",a.jsx("b",{children:me.mens.listo_para_ruta})]}),a.jsxs("span",{className:"pill gray",children:["Otros: ",a.jsx("b",{children:me.mens.otros})]}),a.jsxs("span",{className:"pill gray",style:{marginLeft:12},children:["Destinos: ",a.jsx("b",{children:me.dest.total})]}),a.jsxs("span",{className:"pill orange",children:["Pendientes: ",a.jsx("b",{children:me.dest.pendientes})]}),a.jsxs("span",{className:"pill blue",children:["Recibidas: ",a.jsx("b",{children:me.dest.recibidas})]}),a.jsxs("span",{className:"pill green",children:["Entregadas: ",a.jsx("b",{children:me.dest.entregadas})]}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[a.jsx("label",{style:{fontSize:12,color:"#334155"},children:"Mapa base"}),a.jsxs("select",{value:U,onChange:J=>k(J.target.value),className:"mm-btn",style:{padding:"6px 8px"},children:[a.jsx("option",{value:"carto",children:"Claro (recomendado)"}),a.jsx("option",{value:"osm",children:"Clásico OSM"})]})]})]})}),!v&&a.jsxs("div",{className:"mm-topbar",children:[a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:Ue,onChange:J=>P(J.target.checked)}),"Solo hoy (",oE(),")"]}),a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:M,onChange:J=>D(J.target.checked)}),"Solo pendientes"]}),a.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#555"},children:[a.jsx("span",{style:{marginRight:10},children:"📍 Mensajero"}),a.jsx("span",{children:"📦 Destino"}),ie&&Number.isFinite(Number(ie.lat))&&Number.isFinite(Number(ie.lng))&&a.jsxs("div",{style:{marginTop:2},children:["Mi última ubicación: ",Number(ie.lat).toFixed(5),", ",Number(ie.lng).toFixed(5)]})]})]}),H&&a.jsx("div",{style:{color:"#b00",marginBottom:8},children:H}),v&&a.jsxs("div",{style:{padding:"8px 0",fontSize:14,color:"#333"},children:[se&&a.jsx("div",{children:"Cargando orden…"}),!se&&we&&a.jsx("div",{style:{color:"#b00",marginBottom:6},children:we}),W&&a.jsxs("span",{children:[a.jsx("b",{children:"Cliente:"})," ",W,"  •  "]}),$&&a.jsxs("span",{children:[a.jsx("b",{children:"Factura:"})," ",$,"  •  "]}),A&&a.jsxs("span",{children:[a.jsx("b",{children:"Dirección:"})," ",A]}),!te&&!se&&a.jsxs("div",{style:{marginTop:8},children:["No hay coordenadas para esta orden.",_&&a.jsx("button",{style:{marginLeft:8},onClick:()=>n(`/seleccionar-destino/${_}`,{state:{ordenId:_}}),children:"Seleccionar/Confirmar destino"})]})]}),a.jsxs("div",{style:{height:560,position:"relative"},children:[a.jsx(G6,{}),a.jsxs(ku,{center:ae,zoom:v?15:12,style:{height:"100%",width:"100%"},children:[a.jsx(Ou,{attribution:q.attribution,url:q.url}),w.map(J=>{const oe=Number(J.lat),re=Number(J.lng);if(!Number.isFinite(oe)||!Number.isFinite(re))return null;const he=[oe,re],Ae=J.lastPingAt?J.lastPingAt.toLocaleString():"",K=J.estado==="en_ruta"?"#22c55e":J.estado==="disponible"?"#3b82f6":J.estado==="listo_para_ruta"?"#6d28d9":"#94a3b8";return a.jsxs(E.Fragment,{children:[a.jsx(h6,{center:he,radius:14,pathOptions:{color:K,fillColor:K,fillOpacity:.12,weight:1}}),a.jsxs(ks,{position:he,icon:U6,children:[a.jsx(Hw,{permanent:!0,direction:"top",offset:[0,-18],children:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("b",{children:J.nombre||J.id})," ",a.jsx(sm,{estado:J.estado})]})}),a.jsx(Sa,{children:a.jsxs("div",{style:{fontSize:14},children:[a.jsxs("div",{style:{marginBottom:4},children:[a.jsx("b",{children:"Mensajero:"})," ",J.nombre||J.id,"   ",a.jsx(sm,{estado:J.estado})]}),a.jsxs("div",{children:[a.jsx("b",{children:"Lat/Lng:"})," ",oe.toFixed(5),", ",re.toFixed(5)]}),a.jsxs("div",{children:[a.jsx("b",{children:"Último ping:"})," ",Ae||"—"]})]})})]})]},`rider-wrap-${J.id}`)}),!v&&Y.map(J=>{const{lat:oe,lng:re}=Dd(J);if(!Number.isFinite(oe)||!Number.isFinite(re))return null;const he=J.entregado?"ENTREGADA":J.recibida?"RECIBIDA":"PENDIENTE",Ae=J.asignadoUid||null,K=J.asignadoNombre||"—",le=Ae?w.find(Ge=>String(Ge.id)===String(Ae)):null,Re=le&&Number.isFinite(Number(le.lat))&&Number.isFinite(Number(le.lng))?[Number(le.lat),Number(le.lng)]:null;return a.jsx(ks,{position:[oe,re],icon:aE(J),children:a.jsx(Sa,{children:a.jsxs("div",{style:{fontSize:14,minWidth:240},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Cliente:"})," ",J.cliente]}),a.jsxs("div",{children:[a.jsx("b",{children:"Tel:"})," ",J.telefono||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Factura:"})," ",J.numeroFactura]}),a.jsxs("div",{children:[a.jsx("b",{children:"Fecha/Hora:"})," ",J.fecha," ",J.hora]}),a.jsxs("div",{children:[a.jsx("b",{children:"Estado:"})," ",he]}),a.jsxs("div",{style:{marginTop:6},children:[a.jsx("b",{children:"Mensajero asignado:"})," ",K,Ae&&a.jsxs("span",{style:{fontSize:12,color:"#6b7280"},children:[" (",String(Ae).slice(0,6),"…)"]})," ",le&&a.jsx(sm,{estado:le.estado})]}),a.jsx("div",{style:{marginTop:6,fontSize:12,color:"#555"},children:J.direccionTexto||J.address?.formatted}),a.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>rm(oe,re,!0),className:"mm-btn",style:{padding:"4px 8px"},children:"Ruta desde aquí"}),a.jsx("button",{onClick:()=>rm(oe,re,!1),className:"mm-btn",style:{padding:"4px 8px"},children:"Solo destino"}),Re&&a.jsx(lE,{to:Re,children:"Centrar mensajero"}),a.jsx(Zt,{className:"mm-btn",style:{padding:"4px 8px"},to:`/orden/${J.id}`,children:"Ver orden"})]})]})})},`ord-${J.id}`)}),v&&te&&a.jsxs(a.Fragment,{children:[a.jsx(ks,{position:[be.lat,be.lng],icon:aE(F),children:a.jsx(Sa,{children:a.jsxs("div",{style:{fontSize:14,minWidth:240},children:[t?.cliente||F?.cliente?a.jsxs("div",{children:[a.jsx("b",{children:"Cliente:"})," ",t?.cliente||F?.cliente]}):null,t?.numeroFactura||F?.numeroFactura?a.jsxs("div",{children:[a.jsx("b",{children:"Factura:"})," ",t?.numeroFactura||F?.numeroFactura]}):null,(F?.asignadoNombre||F?.asignadoUid)&&a.jsxs("div",{style:{marginTop:6},children:[a.jsx("b",{children:"Mensajero asignado:"})," ",F.asignadoNombre||"—",F.asignadoUid&&a.jsxs("span",{style:{fontSize:12,color:"#6b7280"},children:[" (",String(F.asignadoUid).slice(0,6),"…)"]}),(()=>{const J=F?.asignadoUid?w.find(oe=>String(oe.id)===String(F.asignadoUid)):null;return J?a.jsx("span",{style:{marginLeft:6},children:a.jsx(sm,{estado:J.estado})}):null})()]}),t?.direccion||t?.address?.formatted||F?.direccionTexto||F?.address?.formatted?a.jsx("div",{style:{marginTop:6,fontSize:12,color:"#555"},children:t?.direccion||t?.address?.formatted||F?.direccionTexto||F?.address?.formatted}):null,a.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>rm(be.lat,be.lng,!0),className:"mm-btn",style:{padding:"4px 8px"},children:"Ruta desde aquí"}),a.jsx("button",{onClick:()=>rm(be.lat,be.lng,!1),className:"mm-btn",style:{padding:"4px 8px"},children:"Solo destino"}),(()=>{const J=F?.asignadoUid?w.find(re=>String(re.id)===String(F.asignadoUid)):null,oe=J&&Number.isFinite(Number(J.lat))&&Number.isFinite(Number(J.lng))?[Number(J.lat),Number(J.lng)]:null;return oe?a.jsx(lE,{to:oe,children:"Centrar mensajero"}):null})(),F?.id&&a.jsx(Zt,{className:"mm-btn",style:{padding:"4px 8px"},to:`/orden/${F.id}`,children:"Ver orden"})]})]})})}),(()=>{const J=F?.asignadoUid?w.find(re=>String(re.id)===String(F.asignadoUid)):null,oe=J&&Number.isFinite(Number(J.lat))&&Number.isFinite(Number(J.lng))?[Number(J.lat),Number(J.lng)]:null;return oe?a.jsx(Sp,{positions:[oe,[be.lat,be.lng]],pathOptions:{color:"#64748b",weight:3,opacity:.7,dashArray:"6 6"}}):null})()]}),j&&Number.isFinite(j.lat)&&Number.isFinite(j.lng)&&a.jsx(ks,{position:[j.lat,j.lng],icon:F6,children:a.jsx(Hw,{direction:"top",offset:[0,-8],children:"Mi ubicación"})}),a.jsx(Z6,{bounds:ye}),a.jsx(q6,{bounds:ye}),a.jsx($6,{onFound:de})]})]})]})}function Z6({bounds:n}){const e=fc();return E.useEffect(()=>{n&&n.length>0&&e.fitBounds(n,{padding:[30,30]})},[n,e]),E.useEffect(()=>{function t(){n&&n.length>0&&e.fitBounds(n,{padding:[30,30]})}return window.addEventListener("ajustar-vista",t),()=>window.removeEventListener("ajustar-vista",t)},[n,e]),null}function K6(n=new Date){const e=new Date(n);return e.setHours(0,0,0,0),e.toISOString().slice(0,10)}function Xl(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const e=new Date(n).getTime();if(Number.isFinite(e))return e}}catch{}return NaN}function Ly(n){const e=(n?.fecha||"").trim(),t=(n?.hora||"").trim();if(!e)return NaN;const r=/^\d{2}:\d{2}$/.test(t)?t:"00:00",l=new Date(`${e}T${r}:00`).getTime();return Number.isFinite(l)?l:NaN}function am(n,e){const t=Xl(n),r=Xl(e);return Number.isFinite(t)&&Number.isFinite(r)?(t-r)/6e4:null}function cE(n){return Number.isFinite(n)?`${n.toFixed(1)} min`:"—"}function Vy(n,e){return e?`${(n/e*100).toFixed(0)}%`:"—"}function uE(n,e){return Number.isFinite(n)&&Number.isFinite(e)?`https://waze.com/ul?ll=${n},${e}&navigate=yes`:null}function dE(n,e){return Number.isFinite(n)&&Number.isFinite(e)?`https://www.google.com/maps?q=${n},${e}`:null}function hE(n=2,e=.1,t=880,r=250,l=120){const u=window.AudioContext||window.webkitAudioContext;if(!u)return;const f=new u;let y=f.currentTime+.01;for(let _=0;_<n;_++){const v=f.createOscillator(),w=f.createGain();v.type="sine",v.frequency.value=t,w.gain.value=e,v.connect(w),w.connect(f.destination),v.start(y),v.stop(y+r/1e3),y+=(r+l)/1e3}setTimeout(()=>f.close().catch(()=>{}),n*(r+l)+300)}function Uy(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const e=n?.empresaId?String(n.empresaId):null;if(String(n?.rol||"").toLowerCase(),!e)return a.jsx("div",{style:{padding:16,color:"#b00"},children:"Falta empresaId en sesión."});const[t,r]=E.useState(K6()),[l,u]=E.useState(""),[f,y]=E.useState(15),[_,v]=E.useState(30),[w,R]=E.useState(!1),[I,G]=E.useState(!1),[H,Z]=E.useState(!1),[F,Q]=E.useState(!0),[se,ue]=E.useState(Date.now());E.useEffect(()=>{const A=setInterval(()=>ue(Date.now()),15e3);return()=>clearInterval(A)},[]);const[we,Ce]=E.useState([]),[Ue,P]=E.useState(!1),[M,D]=E.useState("");E.useEffect(()=>{if(!e)return;let A=[],W=!0;return(async()=>{if(P(!0),D(""),!await Qn()){D("Sesión inválida."),P(!1);return}try{const te=Bt(ze,"programasEntrega"),me=en(te,Nt("empresaId","==",e),Nt("status","==","published"),Nt("fecha","==",t),Fr("createdAt","desc")),J=Kt(me,oe=>{const re=oe.docs.map(he=>({id:he.id,...he.data(),__ordenes:[],__unsub:null}));A.forEach(he=>he&&he()),A=[],re.forEach(he=>{const Ae=Bt(ze,"ordenes"),K=en(Ae,Nt("empresaId","==",e),Nt("programacionId","==",he.id)),le=Kt(K,Re=>{const Ge=Re.docs.map(Je=>({id:Je.id,...Je.data()}));Ce(Je=>{const Ze=[...Je.length?Je:re],Ct=Ze.findIndex(Ot=>Ot.id===he.id);return Ct>=0?Ze[Ct]={...Ze[Ct],__ordenes:Ge}:Ze.push({...he,__ordenes:Ge}),Ze})});A.push(le)}),Ce(re),P(!1)},oe=>{D(oe?.message||"No pude leer programaciones."),P(!1)});A.push(J)}catch(te){D(te?.message||"No pude iniciar la suscripción."),P(!1)}})(),()=>{A.forEach($=>$&&$())}},[e,t]);const U=E.useMemo(()=>{const A=new Set;for(const W of we)W.conductorNombre&&A.add(W.conductorNombre);return["",...Array.from(A).sort((W,$)=>W.localeCompare($))]},[we]);async function k(A,W){try{await mr(gt(ze,"programasEntrega",A.id),{estadoRuta:W,estadoRutaUpdatedAt:ut(),startedAt:W==="en_progreso"?ut():A.startedAt||null,finishedAt:W==="finalizada"?ut():null}),A.conductorUid&&await mi(gt(ze,"ubicacionesMensajeros",A.conductorUid),{estado:W==="en_progreso"?"en_ruta":"disponible",estadoUpdatedAt:ut(),lastPingAt:ut(),empresaId:e,nombre:A.conductorNombre||A.conductorUid},{merge:!0}),alert(`Ruta ${A.nombreRuta||A.id} → ${W}`)}catch($){alert($?.message||"No pude actualizar el estado de la ruta.")}}async function q(A){try{await mr(gt(ze,"ordenes",A.id),{recibida:!0,fechaRecibida:ut()})}catch(W){alert(W?.message||"No pude marcar recibida.")}}async function j(A){try{await mr(gt(ze,"ordenes",A.id),{entregado:!0,fechaEntregada:ut()})}catch(W){alert(W?.message||"No pude marcar entregada.")}}function de(A){const W=A.__ordenes||[],$=W.length;let te=0,me=0,J=0,oe=0,re=0;const he=(Number.isFinite(f)?f:15)*6e4,Ae=(Number.isFinite(_)?_:30)*6e4,K=se;let le=0,Re=0;for(const Ge of W){Ge.recibida&&me++,Ge.entregado&&te++;const Je=am(Ge.fechaEntregada,Ge.createdAt);Number.isFinite(Je)&&(le+=Je,Re++);const Ze=Ly(Ge),Ct=Xl(Ge.fechaEntregada);Ge.entregado&&Number.isFinite(Ze)&&Number.isFinite(Ct)&&Ct<=Ze+he&&J++,!Ge.entregado&&Number.isFinite(Ze)&&K>Ze+he&&oe++,!Ge.entregado&&Number.isFinite(Ze)&&K<=Ze+he&&Ze+he-K<=Ae&&re++}return{tot:$,ent:te,rec:me,pend:$-te,pctEnt:Vy(te,$||0),pctRec:Vy(me,$||0),onTime:J,onTimePct:Vy(J,te||0),atrasadas:oe,porVencer:re,avgTotal:Re?le/Re:null}}const ae=E.useMemo(()=>{const A=[],W=[],$={},te=(Number.isFinite(f)?f:15)*6e4,me=(Number.isFinite(_)?_:30)*6e4;for(const J of we){const oe=[],re=[];for(const he of J.__ordenes||[]){if(he.entregado)continue;const Ae=Ly(he);if(!Number.isFinite(Ae))continue;const K=Ae+te-se,le={programaId:J.id,ruta:J.nombreRuta||J.id,conductor:J.conductorNombre||"",orderId:he.id,cliente:he.cliente||"",factura:he.numeroFactura||"",hora:he.hora||"",remainingMin:K/6e4,orden:he};K<0?(A.push(le),oe.push(le)):K<=me&&(W.push(le),re.push(le))}$[J.id]={criticas:oe,porVencer:re}}return A.sort((J,oe)=>J.remainingMin-oe.remainingMin),W.sort((J,oe)=>J.remainingMin-oe.remainingMin),{criticas:A,vencen:W,porPrograma:$}},[we,se,f,_]),Y=E.useRef(0);E.useEffect(()=>{const A=ae.criticas.length;!H&&A>Y.current&&hE(3,.12,880,220,120),Y.current=A},[ae.criticas.length,H]);function ye(A,W){if(!W?.length)return;const $=Object.keys(W[0]),te=[$.join(","),...W.map(re=>$.map(he=>`"${String(re[he]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),me=new Blob([te],{type:"text/csv;charset=utf-8;"}),J=URL.createObjectURL(me),oe=document.createElement("a");oe.href=J,oe.download=A,oe.click(),URL.revokeObjectURL(J)}function ie(A){const W=(A.__ordenes||[]).map($=>({programacionId:A.id,ruta:A.nombreRuta||"",fecha:A.fecha||"",conductor:A.conductorNombre||"",orderId:$.id,cliente:$.cliente||"",factura:$.numeroFactura||"",programada_hora:$.hora||"",recibida_at:$.fechaRecibida?new Date(Xl($.fechaRecibida)).toLocaleString():"",entregada_at:$.fechaEntregada?new Date(Xl($.fechaEntregada)).toLocaleString():"",estado:$.entregado?"ENTREGADA":$.recibida?"RECIBIDA":"PENDIENTE",min_total:Number.isFinite(am($.fechaEntregada,$.createdAt))?am($.fechaEntregada,$.createdAt).toFixed(1):""}));ye(`seguimiento_${A.nombreRuta||A.id}_${A.fecha}.csv`,W)}const be=E.useMemo(()=>{let A=we.filter(W=>l?W.conductorNombre===l:!0).sort((W,$)=>(W.nombreRuta||"").localeCompare($.nombreRuta||""));return w&&(A=A.filter(W=>(ae.porPrograma[W.id]?.criticas.length||0)>0)),I&&(A=A.filter(W=>(ae.porPrograma[W.id]?.porVencer.length||0)>0)),A},[we,l,w,I,ae.porPrograma]);return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("h2",{style:{margin:0},children:"🚦 Seguimiento de Rutas (Despacho)"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("label",{children:"Fecha"}),a.jsx("input",{type:"date",value:t,onChange:A=>r(A.target.value)}),a.jsx("label",{children:"Conductor"}),a.jsx("select",{value:l,onChange:A=>u(A.target.value),children:U.map(A=>a.jsx("option",{value:A,children:A||"(Todos)"},A||"__"))}),a.jsx("label",{children:"Tolerancia on-time (min)"}),a.jsx("input",{type:"number",value:f,onChange:A=>y(Number(A.target.value)||0),style:{width:80}})]})]}),a.jsxs("div",{style:{marginTop:10,padding:10,border:"1px solid #ffd180",background:"#fff8e1",borderRadius:10},children:[a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("b",{children:"Alertas SLA"}),a.jsxs("span",{children:["🔴 Críticas: ",a.jsx("b",{children:ae.criticas.length})]}),a.jsxs("span",{children:["⏳ Por vencer ≤",a.jsx("input",{type:"number",value:_,onChange:A=>v(Number(A.target.value)||0),style:{width:60,margin:"0 6px"}}),"min: ",a.jsx("b",{children:ae.vencen.length})]}),a.jsxs("label",{style:{marginLeft:10},children:[a.jsx("input",{type:"checkbox",checked:w,onChange:A=>{R(A.target.checked),A.target.checked&&G(!1)}})," ","Solo críticas"]}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:I,onChange:A=>{G(A.target.checked),A.target.checked&&R(!1)}})," ","Solo por vencer"]}),a.jsx("button",{onClick:()=>Q(A=>!A),children:F?"Ocultar lista":"Ver lista"}),a.jsx("button",{onClick:()=>Z(A=>!A),title:H?"Sonido desactivado":"Sonido activado",children:H?"🔕":"🔔"}),a.jsx("button",{onClick:()=>hE(2),title:"Probar sonido",children:"▶️ Probar"}),a.jsx("div",{style:{marginLeft:"auto",fontSize:12,color:"#555"},children:new Date(se).toLocaleTimeString()})]}),F&&a.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:ae.criticas.length||ae.vencen.length?a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Sr,{children:"Tipo"}),a.jsx(Sr,{children:"Ruta"}),a.jsx(Sr,{children:"Conductor"}),a.jsx(Sr,{children:"Cliente"}),a.jsx(Sr,{children:"Factura"}),a.jsx(Sr,{children:"Hora prog."}),a.jsx(Sr,{children:"SLA"}),a.jsx(Sr,{children:"Acciones"})]})}),a.jsx("tbody",{children:[...ae.criticas.map(A=>({...A,__tipo:"Crítica"})),...ae.vencen.map(A=>({...A,__tipo:"Por vencer"}))].map(A=>{const W=A.orden?.address?.lat??A.orden?.destinoLat,$=A.orden?.address?.lng??A.orden?.destinoLng,te=A.__tipo==="Crítica",me=A.remainingMin,J=te?`Vencida hace ${Math.abs(me).toFixed(0)} min`:`Faltan ${Math.max(0,me).toFixed(0)} min`;return a.jsxs("tr",{style:{background:te?"#ffecec":"#fff6e6"},children:[a.jsxs(jr,{style:{fontWeight:700},children:[te?"🔴":"⏳"," ",A.__tipo]}),a.jsx(jr,{children:A.ruta}),a.jsx(jr,{children:A.conductor||"—"}),a.jsx(jr,{children:A.cliente||"—"}),a.jsx(jr,{children:A.factura||"—"}),a.jsx(jr,{children:A.hora||"—"}),a.jsx(jr,{children:J}),a.jsx(jr,{children:a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[!A.orden?.recibida&&a.jsx("button",{onClick:()=>q(A.orden),children:"🟡 Recibida"}),!A.orden?.entregado&&a.jsx("button",{onClick:()=>j(A.orden),children:"🟢 Entregada"}),Number.isFinite(W)&&Number.isFinite($)&&a.jsxs(a.Fragment,{children:[a.jsx("a",{href:uE(W,$),target:"_blank",rel:"noreferrer",children:"Waze"}),a.jsx("a",{href:dE(W,$),target:"_blank",rel:"noreferrer",children:"Maps"})]})]})})]},`${A.__tipo}-${A.orderId}`)})})]}):a.jsx("div",{style:{fontSize:13,color:"#666"},children:"Sin alertas en este momento."})})]}),M&&a.jsx("div",{style:{marginTop:8,color:"#b00"},children:M}),Ue&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),a.jsx("div",{style:{marginTop:12,display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))"},children:be.map(A=>{const W=de(A),$=W.tot?W.ent/W.tot:0,te=W.atrasadas>0?"#d32f2f":W.pend>0?"#f9a825":"#2e7d32",me=ae.porPrograma[A.id]?.criticas.length||0,J=ae.porPrograma[A.id]?.porVencer.length||0;return a.jsxs("div",{style:{border:"1px solid #eee",borderRadius:10,background:"#fff"},children:[a.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid #eee",display:"flex",gap:8,alignItems:"center"},children:[a.jsx("div",{style:{width:10,height:10,borderRadius:5,background:te}}),a.jsxs("div",{style:{fontWeight:700},children:[A.nombreRuta||A.id,me||J?a.jsxs("span",{style:{marginLeft:8,fontSize:12},children:[me?a.jsxs("strong",{style:{color:"#c62828"},children:[" · 🔴 ",me]}):null,J?a.jsxs("strong",{style:{color:"#ef6c00"},children:[" · ⏳ ",J]}):null]}):null]}),a.jsxs("div",{style:{marginLeft:"auto",fontSize:13,color:"#555"},children:[A.fecha," · ",A.conductorNombre||"—"]})]}),a.jsxs("div",{style:{padding:"10px 12px"},children:[a.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[a.jsx(Qo,{label:"Órdenes",value:W.tot}),a.jsx(Qo,{label:"Entregadas",value:`${W.ent} (${W.pctEnt})`}),a.jsx(Qo,{label:"Recibidas",value:`${W.rec} (${W.pctRec})`}),a.jsx(Qo,{label:"Pendientes",value:W.pend}),a.jsx(Qo,{label:"On-time (entregadas)",value:`${W.onTime} (${W.onTimePct})`}),a.jsx(Qo,{label:"Atrasadas",value:W.atrasadas}),a.jsx(Qo,{label:"Por vencer",value:W.porVencer}),a.jsx(Qo,{label:"Prom. total",value:cE(W.avgTotal)})]}),a.jsx("div",{style:{marginTop:10},children:a.jsx("div",{style:{height:10,background:"#f3f3f3",borderRadius:6},children:a.jsx("div",{style:{width:`${Math.min(100,Math.round($*100))}%`,height:"100%",background:"#1976d2",borderRadius:6}})})}),a.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>k(A,"en_progreso"),children:"▶️ Iniciar ruta"}),a.jsx("button",{onClick:()=>k(A,"finalizada"),children:"⏹️ Finalizar ruta"}),a.jsx("button",{onClick:()=>ie(A),children:"⬇️ Export CSV"})]})]}),a.jsx("div",{style:{borderTop:"1px solid #eee",maxHeight:340,overflow:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx(Sr,{children:"Cliente"}),a.jsx(Sr,{children:"Factura"}),a.jsx(Sr,{children:"Prog"}),a.jsx(Sr,{children:"Recibida"}),a.jsx(Sr,{children:"Entregada"}),a.jsx(Sr,{children:"Duración"}),a.jsx(Sr,{children:"SLA"}),a.jsx(Sr,{children:"Acciones"})]})}),a.jsx("tbody",{children:(A.__ordenes||[]).map(oe=>{const re=oe.hora||"",he=oe.fechaRecibida?new Date(Xl(oe.fechaRecibida)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"—",Ae=oe.fechaEntregada?new Date(Xl(oe.fechaEntregada)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"—",K=cE(am(oe.fechaEntregada,oe.createdAt)),le=oe?.address?.lat??oe?.destinoLat,Re=oe?.address?.lng??oe?.destinoLng,Ge=(Number.isFinite(f)?f:15)*6e4,Je=(()=>{const Ke=Ly(oe);return Number.isFinite(Ke)?Ke+Ge-se:null})(),Ze=Je!=null&&Je<0&&!oe.entregado,Ct=Je!=null&&Je>=0&&Je<=(Number.isFinite(_)?_:30)*6e4&&!oe.entregado,Ot=Je==null?"—":Je<0?`Vencida hace ${Math.abs(Je/6e4).toFixed(0)} min`:`Faltan ${(Je/6e4).toFixed(0)} min`;return a.jsxs("tr",{style:{background:Ze?"#fff4f4":Ct?"#fff9e6":"transparent"},children:[a.jsx(jr,{style:{minWidth:150},children:oe.cliente||"—"}),a.jsx(jr,{children:oe.numeroFactura||"—"}),a.jsx(jr,{children:re||"—"}),a.jsx(jr,{children:he}),a.jsx(jr,{children:Ae}),a.jsx(jr,{children:K}),a.jsx(jr,{style:{fontWeight:Ze?700:500,color:Ze?"#b71c1c":Ct?"#e65100":"#333"},children:Ot}),a.jsx(jr,{children:a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[!oe.recibida&&a.jsx("button",{onClick:()=>q(oe),children:"🟡 Recibida"}),!oe.entregado&&a.jsx("button",{onClick:()=>j(oe),children:"🟢 Entregada"}),Number.isFinite(le)&&Number.isFinite(Re)&&a.jsxs(a.Fragment,{children:[a.jsx("a",{href:uE(le,Re),target:"_blank",rel:"noreferrer",children:"Waze"}),a.jsx("a",{href:dE(le,Re),target:"_blank",rel:"noreferrer",children:"Maps"})]})]})})]},oe.id)})})]})})]},A.id)})}),!be.length&&!Ue&&a.jsx("div",{style:{marginTop:12},children:"No hay rutas publicadas para la fecha seleccionada."})]})}function Qo({label:n,value:e}){return a.jsxs("div",{style:{border:"1px dashed #ddd",borderRadius:10,padding:"8px 10px",minWidth:140},children:[a.jsx("div",{style:{fontSize:12,color:"#666"},children:n}),a.jsx("div",{style:{fontSize:18,fontWeight:700},children:e})]})}const Sr=({children:n})=>a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #eee",padding:"6px 8px",background:"#fafafa",position:"sticky",top:0,zIndex:1},children:n}),jr=({children:n,style:e})=>a.jsx("td",{style:{borderBottom:"1px solid #f2f2f2",padding:"6px 8px",...e},children:n}),W6=na.divIcon({className:"destino-icon",html:'<div style="width:18px;height:18px;border-radius:50%;background:#2e7d32;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,.4)"></div>',iconSize:[18,18],iconAnchor:[9,9]});function om(n){if(typeof n=="number")return n;if(n==null)return null;const e=Number(n);return Number.isFinite(e)?e:null}function Y6({center:n}){const e=fc();return E.useEffect(()=>{if(!n)return;const{lat:t,lng:r}=n;Number.isFinite(t)&&Number.isFinite(r)&&e.setView([t,r],16)},[n,e]),null}function Q6(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}return{id:n?.id||n?.uid||null,nombre:n?.nombre||n?.usuario||"desconocido",rol:(n?.rol||"desconocido").toLowerCase(),empresaId:n?.empresaId!=null?String(n.empresaId):null}}function lm(){const{id:n}=Su(),e=rr(),{state:t}=es()||{},[r,l]=E.useState(!0),[u,f]=E.useState(""),[y,_]=E.useState(null),[v,w]=E.useState(null),R=E.useMemo(()=>[18.4861,-69.9312],[]);E.useEffect(()=>{let H=!0;return(async()=>{if(l(!0),f(""),!await Qn()){f("No hay sesión válida. Inicia sesión de nuevo."),l(!1);return}try{const F=om(t?.lat),Q=om(t?.lng),se=gt(ze,"ordenes",n),ue=await Jr(se);if(!H)return;if(!ue.exists()){f("No encontré la orden."),l(!1);return}const we=ue.data()||{};_({id:n,...we});const Ce=om(we?.destinoLat??we?.address?.lat??F),Ue=om(we?.destinoLng??we?.address?.lng??Q),P=we?.direccionTexto||we?.address?.formatted||t?.direccion||t?.address?.formatted||"";Number.isFinite(Ce)&&Number.isFinite(Ue)?w({lat:Ce,lng:Ue,formatted:P}):w(null),l(!1)}catch(F){console.error("SeleccionarDestino load:",F),f("Error cargando la orden."),l(!1)}})(),()=>{H=!1}},[n,t]);async function I(){if(y){if(!v||!Number.isFinite(Number(v.lat))||!Number.isFinite(Number(v.lng))){alert("Selecciona una ubicación válida (lat/lng).");return}try{await Qn();const H={address:{...v||{},lat:Number(v.lat),lng:Number(v.lng)},destinoLat:Number(v.lat),destinoLng:Number(v.lng),direccionTexto:v?.formatted||y?.direccionTexto||null,updatedAt:ut()};await mr(gt(ze,"ordenes",y.id),H);try{const Z=Q6(),F=String(y?.empresaId??Z?.empresaId??""),Q={...y,...H};await xu({orderId:y.id,empresaId:F,antes:y,despues:Q,actor:Z,motivo:"Actualizar destino",extraMeta:{direccion:H.direccionTexto||""}})}catch(Z){console.warn("No pude escribir en historialCambios (continuo):",Z?.message)}alert("Destino guardado ✅"),e(`/mapa/${y.id}`,{state:{ordenId:y.id,lat:Number(v.lat),lng:Number(v.lng),direccion:v?.formatted||"",cliente:y?.cliente||"",numeroFactura:y?.numeroFactura||"",address:v}})}catch(H){console.error("Guardar destino:",H),alert("No pude guardar el destino. Revisa conexión/reglas.")}}}const G=Number.isFinite(Number(v?.lat))&&Number.isFinite(Number(v?.lng))?[Number(v.lat),Number(v.lng)]:R;return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[a.jsx("h2",{style:{margin:0},children:"📍 Seleccionar/Confirmar destino"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[a.jsx("button",{onClick:()=>e(-1),children:"← Volver"}),a.jsx("button",{onClick:I,disabled:r,children:"Guardar destino"})]})]}),r&&a.jsx("div",{children:"Cargando…"}),!!u&&a.jsx("div",{style:{color:"#b00"},children:u}),y&&a.jsxs("div",{style:{marginBottom:10,fontSize:14,color:"#333"},children:[a.jsxs("div",{children:[a.jsx("b",{children:"Cliente:"})," ",y.cliente||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Factura:"})," ",y.numeroFactura||"—"]}),a.jsxs("div",{children:[a.jsx("b",{children:"Fecha/Hora:"})," ",y.fecha||"—"," ",y.hora||""]})]}),a.jsxs("div",{style:{marginBottom:10},children:[a.jsx("label",{style:{display:"block",marginBottom:6},children:a.jsx("b",{children:"Dirección"})}),a.jsx(lc,{value:v,onChange:w})]}),a.jsx("div",{style:{height:520},children:a.jsxs(ku,{center:G,zoom:15,style:{height:"100%",width:"100%"},children:[a.jsx(Ou,{attribution:"© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Number.isFinite(Number(v?.lat))&&Number.isFinite(Number(v?.lng))&&a.jsx(ks,{position:[Number(v.lat),Number(v.lng)],icon:W6,children:a.jsx(Sa,{children:"Destino seleccionado"})}),a.jsx(Y6,{center:Number.isFinite(Number(v?.lat))&&Number.isFinite(Number(v?.lng))?{lat:Number(v.lat),lng:Number(v.lng)}:null})]})}),a.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#666"},children:["* No modificamos ",a.jsx("code",{children:"empresaId"})," ni ",a.jsx("code",{children:"createdAt"})," para cumplir tus reglas."]})]})}function fE(){const n=[{id:1,parada:"Av. Duarte #120",producto:"Paquete 1",eta:"12:45 PM"},{id:2,parada:"Calle 15 de Agosto",producto:"Paquete 2",eta:"1:10 PM"},{id:3,parada:"Zona Franca, Nave 4",producto:"Paquete 3",eta:"1:40 PM"}];return a.jsxs("div",{children:[a.jsx("h2",{children:"Hora Estimada de Llegada (ETA)"}),a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"#"}),a.jsx("th",{children:"Parada"}),a.jsx("th",{children:"Producto"}),a.jsx("th",{children:"ETA"})]})}),a.jsx("tbody",{children:n.map(e=>a.jsxs("tr",{children:[a.jsx("td",{children:e.id}),a.jsx("td",{children:e.parada}),a.jsx("td",{children:e.producto}),a.jsx("td",{children:e.eta})]},e.id))})]})]})}function X6(){if(document.getElementById("multiStopMapCss"))return;const n=document.createElement("style");n.id="multiStopMapCss",n.innerHTML=`
    .multi-stop-map-container { 
      height: 100vh; 
      width: 100%; 
      position: relative; 
      background: #f8fafc; 
    }
    
    .map-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .map-title {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin: 0;
    }
    
    .order-info {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 14px;
      color: #6b7280;
    }
    
    .stops-sidebar {
      position: absolute;
      left: 20px;
      top: 100px;
      bottom: 20px;
      width: 320px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar-header {
      padding: 16px 20px;
      background: #6366f1;
      color: white;
      font-weight: 600;
      font-size: 16px;
    }
    
    .stops-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .stop-item {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .stop-item:hover {
      background: #f1f5f9;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .stop-item.completed {
      background: #d1fae5;
      border-color: #10b981;
    }
    
    .stop-item.current {
      background: #fef3c7;
      border-color: #f59e0b;
      box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }
    
    .stop-number {
      position: absolute;
      top: -8px;
      left: -8px;
      background: #6366f1;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      border: 2px solid white;
    }
    
    .stop-number.completed {
      background: #10b981;
    }
    
    .stop-number.current {
      background: #f59e0b;
    }
    
    .stop-type {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 500;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .stop-address {
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
      font-size: 14px;
    }
    
    .stop-contact {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .stop-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    
    .btn-stop {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .btn-complete {
      background: #10b981;
      color: white;
    }
    
    .btn-complete:hover {
      background: #059669;
    }
    
    .btn-navigate {
      background: #3b82f6;
      color: white;
    }
    
    .btn-navigate:hover {
      background: #2563eb;
    }
    
    .btn-call {
      background: #8b5cf6;
      color: white;
    }
    
    .btn-call:hover {
      background: #7c3aed;
    }
    
    .btn-completed {
      background: #6b7280;
      color: white;
      cursor: not-allowed;
    }
    
    .leaflet-container {
      margin-top: 80px;
      height: calc(100vh - 80px);
    }
    
    .route-progress {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .progress-bar {
      width: 200px;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #06d6a0);
      transition: width 0.3s ease;
    }
    
    .progress-text {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }
  `,document.head.appendChild(n)}const J6=(n,e,t)=>{let r="#6366f1";t==="completed"?r="#10b981":t==="current"&&(r="#f59e0b");const l=e==="pickup"?"📦":"🚚";return na.divIcon({className:"stop-marker",html:`
      <div style="
        background: ${r};
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        font-weight: bold;
      ">
        ${n}
      </div>
      <div style="
        position: absolute;
        top: -8px;
        right: -8px;
        font-size: 12px;
        background: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid ${r};
      ">
        ${l}
      </div>
    `,iconSize:[36,36],iconAnchor:[18,36],popupAnchor:[0,-36]})},e4=new na.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]});function Fy(){X6();const{id:n}=Su(),e=rr();if(!Qn())return e("/login"),null;const[r,l]=E.useState(null),[u,f]=E.useState(0),[y,_]=E.useState(null),[v,w]=E.useState(!0),[R,I]=E.useState("");E.useEffect(()=>{if(!n)return;const P=Kt(gt(ze,"ordenes",n),M=>{if(M.exists()){const D={id:M.id,...M.data()};l(D);const U=D.stops||[],k=U.findIndex(q=>q.estado!=="completed");f(k>=0?k:U.length-1)}else I("Orden no encontrada");w(!1)});return()=>P()},[n]),E.useEffect(()=>{if(!r?.mensajeroId)return;const P=en(Bt(ze,"ubicacionesMensajeros"),Nt("usuarioId","==",r.mensajeroId)),M=Kt(P,D=>{if(!D.empty){const U=D.docs[0].data();_({lat:U.lat,lng:U.lng,timestamp:U.timestamp})}});return()=>M()},[r?.mensajeroId]);const G=async P=>{if(r)try{const M=[...r.stops];M[P]={...M[P],estado:"completed",fechaCompletado:new Date().toISOString()},await mr(gt(ze,"ordenes",r.id),{stops:M}),M.every(U=>U.estado==="completed")&&await mr(gt(ze,"ordenes",r.id),{estado:"completado",fechaCompletado:new Date().toISOString()})}catch(M){console.error("Error completing stop:",M),I("Error al completar la parada")}},H=P=>{if(P.addressLat&&P.addressLng){const M=`https://www.google.com/maps/dir/?api=1&destination=${P.addressLat},${P.addressLng}`;window.open(M,"_blank")}},Z=P=>{P&&window.open(`tel:${P}`,"_self")};if(v)return a.jsx("div",{style:{padding:"20px",textAlign:"center"},children:a.jsx("p",{children:"Cargando información de la entrega..."})});if(R)return a.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#ef4444"},children:[a.jsx("p",{children:R}),a.jsx("button",{onClick:()=>e(-1),style:{marginTop:"10px"},children:"Volver"})]});if(!r)return a.jsx("div",{style:{padding:"20px",textAlign:"center"},children:a.jsx("p",{children:"No se encontró la orden"})});const F=r.stops||[],Q=F.filter(P=>P.estado==="completed").length,se=F.length>0?Q/F.length*100:0,ue=F.filter(P=>P.addressLat&&P.addressLng),we=ue.length>0?ue.reduce((P,M)=>P+parseFloat(M.addressLat),0)/ue.length:-12.0464,Ce=ue.length>0?ue.reduce((P,M)=>P+parseFloat(M.addressLng),0)/ue.length:-77.0428,Ue=ue.map(P=>[parseFloat(P.addressLat),parseFloat(P.addressLng)]);return a.jsxs("div",{className:"multi-stop-map-container",children:[a.jsxs("div",{className:"map-header",children:[a.jsx("h1",{className:"map-title",children:"🗺️ Entrega Multi-Stop"}),a.jsxs("div",{className:"order-info",children:[a.jsxs("span",{children:[a.jsx("strong",{children:"Orden:"})," #",r.id]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Cliente:"})," ",r.cliente]}),a.jsxs("span",{children:[a.jsx("strong",{children:"Paradas:"})," ",Q,"/",F.length]})]})]}),a.jsxs("div",{className:"stops-sidebar",children:[a.jsx("div",{className:"sidebar-header",children:"📋 Lista de Paradas"}),a.jsx("div",{className:"stops-list",children:F.map((P,M)=>{const D=P.estado==="completed",U=M===u&&!D;return a.jsxs("div",{className:`stop-item ${D?"completed":""} ${U?"current":""}`,children:[a.jsx("div",{className:`stop-number ${D?"completed":""} ${U?"current":""}`,children:M+1}),a.jsx("div",{className:"stop-type",children:P.tipo==="pickup"?"📦 Recogida":"🚚 Entrega"}),a.jsx("div",{className:"stop-address",children:P.direccionTexto}),P.contacto&&a.jsxs("div",{className:"stop-contact",children:["👤 ",P.contacto,P.telefonoContacto&&` • 📞 ${P.telefonoContacto}`]}),P.instrucciones&&a.jsxs("div",{className:"stop-contact",children:["💬 ",P.instrucciones]}),a.jsx("div",{className:"stop-actions",children:D?a.jsx("button",{className:"btn-stop btn-completed",children:"✅ Completado"}):a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-stop btn-complete",onClick:()=>G(M),children:"✅ Completar"}),P.addressLat&&P.addressLng&&a.jsx("button",{className:"btn-stop btn-navigate",onClick:()=>H(P),children:"🧭 Navegar"}),P.telefonoContacto&&a.jsx("button",{className:"btn-stop btn-call",onClick:()=>Z(P.telefonoContacto),children:"📞 Llamar"})]})})]},M)})})]}),a.jsxs(ku,{center:[we,Ce],zoom:13,style:{height:"100%",width:"100%"},children:[a.jsx(Ou,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Ue.length>1&&a.jsx(Sp,{positions:Ue,color:"#6366f1",weight:4,opacity:.7,dashArray:"10, 10"}),ue.map((P,M)=>{const D=P.estado==="completed",U=M===u&&!D;let k="pending";return D?k="completed":U&&(k="current"),a.jsx(ks,{position:[parseFloat(P.addressLat),parseFloat(P.addressLng)],icon:J6(M+1,P.tipo,k),children:a.jsx(Sa,{children:a.jsxs("div",{style:{minWidth:"200px"},children:[a.jsxs("h3",{style:{margin:"0 0 8px 0",fontSize:"14px"},children:["Parada ",M+1," - ",P.tipo==="pickup"?"📦 Recogida":"🚚 Entrega"]}),a.jsxs("p",{style:{margin:"4px 0",fontSize:"12px"},children:[a.jsx("strong",{children:"Dirección:"}),a.jsx("br",{}),P.direccionTexto]}),P.contacto&&a.jsxs("p",{style:{margin:"4px 0",fontSize:"12px"},children:[a.jsx("strong",{children:"Contacto:"})," ",P.contacto]}),P.telefonoContacto&&a.jsxs("p",{style:{margin:"4px 0",fontSize:"12px"},children:[a.jsx("strong",{children:"Teléfono:"})," ",P.telefonoContacto]}),P.instrucciones&&a.jsxs("p",{style:{margin:"4px 0",fontSize:"12px"},children:[a.jsx("strong",{children:"Instrucciones:"}),a.jsx("br",{}),P.instrucciones]}),a.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:"12px",fontWeight:"bold"},children:["Estado: ",D?"✅ Completado":U?"📍 Actual":"⏳ Pendiente"]})]})})},M)}),y&&a.jsx(ks,{position:[y.lat,y.lng],icon:e4,children:a.jsx(Sa,{children:a.jsxs("div",{children:[a.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"14px"},children:"🚚 Ubicación del Mensajero"}),a.jsxs("p",{style:{margin:"0",fontSize:"12px"},children:["Última actualización: ",y.timestamp?new Date(y.timestamp.toDate()).toLocaleTimeString():"Desconocida"]})]})})})]}),a.jsxs("div",{className:"route-progress",children:[a.jsxs("div",{className:"progress-text",children:["Progreso: ",Q,"/",F.length]}),a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${se}%`}})}),a.jsxs("div",{className:"progress-text",children:[Math.round(se),"%"]})]})]})}function t4(n=""){return n.normalize("NFKD").replace(/[\u0300-\u036f]/g,"")}function Kl(n){const e=String(n||"").trim(),t=t4(e).toLowerCase();return["administrador","admin","administrator"].includes(t)?"administrador":["operador","operator"].includes(t)?"operador":["gerente","manager"].includes(t)?"gerente":["mensajero","rider","courier","delivery","deliveryman","repartidor"].includes(t)?"mensajero":t||"mensajero"}function mE(){const n=E.useMemo(()=>{try{return JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{return null}},[]),e=n?.empresaId||null,r=Kl(n?.rol)==="administrador",[l,u]=E.useState(""),[f,y]=E.useState(""),[_,v]=E.useState("operador"),[w,R]=E.useState(!1),[I,G]=E.useState(""),[H,Z]=E.useState(""),[F,Q]=E.useState([]),[se,ue]=E.useState({administradores:0,operadores:0,gerentes:0,mensajeros:0}),we=cl(hu,"adminCreateUser"),Ce=cl(hu,"adminDeleteUser");E.useEffect(()=>{if(!e)return;const U=en(Bt(ze,"usuarios"),Nt("empresaId","==",e)),k=Kt(U,q=>{const j=q.docs.map(ae=>({id:ae.id,...ae.data()}));Q(j);const de={administradores:0,operadores:0,gerentes:0,mensajeros:0};for(const ae of j){const Y=Kl(ae.rol);Y==="administrador"?de.administradores++:Y==="operador"?de.operadores++:Y==="gerente"?de.gerentes++:de.mensajeros++}ue(de)},q=>{console.error("onSnapshot(usuarios) ->",q),Z(q?.message||"No pude cargar los usuarios.")});return()=>k()},[e]);async function Ue(){if(G(""),Z(""),w)return;if(!e)return Z("Debes iniciar sesión como administrador.");if(!r)return Z("Solo el administrador puede crear usuarios.");const U=String(l||"").trim().toLowerCase();if(!U||!U.includes("@"))return Z("Correo inválido.");const k=(String(f||"").trim()||U.split("@")[0]).slice(0,80),q=Kl(_);R(!0);try{const j={email:U,nombre:k,rol:q,role:q,empresaId:String(e)};console.log("adminCreateUser payload ->",j);const ae=(await we(j))?.data?.resetLink||"";if(ae)try{await navigator.clipboard.writeText(ae)}catch{}G(ae?"Usuario creado ✅. Enlace de restablecer contraseña copiado.":"Usuario creado ✅. (No se pudo copiar el enlace)."),u(""),y(""),v("operador")}catch(j){const de={code:j?.code,message:j?.message,details:j?.details,raw:j};console.error("adminCreateUser error ->",de);const ae=j?.code||"",Y=j?.message||"No se pudo crear el usuario.",ye=typeof j?.details=="string"?` Detalles: ${j.details}`:"";Z(`${ae?`[${ae}] `:""}${Y}${ye}`)}finally{R(!1)}}function P(U){const k=Kl(U);return k==="administrador"?"administradores":k==="operador"||k==="gerente"?"operadores":"mensajeros"}async function M(U){const k=gt(ze,"empresas",e),q=gt(ze,"usuarios",U.id),j=P(U.rol);await HO(ze,async de=>{const ae=await de.get(k);if(!ae.exists())throw new Error("Empresa no existe.");const Y=ae.data()?.usoActual||{},ye=Number(Y[j]||0),ie=ye>0?ye-1:0;de.delete(q),de.update(k,{[`usoActual.${j}`]:ie,updatedAt:new Date})})}async function D(U){if(G(""),Z(""),!r)return alert("Solo el administrador puede eliminar miembros.");if(!U)return;if(U.uid&&n?.uid&&U.uid===n.uid)return alert("No puedes eliminar tu propio usuario.");if(Kl(U.rol)==="administrador"&&se.administradores<=1)return alert("No puedes eliminar el último administrador.");if(!window.confirm(`¿Eliminar a ${U.nombre||U.email||"este usuario"}?`))return;if(!(await Jr(gt(ze,"usuarios",U.id))).exists()){G("Ese usuario ya no existe (refrescado).");return}try{const ae=await Ce({uid:U.uid||null,userDocId:U.id,empresaId:e,rol:Kl(U.rol)});if(ae?.data?.ok){G("Miembro eliminado.");return}console.warn("adminDeleteUser devolvió sin ok; usando fallback…",ae?.data),await M(U),G("Miembro eliminado (fallback).")}catch(ae){console.error("adminDeleteUser error ->",ae);try{await M(U),G("Miembro eliminado (fallback).")}catch(Y){console.error("fallbackDeleteAndDecrement error ->",Y),Z(Y?.message||"No se pudo eliminar el usuario.")}}}return e?a.jsxs("div",{style:{maxWidth:800,margin:"30px auto",padding:"0 12px"},children:[a.jsx("h2",{children:"Usuarios de la empresa"}),a.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginBottom:12},children:[a.jsxs("span",{style:{padding:"6px 10px",background:"#e0d3d3ff",borderRadius:999},children:["Admins: ",a.jsx("b",{children:se.administradores})]}),a.jsxs("span",{style:{padding:"6px 10px",background:"#e0d3d3ff",borderRadius:999},children:["Operadores: ",a.jsx("b",{children:se.operadores})]}),a.jsxs("span",{style:{padding:"6px 10px",background:"#e0d3d3ff",borderRadius:999},children:["Gerentes: ",a.jsx("b",{children:se.gerentes})]}),a.jsxs("span",{style:{padding:"6px 10px",background:"#e0d3d3ff",borderRadius:999},children:["Mensajeros: ",a.jsx("b",{children:se.mensajeros})]})]}),a.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:"1fr 1fr 180px 140px"},children:[a.jsx("input",{placeholder:"Email del usuario",value:l,onChange:U=>u(U.target.value),onKeyDown:U=>U.key==="Enter"&&Ue()}),a.jsx("input",{placeholder:"Nombre (opcional)",value:f,onChange:U=>y(U.target.value),onKeyDown:U=>U.key==="Enter"&&Ue()}),a.jsxs("select",{value:_,onChange:U=>v(U.target.value),children:[a.jsx("option",{value:"operador",children:"Operador"}),a.jsx("option",{value:"gerente",children:"Gerente"}),a.jsx("option",{value:"mensajero",children:"Mensajero"}),r&&a.jsx("option",{value:"administrador",children:"Administrador"})]}),a.jsx("button",{onClick:Ue,disabled:w||!l,children:w?"Creando...":"Crear usuario"})]}),H&&a.jsx("div",{style:{color:"#b91c1c",marginTop:10},children:H}),I&&a.jsx("div",{style:{color:"#065f46",marginTop:10},children:I}),a.jsx("h3",{style:{marginTop:20},children:"Miembros"}),!F.length&&a.jsx("div",{style:{color:"#6b7280"},children:"No hay usuarios todavía."}),!!F.length&&a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:8},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #ffffffff",padding:"8px 6px"},children:"Nombre"}),a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 6px"},children:"Correo"}),a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 6px"},children:"Rol"}),a.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 6px"},children:"Acciones"})]})}),a.jsx("tbody",{children:F.map(U=>a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"8px 6px"},children:U.nombre||"—"}),a.jsx("td",{style:{padding:"8px 6px"},children:U.email||"—"}),a.jsx("td",{style:{padding:"8px 6px"},children:Kl(U.rol)}),a.jsx("td",{style:{padding:"8px 6px"},children:r&&a.jsx("button",{type:"button",onClick:()=>D(U),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #b91c1c",background:"#b72424ff",color:"#ffffffff",cursor:"pointer"},title:"Eliminar miembro",children:"Eliminar"})})]},U.id))})]})]}):a.jsx("div",{style:{padding:20},children:"Debes iniciar sesión como administrador."})}const n4="ordenes";function ul(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const e=new Date(n).getTime();if(Number.isFinite(e))return e}}catch{}return NaN}function Uj(n){if(typeof n!="string")return NaN;const e=n.trim(),t=new Date(e).getTime();if(Number.isFinite(t))return t;let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{4})\/(\d{2})\/(\d{2})$/),r){const l=new Date(`${r[1]}-${r[2]}-${r[3]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})-(\d{2})-(\d{4})$/),r){const l=new Date(`${r[3]}-${r[2]}-${r[1]}T12:00:00`).getTime();if(Number.isFinite(l))return l}if(r=e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/),r){const l=new Date(`${r[3]}-${r[1]}-${r[2]}T12:00:00`).getTime();if(Number.isFinite(l))return l}return NaN}function Tm(n){const e=(n?.fecha||"").trim(),t=(n?.hora||"").trim();if(!e)return NaN;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){const r=/^\d{2}:\d{2}$/.test(t)?t:"00:00",l=new Date(`${e}T${r}:00`).getTime();return Number.isFinite(l)?l:NaN}return Uj(e)}function Qc(n,e){const t=ul(n),r=ul(e);return Number.isFinite(t)&&Number.isFinite(r)?(t-r)/6e4:null}function Xc(n){return Number.isFinite(n)?`${n.toFixed(1)} min`:"—"}function Wl(n,e){return e?`${(n/e*100).toFixed(1)}%`:"—"}function Fj(n,e){return e==="creacion"?ul(n?.createdAt):e==="programada"?Tm(n):e==="entrega"?ul(n?.fechaEntregada):NaN}function pE(n,e){const t=ul(n?.createdAt);if(Number.isFinite(t))return t;const r=Fj(n,e);return Number.isFinite(r)?r:0}function Vd(n,e){if(!e?.length)return;const t=Object.keys(e[0]),r=[t.join(","),...e.map(y=>t.map(_=>`"${String(y[_]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(l),f=document.createElement("a");f.href=u,f.download=n,f.click(),URL.revokeObjectURL(u)}const kn={textAlign:"left",borderBottom:"1px solid #eee",padding:"8px 10px",background:"#fafafa"},Vi={borderBottom:"1px solid #f2f2f2",padding:"8px 10px"},Kr={...Vi,textAlign:"center"};function zy(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}String(n?.rol||"").toLowerCase();const e=n?.empresaId!=null&&n?.empresaId!==""?String(n.empresaId):null;if(!e)return a.jsx("div",{style:{padding:16,color:"#b00"},children:"Falta empresaId en sesión."});const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1).toISOString().slice(0,10),[l,u]=E.useState(r),[f,y]=E.useState(t.toISOString().slice(0,10)),[_,v]=E.useState("creacion"),[w,R]=E.useState(!1),[I,G]=E.useState(!1),[H,Z]=E.useState(""),[F,Q]=E.useState(""),[se,ue]=E.useState(""),[we,Ce]=E.useState(15),[Ue,P]=E.useState([]),[M,D]=E.useState(!1),[U,k]=E.useState(""),[q,j]=E.useState({fromCache:!1,pendingLocal:0,total:0});E.useEffect(()=>{if(!e)return;let K=[],le=!1,Re=null;return(async()=>{if(D(!0),k(""),!await Qn()){k("Sesión inválida."),D(!1);return}const Je=Bt(ze,n4),Ze=new Map,Ct=ft=>{le=!0,Re&&(clearTimeout(Re),Re=null),ft.docs.forEach(pn=>Ze.set(pn.id,{id:pn.id,...pn.data(),__pending:pn.metadata.hasPendingWrites===!0}));const Wt=Array.from(Ze.values()),Hn=Wt.reduce((pn,qn)=>pn+(qn.__pending?1:0),0);j({fromCache:ft.metadata.fromCache,pendingLocal:Hn,total:Wt.length}),P(Wt.map(({__pending:pn,...qn})=>qn)),D(!1)},Ot=ft=>{k(ft?.message||"No pude leer órdenes."),D(!1)};try{const ft=en(Je,Nt("empresaId","==",String(e)));K.push(Kt(ft,{includeMetadataChanges:!0},Ct,Ot))}catch(ft){console.error("ordenes empresaId:string",ft?.message)}const Ke=Number(e);if(!Number.isNaN(Ke))try{const ft=en(Je,Nt("empresaId","==",Ke));K.push(Kt(ft,{includeMetadataChanges:!0},Ct,Ot))}catch(ft){console.error("ordenes empresaId:number",ft?.message)}Re=setTimeout(()=>{le||(D(!1),k(ft=>ft||"No llegó ningún snapshot (conexión/reglas)."))},6e3)})(),()=>{K.forEach(Ge=>Ge&&Ge()),Re&&clearTimeout(Re)}},[e]);const de=E.useMemo(()=>{const K=new Set;for(const le of Ue)le.asignadoNombre&&K.add(String(le.asignadoNombre));return Array.from(K).sort((le,Re)=>le.localeCompare(Re))},[Ue]),ae=E.useMemo(()=>{const K=new Set;for(const le of Ue)le.usuario&&K.add(String(le.usuario));return Array.from(K).sort((le,Re)=>le.localeCompare(Re))},[Ue]),Y=E.useMemo(()=>{const K=new Date(l);K.setHours(0,0,0,0);const le=new Date(f);le.setHours(23,59,59,999);const Re=K.getTime(),Ge=le.getTime();let Je=Ue.filter(Ze=>{let Ct=Fj(Ze,_);if(!Number.isFinite(Ct)&&_==="programada"){const Ot=Uj(Ze?.fecha);Number.isFinite(Ot)&&(Ct=Ot)}return Number.isFinite(Ct)?Ct>=Re&&Ct<=Ge:!0});if(w&&(Je=Je.filter(Ze=>Ze.entregado)),I&&(Je=Je.filter(Ze=>!!(Ze?.proofUrl||Array.isArray(Ze?.fotosPodUrls)&&Ze.fotosPodUrls.length>0))),H&&(Je=Je.filter(Ze=>(Ze.asignadoNombre||"")===H)),F&&(Je=Je.filter(Ze=>(Ze.usuario||"")===F)),se.trim()){const Ze=se.trim().toLowerCase();Je=Je.filter(Ct=>String(Ct.zona||"").toLowerCase().includes(Ze))}return Je.sort((Ze,Ct)=>pE(Ct,_)-pE(Ze,_)),Je},[Ue,l,f,_,w,I,H,F,se]),ye=(Number.isFinite(we)?we:15)*6e4,ie=E.useMemo(()=>{let K=0,le=0,Re=0,Ge=0,Je=0;for(const Ze of Y){K+=1,Ze.entregado&&(le+=1);const Ct=Qc(Ze.fechaEntregada,Ze.createdAt);Number.isFinite(Ct)&&(Re+=Ct,Ge+=1);const Ot=Tm(Ze),Ke=ul(Ze.fechaEntregada);Ze.entregado&&Number.isFinite(Ot)&&Number.isFinite(Ke)&&Ke<=Ot+ye&&Je++}return{total:K,entregadas:le,pendientes:K-le,promTotal:Ge?Re/Ge:null,onTime:Je,onTimePct:Wl(Je,le||0)}},[Y,ye]),be=E.useMemo(()=>{const K={};for(const le of Y){const Re=le.usuario||"—";K[Re]=K[Re]||{operador:Re,total:0,entregadas:0,sumTot:0,nTot:0,onTime:0},K[Re].total+=1,le.entregado&&(K[Re].entregadas+=1);const Ge=Qc(le.fechaEntregada,le.createdAt);Number.isFinite(Ge)&&(K[Re].sumTot+=Ge,K[Re].nTot+=1);const Je=Tm(le),Ze=ul(le.fechaEntregada);le.entregado&&Number.isFinite(Je)&&Number.isFinite(Ze)&&Ze<=Je+ye&&(K[Re].onTime+=1)}return Object.values(K).map(le=>({...le,promTotal:le.nTot?le.sumTot/le.nTot:null,onTimePct:Wl(le.onTime,le.entregadas||0),tasaExito:Wl(le.entregadas,le.total||0)})).sort((le,Re)=>Re.entregadas-le.entregadas||Re.total-le.total)},[Y,ye]),A=E.useMemo(()=>{const K={};for(const le of Y){const Re=le.asignadoNombre||le.asignadoUid||"—";K[Re]=K[Re]||{mensajero:Re,total:0,entregadas:0,sumTot:0,nTot:0,onTime:0},K[Re].total+=1,le.entregado&&(K[Re].entregadas+=1);const Ge=Qc(le.fechaEntregada,le.createdAt);Number.isFinite(Ge)&&(K[Re].sumTot+=Ge,K[Re].nTot+=1);const Je=Tm(le),Ze=ul(le.fechaEntregada);le.entregado&&Number.isFinite(Je)&&Number.isFinite(Ze)&&Ze<=Je+ye&&(K[Re].onTime+=1)}return Object.values(K).map(le=>({...le,promTotal:le.nTot?le.sumTot/le.nTot:null,onTimePct:Wl(le.onTime,le.entregadas||0),tasaExito:Wl(le.entregadas,le.total||0)})).sort((le,Re)=>Re.entregadas-le.entregadas||Re.total-le.total)},[Y,ye]),W=E.useMemo(()=>{const K={};for(const le of Y){const Re=le.cliente||"—";K[Re]=K[Re]||{cliente:Re,total:0,entregadas:0,sumTot:0,nTot:0},K[Re].total+=1,le.entregado&&(K[Re].entregadas+=1);const Ge=Qc(le.fechaEntregada,le.createdAt);Number.isFinite(Ge)&&(K[Re].sumTot+=Ge,K[Re].nTot+=1)}return Object.values(K).map(le=>({...le,promTotal:le.nTot?le.sumTot/le.nTot:null,tasaExito:Wl(le.entregadas,le.total||0)})).sort((le,Re)=>Re.total-le.total)},[Y]),$=E.useMemo(()=>{const K={};for(const le of Y){const Re=le.zona||"—";K[Re]=K[Re]||{zona:Re,total:0,entregadas:0,sumTot:0,nTot:0},K[Re].total+=1,le.entregado&&(K[Re].entregadas+=1);const Ge=Qc(le.fechaEntregada,le.createdAt);Number.isFinite(Ge)&&(K[Re].sumTot+=Ge,K[Re].nTot+=1)}return Object.values(K).map(le=>({...le,promTotal:le.nTot?le.sumTot/le.nTot:null,tasaExito:Wl(le.entregadas,le.total||0)})).sort((le,Re)=>Re.total-le.total)},[Y]),te=E.useMemo(()=>{const K=[];for(const le of Y){const Re=Qc(le.fechaEntregada,le.createdAt);Number.isFinite(Re)&&K.push({id:le.id,cliente:le.cliente||"",factura:le.numeroFactura||"",mensajero:le.asignadoNombre||"",operador:le.usuario||"",min_total:Re})}return K.sort((le,Re)=>Re.min_total-le.min_total).slice(0,50)},[Y]),me={desde:l,hasta:f,tipoFecha:_,soloEntregadas:w,soloConPod:I,mensajeroSel:H,operadorSel:F,zonaFiltro:se},J=()=>Vd(`rep_operadores_${l}_a_${f}.csv`,be.map(K=>({operador:K.operador,total:K.total,entregadas:K.entregadas,prom_min_total:K.promTotal?.toFixed(1)||"",on_time_pct:K.onTimePct,tasa_exito:K.tasaExito,...me}))),oe=()=>Vd(`rep_mensajeros_${l}_a_${f}.csv`,A.map(K=>({mensajero:K.mensajero,total:K.total,entregadas:K.entregadas,prom_min_total:K.promTotal?.toFixed(1)||"",on_time_pct:K.onTimePct,tasa_exito:K.tasaExito,...me}))),re=()=>Vd(`rep_clientes_${l}_a_${f}.csv`,W.map(K=>({cliente:K.cliente,total:K.total,entregadas:K.entregadas,prom_min_total:K.promTotal?.toFixed(1)||"",tasa_exito:K.tasaExito,...me}))),he=()=>Vd(`rep_zonas_${l}_a_${f}.csv`,$.map(K=>({zona:K.zona,total:K.total,entregadas:K.entregadas,prom_min_total:K.promTotal?.toFixed(1)||"",tasa_exito:K.tasaExito,...me}))),Ae=()=>Vd(`rep_top_atrasos_${l}_a_${f}.csv`,te.map(K=>({orderId:K.id,cliente:K.cliente,factura:K.factura,mensajero:K.mensajero,operador:K.operador,min_total:K.min_total.toFixed(1),...me})));return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsx("h2",{style:{margin:0},children:"📑 Reportes"}),a.jsxs("div",{style:{marginLeft:"auto",fontSize:12,color:"#555"},children:["cache: ",a.jsx("code",{children:String(q.fromCache)})," · pendientes: ",a.jsx("code",{children:q.pendingLocal})," · docs: ",a.jsx("code",{children:q.total})]})]}),U&&a.jsx("div",{style:{marginTop:8,color:"#b00"},children:U}),M&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),a.jsxs("section",{style:Yl,children:[a.jsx("h3",{style:{marginTop:0},children:"Filtros"}),a.jsxs("div",{className:"grid3",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Desde"}),a.jsx("input",{type:"date",value:l,onChange:K=>u(K.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Hasta"}),a.jsx("input",{type:"date",value:f,onChange:K=>y(K.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tipo de fecha"}),a.jsxs("select",{value:_,onChange:K=>v(K.target.value),children:[a.jsx("option",{value:"creacion",children:"Creación"}),a.jsx("option",{value:"programada",children:"Programada (fecha/hora)"}),a.jsx("option",{value:"entrega",children:"Entrega"})]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Mensajero"}),a.jsxs("select",{value:H,onChange:K=>Z(K.target.value),children:[a.jsx("option",{value:"",children:"(Todos)"}),de.map(K=>a.jsx("option",{value:K,children:K},K))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Operador (quien crea)"}),a.jsxs("select",{value:F,onChange:K=>Q(K.target.value),children:[a.jsx("option",{value:"",children:"(Todos)"}),ae.map(K=>a.jsx("option",{value:K,children:K},K))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Zona"}),a.jsx("input",{value:se,onChange:K=>ue(K.target.value),placeholder:"Centro / Norte / ..."})]}),a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:w,onChange:K=>R(K.target.checked)})," Solo entregadas"]}),a.jsxs("label",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:I,onChange:K=>G(K.target.checked)})," Solo con POD"]}),a.jsxs("div",{children:[a.jsx("label",{children:"Tolerancia on-time (min)"}),a.jsx("input",{type:"number",value:we,onChange:K=>Ce(Number(K.target.value)||0)})]})]})]}),a.jsxs("section",{style:Yl,children:[a.jsx("h3",{style:{marginTop:0},children:"Resumen"}),a.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[a.jsx(Ud,{label:"Órdenes (rango)",value:ie.total}),a.jsx(Ud,{label:"Entregadas",value:ie.entregadas}),a.jsx(Ud,{label:"Pendientes",value:ie.pendientes}),a.jsx(Ud,{label:"Prom. total",value:Xc(ie.promTotal)}),a.jsx(Ud,{label:"On-time (entregadas)",value:`${ie.onTime} (${ie.onTimePct})`})]})]}),a.jsxs("section",{style:Yl,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Por operador (quien creó la orden)"}),a.jsx("button",{style:{marginLeft:"auto"},onClick:J,disabled:!be.length,children:"⬇️ Exportar"})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:kn,children:"Operador"}),a.jsx("th",{style:kn,children:"Órdenes"}),a.jsx("th",{style:kn,children:"Entregadas"}),a.jsx("th",{style:kn,children:"Tasa éxito"}),a.jsx("th",{style:kn,children:"Prom. total"}),a.jsx("th",{style:kn,children:"On-time %"})]})}),a.jsx("tbody",{children:be.length?be.map(K=>a.jsxs("tr",{children:[a.jsx("td",{style:Vi,children:K.operador}),a.jsx("td",{style:Kr,children:K.total}),a.jsx("td",{style:Kr,children:K.entregadas}),a.jsx("td",{style:Kr,children:K.tasaExito}),a.jsx("td",{style:Vi,children:Xc(K.promTotal)}),a.jsx("td",{style:Kr,children:K.onTimePct})]},K.operador)):a.jsx("tr",{children:a.jsx("td",{colSpan:6,style:Vi,children:"Sin datos."})})})]})})]}),a.jsxs("section",{style:Yl,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Por mensajero"}),a.jsx("button",{style:{marginLeft:"auto"},onClick:oe,disabled:!A.length,children:"⬇️ Exportar"})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:kn,children:"Mensajero"}),a.jsx("th",{style:kn,children:"Órdenes"}),a.jsx("th",{style:kn,children:"Entregadas"}),a.jsx("th",{style:kn,children:"Tasa éxito"}),a.jsx("th",{style:kn,children:"Prom. total"}),a.jsx("th",{style:kn,children:"On-time %"})]})}),a.jsx("tbody",{children:A.length?A.map(K=>a.jsxs("tr",{children:[a.jsx("td",{style:Vi,children:K.mensajero}),a.jsx("td",{style:Kr,children:K.total}),a.jsx("td",{style:Kr,children:K.entregadas}),a.jsx("td",{style:Kr,children:K.tasaExito}),a.jsx("td",{style:Vi,children:Xc(K.promTotal)}),a.jsx("td",{style:Kr,children:K.onTimePct})]},K.mensajero)):a.jsx("tr",{children:a.jsx("td",{colSpan:6,style:Vi,children:"Sin datos."})})})]})})]}),a.jsxs("section",{style:Yl,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Por cliente"}),a.jsx("button",{style:{marginLeft:"auto"},onClick:re,disabled:!W.length,children:"⬇️ Exportar"})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:kn,children:"Cliente"}),a.jsx("th",{style:kn,children:"Órdenes"}),a.jsx("th",{style:kn,children:"Entregadas"}),a.jsx("th",{style:kn,children:"Tasa éxito"}),a.jsx("th",{style:kn,children:"Prom. total"})]})}),a.jsx("tbody",{children:W.length?W.map(K=>a.jsxs("tr",{children:[a.jsx("td",{style:Vi,children:K.cliente}),a.jsx("td",{style:Kr,children:K.total}),a.jsx("td",{style:Kr,children:K.entregadas}),a.jsx("td",{style:Kr,children:K.tasaExito}),a.jsx("td",{style:Vi,children:Xc(K.promTotal)})]},K.cliente)):a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:Vi,children:"Sin datos."})})})]})})]}),a.jsxs("section",{style:Yl,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Por zona"}),a.jsx("button",{style:{marginLeft:"auto"},onClick:he,disabled:!$.length,children:"⬇️ Exportar"})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:kn,children:"Zona"}),a.jsx("th",{style:kn,children:"Órdenes"}),a.jsx("th",{style:kn,children:"Entregadas"}),a.jsx("th",{style:kn,children:"Tasa éxito"}),a.jsx("th",{style:kn,children:"Prom. total"})]})}),a.jsx("tbody",{children:$.length?$.map(K=>a.jsxs("tr",{children:[a.jsx("td",{style:Vi,children:K.zona}),a.jsx("td",{style:Kr,children:K.total}),a.jsx("td",{style:Kr,children:K.entregadas}),a.jsx("td",{style:Kr,children:K.tasaExito}),a.jsx("td",{style:Vi,children:Xc(K.promTotal)})]},K.zona)):a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:Vi,children:"Sin datos."})})})]})})]}),a.jsxs("section",{style:Yl,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Top atrasos (tiempo total más alto)"}),a.jsx("button",{style:{marginLeft:"auto"},onClick:Ae,disabled:!te.length,children:"⬇️ Exportar"})]}),a.jsx("div",{style:{overflowX:"auto"},children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:kn,children:"Orden"}),a.jsx("th",{style:kn,children:"Cliente"}),a.jsx("th",{style:kn,children:"Factura"}),a.jsx("th",{style:kn,children:"Mensajero"}),a.jsx("th",{style:kn,children:"Operador"}),a.jsx("th",{style:kn,children:"Tiempo total"})]})}),a.jsx("tbody",{children:te.length?te.map(K=>a.jsxs("tr",{children:[a.jsx("td",{style:Vi,children:a.jsxs("code",{children:[K.id.slice(0,8),"…"]})}),a.jsx("td",{style:Vi,children:K.cliente}),a.jsx("td",{style:Vi,children:K.factura}),a.jsx("td",{style:Vi,children:K.mensajero}),a.jsx("td",{style:Vi,children:K.operador}),a.jsx("td",{style:Vi,children:Xc(K.min_total)})]},K.id)):a.jsx("tr",{children:a.jsx("td",{colSpan:6,style:Vi,children:"Sin datos."})})})]})})]}),a.jsxs("div",{style:{marginTop:16,fontSize:12,color:"#666"},children:["* “Operador” se toma del campo ",a.jsx("code",{children:"usuario"})," de la orden (quien la creó). “On-time” evalúa (entrega ≤ programada + tolerancia)."]})]})}function Ud({label:n,value:e}){return a.jsxs("div",{style:{border:"1px dashed #ddd",borderRadius:10,padding:"8px 10px",minWidth:160},children:[a.jsx("div",{style:{fontSize:12,color:"#666"},children:n}),a.jsx("div",{style:{fontSize:18,fontWeight:700},children:e})]})}const Yl={marginTop:12,padding:12,border:"1px solid #eee",borderRadius:10,background:"#fff"},zj=document.createElement("style");zj.innerHTML=`
  .grid3 {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(3, minmax(220px, 1fr));
  }
  input, select { padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; }
  table { font-size: 14px; }
`;document.head.appendChild(zj);function i4(n=new Date){const e=new Date(n);return e.setHours(0,0,0,0),e.toISOString().slice(0,10)}function pa(n){try{if(!n)return NaN;if(typeof n?.toDate=="function")return n.toDate().getTime();if(typeof n?.seconds=="number")return n.seconds*1e3+Math.floor((n.nanoseconds||0)/1e6);if(n instanceof Date)return n.getTime();if(typeof n=="number")return n;if(typeof n=="string"){const e=new Date(n).getTime();if(Number.isFinite(e))return e}}catch{}return NaN}function Jc(n){const e=(n?.fecha||"").trim(),t=(n?.hora||"").trim();if(!e)return NaN;const r=/^\d{2}:\d{2}$/.test(t)?t:"00:00",l=new Date(`${e}T${r}:00`).getTime();return Number.isFinite(l)?l:NaN}function r4(n,e){const t=pa(n),r=pa(e);return Number.isFinite(t)&&Number.isFinite(r)?(t-r)/6e4:null}function s4(n){return Number.isFinite(n)?`${n.toFixed(1)} min`:"—"}function gE(n,e){return e?`${(n/e*100).toFixed(0)}%`:"—"}function a4(n,e){return Number.isFinite(n)&&Number.isFinite(e)?`https://waze.com/ul?ll=${n},${e}&navigate=yes`:null}function o4(n,e){return Number.isFinite(n)&&Number.isFinite(e)?`https://www.google.com/maps?q=${n},${e}`:null}function cm(n){const e=n?.address?.lat??n?.destinoLat,t=n?.address?.lng??n?.destinoLng;return Number.isFinite(Number(e))&&Number.isFinite(Number(t))}function yE(n=2,e=.1,t=880,r=220,l=120){const u=window.AudioContext||window.webkitAudioContext;if(!u)return;const f=new u;let y=f.currentTime+.01;for(let _=0;_<n;_++){const v=f.createOscillator(),w=f.createGain();v.type="sine",v.frequency.value=t,w.gain.value=e,v.connect(w),w.connect(f.destination),v.start(y),v.stop(y+r/1e3),y+=(r+l)/1e3}setTimeout(()=>f.close().catch(()=>{}),n*(r+l)+300)}try{if(!document.getElementById("slaCss")){const n=document.createElement("style");n.id="slaCss",n.innerHTML=`
      .card{margin-top:12px;padding:12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
      .kpis{display:flex;gap:12px;flex-wrap:wrap}
      .kpi{border:1px dashed #e2e8f0;border-radius:10px;padding:8px 10px;min-width:140px}
      .kpi .lbl{font-size:12px;color:#64748b}
      .kpi .val{font-size:18px;font-weight:700}
      .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f8fafc;color:#374151;font-size:12px;font-weight:600;line-height:1}
      .pill.blue{background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
      .pill.green{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}
      .pill.gray{background:#f1f5f9;border-color:#e2e8f0;color:#334155}
      .pill.orange{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
      .pill.red{background:#fee2e2;border-color:#fecaca;color:#991b1b}
      .btn{border:1px solid #e5e7eb;border-radius:10px;background:#fff;padding:6px 10px;cursor:pointer;color:#334155;text-decoration:none;display:inline-flex;align-items:center;gap:6px}
      .btn:hover{background:#f8fafc}
      .btn:disabled{opacity:.6;cursor:not-allowed}
      .btn.primary{background:#6366f1;color:#fff;border-color:#6366f1}
      .btn.primary:hover{filter:brightness(.96)}
      .hstack{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
      .stretch{margin-left:auto}
      table.tbl{width:100%;border-collapse:collapse;font-size:13px}
      table.tbl thead th{position:sticky;top:0;background:#fafafa;border-bottom:1px solid #eee;text-align:left;padding:6px 8px;z-index:1}
      table.tbl td{border-bottom:1px solid #f2f2f2;padding:6px 8px}
      table.tbl tbody tr:nth-child(odd) td{background:#fbfdff}
      table.tbl tbody tr:hover td{background:#eef2ff}
      .row-crit td{background:#fff5f5 !important}
      .row-warn td{background:#fff7ed !important}
      .muted{color:#64748b}
      .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
      .chips{display:flex;gap:8px;flex-wrap:wrap}
      .range-pills{display:flex;gap:6px;flex-wrap:wrap}
    `,document.head.appendChild(n)}}catch{}function By(){let n=null;try{n=JSON.parse(localStorage.getItem("usuarioActivo")||"null")}catch{}const e=n?.empresaId?String(n.empresaId):null;if(!e)return a.jsx("div",{style:{padding:16,color:"#b00"},children:"Falta empresaId en sesión."});const t=i4(),[r,l]=E.useState(t),[u,f]=E.useState(t),[y,_]=E.useState(15),[v,w]=E.useState(30),[R,I]=E.useState(3),[G,H]=E.useState(!1),[Z,F]=E.useState(!1),[Q,se]=E.useState(!1),[ue,we]=E.useState(!1),[Ce,Ue]=E.useState([]),[P,M]=E.useState(!1),[D,U]=E.useState(""),[k,q]=E.useState(null),[j,de]=E.useState(Date.now());E.useEffect(()=>{const re=setInterval(()=>de(Date.now()),15e3);return()=>clearInterval(re)},[]),E.useEffect(()=>{if(!e)return;const re=gt(ze,"ajustesEmpresa",e),he=Kt(re,Ae=>{const K=Ae.data();K?.alertas&&(Number.isFinite(K.alertas?.toleranciaMin)&&_(K.alertas.toleranciaMin),Number.isFinite(K.alertas?.porVencerMin)&&w(K.alertas.porVencerMin),Number.isFinite(K.alertas?.umbralCriticas)&&I(K.alertas.umbralCriticas),typeof K.alertas?.muteDefault=="boolean"&&H(!!K.alertas.muteDefault),K.alertas?.canales&&q(K.alertas.canales))});return()=>he()},[e]),E.useEffect(()=>{if(!e)return;let re=null;return(async()=>{if(M(!0),U(""),!await Qn()){U("Sesión inválida."),M(!1);return}try{const Ae=Bt(ze,"ordenes"),K=en(Ae,Nt("empresaId","==",e),Fr("createdAt","desc"));re=Kt(K,le=>{const Re=le.docs.map(Ge=>({id:Ge.id,...Ge.data()}));Ue(Re),M(!1)},le=>{U(le?.message||"No pude leer órdenes."),M(!1)})}catch(Ae){U(Ae?.message||"No pude iniciar suscripción."),M(!1)}})(),()=>re&&re()},[e]);const ae=E.useMemo(()=>{const re=new Date(r);re.setHours(0,0,0,0);const he=new Date(u);he.setHours(23,59,59,999);const Ae=re.getTime(),K=he.getTime(),le=(Number.isFinite(y)?y:15)*6e4,Re=(Number.isFinite(v)?v:30)*6e4,Ge=Number.isFinite(R)?R:3,Je=Ce.filter(kt=>{const yt=pa(kt.createdAt);if(Number.isFinite(yt))return yt>=Ae&&yt<=K;const ct=Jc(kt);return Number.isFinite(ct)?ct>=Ae&&ct<=K:!0}),Ze=[],Ct=[],Ot=[],Ke=[];let ft=Je.length,Wt=0,Hn=0,pn=0,qn=0;for(const kt of Je){const yt=Jc(kt),ct=Number.isFinite(yt)?yt+le-j:null,$t=r4(kt.fechaEntregada,kt.createdAt);if(Number.isFinite($t)&&(pn+=$t,qn++),kt.entregado){Wt++;const Ln=pa(kt.fechaEntregada);Number.isFinite(yt)&&Number.isFinite(Ln)&&Ln<=yt+le?(Hn++,Ke.push(kt)):Ot.push(kt)}else if(ct!=null&&ct<0){const Ln=Math.abs(Math.round(ct/6e4));Ze.push({o:kt,rem:ct,muyCritica:Ln>=Ge*60})}else ct!=null&&ct<=Re&&Ct.push({o:kt,rem:ct})}Ze.sort((kt,yt)=>kt.rem-yt.rem),Ct.sort((kt,yt)=>kt.rem-yt.rem),Ot.sort((kt,yt)=>{const ct=pa(kt.fechaEntregada)-(Jc(kt)+le);return pa(yt.fechaEntregada)-(Jc(yt)+le)-ct});const gr=Ze.filter(kt=>kt.muyCritica).length;return{tot:ft,ent:Wt,pend:ft-Wt,onTime:Hn,onTimePct:gE(Hn,Wt||0),avgTot:qn?pn/qn:null,criticas:Ze,porVencer:Ct,fueraSLAEntregadas:Ot,aTiempoEntregadas:Ke,muyCriticasCount:gr,enRangoCount:Je.length}},[Ce,r,u,y,v,R,j]),Y=E.useRef(0);E.useEffect(()=>{const re=ae.criticas.length;!G&&re>Y.current&&yE(3,.12,880,220,120),Y.current=re},[ae.criticas.length,G]);async function ye(){try{await mi(gt(ze,"ajustesEmpresa",e),{alertas:{toleranciaMin:Number(y)||0,porVencerMin:Number(v)||0,umbralCriticas:Number(R)||0,muteDefault:!!G,updatedAt:new Date().toISOString()}},{merge:!0}),alert("Ajustes guardados ✅")}catch(re){alert(re?.message||"No pude guardar ajustes.")}}function ie(re,he){if(!he?.length)return;const Ae=Object.keys(he[0]),K=[Ae.join(","),...he.map(Je=>Ae.map(Ze=>`"${String(Je[Ze]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),le=new Blob([K],{type:"text/csv;charset=utf-8;"}),Re=URL.createObjectURL(le),Ge=document.createElement("a");Ge.href=Re,Ge.download=re,Ge.click(),URL.revokeObjectURL(Re)}function be(){const re=(Ae,K)=>({tipo:K,orderId:Ae.o.id,cliente:Ae.o.cliente||"",factura:Ae.o.numeroFactura||"",fecha:Ae.o.fecha||"",hora:Ae.o.hora||"",minutos_restantes:Math.round((Ae.rem||0)/6e4),asignado:Ae.o.asignadoNombre||"",zona:Ae.o.zona||"",direccion:Ae.o.direccionTexto||Ae.o.address?.formatted||""}),he=[...ae.criticas.map(Ae=>re(Ae,Ae.muyCritica?"CRITICA++":"CRITICA")),...ae.porVencer.map(Ae=>re(Ae,"POR_VENCER"))];ie(`alertas_pendientes_${r}_a_${u}.csv`,he)}function A(){const re=(Number.isFinite(y)?y:15)*6e4,he=ae.fueraSLAEntregadas.map(Ae=>{const K=Jc(Ae),le=pa(Ae.fechaEntregada),Re=Number.isFinite(K)&&Number.isFinite(le)?Math.round((le-(K+re))/6e4):"";return{orderId:Ae.id,cliente:Ae.cliente||"",factura:Ae.numeroFactura||"",fecha:Ae.fecha||"",hora:Ae.hora||"",entregada_at:Ae.fechaEntregada?new Date(pa(Ae.fechaEntregada)).toLocaleString():"",retraso_min:Re,asignado:Ae.asignadoNombre||"",zona:Ae.zona||"",direccion:Ae.direccionTexto||Ae.address?.formatted||""}});ie(`alertas_fuera_sla_${r}_a_${u}.csv`,he)}const W=E.useMemo(()=>{let re=[...ae.criticas.map(he=>({...he,__tipo:he.muyCritica?"CRITICA++":"CRITICA"})),...ae.porVencer.map(he=>({...he,__tipo:"POR_VENCER"}))];return Z&&(re=re.filter(he=>he.__tipo.startsWith("CRITICA"))),Q&&(re=re.filter(he=>he.__tipo==="POR_VENCER")),re},[ae.criticas,ae.porVencer,Z,Q]),$=E.useMemo(()=>ue?ae.fueraSLAEntregadas:ae.fueraSLAEntregadas.slice(0,1e3),[ae.fueraSLAEntregadas,ue]);function te(re){const he=new Date,Ae=K=>{const le=new Date(K);return le.setHours(0,0,0,0),le.toISOString().slice(0,10)};if(re==="hoy"){const K=Ae(he);l(K),f(K);return}if(re==="ult7"){const K=new Date(he);K.setDate(K.getDate()-6),l(Ae(K)),f(Ae(he));return}if(re==="mes"){const K=new Date(he.getFullYear(),he.getMonth(),1);l(Ae(K)),f(Ae(he));return}if(re==="todo"){l("2000-01-01"),f(Ae(he));return}}async function me(){try{const re=k?.webhook;if(!re?.enabled)return alert("Webhook deshabilitado.");if(!re?.url)return alert("Falta URL del webhook.");const he={"Content-Type":"application/json",...re.headers||{}},Ae={type:"test",empresaId:e,timestamp:new Date().toISOString(),resumen:{porVencer:ae.porVencer.length,criticas:ae.criticas.length,muyCriticas:ae.muyCriticasCount}},K=await fetch(re.url,{method:"POST",headers:he,body:JSON.stringify(Ae)});alert(`Webhook → ${K.status}`)}catch(re){alert(re?.message||"No pude probar el webhook.")}}async function J(){try{const re=k?.telegram;if(!re?.enabled)return alert("Telegram deshabilitado.");if(!re?.botToken||!re?.chatId)return alert("Faltan botToken/chatId.");const he=`https://api.telegram.org/bot${re.botToken}/sendMessage`,Ae=`✅ Prueba de alertas
Empresa: ${e}
Criticas: ${ae.criticas.length} (Muy: ${ae.muyCriticasCount})
Por vencer: ${ae.porVencer.length}`,le=await(await fetch(he,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:re.chatId,text:Ae})})).json();if(!le.ok)throw new Error(JSON.stringify(le));alert("Telegram OK")}catch(re){alert(re?.message||"No pude enviar a Telegram.")}}function oe(re){return re==null?a.jsx("span",{className:"pill gray",children:"—"}):re<=0?a.jsx("span",{className:"pill red",children:"Vencida"}):re<=(Number(v)||30)*6e4?a.jsx("span",{className:"pill orange",children:"Por vencer"}):a.jsx("span",{className:"pill green",children:"En tiempo"})}return a.jsxs("div",{style:{padding:16},children:[a.jsxs("div",{className:"hstack",children:[a.jsx("h2",{style:{margin:0},children:"📣 Centro de Alertas SLA"}),a.jsxs("div",{className:"stretch hstack",children:[a.jsx("label",{children:"Desde"}),a.jsx("input",{type:"date",value:r,onChange:re=>l(re.target.value)}),a.jsx("label",{children:"Hasta"}),a.jsx("input",{type:"date",value:u,onChange:re=>f(re.target.value)}),a.jsxs("div",{className:"range-pills",children:[a.jsx("button",{className:"btn",onClick:()=>te("hoy"),children:"Hoy"}),a.jsx("button",{className:"btn",onClick:()=>te("ult7"),children:"Últ. 7 días"}),a.jsx("button",{className:"btn",onClick:()=>te("mes"),children:"Este mes"}),a.jsx("button",{className:"btn",onClick:()=>te("todo"),children:"Todo"}),a.jsxs("span",{className:"pill gray",children:["En rango: ",a.jsx("b",{children:ae.enRangoCount})]})]})]})]}),a.jsxs("div",{className:"hstack",style:{marginTop:8},children:[a.jsx("label",{children:"Tolerancia on-time (min)"}),a.jsx("input",{type:"number",value:y,onChange:re=>_(Number(re.target.value)||0),style:{width:80}}),a.jsx("label",{children:"Ventana “por vencer” (min)"}),a.jsx("input",{type:"number",value:v,onChange:re=>w(Number(re.target.value)||0),style:{width:80}}),a.jsx("label",{children:"Umbral críticas (h)"}),a.jsx("input",{type:"number",value:R,onChange:re=>I(Number(re.target.value)||0),style:{width:80}}),a.jsx("button",{className:"btn",onClick:()=>H(re=>!re),title:G?"Silenciado":"Sonar al subir críticas",children:G?"🔕":"🔔"}),a.jsx("button",{className:"btn",onClick:()=>yE(2),children:"Probar sonido ▶️"}),a.jsx("button",{className:"btn primary",onClick:ye,children:"Guardar predeterminado 💾"})]}),D&&a.jsx("div",{style:{marginTop:8,color:"#b00"},children:D}),P&&a.jsx("div",{style:{marginTop:8},children:"Cargando…"}),a.jsxs("div",{className:"kpis",style:{marginTop:12},children:[a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Órdenes (rango)"}),a.jsx("div",{className:"val",children:ae.tot})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Entregadas"}),a.jsxs("div",{className:"val",children:[ae.ent," (",gE(ae.ent,ae.tot||0),")"]})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Pendientes"}),a.jsx("div",{className:"val",children:ae.pend})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"On-time (entregadas)"}),a.jsxs("div",{className:"val",children:[ae.onTime," (",ae.onTimePct,")"]})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Prom. total"}),a.jsx("div",{className:"val",children:s4(ae.avgTot)})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Críticas"}),a.jsx("div",{className:"val",children:ae.criticas.length})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Muy críticas"}),a.jsx("div",{className:"val",children:ae.muyCriticasCount})]}),a.jsxs("div",{className:"kpi",children:[a.jsx("div",{className:"lbl",children:"Por vencer"}),a.jsx("div",{className:"val",children:ae.porVencer.length})]}),a.jsx("div",{className:"stretch",style:{alignSelf:"center",color:"#64748b"},children:new Date(j).toLocaleTimeString()})]}),k&&a.jsxs("section",{className:"card",children:[a.jsx("h3",{style:{margin:0},children:"Canales"}),a.jsxs("div",{className:"hstack",children:[a.jsxs("span",{children:["Webhook: ",a.jsx("b",{children:k?.webhook?.enabled?"ON":"OFF"})]}),a.jsxs("span",{children:["Telegram: ",a.jsx("b",{children:k?.telegram?.enabled?"ON":"OFF"})]}),k?.webhook?.enabled&&a.jsx("button",{className:"btn",onClick:me,children:"🔗 Probar webhook"}),k?.telegram?.enabled&&a.jsx("button",{className:"btn",onClick:J,children:"💬 Probar Telegram"})]}),a.jsxs("div",{style:{marginTop:6},className:"muted",children:["* En producción, enviar Telegram desde Cloud Function para no exponer el ",a.jsx("code",{children:"botToken"}),"."]})]}),a.jsxs("section",{className:"card",children:[a.jsxs("div",{className:"hstack",children:[a.jsx("h3",{style:{margin:0},children:"Pendientes con alerta"}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:Z,onChange:re=>{F(re.target.checked),re.target.checked&&se(!1)}})," Solo críticas"]}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:re=>{se(re.target.checked),re.target.checked&&F(!1)}})," Solo por vencer"]}),a.jsx("button",{className:"btn",onClick:be,style:{marginLeft:"auto"},children:"⬇️ Exportar CSV"})]}),a.jsx("div",{style:{marginTop:8,overflowX:"auto"},children:W.length?a.jsxs("table",{className:"tbl",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Tipo"}),a.jsx("th",{children:"Cliente"}),a.jsx("th",{children:"Factura"}),a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Hora"}),a.jsx("th",{children:"SLA"}),a.jsx("th",{children:"Asignado"}),a.jsx("th",{children:"Zona"}),a.jsx("th",{children:"Dirección"}),a.jsx("th",{children:"Mapa"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:W.map(re=>{const he=re.o,Ae=re.__tipo.startsWith("CRITICA"),K=he?.address?.lat??he?.destinoLat,le=he?.address?.lng??he?.destinoLng,Re=re.rem??null,Ge=Ae?"row-crit":"row-warn";return a.jsxs("tr",{className:Ge,children:[a.jsx("td",{children:re.__tipo==="POR_VENCER"?a.jsx("span",{className:"pill orange",children:"⏳ Por vencer"}):re.__tipo==="CRITICA++"?a.jsx("span",{className:"pill red",children:"🛑 Crítica++"}):a.jsx("span",{className:"pill red",children:"🔴 Crítica"})}),a.jsx("td",{style:{minWidth:160},children:he.cliente||"—"}),a.jsx("td",{children:he.numeroFactura||"—"}),a.jsx("td",{children:he.fecha||"—"}),a.jsx("td",{children:he.hora||"—"}),a.jsx("td",{children:oe(Re)}),a.jsx("td",{children:he.asignadoNombre||"—"}),a.jsx("td",{children:he.zona||"—"}),a.jsx("td",{style:{minWidth:220},children:he.direccionTexto||he.address?.formatted||"—"}),a.jsx("td",{children:Number.isFinite(K)&&Number.isFinite(le)?a.jsxs(a.Fragment,{children:[a.jsx("a",{className:"btn",href:a4(K,le),target:"_blank",rel:"noreferrer",children:"Waze"})," ",a.jsx("a",{className:"btn",href:o4(K,le),target:"_blank",rel:"noreferrer",children:"Maps"})]}):a.jsx("span",{className:"muted",children:"—"})}),a.jsx("td",{children:a.jsxs("div",{className:"chips",children:[a.jsx(Zt,{className:"btn",to:`/orden/${he.id}`,children:"Ver orden"}),a.jsx(Zt,{className:"btn",to:`/mapa/${he.id}`,"aria-disabled":!cm(he),onClick:Je=>{cm(he)||Je.preventDefault()},children:"Ver mapa"})]})})]},he.id)})})]}):a.jsx("div",{className:"muted",children:"Sin pendientes con alerta para el rango."})})]}),a.jsxs("section",{className:"card",children:[a.jsxs("div",{className:"hstack",children:[a.jsx("h3",{style:{margin:0},children:"Entregadas fuera de SLA"}),a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:ue,onChange:re=>we(re.target.checked)})," Mostrar todas"]}),a.jsx("button",{className:"btn",onClick:A,style:{marginLeft:"auto"},children:"⬇️ Exportar CSV"})]}),a.jsx("div",{style:{marginTop:8,overflowX:"auto"},children:$.length?a.jsxs("table",{className:"tbl",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Cliente"}),a.jsx("th",{children:"Factura"}),a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Hora"}),a.jsx("th",{children:"Entregada"}),a.jsx("th",{children:"Retraso"}),a.jsx("th",{children:"Asignado"}),a.jsx("th",{children:"Zona"}),a.jsx("th",{children:"Dirección"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:$.map(re=>{const he=(Number.isFinite(y)?y:15)*6e4,Ae=Jc(re),K=pa(re.fechaEntregada),le=Number.isFinite(Ae)&&Number.isFinite(K)?Math.max(0,Math.round((K-(Ae+he))/6e4)):null;return a.jsxs("tr",{children:[a.jsx("td",{style:{minWidth:160},children:re.cliente||"—"}),a.jsx("td",{children:re.numeroFactura||"—"}),a.jsx("td",{children:re.fecha||"—"}),a.jsx("td",{children:re.hora||"—"}),a.jsx("td",{children:re.fechaEntregada?new Date(pa(re.fechaEntregada)).toLocaleString():"—"}),a.jsx("td",{className:"mono",style:{color:"#b91c1c",fontWeight:700},children:le!=null?`${le} min`:"—"}),a.jsx("td",{children:re.asignadoNombre||"—"}),a.jsx("td",{children:re.zona||"—"}),a.jsx("td",{style:{minWidth:220},children:re.direccionTexto||re.address?.formatted||"—"}),a.jsx("td",{children:a.jsxs("div",{className:"chips",children:[a.jsx(Zt,{className:"btn",to:`/orden/${re.id}`,children:"Ver orden"}),a.jsx(Zt,{className:"btn",to:`/mapa/${re.id}`,"aria-disabled":!cm(re),onClick:Re=>{cm(re)||Re.preventDefault()},children:"Ver mapa"})]})})]},re.id)})})]}):a.jsx("div",{className:"muted",children:"No hubo entregas fuera de SLA en el rango."})})]})]})}function l4(n){const e=String(n||"").trim().toLowerCase();return{admin:"administrador",administrador:"administrador",administrator:"administrador",operador:"operador",operator:"operador",mensajero:"mensajero",rider:"mensajero",courier:"mensajero",delivery:"mensajero",deliveryman:"mensajero",repartidor:"mensajero",gerente:"gerente",manager:"gerente"}[e]||e}function c4(){const n=es(),e=rr(),[t,r]=E.useState(()=>{try{const _=localStorage.getItem("usuarioActivo");return _?JSON.parse(_):null}catch{return null}});E.useEffect(()=>{const _=v=>{if(v.key==="usuarioActivo")try{const w=localStorage.getItem("usuarioActivo");r(w?JSON.parse(w):null)}catch{r(null)}};return window.addEventListener("storage",_),()=>window.removeEventListener("storage",_)},[]);const l=E.useMemo(()=>l4(t?.rol),[t?.rol]),u=n.pathname||"/",f=u==="/"||u==="/login"||u==="/crear-empresa"||u==="/planes-publicos"||u==="/registro-empresa"||u==="/registro-agente"||u==="/reclamar-token"||u.startsWith("/aceptar-invitacion"),y=!!t&&!f;return a.jsxs(a.Fragment,{children:[y&&a.jsx(jL,{}),a.jsxs(eC,{children:[a.jsx(Xe,{path:"/",element:a.jsx(IL,{onLogin:()=>e("/login"),onRegister:()=>e("/registro-empresa"),onDemo:()=>e("/planes-publicos")})}),a.jsx(Xe,{path:"/login",element:a.jsx(CL,{})}),a.jsx(Xe,{path:"/planes-publicos",element:a.jsx(HL,{})}),a.jsx(Xe,{path:"/crear-empresa",element:a.jsx(qL,{})}),a.jsx(Xe,{path:"/registro-empresa",element:a.jsx(kL,{})}),a.jsx(Xe,{path:"/registro-agente",element:a.jsx(OL,{})}),a.jsx(Xe,{path:"/aceptar-invitacion/:token",element:a.jsx(FL,{})}),a.jsx(Xe,{path:"/reclamar-token",element:a.jsx(zL,{})}),!t&&a.jsx(Xe,{path:"*",element:a.jsx(Ws,{to:"/",replace:!0})}),t&&l==="administrador"&&a.jsxs(a.Fragment,{children:[a.jsx(Xe,{path:"/dashboard",element:a.jsx(jy,{})}),a.jsx(Xe,{path:"/estadisticas",element:a.jsx(Ow,{})}),a.jsx(Xe,{path:"/estadisticas-operador",element:a.jsx(Uw,{})}),a.jsx(Xe,{path:"/ordenes",element:a.jsx(My,{})}),a.jsx(Xe,{path:"/orden/:id",element:a.jsx(em,{})}),a.jsx(Xe,{path:"/mapa/:id",element:a.jsx(Ld,{})}),a.jsx(Xe,{path:"/mapa-multi-stop/:id",element:a.jsx(Fy,{})}),a.jsx(Xe,{path:"/mapa-mensajeros",element:a.jsx(Ld,{})}),a.jsx(Xe,{path:"/seleccionar-destino/:id",element:a.jsx(lm,{})}),a.jsx(Xe,{path:"/historial",element:a.jsx(Qw,{})}),a.jsx(Xe,{path:"/reportes",element:a.jsx(zy,{})}),a.jsx(Xe,{path:"/eta",element:a.jsx(fE,{})}),a.jsx(Xe,{path:"/ruta",element:a.jsx(iE,{})}),a.jsx(Xe,{path:"/ruta-mensajero/:id",element:a.jsx(im,{})}),a.jsx(Xe,{path:"/programas",element:a.jsx(nE,{})}),a.jsx(Xe,{path:"/seguimiento-rutas",element:a.jsx(Uy,{})}),a.jsx(Xe,{path:"/seguimiento",element:a.jsx(Ws,{to:"/seguimiento-rutas",replace:!0})}),a.jsx(Xe,{path:"/alertas-sla",element:a.jsx(By,{})}),a.jsx(Xe,{path:"/alertas",element:a.jsx(Ws,{to:"/alertas-sla",replace:!0})}),a.jsx(Xe,{path:"/planes",element:a.jsx(UL,{})}),a.jsx(Xe,{path:"/equipo",element:a.jsx(mE,{})}),a.jsx(Xe,{path:"*",element:a.jsx(Ws,{to:"/dashboard",replace:!0})})]}),t&&l==="gerente"&&a.jsxs(a.Fragment,{children:[a.jsx(Xe,{path:"/dashboard",element:a.jsx(jy,{})}),a.jsx(Xe,{path:"/estadisticas",element:a.jsx(Ow,{})}),a.jsx(Xe,{path:"/estadisticas-operador",element:a.jsx(Uw,{})}),a.jsx(Xe,{path:"/ordenes",element:a.jsx(My,{})}),a.jsx(Xe,{path:"/orden/:id",element:a.jsx(em,{})}),a.jsx(Xe,{path:"/mapa/:id",element:a.jsx(Ld,{})}),a.jsx(Xe,{path:"/mapa-multi-stop/:id",element:a.jsx(Fy,{})}),a.jsx(Xe,{path:"/mapa-mensajeros",element:a.jsx(Ld,{})}),a.jsx(Xe,{path:"/seleccionar-destino/:id",element:a.jsx(lm,{})}),a.jsx(Xe,{path:"/historial",element:a.jsx(Qw,{})}),a.jsx(Xe,{path:"/reportes",element:a.jsx(zy,{})}),a.jsx(Xe,{path:"/eta",element:a.jsx(fE,{})}),a.jsx(Xe,{path:"/ruta",element:a.jsx(iE,{})}),a.jsx(Xe,{path:"/ruta-mensajero/:id",element:a.jsx(im,{})}),a.jsx(Xe,{path:"/seguimiento-rutas",element:a.jsx(Uy,{})}),a.jsx(Xe,{path:"/seguimiento",element:a.jsx(Ws,{to:"/seguimiento-rutas",replace:!0})}),a.jsx(Xe,{path:"/alertas-sla",element:a.jsx(By,{})}),a.jsx(Xe,{path:"/alertas",element:a.jsx(Ws,{to:"/alertas-sla",replace:!0})}),a.jsx(Xe,{path:"/equipo",element:a.jsx(mE,{})}),a.jsx(Xe,{path:"*",element:a.jsx(Ws,{to:"/dashboard",replace:!0})})]}),t&&l==="operador"&&a.jsxs(a.Fragment,{children:[a.jsx(Xe,{path:"/dashboard",element:a.jsx(jy,{})}),a.jsx(Xe,{path:"/ordenes",element:a.jsx(My,{})}),a.jsx(Xe,{path:"/orden/:id",element:a.jsx(em,{})}),a.jsx(Xe,{path:"/mapa/:id",element:a.jsx(Ld,{})}),a.jsx(Xe,{path:"/mapa-multi-stop/:id",element:a.jsx(Fy,{})}),a.jsx(Xe,{path:"/ruta-mensajero/:id",element:a.jsx(im,{})}),a.jsx(Xe,{path:"/seleccionar-destino/:id",element:a.jsx(lm,{})}),a.jsx(Xe,{path:"/reportes",element:a.jsx(zy,{})}),a.jsx(Xe,{path:"/programas",element:a.jsx(nE,{})}),a.jsx(Xe,{path:"/seguimiento-rutas",element:a.jsx(Uy,{})}),a.jsx(Xe,{path:"/seguimiento",element:a.jsx(Ws,{to:"/seguimiento-rutas",replace:!0})}),a.jsx(Xe,{path:"/alertas-sla",element:a.jsx(By,{})}),a.jsx(Xe,{path:"/alertas",element:a.jsx(Ws,{to:"/alertas-sla",replace:!0})}),a.jsx(Xe,{path:"*",element:a.jsx(Ws,{to:"/ordenes",replace:!0})})]}),t&&l==="mensajero"&&a.jsxs(a.Fragment,{children:[a.jsx(Xe,{path:"/entregas",element:a.jsx(N6,{})}),a.jsx(Xe,{path:"/orden/:id",element:a.jsx(em,{})}),a.jsx(Xe,{path:"/seleccionar-destino/:id",element:a.jsx(lm,{})}),a.jsx(Xe,{path:"/ruta-mensajero/:id",element:a.jsx(im,{})}),a.jsx(Xe,{path:"*",element:a.jsx(Ws,{to:"/entregas",replace:!0})})]}),t&&!["administrador","gerente","operador","mensajero"].includes(l)&&a.jsx(Xe,{path:"*",element:a.jsxs("div",{style:{padding:20},children:["Rol no reconocido: ",a.jsx("b",{children:String(t?.rol)}),a.jsx("br",{}),"(Normalizado: ",a.jsx("code",{children:String(l)}),"). Corrige el rol en el perfil o en el guardado de sesión."]})})]})]})}function u4(){return a.jsx(EC,{children:a.jsx(c4,{})})}uN.createRoot(document.getElementById("root")).render(a.jsx(wm.StrictMode,{children:a.jsx(u4,{})}));
